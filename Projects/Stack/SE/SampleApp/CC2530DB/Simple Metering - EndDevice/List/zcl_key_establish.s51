///////////////////////////////////////////////////////////////////////////////
//                                                                            /
// IAR C/C++ Compiler V8.20.2.41139 for 8051            13/Jun/2013  14:25:29 /
// Copyright 2004-2013 IAR Systems AB.                                        /
//                                                                            /
//    Core               =  plain                                             /
//    Code model         =  banked                                            /
//    Data model         =  large                                             /
//    Calling convention =  xdata reentrant                                   /
//    Constant location  =  data_rom                                          /
//    Dptr setup         =  1,16                                              /
//                                                                            /
//    Source file        =  C:\Users\PedroZ\Documents\GitHub\TG\Components\st /
//                          ack\zcl\zcl_key_establish.c                       /
//    Command line       =  -f C:\Users\PedroZ\Documents\GitHub\TG\Projects\S /
//                          tack\SE\SampleApp\CC2530DB\..\..\..\Tools\CC2530D /
//                          B\f8wEndev.cfg (-DCPU32MHZ -DROOT=__near_func     /
//                          -DMAC_CFG_TX_DATA_MAX=3 -DMAC_CFG_TX_MAX=6        /
//                          -DMAC_CFG_RX_MAX=3) -f C:\Users\PedroZ\Documents\ /
//                          GitHub\TG\Projects\Stack\SE\SampleApp\CC2530DB\.. /
//                          \..\..\Tools\CC2530DB\f8wConfig.cfg (-DZIGBEEPRO  /
//                          -DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR      /
//                          -DDEFAULT_CHANLIST=0x00000800                     /
//                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                      /
//                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_M /
//                          ASK=0x007F -DBEACON_REQUEST_DELAY=100             /
//                          -DBEACON_REQ_DELAY_MASK=0x00FF                    /
//                          -DLINK_STATUS_JITTER_MASK=0x007F                  /
//                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_P /
//                          OLLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7           /
//                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3   /
//                          -DNWK_MAX_DATA_RETRIES=2                          /
//                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9        /
//                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40          /
//                          -DNWK_MAX_BINDING_ENTRIES=4                       /
//                          -DMAX_BINDING_CLUSTER_IDS=4                       /
//                          "-DDEFAULT_KEY={0x01, 0x03, 0x05, 0x07, 0x09,     /
//                          0x0B, 0x0D, 0x0F, 0x00, 0x02, 0x04, 0x06, 0x08,   /
//                          0x0A, 0x0C, 0x0D}" -DMAC_MAX_FRAME_SIZE=116       /
//                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const    /
//                          __code" -DGENERIC=__generic                       /
//                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000       /
//                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100   /
//                          -DREJOIN_POLL_RATE=440) -f                        /
//                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stac /
//                          k\SE\SampleApp\CC2530DB\..\..\..\Tools\CC2530DB\f /
//                          8wZCL.cfg (-DZCL_READ -DZCL_WRITE -DZCL_BASIC     /
//                          -DZCL_IDENTIFY -DZCL_ON_OFF -DZCL_KEY_ESTABLISH   /
//                          -DZCL_KEY_ESTABLISHMENT_KEY_GENERATE_TIMEOUT=4    /
//                          -DZCL_KEY_ESTABLISHMENT_MAC_GENERATE_TIMEOUT=10   /
//                          -DZCL_KEY_ESTABLISHMENT_EKEY_GENERATE_TIMEOUT=10  /
//                          -DZCL_LOAD_CONTROL -DZCL_SIMPLE_METERING          /
//                          -DZCL_PRICING -DZCL_MESSAGE -DZCL_TUNNELING       /
//                          -DZCL_TOU) -DZCL_DEVICE_MGMT                      /
//                          C:\Users\PedroZ\Documents\GitHub\TG\Components\st /
//                          ack\zcl\zcl_key_establish.c -D TC_LINKKEY_JOIN    /
//                          -D ZTOOL_P1 -D MT_TASK -D MT_APP_FUNC -D          /
//                          MT_SYS_FUNC -D LCD_SUPPORTED -D NV_INIT -D        /
//                          xNV_RESTORE -D HOLD_AUTO_START -D NWK_AUTO_POLL   /
//                          -D ZCL_REPORT -D POWER_SAVING -D                  /
//                          MAX_POLL_FAILURE_RETRIES=20 -D TEST_CERT_DATA     /
//                          -lC "C:\Users\PedroZ\Documents\GitHub\TG\Projects /
//                          \Stack\SE\SampleApp\CC2530DB\Simple Metering -    /
//                          EndDevice\List\" -lA "C:\Users\PedroZ\Documents\G /
//                          itHub\TG\Projects\Stack\SE\SampleApp\CC2530DB\Sim /
//                          ple Metering - EndDevice\List\" --diag_suppress   /
//                          Pe001,Pa010 -o "C:\Users\PedroZ\Documents\GitHub\ /
//                          TG\Projects\Stack\SE\SampleApp\CC2530DB\Simple    /
//                          Metering - EndDevice\Obj\" -e --no_cse            /
//                          --no_unroll --no_inline --no_code_motion          /
//                          --no_tbaa --debug --core=plain --dptr=16,1        /
//                          --data_model=large --code_model=banked            /
//                          --calling_convention=xdata_reentrant              /
//                          --place_constants=data_rom --nr_virtual_regs 16   /
//                          -I C:\Users\PedroZ\Documents\GitHub\TG\Projects\S /
//                          tack\SE\SampleApp\CC2530DB\ -I                    /
//                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stac /
//                          k\SE\SampleApp\CC2530DB\..\Source\ -I             /
//                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stac /
//                          k\SE\SampleApp\CC2530DB\..\..\Source\ -I          /
//                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stac /
//                          k\SE\SampleApp\CC2530DB\..\..\..\ZMain\TI2530DB\  /
//                          -I C:\Users\PedroZ\Documents\GitHub\TG\Projects\S /
//                          tack\SE\SampleApp\CC2530DB\..\..\..\..\..\Compone /
//                          nts\hal\include\ -I C:\Users\PedroZ\Documents\Git /
//                          Hub\TG\Projects\Stack\SE\SampleApp\CC2530DB\..\.. /
//                          \..\..\..\Components\hal\target\CC2530EB\ -I      /
//                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stac /
//                          k\SE\SampleApp\CC2530DB\..\..\..\..\..\Components /
//                          \mac\include\ -I C:\Users\PedroZ\Documents\GitHub /
//                          \TG\Projects\Stack\SE\SampleApp\CC2530DB\..\..\.. /
//                          \..\..\Components\mac\high_level\ -I              /
//                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stac /
//                          k\SE\SampleApp\CC2530DB\..\..\..\..\..\Components /
//                          \mac\low_level\srf04\ -I                          /
//                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stac /
//                          k\SE\SampleApp\CC2530DB\..\..\..\..\..\Components /
//                          \mac\low_level\srf04\single_chip\ -I              /
//                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stac /
//                          k\SE\SampleApp\CC2530DB\..\..\..\..\..\Components /
//                          \mt\ -I C:\Users\PedroZ\Documents\GitHub\TG\Proje /
//                          cts\Stack\SE\SampleApp\CC2530DB\..\..\..\..\..\Co /
//                          mponents\osal\include\ -I                         /
//                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stac /
//                          k\SE\SampleApp\CC2530DB\..\..\..\..\..\Components /
//                          \services\saddr\ -I C:\Users\PedroZ\Documents\Git /
//                          Hub\TG\Projects\Stack\SE\SampleApp\CC2530DB\..\.. /
//                          \..\..\..\Components\services\sdata\ -I           /
//                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stac /
//                          k\SE\SampleApp\CC2530DB\..\..\..\..\..\Components /
//                          \stack\af\ -I C:\Users\PedroZ\Documents\GitHub\TG /
//                          \Projects\Stack\SE\SampleApp\CC2530DB\..\..\..\.. /
//                          \..\Components\stack\nwk\ -I                      /
//                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stac /
//                          k\SE\SampleApp\CC2530DB\..\..\..\..\..\Components /
//                          \stack\sapi\ -I C:\Users\PedroZ\Documents\GitHub\ /
//                          TG\Projects\Stack\SE\SampleApp\CC2530DB\..\..\..\ /
//                          ..\..\Components\stack\sec\ -I                    /
//                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stac /
//                          k\SE\SampleApp\CC2530DB\..\..\..\..\..\Components /
//                          \stack\sys\ -I C:\Users\PedroZ\Documents\GitHub\T /
//                          G\Projects\Stack\SE\SampleApp\CC2530DB\..\..\..\. /
//                          .\..\Components\stack\zcl\ -I                     /
//                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stac /
//                          k\SE\SampleApp\CC2530DB\..\..\..\..\..\Components /
//                          \stack\zdo\ -I C:\Users\PedroZ\Documents\GitHub\T /
//                          G\Projects\Stack\SE\SampleApp\CC2530DB\..\..\..\. /
//                          .\..\Components\zmac\ -I                          /
//                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stac /
//                          k\SE\SampleApp\CC2530DB\..\..\..\..\..\Components /
//                          \zmac\f8w\ -On --require_prototypes               /
//    List file          =  C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stac /
//                          k\SE\SampleApp\CC2530DB\Simple Metering -         /
//                          EndDevice\List\zcl_key_establish.s51              /
//                                                                            /
//                                                                            /
///////////////////////////////////////////////////////////////////////////////

        NAME zcl_key_establish

        RTMODEL "__SystemLibrary", "CLib"
        RTMODEL "__calling_convention", "xdata_reentrant"
        RTMODEL "__code_model", "banked"
        RTMODEL "__core", "plain"
        RTMODEL "__data_model", "large"
        RTMODEL "__dptr_size", "16"
        RTMODEL "__extended_stack", "disabled"
        RTMODEL "__location_for_constants", "data"
        RTMODEL "__number_of_dptrs", "1"
        RTMODEL "__rt_version", "1"

        RSEG DOVERLAY:DATA:NOROOT(0)
        RSEG IOVERLAY:IDATA:NOROOT(0)
        RSEG ISTACK:IDATA:NOROOT(0)
        RSEG PSTACK:XDATA:NOROOT(0)
        RSEG XSTACK:XDATA:NOROOT(0)

        EXTERN ?ALLOC_XSTACK8
        EXTERN ?BANKED_ENTER_XDATA
        EXTERN ?BANKED_LEAVE_XDATA
        EXTERN ?BDISPATCH
        EXTERN ?BRET
        EXTERN ?DEALLOC_XSTACK8
        EXTERN ?L_ADD_X
        EXTERN ?L_MOV_X
        EXTERN ?L_MUL
        EXTERN ?MOVE_LONG8_XDATA_XDATA
        EXTERN ?PUSH_XSTACK8_X_TWO
        EXTERN ?PUSH_XSTACK_I_FOUR
        EXTERN ?PUSH_XSTACK_I_ONE
        EXTERN ?PUSH_XSTACK_I_THREE
        EXTERN ?PUSH_XSTACK_I_TWO
        EXTERN ?UL_GE_X
        EXTERN ?V0
        EXTERN ?XSP
        EXTERN ?XSTACK_DISP0_8
        EXTERN __INIT_XDATA_I
        EXTERN __INIT_XDATA_Z

        FUNCTION ??zclGeneral_AddKeyEstablishRec?relay,0203H
        FUNCTION ??zclGeneral_AgeKeyEstablishRec?relay,0203H
        FUNCTION ??zclGeneral_GetKeyEstablishRecIndex?relay,0203H
        FUNCTION ??zclGeneral_GetKeyEstablishRecIndex_State?rela,0203H
        FUNCTION ??zclGeneral_InitKeyEstablishRecTable?relay,0203H
        FUNCTION ??zclGeneral_InitiateKeyEstablish_Cmd_Calculate,0203H
        FUNCTION ??zclGeneral_InitiateKeyEstablish_Rsp_Calculate,0203H
        FUNCTION ??zclGeneral_KeyEstablish_HdlInSpecificCommands,0203H
        FUNCTION ??zclGeneral_KeyEstablish_HdlIncoming?relay,0203H
        PUBLIC ??zclGeneral_KeyEstablish_Init?relay
        FUNCTION ??zclGeneral_KeyEstablish_Init?relay,0203H
        PUBLIC ??zclGeneral_KeyEstablish_InitiateKeyEstablishm
        FUNCTION ??zclGeneral_KeyEstablish_InitiateKeyEstablishm,0203H
        PUBLIC ??zclGeneral_KeyEstablish_Send_ConfirmKey?relay
        FUNCTION ??zclGeneral_KeyEstablish_Send_ConfirmKey?relay,0203H
        PUBLIC ??zclGeneral_KeyEstablish_Send_ConfirmKeyRsp?re
        FUNCTION ??zclGeneral_KeyEstablish_Send_ConfirmKeyRsp?re,0203H
        PUBLIC ??zclGeneral_KeyEstablish_Send_EphemeralDataReq
        FUNCTION ??zclGeneral_KeyEstablish_Send_EphemeralDataReq,0203H
        PUBLIC ??zclGeneral_KeyEstablish_Send_EphemeralDataRsp
        FUNCTION ??zclGeneral_KeyEstablish_Send_EphemeralDataRsp,0203H
        PUBLIC ??zclGeneral_KeyEstablish_Send_InitiateKeyEstab
        FUNCTION ??zclGeneral_KeyEstablish_Send_InitiateKeyEstab,0203H
        PUBLIC ??zclGeneral_KeyEstablish_Send_InitiateKeyEstab_1
        FUNCTION ??zclGeneral_KeyEstablish_Send_InitiateKeyEstab_1,0203H
        PUBLIC ??zclGeneral_KeyEstablish_Send_TerminateKeyEsta
        FUNCTION ??zclGeneral_KeyEstablish_Send_TerminateKeyEsta,0203H
        PUBLIC ??zclGeneral_KeyEstablishment_ECDSASign?relay
        FUNCTION ??zclGeneral_KeyEstablishment_ECDSASign?relay,0203H
        PUBLIC ??zclGeneral_KeyEstablishment_ECDSAVerify?relay
        FUNCTION ??zclGeneral_KeyEstablishment_ECDSAVerify?relay,0203H
        FUNCTION ??zclGeneral_KeyEstablishment_GenerateMAC?relay,0203H
        FUNCTION ??zclGeneral_KeyEstablishment_GetRandom?relay,0203H
        FUNCTION ??zclGeneral_KeyEstablishment_HashFunc?relay,0203H
        FUNCTION ??zclGeneral_KeyEstablishment_KeyDeriveFunction,0203H
        PUBLIC ??zclGeneral_KeyEstablishment_RegYieldCB?relay
        FUNCTION ??zclGeneral_KeyEstablishment_RegYieldCB?relay,0203H
        FUNCTION ??zclGeneral_ProcessInCmd_ConfirmKey?relay,0203H
        FUNCTION ??zclGeneral_ProcessInCmd_ConfirmKeyRsp?relay,0203H
        FUNCTION ??zclGeneral_ProcessInCmd_EphemeralDataReq?rela,0203H
        FUNCTION ??zclGeneral_ProcessInCmd_EphemeralDataRsp?rela,0203H
        FUNCTION ??zclGeneral_ProcessInCmd_InitiateKeyEstablish?,0203H
        FUNCTION ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR,0203H
        FUNCTION ??zclGeneral_ProcessInCmd_TerminateKeyEstablish,0203H
        FUNCTION ??zclGeneral_ResetKeyEstablishRec?relay,0203H
        PUBLIC ??zclKeyEstablish_event_loop?relay
        FUNCTION ??zclKeyEstablish_event_loop?relay,0203H
        PUBWEAK __Constant_11
        PUBWEAK __Constant_8
        PUBWEAK __Constant_fffffff0
        FUNCTION zclGeneral_AddKeyEstablishRec,021203H
        ARGFRAME XSTACK, 18, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME XSTACK, 18, STACK
        FUNCTION zclGeneral_AgeKeyEstablishRec,021203H
        ARGFRAME XSTACK, 14, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 1, STACK
        LOCFRAME XSTACK, 9, STACK
        FUNCTION zclGeneral_GetKeyEstablishRecIndex,0203H
        ARGFRAME XSTACK, 47, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 2, STACK
        FUNCTION zclGeneral_GetKeyEstablishRecIndex_State,0203H
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 2, STACK
        FUNCTION zclGeneral_InitKeyEstablishRecTable,021203H
        ARGFRAME XSTACK, 10, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME XSTACK, 9, STACK
        FUNCTION zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey,021203H
        ARGFRAME XSTACK, 14, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 1, STACK
        LOCFRAME XSTACK, 58, STACK
        FUNCTION zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey,021203H
        ARGFRAME XSTACK, 14, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 1, STACK
        LOCFRAME XSTACK, 75, STACK
        FUNCTION zclGeneral_KeyEstablish_HdlInSpecificCommands,021203H
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME XSTACK, 9, STACK
        FUNCTION zclGeneral_KeyEstablish_HdlIncoming,021603H
        ARGFRAME XSTACK, 0, STACK
        LOCFRAME XSTACK, 9, STACK
        PUBLIC zclGeneral_KeyEstablish_Init
        FUNCTION zclGeneral_KeyEstablish_Init,021203H
        ARGFRAME XSTACK, 0, STACK
        LOCFRAME XSTACK, 12, STACK
        PUBLIC zclGeneral_KeyEstablish_InitiateKeyEstablishment
        FUNCTION zclGeneral_KeyEstablish_InitiateKeyEstablishment,021203H
        ARGFRAME XSTACK, 0, STACK
        LOCFRAME ISTACK, 1, STACK
        LOCFRAME XSTACK, 26, STACK
        PUBLIC zclGeneral_KeyEstablish_Send_ConfirmKey
        FUNCTION zclGeneral_KeyEstablish_Send_ConfirmKey,021203H
        ARGFRAME XSTACK, 59, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME XSTACK, 27, STACK
        PUBLIC zclGeneral_KeyEstablish_Send_ConfirmKeyRsp
        FUNCTION zclGeneral_KeyEstablish_Send_ConfirmKeyRsp,021203H
        ARGFRAME XSTACK, 49, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME XSTACK, 27, STACK
        PUBLIC zclGeneral_KeyEstablish_Send_EphemeralDataReq
        FUNCTION zclGeneral_KeyEstablish_Send_EphemeralDataReq,021203H
        ARGFRAME XSTACK, 30, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME XSTACK, 27, STACK
        PUBLIC zclGeneral_KeyEstablish_Send_EphemeralDataRsp
        FUNCTION zclGeneral_KeyEstablish_Send_EphemeralDataRsp,021203H
        ARGFRAME XSTACK, 42, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME XSTACK, 27, STACK
        PUBLIC zclGeneral_KeyEstablish_Send_InitiateKeyEstablishment
        FUNCTION zclGeneral_KeyEstablish_Send_InitiateKeyEstablishment,021203H
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 1, STACK
        LOCFRAME XSTACK, 35, STACK
        PUBLIC zclGeneral_KeyEstablish_Send_InitiateKeyEstablishmentRsp
        FUNCTION zclGeneral_KeyEstablish_Send_InitiateKeyEstablishmentRsp,021203H
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 1, STACK
        LOCFRAME XSTACK, 35, STACK
        PUBLIC zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment
        FUNCTION zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment,021203H
        ARGFRAME XSTACK, 62, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 1, STACK
        LOCFRAME XSTACK, 33, STACK
        PUBLIC zclGeneral_KeyEstablishment_ECDSASign
        FUNCTION zclGeneral_KeyEstablishment_ECDSASign,021203H
        ARGFRAME XSTACK, 0, STACK
        LOCFRAME XSTACK, 48, STACK
        PUBLIC zclGeneral_KeyEstablishment_ECDSAVerify
        FUNCTION zclGeneral_KeyEstablishment_ECDSAVerify,021203H
        ARGFRAME XSTACK, 0, STACK
        LOCFRAME XSTACK, 44, STACK
        FUNCTION zclGeneral_KeyEstablishment_GenerateMAC,021203H
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 1, STACK
        LOCFRAME XSTACK, 24, STACK
        FUNCTION zclGeneral_KeyEstablishment_GetRandom,021603H
        ARGFRAME XSTACK, 4, STACK
        LOCFRAME XSTACK, 16, STACK
        FUNCTION zclGeneral_KeyEstablishment_HashFunc,021603H
        ARGFRAME XSTACK, 4, STACK
        LOCFRAME XSTACK, 24, STACK
        FUNCTION zclGeneral_KeyEstablishment_KeyDeriveFunction,021203H
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 2, STACK
        LOCFRAME XSTACK, 48, STACK
        PUBLIC zclGeneral_KeyEstablishment_RegYieldCB
        FUNCTION zclGeneral_KeyEstablishment_RegYieldCB,0203H
        ARGFRAME XSTACK, 0, STACK
        LOCFRAME ISTACK, 2, STACK
        FUNCTION zclGeneral_ProcessInCmd_ConfirmKey,021203H
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME XSTACK, 52, STACK
        FUNCTION zclGeneral_ProcessInCmd_ConfirmKeyRsp,021203H
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 1, STACK
        LOCFRAME XSTACK, 36, STACK
        FUNCTION zclGeneral_ProcessInCmd_EphemeralDataReq,021203H
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 1, STACK
        LOCFRAME XSTACK, 24, STACK
        FUNCTION zclGeneral_ProcessInCmd_EphemeralDataRsp,021203H
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME XSTACK, 20, STACK
        FUNCTION zclGeneral_ProcessInCmd_InitiateKeyEstablish,021203H
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 1, STACK
        LOCFRAME XSTACK, 24, STACK
        FUNCTION zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp,021203H
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 1, STACK
        LOCFRAME XSTACK, 33, STACK
        FUNCTION zclGeneral_ProcessInCmd_TerminateKeyEstablish,021203H
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME ISTACK, 1, STACK
        LOCFRAME XSTACK, 14, STACK
        FUNCTION zclGeneral_ResetKeyEstablishRec,021203H
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        LOCFRAME XSTACK, 14, STACK
        PUBLIC zclKeyEstablish_InClusterList
        PUBLIC zclKeyEstablish_Options
        PUBLIC zclKeyEstablish_OutClusterList
        PUBLIC zclKeyEstablish_SimpleDesc
        PUBLIC zclKeyEstablish_YieldFunc
        PUBLIC zclKeyEstablish_YieldLevel
        PUBLIC zclKeyEstablish_event_loop
        FUNCTION zclKeyEstablish_event_loop,021203H
        ARGFRAME XSTACK, 0, STACK
        LOCFRAME XSTACK, 14, STACK
        PUBLIC zclSavedPollRate
        
          CFI Names cfiNames0
          CFI StackFrame CFA_SP SP IDATA
          CFI StackFrame CFA_PSP16 PSP16 XDATA
          CFI StackFrame CFA_XSP16 XSP16 XDATA
          CFI StaticOverlayFrame CFA_IOVERLAY IOVERLAY
          CFI StaticOverlayFrame CFA_DOVERLAY DOVERLAY
          CFI Resource `PSW.CY`:1, `B.BR0`:1, `B.BR1`:1, `B.BR2`:1, `B.BR3`:1
          CFI Resource `B.BR4`:1, `B.BR5`:1, `B.BR6`:1, `B.BR7`:1, `VB.BR8`:1
          CFI Resource `VB.BR9`:1, `VB.BR10`:1, `VB.BR11`:1, `VB.BR12`:1
          CFI Resource `VB.BR13`:1, `VB.BR14`:1, `VB.BR15`:1, VB:8, B:8, A:8
          CFI Resource PSW:8, DPL0:8, DPH0:8, R0:8, R1:8, R2:8, R3:8, R4:8, R5:8
          CFI Resource R6:8, R7:8, V0:8, V1:8, V2:8, V3:8, V4:8, V5:8, V6:8, V7:8
          CFI Resource V8:8, V9:8, V10:8, V11:8, V12:8, V13:8, V14:8, V15:8, SP:8
          CFI Resource PSPH:8, PSPL:8, PSP16:16, XSPH:8, XSPL:8, XSP16:16
          CFI VirtualResource ?RET:24
          CFI Resource ?BRET_EXT:8
          CFI VirtualResource ?RET_HIGH:8, ?RET_LOW:8
          CFI ResourceParts PSP16 PSPH, PSPL
          CFI ResourceParts XSP16 XSPH, XSPL
          CFI ResourceParts ?RET ?BRET_EXT, ?RET_HIGH, ?RET_LOW
          CFI EndNames cfiNames0
        
          CFI Common cfiCommon0 Using cfiNames0
          CFI CodeAlign 1
          CFI DataAlign -1
          CFI ReturnAddress ?RET CODE
          CFI CFA_DOVERLAY Used
          CFI CFA_IOVERLAY Used
          CFI CFA_SP SP+-3
          CFI CFA_PSP16 PSP16+0
          CFI CFA_XSP16 XSP16+0
          CFI `PSW.CY` SameValue
          CFI `B.BR0` SameValue
          CFI `B.BR1` SameValue
          CFI `B.BR2` SameValue
          CFI `B.BR3` SameValue
          CFI `B.BR4` SameValue
          CFI `B.BR5` SameValue
          CFI `B.BR6` SameValue
          CFI `B.BR7` SameValue
          CFI `VB.BR8` SameValue
          CFI `VB.BR9` SameValue
          CFI `VB.BR10` SameValue
          CFI `VB.BR11` SameValue
          CFI `VB.BR12` SameValue
          CFI `VB.BR13` SameValue
          CFI `VB.BR14` SameValue
          CFI `VB.BR15` SameValue
          CFI VB SameValue
          CFI B Undefined
          CFI A Undefined
          CFI PSW SameValue
          CFI DPL0 SameValue
          CFI DPH0 SameValue
          CFI R0 Undefined
          CFI R1 Undefined
          CFI R2 Undefined
          CFI R3 Undefined
          CFI R4 Undefined
          CFI R5 Undefined
          CFI R6 SameValue
          CFI R7 SameValue
          CFI V0 SameValue
          CFI V1 SameValue
          CFI V2 SameValue
          CFI V3 SameValue
          CFI V4 SameValue
          CFI V5 SameValue
          CFI V6 SameValue
          CFI V7 SameValue
          CFI V8 SameValue
          CFI V9 SameValue
          CFI V10 SameValue
          CFI V11 SameValue
          CFI V12 SameValue
          CFI V13 SameValue
          CFI V14 SameValue
          CFI V15 SameValue
          CFI PSPH Undefined
          CFI PSPL Undefined
          CFI XSPH Undefined
          CFI XSPL Undefined
          CFI ?RET Concat
          CFI ?BRET_EXT Frame(CFA_SP, 3)
          CFI ?RET_HIGH Frame(CFA_SP, 2)
          CFI ?RET_LOW Frame(CFA_SP, 1)
          CFI EndCommon cfiCommon0
        
AddrMgrExtAddrLookup SYMBOL "AddrMgrExtAddrLookup"
??AddrMgrExtAddrLookup?relay SYMBOL "?relay", AddrMgrExtAddrLookup
NLME_GetExtAddr     SYMBOL "NLME_GetExtAddr"
??NLME_GetExtAddr?relay SYMBOL "?relay", NLME_GetExtAddr
NLME_SetPollRate    SYMBOL "NLME_SetPollRate"
??NLME_SetPollRate?relay SYMBOL "?relay", NLME_SetPollRate
SSP_GetTrueRandAES  SYMBOL "SSP_GetTrueRandAES"
??SSP_GetTrueRandAES?relay SYMBOL "?relay", SSP_GetTrueRandAES
SSP_KeyedHash       SYMBOL "SSP_KeyedHash"
??SSP_KeyedHash?relay SYMBOL "?relay", SSP_KeyedHash
SSP_MemCpyReverse   SYMBOL "SSP_MemCpyReverse"
??SSP_MemCpyReverse?relay SYMBOL "?relay", SSP_MemCpyReverse
ZDSecMgrAddLinkKey  SYMBOL "ZDSecMgrAddLinkKey"
??ZDSecMgrAddLinkKey?relay SYMBOL "?relay", ZDSecMgrAddLinkKey
ZMacGetReq          SYMBOL "ZMacGetReq"
??ZMacGetReq?relay  SYMBOL "?relay", ZMacGetReq
ZMacSetReq          SYMBOL "ZMacSetReq"
??ZMacSetReq?relay  SYMBOL "?relay", ZMacSetReq
ZSE_ECCGenerateKey  SYMBOL "ZSE_ECCGenerateKey"
??ZSE_ECCGenerateKey?relay SYMBOL "?relay", ZSE_ECCGenerateKey
ZSE_ECCKeyBitGenerate SYMBOL "ZSE_ECCKeyBitGenerate"
??ZSE_ECCKeyBitGenerate?relay SYMBOL "?relay", ZSE_ECCKeyBitGenerate
ZSE_ECDSASign       SYMBOL "ZSE_ECDSASign"
??ZSE_ECDSASign?relay SYMBOL "?relay", ZSE_ECDSASign
ZSE_ECDSAVerify     SYMBOL "ZSE_ECDSAVerify"
??ZSE_ECDSAVerify?relay SYMBOL "?relay", ZSE_ECDSAVerify
afRegister          SYMBOL "afRegister"
??afRegister?relay  SYMBOL "?relay", afRegister
osal_mem_alloc      SYMBOL "osal_mem_alloc"
??osal_mem_alloc?relay SYMBOL "?relay", osal_mem_alloc
osal_mem_free       SYMBOL "osal_mem_free"
??osal_mem_free?relay SYMBOL "?relay", osal_mem_free
osal_memcmp         SYMBOL "osal_memcmp"
??osal_memcmp?relay SYMBOL "?relay", osal_memcmp
osal_memcpy         SYMBOL "osal_memcpy"
??osal_memcpy?relay SYMBOL "?relay", osal_memcpy
osal_memset         SYMBOL "osal_memset"
??osal_memset?relay SYMBOL "?relay", osal_memset
osal_msg_allocate   SYMBOL "osal_msg_allocate"
??osal_msg_allocate?relay SYMBOL "?relay", osal_msg_allocate
osal_msg_deallocate SYMBOL "osal_msg_deallocate"
??osal_msg_deallocate?relay SYMBOL "?relay", osal_msg_deallocate
osal_msg_receive    SYMBOL "osal_msg_receive"
??osal_msg_receive?relay SYMBOL "?relay", osal_msg_receive
osal_msg_send       SYMBOL "osal_msg_send"
??osal_msg_send?relay SYMBOL "?relay", osal_msg_send
osal_nv_read        SYMBOL "osal_nv_read"
??osal_nv_read?relay SYMBOL "?relay", osal_nv_read
osal_start_reload_timer SYMBOL "osal_start_reload_timer"
??osal_start_reload_timer?relay SYMBOL "?relay", osal_start_reload_timer
osal_start_timerEx  SYMBOL "osal_start_timerEx"
??osal_start_timerEx?relay SYMBOL "?relay", osal_start_timerEx
osal_stop_timerEx   SYMBOL "osal_stop_timerEx"
??osal_stop_timerEx?relay SYMBOL "?relay", osal_stop_timerEx
sspMMOHash          SYMBOL "sspMMOHash"
??sspMMOHash?relay  SYMBOL "?relay", sspMMOHash
zcl_SendCommand     SYMBOL "zcl_SendCommand"
??zcl_SendCommand?relay SYMBOL "?relay", zcl_SendCommand
zcl_registerClusterOptionList SYMBOL "zcl_registerClusterOptionList"
??zcl_registerClusterOptionList?relay SYMBOL "?relay", zcl_registerClusterOptionList
zcl_registerPlugin  SYMBOL "zcl_registerPlugin"
??zcl_registerPlugin?relay SYMBOL "?relay", zcl_registerPlugin
zclGeneral_KeyEstablish_Init SYMBOL "zclGeneral_KeyEstablish_Init"
??zclGeneral_KeyEstablish_Init?relay SYMBOL "?relay", zclGeneral_KeyEstablish_Init
zclGeneral_KeyEstablish_InitiateKeyEstablishment SYMBOL "zclGeneral_KeyEstablish_InitiateKeyEstablishment"
??zclGeneral_KeyEstablish_InitiateKeyEstablishm SYMBOL "?relay", zclGeneral_KeyEstablish_InitiateKeyEstablishment
zclGeneral_KeyEstablish_Send_ConfirmKey SYMBOL "zclGeneral_KeyEstablish_Send_ConfirmKey"
??zclGeneral_KeyEstablish_Send_ConfirmKey?relay SYMBOL "?relay", zclGeneral_KeyEstablish_Send_ConfirmKey
zclGeneral_KeyEstablish_Send_ConfirmKeyRsp SYMBOL "zclGeneral_KeyEstablish_Send_ConfirmKeyRsp"
??zclGeneral_KeyEstablish_Send_ConfirmKeyRsp?re SYMBOL "?relay", zclGeneral_KeyEstablish_Send_ConfirmKeyRsp
zclGeneral_KeyEstablish_Send_EphemeralDataReq SYMBOL "zclGeneral_KeyEstablish_Send_EphemeralDataReq"
??zclGeneral_KeyEstablish_Send_EphemeralDataReq SYMBOL "?relay", zclGeneral_KeyEstablish_Send_EphemeralDataReq
zclGeneral_KeyEstablish_Send_EphemeralDataRsp SYMBOL "zclGeneral_KeyEstablish_Send_EphemeralDataRsp"
??zclGeneral_KeyEstablish_Send_EphemeralDataRsp SYMBOL "?relay", zclGeneral_KeyEstablish_Send_EphemeralDataRsp
zclGeneral_KeyEstablish_Send_InitiateKeyEstablishment SYMBOL "zclGeneral_KeyEstablish_Send_InitiateKeyEstablishment"
??zclGeneral_KeyEstablish_Send_InitiateKeyEstab SYMBOL "?relay", zclGeneral_KeyEstablish_Send_InitiateKeyEstablishment
zclGeneral_KeyEstablish_Send_InitiateKeyEstablishmentRsp SYMBOL "zclGeneral_KeyEstablish_Send_InitiateKeyEstablishmentRsp"
??zclGeneral_KeyEstablish_Send_InitiateKeyEstab_1 SYMBOL "?relay", zclGeneral_KeyEstablish_Send_InitiateKeyEstablishmentRsp
zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment SYMBOL "zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment"
??zclGeneral_KeyEstablish_Send_TerminateKeyEsta SYMBOL "?relay", zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment
zclGeneral_KeyEstablishment_ECDSASign SYMBOL "zclGeneral_KeyEstablishment_ECDSASign"
??zclGeneral_KeyEstablishment_ECDSASign?relay SYMBOL "?relay", zclGeneral_KeyEstablishment_ECDSASign
zclGeneral_KeyEstablishment_ECDSAVerify SYMBOL "zclGeneral_KeyEstablishment_ECDSAVerify"
??zclGeneral_KeyEstablishment_ECDSAVerify?relay SYMBOL "?relay", zclGeneral_KeyEstablishment_ECDSAVerify
zclGeneral_KeyEstablishment_RegYieldCB SYMBOL "zclGeneral_KeyEstablishment_RegYieldCB"
??zclGeneral_KeyEstablishment_RegYieldCB?relay SYMBOL "?relay", zclGeneral_KeyEstablishment_RegYieldCB
zclKeyEstablish_event_loop SYMBOL "zclKeyEstablish_event_loop"
??zclKeyEstablish_event_loop?relay SYMBOL "?relay", zclKeyEstablish_event_loop

        EXTERN ??AddrMgrExtAddrLookup?relay
        FUNCTION ??AddrMgrExtAddrLookup?relay,00H
        EXTERN ??NLME_GetExtAddr?relay
        FUNCTION ??NLME_GetExtAddr?relay,00H
        EXTERN ??NLME_SetPollRate?relay
        FUNCTION ??NLME_SetPollRate?relay,00H
        EXTERN ??SSP_GetTrueRandAES?relay
        FUNCTION ??SSP_GetTrueRandAES?relay,00H
        EXTERN ??SSP_KeyedHash?relay
        FUNCTION ??SSP_KeyedHash?relay,00H
        EXTERN ??SSP_MemCpyReverse?relay
        FUNCTION ??SSP_MemCpyReverse?relay,00H
        EXTERN ??ZDSecMgrAddLinkKey?relay
        FUNCTION ??ZDSecMgrAddLinkKey?relay,00H
        EXTERN ??ZMacGetReq?relay
        FUNCTION ??ZMacGetReq?relay,00H
        EXTERN ??ZMacSetReq?relay
        FUNCTION ??ZMacSetReq?relay,00H
        EXTERN ??ZSE_ECCGenerateKey?relay
        FUNCTION ??ZSE_ECCGenerateKey?relay,00H
        EXTERN ??ZSE_ECCKeyBitGenerate?relay
        FUNCTION ??ZSE_ECCKeyBitGenerate?relay,00H
        EXTERN ??ZSE_ECDSASign?relay
        FUNCTION ??ZSE_ECDSASign?relay,00H
        EXTERN ??ZSE_ECDSAVerify?relay
        FUNCTION ??ZSE_ECDSAVerify?relay,00H
        EXTERN ??afRegister?relay
        FUNCTION ??afRegister?relay,00H
        EXTERN ??osal_mem_alloc?relay
        FUNCTION ??osal_mem_alloc?relay,00H
        EXTERN ??osal_mem_free?relay
        FUNCTION ??osal_mem_free?relay,00H
        EXTERN ??osal_memcmp?relay
        FUNCTION ??osal_memcmp?relay,00H
        EXTERN ??osal_memcpy?relay
        FUNCTION ??osal_memcpy?relay,00H
        EXTERN ??osal_memset?relay
        FUNCTION ??osal_memset?relay,00H
        EXTERN ??osal_msg_allocate?relay
        FUNCTION ??osal_msg_allocate?relay,00H
        EXTERN ??osal_msg_deallocate?relay
        FUNCTION ??osal_msg_deallocate?relay,00H
        EXTERN ??osal_msg_receive?relay
        FUNCTION ??osal_msg_receive?relay,00H
        EXTERN ??osal_msg_send?relay
        FUNCTION ??osal_msg_send?relay,00H
        EXTERN ??osal_nv_read?relay
        FUNCTION ??osal_nv_read?relay,00H
        EXTERN ??osal_start_reload_timer?relay
        FUNCTION ??osal_start_reload_timer?relay,00H
        EXTERN ??osal_start_timerEx?relay
        FUNCTION ??osal_start_timerEx?relay,00H
        EXTERN ??osal_stop_timerEx?relay
        FUNCTION ??osal_stop_timerEx?relay,00H
        EXTERN ??sspMMOHash?relay
        FUNCTION ??sspMMOHash?relay,00H
        EXTERN ??zcl_SendCommand?relay
        FUNCTION ??zcl_SendCommand?relay,00H
        EXTERN ??zcl_registerClusterOptionList?relay
        FUNCTION ??zcl_registerClusterOptionList?relay,00H
        EXTERN ??zcl_registerPlugin?relay
        FUNCTION ??zcl_registerPlugin?relay,00H
        EXTERN AddrMgrExtAddrLookup
        FUNCTION AddrMgrExtAddrLookup,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 28, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN NLME_GetExtAddr
        FUNCTION NLME_GetExtAddr,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 22, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN NLME_SetPollRate
        FUNCTION NLME_SetPollRate,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN SSP_GetTrueRandAES
        FUNCTION SSP_GetTrueRandAES,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 16, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN SSP_KeyedHash
        FUNCTION SSP_KeyedHash,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN SSP_MemCpyReverse
        FUNCTION SSP_MemCpyReverse,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 30, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN ZDSecMgrAddLinkKey
        FUNCTION ZDSecMgrAddLinkKey,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 49, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN ZMacGetReq
        FUNCTION ZMacGetReq,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN ZMacSetReq
        FUNCTION ZMacSetReq,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN ZSE_ECCGenerateKey
        FUNCTION ZSE_ECCGenerateKey,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 26, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN ZSE_ECCKeyBitGenerate
        FUNCTION ZSE_ECCKeyBitGenerate,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 75, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN ZSE_ECDSASign
        FUNCTION ZSE_ECDSASign,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 48, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN ZSE_ECDSAVerify
        FUNCTION ZSE_ECDSAVerify,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 44, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN afRegister
        FUNCTION afRegister,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 10, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN osal_mem_alloc
        FUNCTION osal_mem_alloc,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN osal_mem_free
        FUNCTION osal_mem_free,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN osal_memcmp
        FUNCTION osal_memcmp,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 50, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN osal_memcpy
        FUNCTION osal_memcpy,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 60, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN osal_memset
        FUNCTION osal_memset,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 14, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN osal_msg_allocate
        FUNCTION osal_msg_allocate,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 31, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN osal_msg_deallocate
        FUNCTION osal_msg_deallocate,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 14, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN osal_msg_receive
        FUNCTION osal_msg_receive,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 14, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN osal_msg_send
        FUNCTION osal_msg_send,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 31, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN osal_nv_read
        FUNCTION osal_nv_read,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 61, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN osal_start_reload_timer
        FUNCTION osal_start_reload_timer,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN osal_start_timerEx
        FUNCTION osal_start_timerEx,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 16, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN osal_stop_timerEx
        FUNCTION osal_stop_timerEx,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 47, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN sspMMOHash
        FUNCTION sspMMOHash,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 48, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN zcl_SendCommand
        FUNCTION zcl_SendCommand,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 35, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN zcl_SeqNum
        EXTERN zcl_TaskID
        EXTERN zcl_registerClusterOptionList
        FUNCTION zcl_registerClusterOptionList,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 10, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN zcl_registerPlugin
        FUNCTION zcl_registerPlugin,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 12, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN zgPollRate

// C:\Users\PedroZ\Documents\GitHub\TG\Components\stack\zcl\zcl_key_establish.c
//    1 /******************************************************************************
//    2   Filename:       zcl_key_establish.c
//    3   Revised:        $Date: 2012-04-02 17:02:19 -0700 (Mon, 02 Apr 2012) $
//    4   Revision:       $Revision: 29996 $
//    5 
//    6   Description:    Zigbee Cluster Library - General Function Domain - key
//    7                   establishment cluster.
//    8                   This application receives ZCL messages and handles them
//    9                   within the ZCL layer, without passing to application.
//   10 
//   11 
//   12   Copyright 2007-2012 Texas Instruments Incorporated. All rights reserved.
//   13 
//   14   IMPORTANT: Your use of this Software is limited to those specific rights
//   15   granted under the terms of a software license agreement between the user
//   16   who downloaded the software, his/her employer (which must be your employer)
//   17   and Texas Instruments Incorporated (the "License"). You may not use this
//   18   Software unless you agree to abide by the terms of the License. The License
//   19   limits your use, and you acknowledge, that the Software may not be modified,
//   20   copied or distributed unless embedded on a Texas Instruments microcontroller
//   21   or used solely and exclusively in conjunction with a Texas Instruments radio
//   22   frequency transceiver, which is integrated into your product. Other than for
//   23   the foregoing purpose, you may not use, reproduce, copy, prepare derivative
//   24   works of, modify, distribute, perform, display or sell this Software and/or
//   25   its documentation for any purpose.
//   26 
//   27   YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
//   28   PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
//   29   INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
//   30   NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
//   31   TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
//   32   NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
//   33   LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
//   34   INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
//   35   OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
//   36   OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
//   37   (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
//   38 
//   39   Should you have any questions regarding your right to use this Software,
//   40   contact Texas Instruments Incorporated at www.TI.com.
//   41 ******************************************************************************/
//   42 
//   43 /*********************************************************************
//   44  * INCLUDES
//   45  */
//   46 #include "ZComDef.h"
//   47 #include "OSAL.h"
//   48 #include "OSAL_Nv.h"
//   49 #include "zcl.h"
//   50 #include "ZDApp.h"
//   51 #include "ssp_hash.h"
//   52 #include "AddrMgr.h"
//   53 #include "ZDSecMgr.h"
//   54 #include "APSMEDE.h"
//   55 #include "eccapi.h"
//   56 #include "zcl_key_establish.h"
//   57 #include "DebugTrace.h"
//   58 #include "se.h"
//   59 
//   60 #if defined ( INTER_PAN )
//   61   #include "stub_aps.h"
//   62 #endif
//   63 
//   64 /*********************************************************************
//   65  * MACROS
//   66  */
//   67 
//   68 /*********************************************************************
//   69  * CONSTANTS
//   70  */
//   71 
//   72 #define KEY_ESTABLISHMENT_DEVICE_VERSION      0
//   73 #define KEY_ESTABLISHMENT_FLAGS               0
//   74 #define KEY_ESTABLISHMENT_SUITE               1  // For CBKE with ECMQV
//   75 #define KEY_ESTABLISHMENT_AVG_TIMEOUT         ( 2 * ( ZCL_KEY_ESTABLISHMENT_KEY_GENERATE_TIMEOUT + \ 
//   76                                                   ZCL_KEY_ESTABLISHMENT_MAC_GENERATE_TIMEOUT ) )
//   77 
//   78 #define ZCL_KEY_ESTABLISH_DEVICE_VERSION      0
//   79 #define ZCL_KEY_ESTABLISH_FLAGS               0
//   80 
//   81 #define INVALID_TASK_ID                       0xFF
//   82 
//   83 /*********************************************************************
//   84  * TYPEDEFS
//   85  */
//   86 
//   87 /*********************************************************************
//   88  * GLOBAL VARIABLES
//   89  */
//   90 
//   91 // For debug and testing purpose, use a fixed ephermeral key pair instead
//   92 // of the randomly generated one.
//   93 #if defined (DEBUG_STATIC_ECC)
//   94 uint8 public1[22] = {
//   95     0x03, 0x06, 0xAB, 0x52, 0x06, 0x22, 0x01, 0xD9,
//   96     0x95, 0xB8, 0xB8, 0x59, 0x1F, 0x3F, 0x08, 0x6A,
//   97     0x3A, 0x2E, 0x21, 0x4D, 0x84, 0x5E
//   98   };
//   99 uint8 private1[21] = {
//  100     0x03, 0xD4, 0x8C, 0x72, 0x10, 0xDD, 0xBC, 0xC4,
//  101     0xFB, 0x2E, 0x5E, 0x7A, 0x0A, 0xA1, 0x6A, 0x0D,
//  102     0xB8, 0x95, 0x40, 0x82, 0x0B
//  103   };
//  104 uint8 public2[22] = {
//  105     0x03, 0x00, 0xE1, 0x17, 0xC8, 0x6D, 0x0E, 0x7C,
//  106     0xD1, 0x28, 0xB2, 0xF3, 0x4E, 0x90, 0x76, 0xCF,
//  107     0xF2, 0x4A, 0xF4, 0x6D, 0x72, 0x88
//  108   };
//  109 uint8 private2[21] = {
//  110     0x00, 0x13, 0xD3, 0x6D, 0xE4, 0xB1, 0xEA, 0x8E,
//  111     0x22, 0x73, 0x9C, 0x38, 0x13, 0x70, 0x82, 0x3F,
//  112     0x40, 0x4B, 0xFF, 0x88, 0x62
//  113   };
//  114 #endif
//  115 
//  116 

        RSEG XDATA_I:XDATA:NOROOT(0)
//  117 zclOptionRec_t zclKeyEstablish_Options[1] =
zclKeyEstablish_Options:
        DATA8
        DS 3
        REQUIRE `?<Initializer for zclKeyEstablish_Options>`
        REQUIRE __INIT_XDATA_I
//  118 {
//  119   {
//  120     ZCL_CLUSTER_ID_GEN_KEY_ESTABLISHMENT,
//  121     ( AF_ACK_REQUEST ),
//  122   },
//  123 };
//  124 

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA16
//  125 YieldFunc *zclKeyEstablish_YieldFunc = NULL;
zclKeyEstablish_YieldFunc:
        DS 2
        REQUIRE __INIT_XDATA_Z

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//  126 uint8 zclKeyEstablish_YieldLevel = 0;
zclKeyEstablish_YieldLevel:
        DS 1
        REQUIRE __INIT_XDATA_Z
//  127 
//  128 #if defined (NWK_AUTO_POLL)

        RSEG XDATA_I:XDATA:NOROOT(0)
//  129 uint16 zclSavedPollRate = POLL_RATE;
zclSavedPollRate:
        DATA16
        DS 2
        REQUIRE `?<Initializer for zclSavedPollRate>`
        REQUIRE __INIT_XDATA_I
//  130 #endif
//  131 
//  132 /*********************************************************************
//  133  * GLOBAL FUNCTIONS
//  134  */
//  135 extern uint8* SSP_MemCpyReverse( uint8* dst, uint8* src, unsigned int len );
//  136 
//  137 /*********************************************************************
//  138  * LOCAL VARIABLES
//  139  */
//  140 #if defined(ZCL_KEY_ESTABLISH)

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//  141 static uint8 zcl_KeyEstablishment_TaskID;    // Task ID of the key Establishment cluster
zcl_KeyEstablishment_TaskID:
        DS 1
        REQUIRE __INIT_XDATA_Z
//  142 #endif
//  143 
//  144 /*********************************************************************
//  145  * SIMPLE DESCRIPTOR
//  146  */
//  147 // This is the Cluster ID List and should be filled with Application
//  148 // specific cluster IDs.
//  149 #define ZCL_KEY_ESTABLISH_MAX_INCLUSTERS       1

        RSEG XDATA_ROM_C:CONST:REORDER:NOROOT(0)
        DATA16
//  150 const cId_t zclKeyEstablish_InClusterList[ZCL_KEY_ESTABLISH_MAX_INCLUSTERS] =
zclKeyEstablish_InClusterList:
        DW 2048
//  151 {
//  152   ZCL_CLUSTER_ID_GEN_KEY_ESTABLISHMENT,
//  153 };
//  154 
//  155 #define ZCL_KEY_ESTABLISH_MAX_OUTCLUSTERS       1

        RSEG XDATA_ROM_C:CONST:REORDER:NOROOT(0)
        DATA16
//  156 const cId_t zclKeyEstablish_OutClusterList[ZCL_KEY_ESTABLISH_MAX_OUTCLUSTERS] =
zclKeyEstablish_OutClusterList:
        DW 2048
//  157 {
//  158   ZCL_CLUSTER_ID_GEN_KEY_ESTABLISHMENT,
//  159 };
//  160 

        RSEG XDATA_I:XDATA:NOROOT(0)
//  161 SimpleDescriptionFormat_t zclKeyEstablish_SimpleDesc =
zclKeyEstablish_SimpleDesc:
        DATA8
        DS 12
        REQUIRE `?<Initializer for zclKeyEstablish_SimpleDesc>`
        REQUIRE __INIT_XDATA_I
//  162 {
//  163   ZCL_KEY_ESTABLISHMENT_ENDPOINT,          //  int Endpoint;
//  164   ZCL_SE_PROFILE_ID,                       //  uint16 AppProfId[2];
//  165   ZCL_SE_DEVICEID_PHYSICAL,                //  uint16 AppDeviceId[2];
//  166   ZCL_KEY_ESTABLISH_DEVICE_VERSION,        //  int   AppDevVer:4;
//  167   ZCL_KEY_ESTABLISH_FLAGS,                 //  int   AppFlags:4;
//  168   ZCL_KEY_ESTABLISH_MAX_INCLUSTERS,        //  byte  AppNumInClusters;
//  169   (cId_t *)zclKeyEstablish_InClusterList,  //  byte *pAppInClusterList;
//  170   ZCL_KEY_ESTABLISH_MAX_OUTCLUSTERS,       //  byte  AppNumInClusters;
//  171   (cId_t *)zclKeyEstablish_OutClusterList  //  byte *pAppInClusterList;
//  172 };
//  173 
//  174 #if defined (ZCL_KEY_ESTABLISH)
//  175 // Endpoint for Key Establishment Cluster

        RSEG XDATA_I:XDATA:NOROOT(0)
//  176 static endPointDesc_t zclKeyEstablish_Ep =
zclKeyEstablish_Ep:
        DATA8
        DS 6
        REQUIRE `?<Initializer for zclKeyEstablish_Ep>`
        REQUIRE __INIT_XDATA_I
//  177 {
//  178   ZCL_KEY_ESTABLISHMENT_ENDPOINT,                               // Test endpoint
//  179   &zcl_TaskID,
//  180   (SimpleDescriptionFormat_t *)&zclKeyEstablish_SimpleDesc,
//  181   (afNetworkLatencyReq_t)0                           // No Network Latency req
//  182 };
//  183 #endif
//  184 
//  185 // Pointer to the application sequence number for ZCL commands
//  186 #if defined ( ZCL_KEY_ESTABLISH)

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//  187 static uint8 zclKeyEstablishPluginRegisted = FALSE;
zclKeyEstablishPluginRegisted:
        DS 1
        REQUIRE __INIT_XDATA_Z
//  188 

        RSEG XDATA_Z:XDATA:NOROOT(0)
        DATA8
//  189 static zclKeyEstablishRec_t keyEstablishRec[MAX_KEY_ESTABLISHMENT_REC_ENTRY];
keyEstablishRec:
        DS 78
        REQUIRE __INIT_XDATA_Z
//  190 
//  191 /*********************************************************************
//  192  * LOCAL FUNCTIONS
//  193  */
//  194 static ZStatus_t zclGeneral_KeyEstablish_HdlIncoming( zclIncoming_t *pInMsg );
//  195 
//  196 static ZStatus_t zclGeneral_KeyEstablish_HdlInSpecificCommands( zclIncoming_t *pInMsg );
//  197 
//  198 // Key Establish Cluster Command Processing functions
//  199 static ZStatus_t zclGeneral_ProcessInCmd_InitiateKeyEstablish( zclIncoming_t *pInMsg );
//  200 static ZStatus_t zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp( zclIncoming_t *pInMsg );
//  201 static ZStatus_t zclGeneral_ProcessInCmd_EphemeralDataReq( zclIncoming_t *pInMsg );
//  202 static ZStatus_t zclGeneral_ProcessInCmd_EphemeralDataRsp( zclIncoming_t *pInMsg );
//  203 static ZStatus_t zclGeneral_ProcessInCmd_ConfirmKey( zclIncoming_t *pInMsg );
//  204 static ZStatus_t zclGeneral_ProcessInCmd_ConfirmKeyRsp( zclIncoming_t *pInMsg );
//  205 static ZStatus_t zclGeneral_ProcessInCmd_TerminateKeyEstablish( zclIncoming_t *pInMsg );
//  206 
//  207 // Event driven key calculation function
//  208 static ZStatus_t zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey(void);
//  209 static ZStatus_t zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey(void);
//  210 
//  211 // Key establishment rec table management function
//  212 static void zclGeneral_InitKeyEstablishRecTable( void );
//  213 static uint8 zclGeneral_GetKeyEstablishRecIndex( uint16 partnerAddress );
//  214 static uint8 zclGeneral_GetKeyEstablishRecIndex_State( KeyEstablishState_t state );
//  215 static uint8 zclGeneral_AddKeyEstablishRec( afAddrType_t *addr );
//  216 static void zclGeneral_AgeKeyEstablishRec( void );
//  217 static void zclGeneral_ResetKeyEstablishRec( uint8 index );
//  218 
//  219 // Call back function supplying to ECC library
//  220 static int zclGeneral_KeyEstablishment_GetRandom(unsigned char *buffer, unsigned long len);
//  221 static int zclGeneral_KeyEstablishment_HashFunc(unsigned char *digest, unsigned long len, unsigned char *data);
//  222 
//  223 // Security related functions
//  224 static void zclGeneral_KeyEstablishment_KeyDeriveFunction( uint8 *zData,
//  225                                                            uint8 keyBitLen,
//  226                                                            uint8 *keyBit );
//  227 
//  228 static ZStatus_t zclGeneral_KeyEstablishment_GenerateMAC(uint8 recIndex,
//  229                                                          uint8 ifMACu,
//  230                                                          uint8 *MAC);
//  231 
//  232 /*********************************************************************
//  233  * @fn      zclGeneral_KeyEstablish_Init
//  234  *
//  235  * @brief   Call to initialize the Key Establishment Task
//  236  *
//  237  * @param   task_id
//  238  *
//  239  * @return  none
//  240  */
//  241 

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  242 void zclGeneral_KeyEstablish_Init( uint8 task_id )
zclGeneral_KeyEstablish_Init:
          CFI Block cfiBlock0 Using cfiCommon0
          CFI Function zclGeneral_KeyEstablish_Init
        CODE
//  243 {
        FUNCALL zclGeneral_KeyEstablish_Init, afRegister
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 10, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 10, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_Init, zcl_registerClusterOptionList
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 10, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 10, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_Init, zcl_registerPlugin
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 12, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 12, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_Init, zclGeneral_InitKeyEstablishRecTable
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 10, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 10, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0xa
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 10)
        ; Saved register size: 10
        ; Auto size: 0
        MOV     A,R1
        MOV     R6,A
//  244   zcl_KeyEstablishment_TaskID = task_id;
        MOV     DPTR,#zcl_KeyEstablishment_TaskID
        MOVX    @DPTR,A
//  245 
//  246   // Register for the key establishment cluster endpoint
//  247   afRegister( &zclKeyEstablish_Ep );
        ; Setup parameters for call to function afRegister
        MOV     R2,#zclKeyEstablish_Ep & 0xff
        MOV     R3,#(zclKeyEstablish_Ep >> 8) & 0xff
        LCALL   ??afRegister?relay
        MOV     A,R1
//  248 
//  249   zcl_registerClusterOptionList( ZCL_KEY_ESTABLISHMENT_ENDPOINT, 1,
//  250                                  zclKeyEstablish_Options );
        ; Setup parameters for call to function zcl_registerClusterOptionList
        MOV     R4,#zclKeyEstablish_Options & 0xff
        MOV     R5,#(zclKeyEstablish_Options >> 8) & 0xff
        MOV     R2,#0x1
        MOV     R1,#0xa
        LCALL   ??zcl_registerClusterOptionList?relay
        MOV     A,R1
//  251 
//  252   // Register as a ZCL Plugin
//  253   if ( !zclKeyEstablishPluginRegisted )
        MOV     DPTR,#zclKeyEstablishPluginRegisted
        MOVX    A,@DPTR
        JNZ     ??zclGeneral_KeyEstablish_Init_0
//  254   {
//  255     zcl_registerPlugin( ZCL_CLUSTER_ID_GEN_KEY_ESTABLISHMENT,
//  256                         ZCL_CLUSTER_ID_GEN_KEY_ESTABLISHMENT,
//  257                         zclGeneral_KeyEstablish_HdlIncoming );
        ; Setup parameters for call to function zcl_registerPlugin
        MOV     ?V0 + 0,#??zclGeneral_KeyEstablish_HdlIncoming?relay & 0xff
        MOV     ?V0 + 1,#(??zclGeneral_KeyEstablish_HdlIncoming?relay >> 8) & 0xff
        MOV     R0,#?V0 + 0
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 12)
        MOV     R4,#0x0
        MOV     R5,#0x8
        MOV     R2,#0x0
        MOV     R3,#0x8
        LCALL   ??zcl_registerPlugin?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 10)
        MOV     A,R1
//  258     zclKeyEstablishPluginRegisted = TRUE;
        MOV     DPTR,#zclKeyEstablishPluginRegisted
        MOV     A,#0x1
        MOVX    @DPTR,A
//  259   }
//  260 
//  261   // Initialize the keyEstablishRec table
//  262   zclGeneral_InitKeyEstablishRecTable();
??zclGeneral_KeyEstablish_Init_0:
        ; Setup parameters for call to function zclGeneral_InitKeyEstablishRecTable
        LCALL   ??zclGeneral_InitKeyEstablishRecTable?relay
//  263 }
        MOV     R7,#0x2
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock0
//  264 
//  265 /*********************************************************************
//  266  * @fn          zclKeyEstablish_event_loop
//  267  *
//  268  * @brief       Event Loop Processor for Key establish task.
//  269  *
//  270  * @param       task_id - TaskId
//  271  *              events - events
//  272  *
//  273  * @return      none
//  274  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  275 uint16 zclKeyEstablish_event_loop( uint8 task_id, uint16 events )
zclKeyEstablish_event_loop:
          CFI Block cfiBlock1 Using cfiCommon0
          CFI Function zclKeyEstablish_event_loop
        CODE
//  276 {
        FUNCALL zclKeyEstablish_event_loop, osal_msg_receive
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 14, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 14, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclKeyEstablish_event_loop, osal_msg_deallocate
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 14, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 14, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclKeyEstablish_event_loop, zclGeneral_AgeKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 14, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 14, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclKeyEstablish_event_loop, zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 14, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 14, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclKeyEstablish_event_loop, zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 14, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 14, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0xe
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 14)
        ; Saved register size: 14
        ; Auto size: 0
        MOV     ?V0 + 2,R1
        MOV     A,R2
        MOV     R6,A
        MOV     A,R3
        MOV     R7,A
//  277   afIncomingMSGPacket_t *MSGpkt;
//  278 
//  279   if ( events & SYS_EVENT_MSG )
        MOV     A,R6
        ANL     A,#0x0
        MOV     R0,A
        MOV     A,R7
        ANL     A,#0x80
        MOV     R1,A
        MOV     A,R0
        ORL     A,R1
        JZ      ??zclKeyEstablish_event_loop_0
//  280   {
//  281     while ( (MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( task_id )) )
??zclKeyEstablish_event_loop_1:
        ; Setup parameters for call to function osal_msg_receive
        MOV     R1,?V0 + 2
        LCALL   ??osal_msg_receive?relay
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     R0,?V0 + 4
        MOV     R1,?V0 + 5
        MOV     ?V0 + 0,R0
        MOV     ?V0 + 1,R1
        MOV     A,R0
        ORL     A,R1
        JZ      ??zclKeyEstablish_event_loop_2
//  282     {
//  283       switch ( MSGpkt->hdr.event )
//  284       {
//  285         default:
//  286           break;
//  287       }
//  288 
//  289       // Release the memory
//  290       osal_msg_deallocate( (uint8 *)MSGpkt );
        ; Setup parameters for call to function osal_msg_deallocate
        MOV     R2,?V0 + 0
        MOV     R3,?V0 + 1
        LCALL   ??osal_msg_deallocate?relay
        MOV     A,R1
        SJMP    ??zclKeyEstablish_event_loop_1
//  291     }
//  292 
//  293     // return unprocessed events
//  294     return (events ^ SYS_EVENT_MSG);
??zclKeyEstablish_event_loop_2:
        MOV     A,R6
        XRL     A,#0x0
        MOV     R2,A
        MOV     A,R7
        XRL     A,#0x80
        MOV     R3,A
        SJMP    ??zclKeyEstablish_event_loop_3
//  295   }
//  296 
//  297   if ( events & KEY_ESTABLISHMENT_REC_AGING_EVT )
??zclKeyEstablish_event_loop_0:
        MOV     A,R6
        MOV     C,0xE0 /* A   */.0
        JNC     ??zclKeyEstablish_event_loop_4
//  298   {
//  299 
//  300     zclGeneral_AgeKeyEstablishRec();
        ; Setup parameters for call to function zclGeneral_AgeKeyEstablishRec
        LCALL   ??zclGeneral_AgeKeyEstablishRec?relay
//  301 
//  302     return ( events ^ KEY_ESTABLISHMENT_REC_AGING_EVT );
        MOV     A,R6
        XRL     A,#0x1
        MOV     R2,A
        MOV     A,R7
        XRL     A,#0x0
        MOV     R3,A
        SJMP    ??zclKeyEstablish_event_loop_3
//  303   }
//  304 
//  305   if ( events & KEY_ESTABLISHMENT_CMD_PROCESS_EVT )
??zclKeyEstablish_event_loop_4:
        MOV     A,R6
        ANL     A,#0x2
        JZ      ??zclKeyEstablish_event_loop_5
//  306   {
//  307     zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey();
        ; Setup parameters for call to function zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey
        LCALL   ??zclGeneral_InitiateKeyEstablish_Cmd_Calculate
        MOV     A,R1
//  308 
//  309     return ( events ^ KEY_ESTABLISHMENT_CMD_PROCESS_EVT );
        MOV     A,R6
        XRL     A,#0x2
        MOV     R2,A
        MOV     A,R7
        XRL     A,#0x0
        MOV     R3,A
        SJMP    ??zclKeyEstablish_event_loop_3
//  310   }
//  311 
//  312   if ( events & KEY_ESTABLISHMENT_RSP_PROCESS_EVT )
??zclKeyEstablish_event_loop_5:
        MOV     A,R6
        ANL     A,#0x4
        JZ      ??zclKeyEstablish_event_loop_6
//  313   {
//  314     zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey();
        ; Setup parameters for call to function zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey
        LCALL   ??zclGeneral_InitiateKeyEstablish_Rsp_Calculate
        MOV     A,R1
//  315     return ( events ^ KEY_ESTABLISHMENT_RSP_PROCESS_EVT );
        MOV     A,R6
        XRL     A,#0x4
        MOV     R2,A
        MOV     A,R7
        XRL     A,#0x0
        MOV     R3,A
        SJMP    ??zclKeyEstablish_event_loop_3
//  316   }
//  317   // Discard unknown events
//  318   return 0;
??zclKeyEstablish_event_loop_6:
        MOV     R2,#0x0
        MOV     R3,#0x0
??zclKeyEstablish_event_loop_3:
        MOV     R7,#0x6
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock1
//  319 }
//  320 
//  321 /*********************************************************************
//  322  * @fn      zclGeneral_KeyEstablish_InitiateKeyEstablishment
//  323  *
//  324  * @brief   Call to initiate key establishment with partner device
//  325  *
//  326  * @param   appTaskID - task ID of the application that initates the key establish
//  327  * @param   partnerAddr - short address and endpoint of the partner to establish key with
//  328  * @param   seqNum - pointer to the sequence number of application (ZCL)
//  329  *
//  330  * @return  ZStatus_t ZSuccess or ZFailure
//  331  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  332 ZStatus_t zclGeneral_KeyEstablish_InitiateKeyEstablishment(uint8 appTaskID,
zclGeneral_KeyEstablish_InitiateKeyEstablishment:
          CFI Block cfiBlock2 Using cfiCommon0
          CFI Function zclGeneral_KeyEstablish_InitiateKeyEstablishment
        CODE
//  333                                                            afAddrType_t *partnerAddr,
//  334                                                            uint8 seqNum)
//  335 {
        FUNCALL zclGeneral_KeyEstablish_InitiateKeyEstablishment, zclGeneral_AddKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 18, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 18, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_InitiateKeyEstablishment, ZSE_ECCGenerateKey
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 26, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 26, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_InitiateKeyEstablishment, osal_mem_alloc
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 18, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 18, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_InitiateKeyEstablishment, osal_nv_read
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 22, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 22, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_InitiateKeyEstablishment, zclGeneral_KeyEstablish_Send_InitiateKeyEstablishment
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 24, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_InitiateKeyEstablishment, osal_start_reload_timer
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 18, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 18, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_InitiateKeyEstablishment, osal_mem_free
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 18, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 18, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_InitiateKeyEstablishment, NLME_SetPollRate
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 18, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 18, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x12
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V9 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V8 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V7 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-16)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-17)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-18)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 18)
        ; Saved register size: 18
        ; Auto size: 0
        MOV     A,R1
        MOV     R6,A
        MOV     ?V0 + 2,R2
        MOV     ?V0 + 3,R3
        MOV     ?V0 + 0,R4
//  336   uint8 *implicitCert, index;
//  337 
//  338   // Assign the app seqnum pointer
//  339   zcl_SeqNum = seqNum;
        MOV     A,?V0 + 0
        MOV     DPTR,#zcl_SeqNum
        MOVX    @DPTR,A
//  340 
//  341   // Start a new key establishment rec entry
//  342   index = zclGeneral_AddKeyEstablishRec( partnerAddr );
        ; Setup parameters for call to function zclGeneral_AddKeyEstablishRec
        MOV     R2,?V0 + 2
        MOV     R3,?V0 + 3
        LCALL   ??zclGeneral_AddKeyEstablishRec?relay
        MOV     A,R1
        MOV     R7,A
//  343 
//  344   if( index < MAX_KEY_ESTABLISHMENT_REC_ENTRY ) // valid entry
        MOV     A,R7
        CLR     C
        SUBB    A,#0x2
        JC      $+5
        LJMP    ??zclGeneral_KeyEstablish_InitiateKeyEstablishm_1 & 0xFFFF
//  345   {
//  346     keyEstablishRec[index].role = KEY_ESTABLISHMENT_INITIATOR;
        MOV     A,R7
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 22) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 22) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,#0x0
        MOVX    @DPTR,A
//  347 
//  348     // Assign the application task ID that initiates the key establishment
//  349     keyEstablishRec[index].appTaskID = appTaskID;
        MOV     A,R6
        PUSH    A
          CFI CFA_SP SP+-1
        MOV     A,R7
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 13) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 13) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        POP     A
          CFI CFA_SP SP+0
        MOVX    @DPTR,A
//  350   }
//  351   else
//  352   {
//  353     return ZFailure;
//  354   }
//  355 
//  356   // Generate Ephemeral Public/Private Key Pair
//  357   ZSE_ECCGenerateKey( ( unsigned char *)keyEstablishRec[index].pLocalEPrivateKey,
//  358                      ( unsigned char *)keyEstablishRec[index].pLocalEPublicKey,
//  359                      zclGeneral_KeyEstablishment_GetRandom,
//  360                      zclKeyEstablish_YieldFunc, zclKeyEstablish_YieldLevel);
        ; Setup parameters for call to function ZSE_ECCGenerateKey
        MOV     DPTR,#zclKeyEstablish_YieldLevel
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        CLR     A
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,A
        MOV     ?V0 + 7,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_FOUR
          CFI CFA_XSP16 add(XSP16, 22)
        MOV     DPTR,#zclKeyEstablish_YieldFunc
        LCALL   ?PUSH_XSTACK8_X_TWO
          CFI CFA_XSP16 add(XSP16, 24)
        MOV     ?V0 + 4,#??zclGeneral_KeyEstablishment_GetRandom?relay & 0xff
        MOV     ?V0 + 5,#(??zclGeneral_KeyEstablishment_GetRandom?relay >> 8) & 0xff
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 26)
        MOV     A,R7
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 27) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 27) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R4,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R5,A
        MOV     A,R7
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 25) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 25) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??ZSE_ECCGenerateKey?relay
        MOV     A,#0x8
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 18)
//  361 
//  362 #if defined (DEBUG_STATIC_ECC)
//  363   // For debug and testing purpose, use a fixed ephermeral key pair instead
//  364   // of the randomly generated one.
//  365   osal_memcpy( keyEstablishRec[index].pLocalEPrivateKey, private1, 21 );
//  366   osal_memcpy( keyEstablishRec[index].pLocalEPublicKey, public1, 22 );
//  367 #endif
//  368 
//  369   keyEstablishRec[index].state = KeyEstablishState_InitiatePending;
        MOV     A,R7
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 24) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 24) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,#0x1
        MOVX    @DPTR,A
//  370 
//  371   if ((implicitCert = osal_mem_alloc(ZCL_KE_IMPLICIT_CERTIFICATE_LEN)) == NULL)
        ; Setup parameters for call to function osal_mem_alloc
        MOV     R2,#0x30
        MOV     R3,#0x0
        LCALL   ??osal_mem_alloc?relay
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     R0,?V0 + 4
        MOV     R1,?V0 + 5
        MOV     ?V0 + 8,R0
        MOV     ?V0 + 9,R1
        MOV     A,R0
        ORL     A,R1
        JNZ     ??zclGeneral_KeyEstablish_InitiateKeyEstablishm_2
        SJMP    ??zclGeneral_KeyEstablish_InitiateKeyEstablishm_3
??zclGeneral_KeyEstablish_InitiateKeyEstablishm_1:
        MOV     R1,#0x1
        LJMP    ??zclGeneral_KeyEstablish_InitiateKeyEstablishm_4 & 0xFFFF
//  372   {
//  373     return ZCL_STATUS_SOFTWARE_FAILURE;  // Memory allocation failure.
??zclGeneral_KeyEstablish_InitiateKeyEstablishm_3:
        MOV     R1,#-0x3f
        LJMP    ??zclGeneral_KeyEstablish_InitiateKeyEstablishm_4 & 0xFFFF
//  374   }
//  375   osal_nv_read(ZCD_NV_IMPLICIT_CERTIFICATE, 0, ZCL_KE_IMPLICIT_CERTIFICATE_LEN, implicitCert);
??zclGeneral_KeyEstablish_InitiateKeyEstablishm_2:
        ; Setup parameters for call to function osal_nv_read
        MOV     R0,#?V0 + 8
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 20)
        MOV     ?V0 + 4,#0x30
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 22)
        MOV     R4,#0x0
        MOV     R5,#0x0
        MOV     R2,#0x69
        MOV     R3,#0x0
        LCALL   ??osal_nv_read?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 18)
        MOV     A,R1
//  376 
//  377   // Send Initiate Key Establishment Command
//  378   zclGeneral_KeyEstablish_Send_InitiateKeyEstablishment( ZCL_KEY_ESTABLISHMENT_ENDPOINT,
//  379              partnerAddr,
//  380              KEY_ESTABLISHMENT_SUITE,
//  381              ZCL_KEY_ESTABLISHMENT_EKEY_GENERATE_TIMEOUT,
//  382              ZCL_KEY_ESTABLISHMENT_MAC_GENERATE_TIMEOUT + ZCL_KEY_ESTABLISHMENT_KEY_GENERATE_TIMEOUT,
//  383              implicitCert, TRUE, zcl_SeqNum++ );
        MOV     DPTR,#zcl_SeqNum
        MOVX    A,@DPTR
        MOV     R0,A
        MOV     A,#0x1
        ADD     A,R0
        MOV     DPTR,#zcl_SeqNum
        MOVX    @DPTR,A
        ; Setup parameters for call to function zclGeneral_KeyEstablish_Send_InitiateKeyEstablishment
        MOV     A,R0
        MOV     ?V0 + 1,A
        MOV     R0,#?V0 + 1
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 19)
        MOV     ?V0 + 1,#0x1
        MOV     R0,#?V0 + 1
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 20)
        MOV     R0,#?V0 + 8
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 22)
        MOV     ?V0 + 1,#0xe
        MOV     R0,#?V0 + 1
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 23)
        MOV     ?V0 + 1,#0xa
        MOV     R0,#?V0 + 1
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 24)
        MOV     R4,#0x1
        MOV     R5,#0x0
        MOV     R2,?V0 + 2
        MOV     R3,?V0 + 3
        MOV     R1,#0xa
        LCALL   ??zclGeneral_KeyEstablish_Send_InitiateKeyEstab
        MOV     A,#0x6
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 18)
        MOV     A,R1
//  384 
//  385   // Start the Key Establishment aging timer, this has to be started to make sure the record
//  386   // is going to be deleted in the event that "Key Establishment Response" is not received for
//  387   // any reason. This way we do not have hanging records in the table and memory leak issues.
//  388   osal_start_reload_timer( zcl_KeyEstablishment_TaskID, KEY_ESTABLISHMENT_REC_AGING_EVT,
//  389                            KEY_ESTABLISHMENT_REC_AGING_INTERVAL );
        ; Setup parameters for call to function osal_start_reload_timer
        MOV     R4,#-0x18
        MOV     R5,#0x3
        MOV     R2,#0x1
        MOV     R3,#0x0
        MOV     DPTR,#zcl_KeyEstablishment_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_start_reload_timer?relay
        MOV     A,R1
//  390 
//  391   osal_mem_free(implicitCert);
        ; Setup parameters for call to function osal_mem_free
        MOV     R2,?V0 + 8
        MOV     R3,?V0 + 9
        LCALL   ??osal_mem_free?relay
//  392 
//  393 #if defined (NWK_AUTO_POLL)
//  394   // Start the key establishment process and set the Key Establish poll rate
//  395   zclSavedPollRate = zgPollRate;
        MOV     DPTR,#zgPollRate
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R1,A
        MOV     DPTR,#zclSavedPollRate
        MOV     A,R0
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R1
        MOVX    @DPTR,A
//  396   NLME_SetPollRate(ZCL_KEY_ESTABLISH_POLL_RATE);
        ; Setup parameters for call to function NLME_SetPollRate
        MOV     R2,#-0x18
        MOV     R3,#0x3
        LCALL   ??NLME_SetPollRate?relay
//  397 #endif
//  398 
//  399   return ZSuccess;
        MOV     R1,#0x0
??zclGeneral_KeyEstablish_InitiateKeyEstablishm_4:
        MOV     R7,#0xa
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock2
//  400 }
//  401 
//  402 /*********************************************************************
//  403  * @fn      zclGeneral_KeyEstablish_Send_InitiateKeyEstablishment
//  404  *
//  405  * @brief   Call to send out a Initiate Key Establishment Command
//  406  *
//  407  * @param   srcEP - Sending application's endpoint
//  408  * @param   dstAddr - where you want the message to go
//  409  * @param   keyEstablishmentSuite - key establishment suite bitmap
//  410  * @param   keyGenerateTime - how long it takes to generate key
//  411  * @param   macGenerateTime - how long it takes to generate mac
//  412  * @param   certificate - identity. For CBKE, it's the implicit certificate.
//  413  * @param   disableDefaultRsp - disable default response
//  414  * @param   seqNum - ZCL sequence number
//  415  *
//  416  * @return  ZStatus_t
//  417  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  418 ZStatus_t zclGeneral_KeyEstablish_Send_InitiateKeyEstablishment( uint8 srcEP, afAddrType_t *dstAddr,
zclGeneral_KeyEstablish_Send_InitiateKeyEstablishment:
          CFI Block cfiBlock3 Using cfiCommon0
          CFI Function zclGeneral_KeyEstablish_Send_InitiateKeyEstablishment
        CODE
//  419                                              uint16 keyEstablishmentSuite,
//  420                                              uint8  keyGenerateTime,
//  421                                              uint8  macGenerateTime,
//  422                                              uint8 *certificate,
//  423                                              uint8 disableDefaultRsp, uint8 seqNum )
//  424 {
        FUNCALL zclGeneral_KeyEstablish_Send_InitiateKeyEstablishment, osal_mem_alloc
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 24, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_Send_InitiateKeyEstablishment, osal_memcpy
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 27, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 27, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_Send_InitiateKeyEstablishment, zcl_SendCommand
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 35, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 35, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_Send_InitiateKeyEstablishment, osal_mem_free
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 24, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x18
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V15 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V14 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V13 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V12 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V11 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V10 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V9 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI V8 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI V7 load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-16)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-17)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-18)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-19)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-20)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-21)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-22)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-23)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-24)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 24)
        ; Saved register size: 24
        ; Auto size: 0
        MOV     ?V0 + 13,R1
        MOV     ?V0 + 14,R2
        MOV     ?V0 + 15,R3
        MOV     ?V0 + 0,R4
        MOV     ?V0 + 1,R5
        MOV     A,#0x18
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 9,A
        MOV     A,#0x19
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 8,A
        MOV     A,#0x1c
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 12,A
        MOV     A,#0x1d
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 11,A
//  425   uint8 *buf;
//  426   uint8 *pBuf;
//  427   uint8 status;
//  428   uint8 bufLen;
//  429 
//  430   (void)srcEP; // Intentionally unreferenced parameter
//  431 
//  432   // keyEstablishmentSuite + eDataGenerateTime + macGenerateTime + certificate
//  433   bufLen = 2 + 1 + 1 + ZCL_KE_IMPLICIT_CERTIFICATE_LEN;
        MOV     ?V0 + 7,#0x34
//  434 
//  435   if ((buf = osal_mem_alloc(bufLen)) == NULL)
        ; Setup parameters for call to function osal_mem_alloc
        MOV     ?V0 + 4,?V0 + 7
        MOV     ?V0 + 5,#0x0
        MOV     R2,?V0 + 4
        MOV     R3,?V0 + 5
        LCALL   ??osal_mem_alloc?relay
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     R0,?V0 + 4
        MOV     R1,?V0 + 5
        MOV     ?V0 + 2,R0
        MOV     ?V0 + 3,R1
        MOV     A,R0
        ORL     A,R1
        JNZ     ??zclGeneral_KeyEstablish_Send_InitiateKeyEstab_2
//  436   {
//  437     return ZMemError;
        MOV     R1,#0x10
        LJMP    ??zclGeneral_KeyEstablish_Send_InitiateKeyEstab_3 & 0xFFFF
//  438   }
//  439 
//  440   pBuf = buf;
??zclGeneral_KeyEstablish_Send_InitiateKeyEstab_2:
        MOV     R6,?V0 + 2
        MOV     R7,?V0 + 3
//  441 
//  442   *pBuf++ = LO_UINT16( keyEstablishmentSuite );
        MOV     A,?V0 + 0
        MOV     DPL,R6
        MOV     DPH,R7
        MOV     A,?V0 + 0
        MOVX    @DPTR,A
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        MOV     R6,DPL
        MOV     R7,DPH
//  443   *pBuf++ = HI_UINT16( keyEstablishmentSuite );
        MOV     R0,?V0 + 0
        MOV     R1,?V0 + 1
        CLR     A
        MOV     A,?V0 + 1
        MOV     R0,?V0 + 1
        MOV     A,?V0 + 1
        MOV     DPL,R6
        MOV     DPH,R7
        MOV     A,?V0 + 1
        MOVX    @DPTR,A
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        MOV     R6,DPL
        MOV     R7,DPH
//  444   *pBuf++ = keyGenerateTime;
        MOV     A,?V0 + 9
        MOV     DPL,R6
        MOV     DPH,R7
        MOV     A,?V0 + 9
        MOVX    @DPTR,A
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        MOV     R6,DPL
        MOV     R7,DPH
//  445   *pBuf++ = macGenerateTime;
        MOV     A,?V0 + 8
        MOV     DPL,R6
        MOV     DPH,R7
        MOV     A,?V0 + 8
        MOVX    @DPTR,A
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        MOV     R6,DPL
        MOV     R7,DPH
//  446   osal_memcpy( pBuf, certificate, ZCL_KE_IMPLICIT_CERTIFICATE_LEN );
        ; Setup parameters for call to function osal_memcpy
        MOV     A,#0x1a
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 27)
        MOV     R4,#0x30
        MOV     R5,#0x0
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 24)
//  447 
//  448   status = zcl_SendCommand( ZCL_KEY_ESTABLISHMENT_ENDPOINT, dstAddr,
//  449                            ZCL_CLUSTER_ID_GEN_KEY_ESTABLISHMENT,
//  450                            COMMAND_INITIATE_KEY_ESTABLISHMENT, TRUE,
//  451                            ZCL_FRAME_CLIENT_SERVER_DIR, disableDefaultRsp,
//  452                            0, seqNum, bufLen, buf );
        ; Setup parameters for call to function zcl_SendCommand
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 26)
        MOV     ?V0 + 4,?V0 + 7
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 28)
        MOV     A,?V0 + 11
        MOV     ?V0 + 4,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 29)
        CLR     A
        MOV     ?V0 + 4,A
        MOV     ?V0 + 5,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 31)
        MOV     A,?V0 + 12
        MOV     ?V0 + 4,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 32)
        MOV     ?V0 + 4,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 33)
        MOV     ?V0 + 4,#0x1
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 34)
        MOV     ?V0 + 4,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 35)
        MOV     R4,#0x0
        MOV     R5,#0x8
        MOV     R2,?V0 + 14
        MOV     R3,?V0 + 15
        MOV     R1,#0xa
        LCALL   ??zcl_SendCommand?relay
        MOV     A,#0xb
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 24)
        MOV     A,R1
        MOV     ?V0 + 10,A
//  453 
//  454   osal_mem_free(buf);
        ; Setup parameters for call to function osal_mem_free
        MOV     R2,?V0 + 2
        MOV     R3,?V0 + 3
        LCALL   ??osal_mem_free?relay
//  455 
//  456   return status;
        MOV     R1,?V0 + 10
??zclGeneral_KeyEstablish_Send_InitiateKeyEstab_3:
        MOV     R7,#0x10
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock3
//  457 }
//  458 
//  459 /*********************************************************************
//  460  * @fn      zclGeneral_KeyEstablish_Send_EphemeralDataReq
//  461  *
//  462  * @brief   Call to send out a Ephemeral Data Request Command
//  463  *
//  464  * @param   srcEP - Sending application's endpoint
//  465  * @param   dstAddr - where you want the message to go
//  466  * @param   eData - ephemeral data.
//  467  * @param   disableDefaultRsp - disable default response
//  468  * @param   seqNum - ZCL sequence number
//  469  *
//  470  * @return  ZStatus_t
//  471  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  472 ZStatus_t zclGeneral_KeyEstablish_Send_EphemeralDataReq( uint8 srcEP, afAddrType_t *dstAddr,
zclGeneral_KeyEstablish_Send_EphemeralDataReq:
          CFI Block cfiBlock4 Using cfiCommon0
          CFI Function zclGeneral_KeyEstablish_Send_EphemeralDataReq
        CODE
//  473                                              uint8 *eData,
//  474                                              uint8 disableDefaultRsp, uint8 seqNum )
//  475 {
        FUNCALL zclGeneral_KeyEstablish_Send_EphemeralDataReq, zcl_SendCommand
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 27, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 27, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x10
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V7 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-16)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 16)
        ; Saved register size: 16
        ; Auto size: 0
        MOV     ?V0 + 0,R1
        MOV     A,R2
        MOV     R6,A
        MOV     A,R3
        MOV     R7,A
        MOV     ?V0 + 2,R4
        MOV     ?V0 + 3,R5
        MOV     A,#0x10
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 1,A
        MOV     A,#0x11
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
//  476   return zcl_SendCommand( srcEP, dstAddr,
//  477                            ZCL_CLUSTER_ID_GEN_KEY_ESTABLISHMENT,
//  478                            COMMAND_EPHEMERAL_DATA_REQUEST, TRUE,
//  479                            ZCL_FRAME_CLIENT_SERVER_DIR, disableDefaultRsp,
//  480                            0, seqNum, ZCL_KE_CA_PUBLIC_KEY_LEN, eData );
        ; Setup parameters for call to function zcl_SendCommand
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 18)
        MOV     ?V0 + 6,#0x16
        MOV     ?V0 + 7,#0x0
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 20)
        MOV     A,?V0 + 4
        MOV     ?V0 + 5,A
        MOV     R0,#?V0 + 5
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 21)
        CLR     A
        MOV     ?V0 + 6,A
        MOV     ?V0 + 7,A
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 23)
        MOV     A,?V0 + 1
        MOV     ?V0 + 5,A
        MOV     R0,#?V0 + 5
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 24)
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 5
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 25)
        MOV     ?V0 + 5,#0x1
        MOV     R0,#?V0 + 5
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 26)
        MOV     ?V0 + 5,#0x1
        MOV     R0,#?V0 + 5
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 27)
        MOV     R4,#0x0
        MOV     R5,#0x8
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        MOV     R1,?V0 + 0
        LCALL   ??zcl_SendCommand?relay
        MOV     A,#0xb
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 16)
        MOV     R7,#0x8
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock4
//  481 }
//  482 
//  483 /*********************************************************************
//  484  * @fn      zclGeneral_KeyEstablish_Send_ConfirmKey
//  485  *
//  486  * @brief   Call to send out a Confirm Key Command
//  487  *
//  488  * @param   srcEP - Sending application's endpoint
//  489  * @param   dstAddr - where you want the message to go
//  490  * @param   mac - MAC.
//  491  * @param   disableDefaultRsp - disable default response
//  492  * @param   seqNum - ZCL sequence number
//  493  *
//  494  * @return  ZStatus_t
//  495  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  496 ZStatus_t zclGeneral_KeyEstablish_Send_ConfirmKey( uint8 srcEP, afAddrType_t *dstAddr,
zclGeneral_KeyEstablish_Send_ConfirmKey:
          CFI Block cfiBlock5 Using cfiCommon0
          CFI Function zclGeneral_KeyEstablish_Send_ConfirmKey
        CODE
//  497                                              uint8 *mac,
//  498                                              uint8 disableDefaultRsp, uint8 seqNum )
//  499 {
        FUNCALL zclGeneral_KeyEstablish_Send_ConfirmKey, zcl_SendCommand
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 27, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 27, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x10
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V7 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-16)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 16)
        ; Saved register size: 16
        ; Auto size: 0
        MOV     ?V0 + 0,R1
        MOV     A,R2
        MOV     R6,A
        MOV     A,R3
        MOV     R7,A
        MOV     ?V0 + 2,R4
        MOV     ?V0 + 3,R5
        MOV     A,#0x10
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 1,A
        MOV     A,#0x11
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
//  500   return (zcl_SendCommand(srcEP, dstAddr,
//  501                            ZCL_CLUSTER_ID_GEN_KEY_ESTABLISHMENT,
//  502                            COMMAND_CONFIRM_KEY, TRUE,
//  503                            ZCL_FRAME_CLIENT_SERVER_DIR, disableDefaultRsp,
//  504                            0, seqNum, KEY_ESTABLISH_MAC_LENGTH, mac ));
        ; Setup parameters for call to function zcl_SendCommand
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 18)
        MOV     ?V0 + 6,#0x10
        MOV     ?V0 + 7,#0x0
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 20)
        MOV     A,?V0 + 4
        MOV     ?V0 + 5,A
        MOV     R0,#?V0 + 5
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 21)
        CLR     A
        MOV     ?V0 + 6,A
        MOV     ?V0 + 7,A
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 23)
        MOV     A,?V0 + 1
        MOV     ?V0 + 5,A
        MOV     R0,#?V0 + 5
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 24)
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 5
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 25)
        MOV     ?V0 + 5,#0x1
        MOV     R0,#?V0 + 5
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 26)
        MOV     ?V0 + 5,#0x2
        MOV     R0,#?V0 + 5
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 27)
        MOV     R4,#0x0
        MOV     R5,#0x8
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        MOV     R1,?V0 + 0
        LCALL   ??zcl_SendCommand?relay
        MOV     A,#0xb
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 16)
        MOV     R7,#0x8
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock5
//  505 }
//  506 
//  507 /*********************************************************************
//  508  * @fn      zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment
//  509  *
//  510  * @brief   Call to send out a Terminate Key Establishment Command
//  511  *
//  512  * @param   srcEP - Sending application's endpoint
//  513  * @param   dstAddr - where you want the message to go
//  514  * @param   status - status of the key establishment procedure.
//  515  * @param   direction - client/server direction of the command
//  516  * @param   disableDefaultRsp - disable default response
//  517  * @param   seqNum - ZCL sequence number
//  518  *
//  519  * @return  ZStatus_t
//  520  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  521 ZStatus_t zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment( uint8 srcEP,
zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment:
          CFI Block cfiBlock6 Using cfiCommon0
          CFI Function zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment
        CODE
//  522                                              afAddrType_t *dstAddr,
//  523                                              TermKeyStatus_t status,
//  524                                              uint8 waitTime,
//  525                                              uint16 keyEstablishmentSuite, uint8 direction,
//  526                                              uint8 disableDefaultRsp, uint8 seqNum )
//  527 {
        FUNCALL zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment, zcl_SendCommand
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 33, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 33, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x12
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V9 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V8 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V7 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-16)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-17)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-18)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 18)
        ; Saved register size: 18
        ; Auto size: 4
        MOV     A,#-0x4
        LCALL   ?ALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 22)
        MOV     ?V0 + 0,R1
        MOV     ?V0 + 8,R2
        MOV     ?V0 + 9,R3
        MOV     ?V0 + 2,R4
        MOV     ?V0 + 3,R5
        MOV     A,#0x16
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     R6,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R7,A
        MOV     A,#0x18
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 5,A
        MOV     A,#0x19
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        MOV     A,#0x1a
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 1,A
//  528   uint8 buf[4];
//  529 
//  530   buf[0] = status;
        MOV     A,?V0 + 2
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOV     A,?V0 + 2
        MOVX    @DPTR,A
//  531   buf[1] = waitTime;
        MOV     A,?V0 + 3
        MOV     A,#0x1
        LCALL   ?XSTACK_DISP0_8
        MOV     A,?V0 + 3
        MOVX    @DPTR,A
//  532   buf[2] = LO_UINT16(keyEstablishmentSuite);
        MOV     A,R6
        PUSH    A
          CFI CFA_SP SP+-1
        MOV     A,#0x2
        LCALL   ?XSTACK_DISP0_8
        POP     A
          CFI CFA_SP SP+0
        MOVX    @DPTR,A
//  533   buf[3] = HI_UINT16(keyEstablishmentSuite);
        MOV     A,R6
        MOV     R0,A
        MOV     A,R7
        MOV     R1,A
        CLR     A
        MOV     A,R1
        MOV     R0,A
        PUSH    A
          CFI CFA_SP SP+-1
        MOV     A,#0x3
        LCALL   ?XSTACK_DISP0_8
        POP     A
          CFI CFA_SP SP+0
        MOVX    @DPTR,A
//  534 
//  535   return zcl_SendCommand(srcEP, dstAddr,
//  536                          ZCL_CLUSTER_ID_GEN_KEY_ESTABLISHMENT,
//  537                          COMMAND_TERMINATE_KEY_ESTABLISHMENT, TRUE,
//  538                          direction, disableDefaultRsp,
//  539                          0, seqNum, 4, buf );
        ; Setup parameters for call to function zcl_SendCommand
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOV     ?V0 + 6,DPL
        MOV     ?V0 + 7,DPH
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 24)
        MOV     ?V0 + 6,#0x4
        MOV     ?V0 + 7,#0x0
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 26)
        MOV     A,?V0 + 1
        MOV     ?V0 + 6,A
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 27)
        CLR     A
        MOV     ?V0 + 6,A
        MOV     ?V0 + 7,A
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 29)
        MOV     A,?V0 + 4
        MOV     ?V0 + 6,A
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 30)
        MOV     A,?V0 + 5
        MOV     ?V0 + 6,A
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 31)
        MOV     ?V0 + 6,#0x1
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 32)
        MOV     ?V0 + 6,#0x3
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 33)
        MOV     R4,#0x0
        MOV     R5,#0x8
        MOV     R2,?V0 + 8
        MOV     R3,?V0 + 9
        MOV     R1,?V0 + 0
        LCALL   ??zcl_SendCommand?relay
        MOV     A,#0xb
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 22)
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 18)
        MOV     R7,#0xa
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock6
//  540 }
//  541 
//  542 /*********************************************************************
//  543  * @fn      zclGeneral_KeyEstablish_Send_InitiateKeyEstablishmentRsp
//  544  *
//  545  * @brief   Call to send out a Initiate Key Establishment Response
//  546  *
//  547  * @param   srcEP - Sending application's endpoint
//  548  * @param   dstAddr - where you want the message to go
//  549  * @param   status - status of the key establishment response.
//  550  * @param   keyEstablishmentSuite - requested key establishment suite bitmap
//  551  * @param   keyGenerateTime - how long it takes to generate key
//  552  * @param   macGenerateTime - how long it takes to generate mac
//  553  * @param   certificate - identity. For CBKE, it's the implicit certificate.
//  554  * @param   disableDefaultRsp - disable default response
//  555  * @param   seqNum - ZCL sequence number
//  556  *
//  557  * @return  ZStatus_t
//  558  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  559 ZStatus_t zclGeneral_KeyEstablish_Send_InitiateKeyEstablishmentRsp( uint8 srcEP, afAddrType_t *dstAddr,
zclGeneral_KeyEstablish_Send_InitiateKeyEstablishmentRsp:
          CFI Block cfiBlock7 Using cfiCommon0
          CFI Function zclGeneral_KeyEstablish_Send_InitiateKeyEstablishmentRsp
        CODE
//  560                                              uint16 keyEstablishmentSuite,
//  561                                              uint8  keyGenerateTime,
//  562                                              uint8  macGenerateTime,
//  563                                              uint8 *certificate,
//  564                                              uint8 disableDefaultRsp, uint8 seqNum )
//  565 {
        FUNCALL zclGeneral_KeyEstablish_Send_InitiateKeyEstablishmentRsp, osal_mem_alloc
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 24, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_Send_InitiateKeyEstablishmentRsp, osal_memcpy
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 27, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 27, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_Send_InitiateKeyEstablishmentRsp, zcl_SendCommand
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 35, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 35, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_Send_InitiateKeyEstablishmentRsp, osal_mem_free
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 24, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x18
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V15 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V14 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V13 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V12 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V11 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V10 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V9 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI V8 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI V7 load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-16)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-17)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-18)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-19)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-20)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-21)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-22)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-23)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-24)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 24)
        ; Saved register size: 24
        ; Auto size: 0
        MOV     ?V0 + 10,R1
        MOV     ?V0 + 14,R2
        MOV     ?V0 + 15,R3
        MOV     ?V0 + 0,R4
        MOV     ?V0 + 1,R5
        MOV     A,#0x18
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 9,A
        MOV     A,#0x19
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 8,A
        MOV     A,#0x1c
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 13,A
        MOV     A,#0x1d
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 12,A
//  566   uint8 *buf;
//  567   uint8 bufLen;
//  568   uint8 ret;
//  569   uint8 *pBuf;
//  570 
//  571   bufLen = 2 + 1 + 1 + ZCL_KE_IMPLICIT_CERTIFICATE_LEN;
        MOV     ?V0 + 7,#0x34
//  572 
//  573   if ((buf = osal_mem_alloc(bufLen)) == NULL)
        ; Setup parameters for call to function osal_mem_alloc
        MOV     ?V0 + 4,?V0 + 7
        MOV     ?V0 + 5,#0x0
        MOV     R2,?V0 + 4
        MOV     R3,?V0 + 5
        LCALL   ??osal_mem_alloc?relay
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     R0,?V0 + 4
        MOV     R1,?V0 + 5
        MOV     ?V0 + 2,R0
        MOV     ?V0 + 3,R1
        MOV     A,R0
        ORL     A,R1
        JNZ     ??zclGeneral_KeyEstablish_Send_InitiateKeyEstab_4
//  574   {
//  575     return ZMemError;
        MOV     R1,#0x10
        LJMP    ??zclGeneral_KeyEstablish_Send_InitiateKeyEstab_5 & 0xFFFF
//  576   }
//  577 
//  578   pBuf = buf;
??zclGeneral_KeyEstablish_Send_InitiateKeyEstab_4:
        MOV     R6,?V0 + 2
        MOV     R7,?V0 + 3
//  579 
//  580   *pBuf++ = LO_UINT16( keyEstablishmentSuite );
        MOV     A,?V0 + 0
        MOV     DPL,R6
        MOV     DPH,R7
        MOV     A,?V0 + 0
        MOVX    @DPTR,A
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        MOV     R6,DPL
        MOV     R7,DPH
//  581   *pBuf++ = HI_UINT16( keyEstablishmentSuite );
        MOV     R0,?V0 + 0
        MOV     R1,?V0 + 1
        CLR     A
        MOV     A,?V0 + 1
        MOV     R0,?V0 + 1
        MOV     A,?V0 + 1
        MOV     DPL,R6
        MOV     DPH,R7
        MOV     A,?V0 + 1
        MOVX    @DPTR,A
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        MOV     R6,DPL
        MOV     R7,DPH
//  582   *pBuf++ = keyGenerateTime;
        MOV     A,?V0 + 9
        MOV     DPL,R6
        MOV     DPH,R7
        MOV     A,?V0 + 9
        MOVX    @DPTR,A
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        MOV     R6,DPL
        MOV     R7,DPH
//  583   *pBuf++ = macGenerateTime;
        MOV     A,?V0 + 8
        MOV     DPL,R6
        MOV     DPH,R7
        MOV     A,?V0 + 8
        MOVX    @DPTR,A
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        MOV     R6,DPL
        MOV     R7,DPH
//  584   osal_memcpy( pBuf, certificate, ZCL_KE_IMPLICIT_CERTIFICATE_LEN );
        ; Setup parameters for call to function osal_memcpy
        MOV     A,#0x1a
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 27)
        MOV     R4,#0x30
        MOV     R5,#0x0
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 24)
//  585 
//  586   ret = zcl_SendCommand( srcEP, dstAddr,
//  587                            ZCL_CLUSTER_ID_GEN_KEY_ESTABLISHMENT,
//  588                            COMMAND_INITIATE_KEY_ESTABLISHMENT_RESPONSE, TRUE,
//  589                            ZCL_FRAME_SERVER_CLIENT_DIR, disableDefaultRsp,
//  590                            0, seqNum, bufLen, buf );
        ; Setup parameters for call to function zcl_SendCommand
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 26)
        MOV     ?V0 + 4,?V0 + 7
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 28)
        MOV     A,?V0 + 12
        MOV     ?V0 + 4,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 29)
        CLR     A
        MOV     ?V0 + 4,A
        MOV     ?V0 + 5,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 31)
        MOV     A,?V0 + 13
        MOV     ?V0 + 4,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 32)
        MOV     ?V0 + 4,#0x1
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 33)
        MOV     ?V0 + 4,#0x1
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 34)
        MOV     ?V0 + 4,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 35)
        MOV     R4,#0x0
        MOV     R5,#0x8
        MOV     R2,?V0 + 14
        MOV     R3,?V0 + 15
        MOV     R1,?V0 + 10
        LCALL   ??zcl_SendCommand?relay
        MOV     A,#0xb
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 24)
        MOV     A,R1
        MOV     ?V0 + 11,A
//  591   osal_mem_free(buf);
        ; Setup parameters for call to function osal_mem_free
        MOV     R2,?V0 + 2
        MOV     R3,?V0 + 3
        LCALL   ??osal_mem_free?relay
//  592 
//  593   return ret;
        MOV     R1,?V0 + 11
??zclGeneral_KeyEstablish_Send_InitiateKeyEstab_5:
        MOV     R7,#0x10
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock7
//  594 }
//  595 
//  596 /*********************************************************************
//  597  * @fn      zclGeneral_KeyEstablish_Send_EphemeralDataRsp
//  598  *
//  599  * @brief   Call to send out a Ephemeral Data Response Command
//  600  *
//  601  * @param   srcEP - Sending application's endpoint
//  602  * @param   dstAddr - where you want the message to go
//  603  * @param   eData - ephemeral data.
//  604  * @param   disableDefaultRsp - disable default response
//  605  * @param   seqNum - ZCL sequence number
//  606  *
//  607  * @return  ZStatus_t
//  608  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  609 ZStatus_t zclGeneral_KeyEstablish_Send_EphemeralDataRsp( uint8 srcEP, afAddrType_t *dstAddr,
zclGeneral_KeyEstablish_Send_EphemeralDataRsp:
          CFI Block cfiBlock8 Using cfiCommon0
          CFI Function zclGeneral_KeyEstablish_Send_EphemeralDataRsp
        CODE
//  610                                              uint8 *eData,
//  611                                              uint8 disableDefaultRsp, uint8 seqNum )
//  612 {
        FUNCALL zclGeneral_KeyEstablish_Send_EphemeralDataRsp, zcl_SendCommand
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 27, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 27, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x10
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V7 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-16)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 16)
        ; Saved register size: 16
        ; Auto size: 0
        MOV     ?V0 + 0,R1
        MOV     A,R2
        MOV     R6,A
        MOV     A,R3
        MOV     R7,A
        MOV     ?V0 + 2,R4
        MOV     ?V0 + 3,R5
        MOV     A,#0x10
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 1,A
        MOV     A,#0x11
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
//  613   return (zcl_SendCommand( srcEP, dstAddr,
//  614                            ZCL_CLUSTER_ID_GEN_KEY_ESTABLISHMENT,
//  615                            COMMAND_EPHEMERAL_DATA_RESPONSE, TRUE,
//  616                            ZCL_FRAME_SERVER_CLIENT_DIR, disableDefaultRsp,
//  617                            0, seqNum, ZCL_KE_CA_PUBLIC_KEY_LEN, eData ));
        ; Setup parameters for call to function zcl_SendCommand
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 18)
        MOV     ?V0 + 6,#0x16
        MOV     ?V0 + 7,#0x0
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 20)
        MOV     A,?V0 + 4
        MOV     ?V0 + 5,A
        MOV     R0,#?V0 + 5
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 21)
        CLR     A
        MOV     ?V0 + 6,A
        MOV     ?V0 + 7,A
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 23)
        MOV     A,?V0 + 1
        MOV     ?V0 + 5,A
        MOV     R0,#?V0 + 5
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 24)
        MOV     ?V0 + 5,#0x1
        MOV     R0,#?V0 + 5
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 25)
        MOV     ?V0 + 5,#0x1
        MOV     R0,#?V0 + 5
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 26)
        MOV     ?V0 + 5,#0x1
        MOV     R0,#?V0 + 5
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 27)
        MOV     R4,#0x0
        MOV     R5,#0x8
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        MOV     R1,?V0 + 0
        LCALL   ??zcl_SendCommand?relay
        MOV     A,#0xb
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 16)
        MOV     R7,#0x8
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock8
//  618 }
//  619 
//  620 /*********************************************************************
//  621  * @fn      zclGeneral_KeyEstablish_Send_ConfirmKeyRsp
//  622  *
//  623  * @brief   Call to send out a Confirm Key Response
//  624  *
//  625  * @param   srcEP - Sending application's endpoint
//  626  * @param   dstAddr - where you want the message to go
//  627  * @param   mac - MAC
//  628  * @param   disableDefaultRsp - disable default response
//  629  * @param   seqNum - ZCL sequence number
//  630  *
//  631  * @return  ZStatus_t
//  632  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  633 ZStatus_t zclGeneral_KeyEstablish_Send_ConfirmKeyRsp( uint8 srcEP, afAddrType_t *dstAddr,
zclGeneral_KeyEstablish_Send_ConfirmKeyRsp:
          CFI Block cfiBlock9 Using cfiCommon0
          CFI Function zclGeneral_KeyEstablish_Send_ConfirmKeyRsp
        CODE
//  634                                              uint8 *mac,
//  635                                              uint8 disableDefaultRsp, uint8 seqNum )
//  636 {
        FUNCALL zclGeneral_KeyEstablish_Send_ConfirmKeyRsp, zcl_SendCommand
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 27, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 27, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x10
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V7 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-16)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 16)
        ; Saved register size: 16
        ; Auto size: 0
        MOV     ?V0 + 0,R1
        MOV     A,R2
        MOV     R6,A
        MOV     A,R3
        MOV     R7,A
        MOV     ?V0 + 2,R4
        MOV     ?V0 + 3,R5
        MOV     A,#0x10
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 1,A
        MOV     A,#0x11
        LCALL   ?XSTACK_DISP0_8
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
//  637   return (zcl_SendCommand(srcEP, dstAddr,
//  638                            ZCL_CLUSTER_ID_GEN_KEY_ESTABLISHMENT,
//  639                            COMMAND_CONFIRM_KEY_RESPONSE, TRUE,
//  640                            ZCL_FRAME_SERVER_CLIENT_DIR, disableDefaultRsp,
//  641                            0, seqNum, KEY_ESTABLISH_MAC_LENGTH, mac ));
        ; Setup parameters for call to function zcl_SendCommand
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 18)
        MOV     ?V0 + 6,#0x10
        MOV     ?V0 + 7,#0x0
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 20)
        MOV     A,?V0 + 4
        MOV     ?V0 + 5,A
        MOV     R0,#?V0 + 5
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 21)
        CLR     A
        MOV     ?V0 + 6,A
        MOV     ?V0 + 7,A
        MOV     R0,#?V0 + 6
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 23)
        MOV     A,?V0 + 1
        MOV     ?V0 + 5,A
        MOV     R0,#?V0 + 5
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 24)
        MOV     ?V0 + 5,#0x1
        MOV     R0,#?V0 + 5
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 25)
        MOV     ?V0 + 5,#0x1
        MOV     R0,#?V0 + 5
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 26)
        MOV     ?V0 + 5,#0x2
        MOV     R0,#?V0 + 5
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 27)
        MOV     R4,#0x0
        MOV     R5,#0x8
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        MOV     R1,?V0 + 0
        LCALL   ??zcl_SendCommand?relay
        MOV     A,#0xb
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 16)
        MOV     R7,#0x8
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock9
//  642 }
//  643 
//  644 /*********************************************************************
//  645  * @fn      zclGeneral_KeyEstablish_Send_ConfirmKeyRsp
//  646  *
//  647  * @brief   Register the user defined yielding function
//  648  *
//  649  * @param   yield - Pointer to a function to allow user defined yielding.
//  650  *          YieldFunc may be NULL if yieldLevel is 0
//  651  * @param   yieldLevel - The yield level determines how often the user defined
//  652  *          yield function will be called. This is a number from 0 to 10.
//  653  *          0 will never yield. 1 will yield the most often. 10 will yield the
//  654  *          least often.
//  655  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  656 void zclGeneral_KeyEstablishment_RegYieldCB( YieldFunc *pFnYield,
zclGeneral_KeyEstablishment_RegYieldCB:
          CFI Block cfiBlock10 Using cfiCommon0
          CFI Function zclGeneral_KeyEstablishment_RegYieldCB
        CODE
//  657                                              uint8 yieldLevel )
//  658 {
        PUSH    DPL
          CFI DPL0 Frame(CFA_SP, 4)
          CFI CFA_SP SP+-4
        PUSH    DPH
          CFI DPH0 Frame(CFA_SP, 5)
          CFI CFA_SP SP+-5
        ; Saved register size: 2
        ; Auto size: 0
//  659   if( pFnYield == NULL )
        MOV     A,R2
        ORL     A,R3
        JNZ     ??zclGeneral_KeyEstablishment_RegYieldCB_0
//  660   {
//  661     zclKeyEstablish_YieldLevel = 0;
        MOV     DPTR,#zclKeyEstablish_YieldLevel
        MOV     A,#0x0
        MOVX    @DPTR,A
        SJMP    ??zclGeneral_KeyEstablishment_RegYieldCB_1
//  662   }
//  663   else
//  664   {
//  665     zclKeyEstablish_YieldFunc = pFnYield;
??zclGeneral_KeyEstablishment_RegYieldCB_0:
        MOV     DPTR,#zclKeyEstablish_YieldFunc
        MOV     A,R2
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R3
        MOVX    @DPTR,A
//  666     zclKeyEstablish_YieldLevel = yieldLevel;
        MOV     A,R1
        MOV     DPTR,#zclKeyEstablish_YieldLevel
        MOVX    @DPTR,A
//  667   }
//  668 }
??zclGeneral_KeyEstablishment_RegYieldCB_1:
        POP     DPH
          CFI DPH0 SameValue
          CFI CFA_SP SP+-4
        POP     DPL
          CFI DPL0 SameValue
          CFI CFA_SP SP+-3
        LJMP    ?BRET
          CFI EndBlock cfiBlock10
//  669 
//  670 /*********************************************************************
//  671  * @fn      zclGeneral_KeyEstablish_HdlIncoming
//  672  *
//  673  * @brief   Callback from ZCL to process incoming Commands specific
//  674  *          to this cluster library or Profile commands
//  675  *
//  676  * @param   pInMsg - pointer to the incoming message
//  677  *
//  678  * @return  ZStatus_t
//  679  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  680 static ZStatus_t zclGeneral_KeyEstablish_HdlIncoming( zclIncoming_t *pInMsg )
zclGeneral_KeyEstablish_HdlIncoming:
          CFI Block cfiBlock11 Using cfiCommon0
          CFI Function zclGeneral_KeyEstablish_HdlIncoming
        CODE
//  681 {
        FUNCALL zclGeneral_KeyEstablish_HdlIncoming, zclGeneral_KeyEstablish_HdlInSpecificCommands
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 9, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x9
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 9)
        ; Saved register size: 9
        ; Auto size: 0
        MOV     A,R2
        MOV     R6,A
        MOV     A,R3
        MOV     R7,A
//  682   ZStatus_t stat = ZSuccess;
        MOV     ?V0 + 0,#0x0
//  683 
//  684 #if defined ( INTER_PAN )
//  685   if ( StubAPS_InterPan( pInMsg->msg->srcAddr.panId, pInMsg->msg->srcAddr.endPoint ) )
//  686     return ( stat ); // Cluster not supported thru Inter-PAN
//  687 #endif
//  688 
//  689   if ( zcl_ClusterCmd( pInMsg->hdr.fc.type ) )
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        ANL     A,#0x3
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        ANL     A,#0x0
        MOV     R1,A
        MOV     A,R0
        XRL     A,#0x1
        JNZ     ??zclGeneral_KeyEstablish_HdlIncoming_0
//  690   {
//  691     // Is this a manufacturer specific command?
//  692     if ( pInMsg->hdr.fc.manuSpecific == 0 )
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R1,A
        MOV     A,R0
        RRC     A
        RRC     A
        ANL     A,#0x3f
        MOV     R0,A
        MOV     R1,#0x0
        ANL     A,#0x1
        MOV     R0,A
        MOV     A,R1
        ANL     A,#0x0
        MOV     R1,A
        MOV     A,R0
        MOV     C,0xE0 /* A   */.0
        JC      ??zclGeneral_KeyEstablish_HdlIncoming_1
//  693     {
//  694       stat = zclGeneral_KeyEstablish_HdlInSpecificCommands( pInMsg );
        ; Setup parameters for call to function zclGeneral_KeyEstablish_HdlInSpecificCommands
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   ??zclGeneral_KeyEstablish_HdlInSpecificCommands
        MOV     A,R1
        MOV     ?V0 + 0,A
        SJMP    ??zclGeneral_KeyEstablish_HdlIncoming_2
//  695     }
//  696     else
//  697     {
//  698       // We don't support any manufacturer specific command.
//  699       stat = ZFailure;
??zclGeneral_KeyEstablish_HdlIncoming_1:
        MOV     ?V0 + 0,#0x1
        SJMP    ??zclGeneral_KeyEstablish_HdlIncoming_2
//  700     }
//  701   }
//  702   else
//  703   {
//  704     // Handle all the normal (Read, Write...) commands -- should never get here
//  705     stat = ZFailure;
??zclGeneral_KeyEstablish_HdlIncoming_0:
        MOV     ?V0 + 0,#0x1
//  706   }
//  707   return ( stat );
??zclGeneral_KeyEstablish_HdlIncoming_2:
        MOV     R1,?V0 + 0
        MOV     R7,#0x1
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock11
//  708 }
//  709 
//  710 /*********************************************************************
//  711  * @fn      zclGeneral_KeyEstablish_HdlInSpecificCommands
//  712  *
//  713  * @brief   Callback from ZCL to process incoming Commands specific
//  714  *          to this cluster library
//  715 
//  716  * @param   pInMsg - pointer to the incoming message
//  717  *
//  718  * @return  ZStatus_t
//  719  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  720 static ZStatus_t zclGeneral_KeyEstablish_HdlInSpecificCommands( zclIncoming_t *pInMsg )
zclGeneral_KeyEstablish_HdlInSpecificCommands:
          CFI Block cfiBlock12 Using cfiCommon0
          CFI Function zclGeneral_KeyEstablish_HdlInSpecificCommands
        CODE
//  721 {
        FUNCALL zclGeneral_KeyEstablish_HdlInSpecificCommands, zclGeneral_ProcessInCmd_InitiateKeyEstablish
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 9, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_HdlInSpecificCommands, zclGeneral_ProcessInCmd_EphemeralDataReq
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 9, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_HdlInSpecificCommands, zclGeneral_ProcessInCmd_ConfirmKey
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 9, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_HdlInSpecificCommands, zclGeneral_ProcessInCmd_TerminateKeyEstablish
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 9, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_HdlInSpecificCommands, zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 9, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_HdlInSpecificCommands, zclGeneral_ProcessInCmd_EphemeralDataRsp
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 9, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_HdlInSpecificCommands, zclGeneral_ProcessInCmd_ConfirmKeyRsp
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 9, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablish_HdlInSpecificCommands, zclGeneral_ProcessInCmd_TerminateKeyEstablish
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 9, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x9
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 9)
        ; Saved register size: 9
        ; Auto size: 0
        MOV     A,R2
        MOV     R6,A
        MOV     A,R3
        MOV     R7,A
//  722   ZStatus_t stat;
//  723 
//  724   if ( zcl_ServerCmd( pInMsg->hdr.fc.direction ) )
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R1,A
        MOV     A,R0
        RRC     A
        RRC     A
        RRC     A
        ANL     A,#0x1f
        MOV     R0,A
        MOV     R1,#0x0
        ANL     A,#0x1
        MOV     R0,A
        MOV     A,R1
        ANL     A,#0x0
        MOV     R1,A
        MOV     A,R0
        MOV     C,0xE0 /* A   */.0
        JC      ??zclGeneral_KeyEstablish_HdlInSpecificCommands_1
//  725   {
//  726     // Commands received by Server
//  727     switch ( pInMsg->hdr.commandID )
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        JZ      ??zclGeneral_KeyEstablish_HdlInSpecificCommands_2
        DEC     A
        JZ      ??zclGeneral_KeyEstablish_HdlInSpecificCommands_3
        DEC     A
        JZ      ??zclGeneral_KeyEstablish_HdlInSpecificCommands_4
        DEC     A
        JZ      ??zclGeneral_KeyEstablish_HdlInSpecificCommands_5
        SJMP    ??zclGeneral_KeyEstablish_HdlInSpecificCommands_6
//  728     {
//  729       case COMMAND_INITIATE_KEY_ESTABLISHMENT:
//  730         stat = zclGeneral_ProcessInCmd_InitiateKeyEstablish( pInMsg );
??zclGeneral_KeyEstablish_HdlInSpecificCommands_2:
        ; Setup parameters for call to function zclGeneral_ProcessInCmd_InitiateKeyEstablish
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   ??zclGeneral_ProcessInCmd_InitiateKeyEstablish?
        MOV     A,R1
        MOV     ?V0 + 0,A
//  731         break;
        SJMP    ??zclGeneral_KeyEstablish_HdlInSpecificCommands_7
//  732 
//  733       case COMMAND_EPHEMERAL_DATA_REQUEST:
//  734         stat = zclGeneral_ProcessInCmd_EphemeralDataReq( pInMsg );
??zclGeneral_KeyEstablish_HdlInSpecificCommands_3:
        ; Setup parameters for call to function zclGeneral_ProcessInCmd_EphemeralDataReq
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   ??zclGeneral_ProcessInCmd_EphemeralDataReq?rela
        MOV     A,R1
        MOV     ?V0 + 0,A
//  735         break;
        SJMP    ??zclGeneral_KeyEstablish_HdlInSpecificCommands_7
//  736 
//  737       case COMMAND_CONFIRM_KEY:
//  738         stat = zclGeneral_ProcessInCmd_ConfirmKey( pInMsg );
??zclGeneral_KeyEstablish_HdlInSpecificCommands_4:
        ; Setup parameters for call to function zclGeneral_ProcessInCmd_ConfirmKey
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   ??zclGeneral_ProcessInCmd_ConfirmKey?relay
        MOV     A,R1
        MOV     ?V0 + 0,A
//  739         break;
        SJMP    ??zclGeneral_KeyEstablish_HdlInSpecificCommands_7
//  740 
//  741       case COMMAND_TERMINATE_KEY_ESTABLISHMENT:
//  742         stat = zclGeneral_ProcessInCmd_TerminateKeyEstablish( pInMsg );
??zclGeneral_KeyEstablish_HdlInSpecificCommands_5:
        ; Setup parameters for call to function zclGeneral_ProcessInCmd_TerminateKeyEstablish
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   ??zclGeneral_ProcessInCmd_TerminateKeyEstablish
        MOV     A,R1
        MOV     ?V0 + 0,A
//  743         break;
        SJMP    ??zclGeneral_KeyEstablish_HdlInSpecificCommands_7
//  744 
//  745       default:
//  746         stat = ZFailure;
??zclGeneral_KeyEstablish_HdlInSpecificCommands_6:
        MOV     ?V0 + 0,#0x1
//  747         break;
        SJMP    ??zclGeneral_KeyEstablish_HdlInSpecificCommands_7
//  748     }
//  749   }
//  750   else
//  751   {
//  752     // Commands received by Client
//  753     switch ( pInMsg->hdr.commandID )
??zclGeneral_KeyEstablish_HdlInSpecificCommands_1:
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        JZ      ??zclGeneral_KeyEstablish_HdlInSpecificCommands_8
        DEC     A
        JZ      ??zclGeneral_KeyEstablish_HdlInSpecificCommands_9
        DEC     A
        JZ      ??zclGeneral_KeyEstablish_HdlInSpecificCommands_10
        DEC     A
        JZ      ??zclGeneral_KeyEstablish_HdlInSpecificCommands_11
        SJMP    ??zclGeneral_KeyEstablish_HdlInSpecificCommands_12
//  754     {
//  755       case COMMAND_INITIATE_KEY_ESTABLISHMENT_RESPONSE:
//  756         stat = zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp( pInMsg );
??zclGeneral_KeyEstablish_HdlInSpecificCommands_8:
        ; Setup parameters for call to function zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR
        MOV     A,R1
        MOV     ?V0 + 0,A
//  757         break;
        SJMP    ??zclGeneral_KeyEstablish_HdlInSpecificCommands_7
//  758 
//  759       case COMMAND_EPHEMERAL_DATA_RESPONSE:
//  760         stat = zclGeneral_ProcessInCmd_EphemeralDataRsp( pInMsg );
??zclGeneral_KeyEstablish_HdlInSpecificCommands_9:
        ; Setup parameters for call to function zclGeneral_ProcessInCmd_EphemeralDataRsp
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   ??zclGeneral_ProcessInCmd_EphemeralDataRsp?rela
        MOV     A,R1
        MOV     ?V0 + 0,A
//  761         break;
        SJMP    ??zclGeneral_KeyEstablish_HdlInSpecificCommands_7
//  762 
//  763       case COMMAND_CONFIRM_KEY_RESPONSE:
//  764         stat = zclGeneral_ProcessInCmd_ConfirmKeyRsp( pInMsg );
??zclGeneral_KeyEstablish_HdlInSpecificCommands_10:
        ; Setup parameters for call to function zclGeneral_ProcessInCmd_ConfirmKeyRsp
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   ??zclGeneral_ProcessInCmd_ConfirmKeyRsp?relay
        MOV     A,R1
        MOV     ?V0 + 0,A
//  765         break;
        SJMP    ??zclGeneral_KeyEstablish_HdlInSpecificCommands_7
//  766 
//  767       case COMMAND_TERMINATE_KEY_ESTABLISHMENT:
//  768         stat = zclGeneral_ProcessInCmd_TerminateKeyEstablish( pInMsg );
??zclGeneral_KeyEstablish_HdlInSpecificCommands_11:
        ; Setup parameters for call to function zclGeneral_ProcessInCmd_TerminateKeyEstablish
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   ??zclGeneral_ProcessInCmd_TerminateKeyEstablish
        MOV     A,R1
        MOV     ?V0 + 0,A
//  769         break;
        SJMP    ??zclGeneral_KeyEstablish_HdlInSpecificCommands_7
//  770 
//  771       default:
//  772         stat = ZFailure;
??zclGeneral_KeyEstablish_HdlInSpecificCommands_12:
        MOV     ?V0 + 0,#0x1
//  773         break;
//  774     }
//  775   }
//  776 
//  777   return ( stat );
??zclGeneral_KeyEstablish_HdlInSpecificCommands_7:
        MOV     R1,?V0 + 0
        MOV     R7,#0x1
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock12
//  778 }
//  779 
//  780 /*********************************************************************
//  781  * @fn      zclGeneral_ProcessInCmd_InitiateKeyEstablish
//  782  *
//  783  * @brief   Process the received Initiate Key Establishment Request.
//  784  *
//  785  * @param   pInMsg - pointer to the incoming message
//  786  *
//  787  * @return  ZStatus_t - ZFailure @ Unsupported
//  788  *                      ZCL_STATUS_MALFORMED_COMMAND
//  789  *                      ZCL_STATUS_CMD_HAS_RSP
//  790  *                      ZCL_STATUS_SOFTWARE_FAILURE
//  791  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  792 static ZStatus_t zclGeneral_ProcessInCmd_InitiateKeyEstablish( zclIncoming_t *pInMsg )
zclGeneral_ProcessInCmd_InitiateKeyEstablish:
          CFI Block cfiBlock13 Using cfiCommon0
          CFI Function zclGeneral_ProcessInCmd_InitiateKeyEstablish
        CODE
//  793 {
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablish, zclGeneral_AddKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 18, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 18, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablish, osal_memcpy
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 21, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 21, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablish, osal_mem_alloc
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 18, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 18, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablish, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 18, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 18, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablish, osal_nv_read
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 22, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 22, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablish, osal_memcmp
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 21, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 21, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablish, zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 23, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 23, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablish, osal_mem_free
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 18, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 18, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablish, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 18, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 18, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablish, SSP_MemCpyReverse
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablish, zclGeneral_KeyEstablish_Send_InitiateKeyEstablishmentRsp
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 24, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablish, osal_start_reload_timer
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 18, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 18, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablish, osal_mem_free
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 18, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 18, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablish, NLME_SetPollRate
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 18, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 18, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x12
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V9 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V8 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V7 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-16)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-17)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-18)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 18)
        ; Saved register size: 18
        ; Auto size: 0
        MOV     ?V0 + 0,R2
        MOV     ?V0 + 1,R3
//  794   TermKeyStatus_t status = TermKeyStatus_Success;
        MOV     R6,#0x0
//  795   uint16 remoteKeyEstablishmentSuite;
//  796   uint8 *implicitCert = NULL;
        MOV     ?V0 + 2,#0x0
        MOV     ?V0 + 3,#0x0
//  797   uint8 index = MAX_KEY_ESTABLISHMENT_REC_ENTRY;  // set to non valid value
        MOV     R7,#0x2
//  798 
//  799   // Check the incoming packet length
//  800   if ( pInMsg->pDataLen < PACKET_LEN_INITIATE_KEY_EST_REQ )
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        CLR     C
        MOVX    A,@DPTR
        SUBB    A,#0x34
        INC     DPTR
        MOVX    A,@DPTR
        SUBB    A,#0x0
        JNC     ??zclGeneral_ProcessInCmd_InitiateKeyEstablish_0
//  801   {
//  802     status = TermKeyStatus_BadMessage;
        MOV     R6,#0x3
        LJMP    ??zclGeneral_ProcessInCmd_InitiateKeyEstablish_1 & 0xFFFF
//  803   }
//  804   else
//  805   {
//  806     // Start a new key establishment rec entry
//  807     index = zclGeneral_AddKeyEstablishRec( &pInMsg->msg->srcAddr );
??zclGeneral_ProcessInCmd_InitiateKeyEstablish_0:
        ; Setup parameters for call to function zclGeneral_AddKeyEstablishRec
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOVX    A,@DPTR
        ADD     A,#0x6
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#0x0
        MOV     R3,A
        LCALL   ??zclGeneral_AddKeyEstablishRec?relay
        MOV     A,R1
        MOV     R7,A
//  808 
//  809     if( index >= MAX_KEY_ESTABLISHMENT_REC_ENTRY )
        MOV     A,R7
        CLR     C
        SUBB    A,#0x2
        JC      ??zclGeneral_ProcessInCmd_InitiateKeyEstablish_2
//  810     {
//  811       // Failed to add an entry
//  812       status = TermKeyStatus_NoResources;
        MOV     R6,#0x4
        LJMP    ??zclGeneral_ProcessInCmd_InitiateKeyEstablish_1 & 0xFFFF
//  813     }
//  814     else
//  815     {
//  816       // Parse the incoming message
//  817       // Copy the remote device certificate
//  818       osal_memcpy(keyEstablishRec[index].pRemoteCertificate, &(pInMsg->pData[KEY_ESTABLISH_CERT_IDX]),
//  819                   ZCL_KE_IMPLICIT_CERTIFICATE_LEN );
??zclGeneral_ProcessInCmd_InitiateKeyEstablish_2:
        ; Setup parameters for call to function osal_memcpy
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        ADD     A,#0x4
        MOV     ?V0 + 4,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#0x0
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 21)
        MOV     R4,#0x30
        MOV     R5,#0x0
        MOV     A,R7
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 31) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 31) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 18)
//  820 
//  821       // Verify the certificate issuer and key establishment suite
//  822       remoteKeyEstablishmentSuite = BUILD_UINT16( pInMsg->pData[0], pInMsg->pData[1] );
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     DPH,A
        MOV     DPL,R0
        MOVX    A,@DPTR
        MOV     R2,A
        MOV     R3,#0x0
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     DPH,A
        MOV     DPL,R0
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        MOV     R1,#0x0
        CLR     A
        XCH     A,R0
        MOV     R1,A
        MOV     A,R2
        ADD     A,R0
        MOV     R0,A
        MOV     A,R3
        ADDC    A,R1
        MOV     R1,A
        MOV     ?V0 + 8,R0
        MOV     ?V0 + 9,R1
//  823 
//  824       if ( remoteKeyEstablishmentSuite != KEY_ESTABLISHMENT_SUITE )
        MOV     A,#0x1
        XRL     A,?V0 + 8
        JNZ     ??zclGeneral_ProcessInCmd_InitiateKeyEstablish_3
        MOV     A,#0x0
        XRL     A,?V0 + 9
??zclGeneral_ProcessInCmd_InitiateKeyEstablish_3:
        JZ      ??zclGeneral_ProcessInCmd_InitiateKeyEstablish_4
//  825       {
//  826         status = TermKeyStatus_UnSupportedSuite;
        MOV     R6,#0x5
        LJMP    ??zclGeneral_ProcessInCmd_InitiateKeyEstablish_1 & 0xFFFF
//  827       }
//  828       else
//  829       {
//  830         // continue parsing message
//  831         // Save Ephemeral Data Generate Key and Confirm Key Time
//  832         if (pInMsg->pData[2] >= KEY_ESTABLISHMENT_EPH_DATA_GEN_INVALID_TIME)
??zclGeneral_ProcessInCmd_InitiateKeyEstablish_4:
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     DPH,A
        MOV     DPL,R0
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        CLR     C
        SUBB    A,#-0x1
        JC      ??zclGeneral_ProcessInCmd_InitiateKeyEstablish_5
//  833         {
//  834           status = TermKeyStatus_BadMessage;
        MOV     R6,#0x3
        LJMP    ??zclGeneral_ProcessInCmd_InitiateKeyEstablish_1 & 0xFFFF
//  835         }
//  836         else
//  837         {
//  838           // continue parsing message
//  839           keyEstablishRec[index].remoteEphDataGenTime = pInMsg->pData[2];
??zclGeneral_ProcessInCmd_InitiateKeyEstablish_5:
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     DPH,A
        MOV     DPL,R0
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        PUSH    A
          CFI CFA_SP SP+-1
        MOV     A,R7
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 37) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 37) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        POP     A
          CFI CFA_SP SP+0
        MOVX    @DPTR,A
//  840 
//  841           if (pInMsg->pData[3] >= KEY_ESTABLISHMENT_CONF_KEY_GEN_INVALID_TIME)
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     DPH,A
        MOV     DPL,R0
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        CLR     C
        SUBB    A,#-0x1
        JC      ??zclGeneral_ProcessInCmd_InitiateKeyEstablish_6
//  842           {
//  843             status = TermKeyStatus_BadMessage;
        MOV     R6,#0x3
        LJMP    ??zclGeneral_ProcessInCmd_InitiateKeyEstablish_1 & 0xFFFF
//  844           }
//  845           else
//  846           {
//  847             // continue parsing message
//  848             keyEstablishRec[index].remoteConfKeyGenTime = pInMsg->pData[3];
??zclGeneral_ProcessInCmd_InitiateKeyEstablish_6:
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     DPH,A
        MOV     DPL,R0
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        PUSH    A
          CFI CFA_SP SP+-1
        MOV     A,R7
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 38) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 38) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        POP     A
          CFI CFA_SP SP+0
        MOVX    @DPTR,A
//  849 
//  850             if ((implicitCert = osal_mem_alloc(ZCL_KE_IMPLICIT_CERTIFICATE_LEN)) == NULL)
        ; Setup parameters for call to function osal_mem_alloc
        MOV     R2,#0x30
        MOV     R3,#0x0
        LCALL   ??osal_mem_alloc?relay
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     R0,?V0 + 4
        MOV     R1,?V0 + 5
        MOV     ?V0 + 2,R0
        MOV     ?V0 + 3,R1
        MOV     A,R0
        ORL     A,R1
        JNZ     ??zclGeneral_ProcessInCmd_InitiateKeyEstablish_7
//  851             {
//  852               // Reset the entry
//  853               zclGeneral_ResetKeyEstablishRec( index );
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R7
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
//  854 
//  855               return ZCL_STATUS_SOFTWARE_FAILURE;  // Memory allocation failure.
        MOV     R1,#-0x3f
        LJMP    ??zclGeneral_ProcessInCmd_InitiateKeyEstablish_8 & 0xFFFF
//  856             }
//  857 
//  858             osal_nv_read(ZCD_NV_IMPLICIT_CERTIFICATE, 0, ZCL_KE_IMPLICIT_CERTIFICATE_LEN, implicitCert);
??zclGeneral_ProcessInCmd_InitiateKeyEstablish_7:
        ; Setup parameters for call to function osal_nv_read
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 20)
        MOV     ?V0 + 4,#0x30
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 22)
        MOV     R4,#0x0
        MOV     R5,#0x0
        MOV     R2,#0x69
        MOV     R3,#0x0
        LCALL   ??osal_nv_read?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 18)
        MOV     A,R1
//  859 
//  860             if ( !osal_memcmp( &(keyEstablishRec[index].pRemoteCertificate[KEY_ESTABLISH_CERT_ISSUER_IDX]),
//  861                                &(implicitCert[KEY_ESTABLISH_CERT_ISSUER_IDX]),
//  862                                KEY_ESTABLISH_CERT_ISSUER_LENTGH ) )
        ; Setup parameters for call to function osal_memcmp
        MOV     A,?V0 + 2
        ADD     A,#0x1e
        MOV     ?V0 + 4,A
        MOV     A,?V0 + 3
        ADDC    A,#0x0
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 21)
        MOV     R4,#0x8
        MOV     R5,#0x0
        MOV     A,R7
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 31) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 31) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        XCH     A,R0
        ADD     A,#0x1e
        MOV     DPL,A
        MOV     A,R0
        ADDC    A,#0x0
        MOV     DPH,A
        MOV     R1,DPL
        MOV     R2,DPH
        MOV     R3,#0x0
        LCALL   ??osal_memcmp?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 18)
        MOV     A,R1
        JNZ     ??zclGeneral_ProcessInCmd_InitiateKeyEstablish_1
//  863             {
//  864               status = TermKeyStatus_UnknowIssuer;
        MOV     R6,#0x1
//  865             }
//  866           }
//  867         }
//  868       }
//  869     } // end of parsing of the message
//  870   }
//  871 
//  872   if ( status != TermKeyStatus_Success )
??zclGeneral_ProcessInCmd_InitiateKeyEstablish_1:
        MOV     A,R6
        JZ      ??zclGeneral_ProcessInCmd_InitiateKeyEstablish_9
//  873   {
//  874     zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment( ZCL_KEY_ESTABLISHMENT_ENDPOINT,
//  875                                                             &pInMsg->msg->srcAddr,
//  876                                                             status,
//  877                                                             KEY_ESTABLISHMENT_AVG_TIMEOUT,
//  878                                                             KEY_ESTABLISHMENT_SUITE,
//  879                                                             ZCL_FRAME_SERVER_CLIENT_DIR,
//  880                                                             FALSE, zcl_SeqNum++ );
        MOV     DPTR,#zcl_SeqNum
        MOVX    A,@DPTR
        MOV     R0,A
        MOV     A,#0x1
        ADD     A,R0
        MOV     DPTR,#zcl_SeqNum
        MOVX    @DPTR,A
        ; Setup parameters for call to function zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment
        MOV     A,R0
        MOV     ?V0 + 4,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 19)
        MOV     ?V0 + 4,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 20)
        MOV     ?V0 + 4,#0x1
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 21)
        MOV     ?V0 + 4,#0x1
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 23)
        MOV     R5,#0x1c
        MOV     A,R6
        MOV     R4,A
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOVX    A,@DPTR
        ADD     A,#0x6
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#0x0
        MOV     R3,A
        MOV     R1,#0xa
        LCALL   ??zclGeneral_KeyEstablish_Send_TerminateKeyEsta
        MOV     A,#0x5
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 18)
        MOV     A,R1
//  881     if ( implicitCert != NULL )
        MOV     A,?V0 + 2
        ORL     A,?V0 + 3
        JZ      ??zclGeneral_ProcessInCmd_InitiateKeyEstablish_10
//  882     {
//  883       osal_mem_free(implicitCert);
        ; Setup parameters for call to function osal_mem_free
        MOV     R2,?V0 + 2
        MOV     R3,?V0 + 3
        LCALL   ??osal_mem_free?relay
//  884     }
//  885 
//  886     // Reset the entry
//  887     if ( index < MAX_KEY_ESTABLISHMENT_REC_ENTRY )
??zclGeneral_ProcessInCmd_InitiateKeyEstablish_10:
        MOV     A,R7
        CLR     C
        SUBB    A,#0x2
        JNC     ??zclGeneral_ProcessInCmd_InitiateKeyEstablish_11
//  888     {
//  889       zclGeneral_ResetKeyEstablishRec( index );
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R7
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
//  890     }
//  891 
//  892     return ZCL_STATUS_CMD_HAS_RSP;
??zclGeneral_ProcessInCmd_InitiateKeyEstablish_11:
        MOV     R1,#-0x1
        LJMP    ??zclGeneral_ProcessInCmd_InitiateKeyEstablish_8 & 0xFFFF
//  893   }
//  894 
//  895   // Fill in partner's extended address
//  896   SSP_MemCpyReverse( keyEstablishRec[index].partnerExtAddr,
//  897                     &(keyEstablishRec[index].pRemoteCertificate[KEY_ESTABLISH_CERT_EXT_ADDR_IDX]),
//  898                     Z_EXTADDR_LEN); // ID(L)
??zclGeneral_ProcessInCmd_InitiateKeyEstablish_9:
        ; Setup parameters for call to function SSP_MemCpyReverse
        MOV     ?V0 + 4,#0x8
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 20)
        MOV     A,R7
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 31) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 31) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        ADD     A,#0x16
        MOV     R4,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#0x0
        MOV     R5,A
        MOV     A,R7
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 14) & 0xff
        ADD     A,R0
        MOV     R2,A
        MOV     A,#((keyEstablishRec + 14) >> 8) & 0xff
        ADDC    A,R1
        MOV     R3,A
        LCALL   ??SSP_MemCpyReverse?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 18)
//  899 
//  900   // Change the state and wait for the Ephemeral Data Request
//  901   keyEstablishRec[index].lastSeqNum = pInMsg->hdr.transSeqNum;
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        PUSH    A
          CFI CFA_SP SP+-1
        MOV     A,R7
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 12) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 12) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        POP     A
          CFI CFA_SP SP+0
        MOVX    @DPTR,A
//  902   keyEstablishRec[index].state = KeyEstablishState_EDataPending;
        MOV     A,R7
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 24) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 24) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,#0x2
        MOVX    @DPTR,A
//  903   keyEstablishRec[index].role = KEY_ESTABLISHMENT_RESPONDER;
        MOV     A,R7
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 22) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 22) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,#0x1
        MOVX    @DPTR,A
//  904 
//  905   zclGeneral_KeyEstablish_Send_InitiateKeyEstablishmentRsp( ZCL_KEY_ESTABLISHMENT_ENDPOINT,
//  906             &pInMsg->msg->srcAddr,
//  907             KEY_ESTABLISHMENT_SUITE,
//  908             ZCL_KEY_ESTABLISHMENT_EKEY_GENERATE_TIMEOUT + ZCL_KEY_ESTABLISHMENT_KEY_GENERATE_TIMEOUT,
//  909             ZCL_KEY_ESTABLISHMENT_MAC_GENERATE_TIMEOUT * 2 ,
//  910             implicitCert, FALSE, pInMsg->hdr.transSeqNum );
        ; Setup parameters for call to function zclGeneral_KeyEstablish_Send_InitiateKeyEstablishmentRsp
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 19)
        MOV     ?V0 + 4,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 20)
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 22)
        MOV     ?V0 + 4,#0x14
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 23)
        MOV     ?V0 + 4,#0xe
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 24)
        MOV     R4,#0x1
        MOV     R5,#0x0
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOVX    A,@DPTR
        ADD     A,#0x6
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#0x0
        MOV     R3,A
        MOV     R1,#0xa
        LCALL   ??zclGeneral_KeyEstablish_Send_InitiateKeyEstab_1
        MOV     A,#0x6
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 18)
        MOV     A,R1
//  911 
//  912   // The Request was processed successfuly, now the age timer needs to start based on the
//  913   // remote Ephemeral Data Generate Time
//  914   keyEstablishRec[index].age = keyEstablishRec[index].remoteEphDataGenTime;
        MOV     A,R7
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 37) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 37) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        PUSH    A
          CFI CFA_SP SP+-1
        MOV     A,R7
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 23) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 23) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        POP     A
          CFI CFA_SP SP+0
        MOVX    @DPTR,A
//  915 
//  916   // Start the Ephemeral Data Generate aging timer
//  917   osal_start_reload_timer( zcl_KeyEstablishment_TaskID, KEY_ESTABLISHMENT_REC_AGING_EVT,
//  918                            KEY_ESTABLISHMENT_REC_AGING_INTERVAL );
        ; Setup parameters for call to function osal_start_reload_timer
        MOV     R4,#-0x18
        MOV     R5,#0x3
        MOV     R2,#0x1
        MOV     R3,#0x0
        MOV     DPTR,#zcl_KeyEstablishment_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_start_reload_timer?relay
        MOV     A,R1
//  919 
//  920   osal_mem_free(implicitCert);
        ; Setup parameters for call to function osal_mem_free
        MOV     R2,?V0 + 2
        MOV     R3,?V0 + 3
        LCALL   ??osal_mem_free?relay
//  921 
//  922 #if defined (NWK_AUTO_POLL)
//  923   // For polling end device, set the Key Establishment poll rate
//  924   zclSavedPollRate = zgPollRate;
        MOV     DPTR,#zgPollRate
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R1,A
        MOV     DPTR,#zclSavedPollRate
        MOV     A,R0
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R1
        MOVX    @DPTR,A
//  925   NLME_SetPollRate(ZCL_KEY_ESTABLISH_POLL_RATE);
        ; Setup parameters for call to function NLME_SetPollRate
        MOV     R2,#-0x18
        MOV     R3,#0x3
        LCALL   ??NLME_SetPollRate?relay
//  926 #endif
//  927 
//  928   return ZCL_STATUS_CMD_HAS_RSP;
        MOV     R1,#-0x1
??zclGeneral_ProcessInCmd_InitiateKeyEstablish_8:
        MOV     R7,#0xa
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock13
//  929 }
//  930 
//  931 /*********************************************************************
//  932  * @fn      zclGeneral_ProcessInCmd_EphemeralDataReq
//  933  *
//  934  * @brief   Process the received Ephemeral Data Request.
//  935  *
//  936  * @param   pInMsg - pointer to the incoming message
//  937  *
//  938  * @return  ZStatus_t - ZFailure @ Unsupported
//  939  *                      ZCL_STATUS_MALFORMED_COMMAND
//  940  *                      ZCL_STATUS_CMD_HAS_RSP
//  941  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
//  942 static ZStatus_t zclGeneral_ProcessInCmd_EphemeralDataReq( zclIncoming_t *pInMsg )
zclGeneral_ProcessInCmd_EphemeralDataReq:
          CFI Block cfiBlock14 Using cfiCommon0
          CFI Function zclGeneral_ProcessInCmd_EphemeralDataReq
        CODE
//  943 {
        FUNCALL zclGeneral_ProcessInCmd_EphemeralDataReq, osal_stop_timerEx
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 16, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 16, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_EphemeralDataReq, zclGeneral_GetKeyEstablishRecIndex
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 16, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 16, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_EphemeralDataReq, osal_memcpy
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 19, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 19, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_EphemeralDataReq, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 16, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 16, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_EphemeralDataReq, zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 21, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 21, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_EphemeralDataReq, NLME_SetPollRate
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 16, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 16, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_EphemeralDataReq, ZSE_ECCGenerateKey
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 24, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_EphemeralDataReq, osal_start_timerEx
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 16, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 16, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x10
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V7 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-16)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 16)
        ; Saved register size: 16
        ; Auto size: 0
        MOV     ?V0 + 0,R2
        MOV     ?V0 + 1,R3
//  944   uint8 index;
//  945   uint8 status = ZFailure;
        MOV     R7,#0x1
//  946 
//  947   // Omit checking the incoming packet length
//  948 
//  949   // Stop the Ephemeral Data Generate timer because the message has been received
//  950   osal_stop_timerEx( zcl_KeyEstablishment_TaskID, KEY_ESTABLISHMENT_REC_AGING_EVT );
        ; Setup parameters for call to function osal_stop_timerEx
        MOV     R2,#0x1
        MOV     R3,#0x0
        MOV     DPTR,#zcl_KeyEstablishment_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_stop_timerEx?relay
        MOV     A,R1
//  951 
//  952   // Check state of the key establishment record. If not match, terminate the procedure
//  953   if ( ( index = zclGeneral_GetKeyEstablishRecIndex( pInMsg->msg->srcAddr.addr.shortAddr ) )
//  954       < MAX_KEY_ESTABLISHMENT_REC_ENTRY )
        ; Setup parameters for call to function zclGeneral_GetKeyEstablishRecIndex
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        XCH     A,R0
        ADD     A,#0x6
        MOV     DPL,A
        MOV     A,R0
        ADDC    A,#0x0
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??zclGeneral_GetKeyEstablishRecIndex?relay
        MOV     A,R1
        MOV     R0,A
        MOV     A,R0
        MOV     R6,A
        MOV     A,R0
        CLR     C
        SUBB    A,#0x2
        JC      $+5
        LJMP    ??zclGeneral_ProcessInCmd_EphemeralDataReq_0 & 0xFFFF
//  955   {
//  956     if ( keyEstablishRec[index].role == KEY_ESTABLISHMENT_RESPONDER &&
//  957          keyEstablishRec[index].state == KeyEstablishState_EDataPending )
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 22) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 22) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        XRL     A,#0x1
        JNZ     ??zclGeneral_ProcessInCmd_EphemeralDataReq_1
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 24) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 24) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        XRL     A,#0x2
        JNZ     ??zclGeneral_ProcessInCmd_EphemeralDataReq_1
//  958     {
//  959       status = ZSuccess;
        MOV     R7,#0x0
//  960 
//  961       // Copy the remote device Ephemeral Public key
//  962       osal_memcpy( keyEstablishRec[index].pRemotePublicKey,
//  963               &(pInMsg->pData[0]),
//  964               ZCL_KE_CA_PUBLIC_KEY_LEN );
        ; Setup parameters for call to function osal_memcpy
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 19)
        MOV     R4,#0x16
        MOV     R5,#0x0
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 29) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 29) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 16)
        SJMP    ??zclGeneral_ProcessInCmd_EphemeralDataReq_0
//  965     }
//  966     else
//  967     {
//  968       // Reset the entry
//  969       zclGeneral_ResetKeyEstablishRec( index );
??zclGeneral_ProcessInCmd_EphemeralDataReq_1:
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
//  970     }
//  971   }
//  972 
//  973   if( status != ZSuccess )
??zclGeneral_ProcessInCmd_EphemeralDataReq_0:
        MOV     A,R7
        JZ      ??zclGeneral_ProcessInCmd_EphemeralDataReq_2
//  974   {
//  975     // Either the entry doesn't exist or in the wrong state, send termination back
//  976     zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment( ZCL_KEY_ESTABLISHMENT_ENDPOINT,
//  977                                                             &pInMsg->msg->srcAddr,
//  978                                                             TermKeyStatus_BadMessage,
//  979                                                             KEY_ESTABLISHMENT_AVG_TIMEOUT,
//  980                                                             KEY_ESTABLISHMENT_SUITE,
//  981                                                             ZCL_FRAME_SERVER_CLIENT_DIR,
//  982                                                             FALSE, zcl_SeqNum++ );
        MOV     DPTR,#zcl_SeqNum
        MOVX    A,@DPTR
        MOV     R0,A
        MOV     A,#0x1
        ADD     A,R0
        MOV     DPTR,#zcl_SeqNum
        MOVX    @DPTR,A
        ; Setup parameters for call to function zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment
        MOV     A,R0
        MOV     ?V0 + 2,A
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 17)
        MOV     ?V0 + 2,#0x0
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 18)
        MOV     ?V0 + 2,#0x1
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 19)
        MOV     ?V0 + 2,#0x1
        MOV     ?V0 + 3,#0x0
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 21)
        MOV     R5,#0x1c
        MOV     R4,#0x3
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOVX    A,@DPTR
        ADD     A,#0x6
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#0x0
        MOV     R3,A
        MOV     R1,#0xa
        LCALL   ??zclGeneral_KeyEstablish_Send_TerminateKeyEsta
        MOV     A,#0x5
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 16)
        MOV     A,R1
//  983 
//  984 #if defined (NWK_AUTO_POLL)
//  985   // Restore the saved poll rate for end device
//  986   NLME_SetPollRate(zclSavedPollRate);
        ; Setup parameters for call to function NLME_SetPollRate
        MOV     DPTR,#zclSavedPollRate
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??NLME_SetPollRate?relay
//  987 #endif
//  988     return ZCL_STATUS_CMD_HAS_RSP;
        MOV     R1,#-0x1
        LJMP    ??zclGeneral_ProcessInCmd_EphemeralDataReq_3 & 0xFFFF
//  989   }
//  990 
//  991   // Generate Ephemeral Public/Private Key Pair
//  992   ZSE_ECCGenerateKey( (unsigned char *)keyEstablishRec[index].pLocalEPrivateKey,
//  993                     (unsigned char *)keyEstablishRec[index].pLocalEPublicKey,
//  994                     zclGeneral_KeyEstablishment_GetRandom,
//  995                     zclKeyEstablish_YieldFunc, zclKeyEstablish_YieldLevel );
??zclGeneral_ProcessInCmd_EphemeralDataReq_2:
        ; Setup parameters for call to function ZSE_ECCGenerateKey
        MOV     DPTR,#zclKeyEstablish_YieldLevel
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        CLR     A
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,A
        MOV     ?V0 + 7,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_FOUR
          CFI CFA_XSP16 add(XSP16, 20)
        MOV     DPTR,#zclKeyEstablish_YieldFunc
        LCALL   ?PUSH_XSTACK8_X_TWO
          CFI CFA_XSP16 add(XSP16, 22)
        MOV     ?V0 + 2,#??zclGeneral_KeyEstablishment_GetRandom?relay & 0xff
        MOV     ?V0 + 3,#(??zclGeneral_KeyEstablishment_GetRandom?relay >> 8) & 0xff
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 24)
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 27) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 27) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R4,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R5,A
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 25) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 25) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??ZSE_ECCGenerateKey?relay
        MOV     A,#0x8
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 16)
//  996 
//  997 #if defined (DEBUG_STATIC_ECC)
//  998 
//  999   // For debug and testing purpose, use a fixed ephermeral key pair instead
// 1000   // of the randomly generated one.
// 1001   osal_memcpy( keyEstablishRec[index].pLocalEPrivateKey, private2, 21 );
// 1002   osal_memcpy( keyEstablishRec[index].pLocalEPublicKey, public2, 22 );
// 1003 #endif
// 1004 
// 1005   // Update Sequence Number
// 1006   keyEstablishRec[index].lastSeqNum = pInMsg->hdr.transSeqNum;
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        PUSH    A
          CFI CFA_SP SP+-1
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 12) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 12) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        POP     A
          CFI CFA_SP SP+0
        MOVX    @DPTR,A
// 1007 
// 1008   // Change the state and wait for the Key to be calculated
// 1009   keyEstablishRec[index].state = KeyEstablishState_KeyCalculatePending;
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 24) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 24) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,#0x3
        MOVX    @DPTR,A
// 1010 
// 1011   osal_start_timerEx( zcl_KeyEstablishment_TaskID, KEY_ESTABLISHMENT_CMD_PROCESS_EVT,
// 1012                       KEY_ESTABLISHMENT_WAIT_PERIOD );
        ; Setup parameters for call to function osal_start_timerEx
        MOV     R4,#-0xc
        MOV     R5,#0x1
        MOV     R2,#0x2
        MOV     R3,#0x0
        MOV     DPTR,#zcl_KeyEstablishment_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_start_timerEx?relay
        MOV     A,R1
// 1013 
// 1014 
// 1015   return ZCL_STATUS_CMD_HAS_RSP;
        MOV     R1,#-0x1
??zclGeneral_ProcessInCmd_EphemeralDataReq_3:
        MOV     R7,#0x8
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock14
// 1016 }
// 1017 
// 1018 
// 1019 /*********************************************************************
// 1020  * @fn      zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp
// 1021  *
// 1022  * @brief   Process the received Initiate Key Establishment Response.
// 1023  *
// 1024  * @param   pInMsg - pointer to the incoming message
// 1025  *
// 1026  * @return  ZStatus_t - ZFailure @ Unsupported
// 1027  *                      ZCL_STATUS_MALFORMED_COMMAND
// 1028  *                      ZCL_STATUS_CMD_HAS_RSP
// 1029  *                      ZCL_STATUS_SOFTWARE_FAILURE
// 1030  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
// 1031 static ZStatus_t zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp( zclIncoming_t *pInMsg )
zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp:
          CFI Block cfiBlock15 Using cfiCommon0
          CFI Function zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp
        CODE
// 1032 {
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp, osal_stop_timerEx
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 28, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 28, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp, zclGeneral_GetKeyEstablishRecIndex
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 28, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 28, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp, osal_memcpy
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 31, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 31, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp, AddrMgrExtAddrLookup
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 28, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 28, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp, SSP_MemCpyReverse
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 30, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 30, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp, osal_memcmp
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 31, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 31, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 28, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 28, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp, osal_mem_alloc
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 28, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 28, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 28, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 28, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp, osal_nv_read
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 32, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 32, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp, osal_memcmp
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 31, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 31, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp, osal_mem_free
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 28, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 28, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp, zclGeneral_KeyEstablish_Send_EphemeralDataReq
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 30, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 30, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp, osal_start_reload_timer
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 28, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 28, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp, zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 33, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 33, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 28, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 28, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp, NLME_SetPollRate
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 28, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 28, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x14
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V11 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V10 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V9 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V8 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V7 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-16)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-17)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-18)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-19)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-20)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 20)
        ; Saved register size: 20
        ; Auto size: 8
        MOV     A,#-0x8
        LCALL   ?ALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 28)
        MOV     ?V0 + 2,R2
        MOV     ?V0 + 3,R3
// 1033   TermKeyStatus_t keyStatus = TermKeyStatus_Success;
        MOV     R7,#0x0
// 1034   uint16 remoteKeyEstablishmentSuite;
// 1035   uint8 index = MAX_KEY_ESTABLISHMENT_REC_ENTRY; // set to non valid value
        MOV     R6,#0x2
// 1036   uint8 status = ZFailure;
        MOV     ?V0 + 0,#0x1
// 1037   uint8 recvExtAddr[Z_EXTADDR_LEN];
// 1038 
// 1039   // Stop the Key Establishment aging timer because the message has been received
// 1040   osal_stop_timerEx( zcl_KeyEstablishment_TaskID, KEY_ESTABLISHMENT_REC_AGING_EVT );
        ; Setup parameters for call to function osal_stop_timerEx
        MOV     R2,#0x1
        MOV     R3,#0x0
        MOV     DPTR,#zcl_KeyEstablishment_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_stop_timerEx?relay
        MOV     A,R1
// 1041 
// 1042   // Check the incoming packet length
// 1043   if ( pInMsg->pDataLen >= PACKET_LEN_INITIATE_KEY_EST_RSP )
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        CLR     C
        MOVX    A,@DPTR
        SUBB    A,#0x34
        INC     DPTR
        MOVX    A,@DPTR
        SUBB    A,#0x0
        JNC     $+5
        LJMP    ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_1 & 0xFFFF
// 1044   {
// 1045     // Check state of the key establishment record. If not match, terminate the procedure
// 1046     if ( ( index = zclGeneral_GetKeyEstablishRecIndex( pInMsg->msg->srcAddr.addr.shortAddr ) )
// 1047         < MAX_KEY_ESTABLISHMENT_REC_ENTRY )
        ; Setup parameters for call to function zclGeneral_GetKeyEstablishRecIndex
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        XCH     A,R0
        ADD     A,#0x6
        MOV     DPL,A
        MOV     A,R0
        ADDC    A,#0x0
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??zclGeneral_GetKeyEstablishRecIndex?relay
        MOV     A,R1
        MOV     R0,A
        MOV     A,R0
        MOV     R6,A
        MOV     A,R0
        CLR     C
        SUBB    A,#0x2
        JC      $+5
        LJMP    ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_1 & 0xFFFF
// 1048     {
// 1049       if ( keyEstablishRec[index].role == KEY_ESTABLISHMENT_INITIATOR &&
// 1050           keyEstablishRec[index].state == KeyEstablishState_InitiatePending )
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 22) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 22) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        JZ      $+5
        LJMP    ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_2 & 0xFFFF
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 24) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 24) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        XRL     A,#0x1
        JZ      $+5
        LJMP    ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_2 & 0xFFFF
// 1051       {
// 1052         // Parse the incoming message
// 1053         // Copy the remote device certificate
// 1054         osal_memcpy( keyEstablishRec[index].pRemoteCertificate, &(pInMsg->pData[KEY_ESTABLISH_CERT_IDX]),
// 1055                      ZCL_KE_IMPLICIT_CERTIFICATE_LEN );
        ; Setup parameters for call to function osal_memcpy
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        ADD     A,#0x4
        MOV     ?V0 + 4,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#0x0
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 31)
        MOV     R4,#0x30
        MOV     R5,#0x0
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 31) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 31) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 28)
// 1056 
// 1057         // look for extended address of partner device
// 1058         AddrMgrExtAddrLookup(keyEstablishRec[index].dstAddr.addr.shortAddr,
// 1059                              keyEstablishRec[index].partnerExtAddr);
        ; Setup parameters for call to function AddrMgrExtAddrLookup
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 14) & 0xff
        ADD     A,R0
        MOV     R4,A
        MOV     A,#((keyEstablishRec + 14) >> 8) & 0xff
        ADDC    A,R1
        MOV     R5,A
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#keyEstablishRec & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#(keyEstablishRec >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??AddrMgrExtAddrLookup?relay
        MOV     A,R1
// 1060 
// 1061         // retrieve extended address from certificate and reverse bytes
// 1062         SSP_MemCpyReverse( recvExtAddr,
// 1063                            &(keyEstablishRec[index].pRemoteCertificate[KEY_ESTABLISH_CERT_EXT_ADDR_IDX]),
// 1064                            Z_EXTADDR_LEN);
        ; Setup parameters for call to function SSP_MemCpyReverse
        MOV     ?V0 + 4,#0x8
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 30)
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 31) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 31) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        ADD     A,#0x16
        MOV     R4,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#0x0
        MOV     R5,A
        MOV     A,#0x2
        LCALL   ?XSTACK_DISP0_8
        MOV     R2,DPL
        MOV     R3,DPH
        LCALL   ??SSP_MemCpyReverse?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 28)
// 1065 
// 1066         // verify extended address in certificate matches partner's extended address
// 1067         if (osal_memcmp(keyEstablishRec[index].partnerExtAddr, recvExtAddr, Z_EXTADDR_LEN))
        ; Setup parameters for call to function osal_memcmp
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOV     R1,DPL
        MOV     R2,DPH
        MOV     R3,#0x0
        MOV     ?V0 + 4,R1
        MOV     ?V0 + 5,R2
        MOV     ?V0 + 6,R3
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 31)
        MOV     R4,#0x8
        MOV     R5,#0x0
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 14) & 0xff
        ADD     A,R0
        MOV     ?V0 + 4,A
        MOV     A,#((keyEstablishRec + 14) >> 8) & 0xff
        ADDC    A,R1
        MOV     ?V0 + 5,A
        MOV     R1,?V0 + 4
        MOV     R2,?V0 + 5
        MOV     R3,#0x0
        LCALL   ??osal_memcmp?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 28)
        MOV     A,R1
        JZ      ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_1
// 1068         {
// 1069           status = ZSuccess;
        MOV     ?V0 + 0,#0x0
        SJMP    ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_1
// 1070         }
// 1071       }
// 1072       else
// 1073       {
// 1074         // Reset the entry from the rec table
// 1075         zclGeneral_ResetKeyEstablishRec( index );
??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_2:
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
// 1076       }
// 1077     }
// 1078   }
// 1079 
// 1080   if ( status == ZFailure )
??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_1:
        MOV     A,#0x1
        XRL     A,?V0 + 0
        JNZ     ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_3
// 1081   {
// 1082     keyStatus = TermKeyStatus_BadMessage;
        MOV     R7,#0x3
        LJMP    ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_4 & 0xFFFF
// 1083   }
// 1084   else
// 1085   {
// 1086     uint8 *implicitCert;
// 1087 
// 1088     // Parse the incoming message
// 1089     // Verify the certificate issuer and key establishment suite
// 1090     remoteKeyEstablishmentSuite = BUILD_UINT16( pInMsg->pData[0], pInMsg->pData[1] );
??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_3:
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     DPH,A
        MOV     DPL,R0
        MOVX    A,@DPTR
        MOV     R2,A
        MOV     R3,#0x0
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     DPH,A
        MOV     DPL,R0
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        MOV     R1,#0x0
        CLR     A
        XCH     A,R0
        MOV     R1,A
        MOV     A,R2
        ADD     A,R0
        MOV     R0,A
        MOV     A,R3
        ADDC    A,R1
        MOV     R1,A
        MOV     ?V0 + 8,R0
        MOV     ?V0 + 9,R1
// 1091     if ( remoteKeyEstablishmentSuite != KEY_ESTABLISHMENT_SUITE )
        MOV     A,#0x1
        XRL     A,?V0 + 8
        JNZ     ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_5
        MOV     A,#0x0
        XRL     A,?V0 + 9
??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_5:
        JZ      ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_6
// 1092     {
// 1093       keyStatus = TermKeyStatus_UnSupportedSuite;
        MOV     R7,#0x5
        LJMP    ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_4 & 0xFFFF
// 1094     }
// 1095     else
// 1096     {
// 1097       // continue parsing message
// 1098 
// 1099       // Save Ephemeral Data Generate Key and Confirm Key Time
// 1100       if (pInMsg->pData[2] >= KEY_ESTABLISHMENT_EPH_DATA_GEN_INVALID_TIME)
??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_6:
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     DPH,A
        MOV     DPL,R0
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        CLR     C
        SUBB    A,#-0x1
        JC      ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_7
// 1101       {
// 1102         status = TermKeyStatus_BadMessage;
        MOV     ?V0 + 0,#0x3
        LJMP    ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_4 & 0xFFFF
// 1103       }
// 1104       else
// 1105       {
// 1106         // continue parsing message
// 1107 
// 1108         keyEstablishRec[index].remoteEphDataGenTime = pInMsg->pData[2];
??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_7:
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     DPH,A
        MOV     DPL,R0
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        PUSH    A
          CFI CFA_SP SP+-1
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 37) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 37) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        POP     A
          CFI CFA_SP SP+0
        MOVX    @DPTR,A
// 1109 
// 1110         if (pInMsg->pData[3] >= KEY_ESTABLISHMENT_CONF_KEY_GEN_INVALID_TIME)
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     DPH,A
        MOV     DPL,R0
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        CLR     C
        SUBB    A,#-0x1
        JC      ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_8
// 1111         {
// 1112           status = TermKeyStatus_BadMessage;
        MOV     ?V0 + 0,#0x3
        LJMP    ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_4 & 0xFFFF
// 1113         }
// 1114         else
// 1115         {
// 1116           // continue parsing message
// 1117 
// 1118           keyEstablishRec[index].remoteConfKeyGenTime = pInMsg->pData[3];
??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_8:
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     DPH,A
        MOV     DPL,R0
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        PUSH    A
          CFI CFA_SP SP+-1
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 38) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 38) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        POP     A
          CFI CFA_SP SP+0
        MOVX    @DPTR,A
// 1119 
// 1120           if ((implicitCert = osal_mem_alloc(ZCL_KE_IMPLICIT_CERTIFICATE_LEN)) == NULL)
        ; Setup parameters for call to function osal_mem_alloc
        MOV     R2,#0x30
        MOV     R3,#0x0
        LCALL   ??osal_mem_alloc?relay
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     R0,?V0 + 4
        MOV     R1,?V0 + 5
        MOV     ?V0 + 10,R0
        MOV     ?V0 + 11,R1
        MOV     A,R0
        ORL     A,R1
        JNZ     ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_9
// 1121           {
// 1122             // Reset the entry
// 1123             zclGeneral_ResetKeyEstablishRec( index );
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
// 1124 
// 1125             return ZCL_STATUS_SOFTWARE_FAILURE;  // Memory allocation failure.
        MOV     R1,#-0x3f
        LJMP    ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_10 & 0xFFFF
// 1126           }
// 1127 
// 1128           osal_nv_read(ZCD_NV_IMPLICIT_CERTIFICATE, 0, ZCL_KE_IMPLICIT_CERTIFICATE_LEN, implicitCert);
??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_9:
        ; Setup parameters for call to function osal_nv_read
        MOV     R0,#?V0 + 10
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 30)
        MOV     ?V0 + 4,#0x30
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 32)
        MOV     R4,#0x0
        MOV     R5,#0x0
        MOV     R2,#0x69
        MOV     R3,#0x0
        LCALL   ??osal_nv_read?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 28)
        MOV     A,R1
// 1129 
// 1130           if ( !osal_memcmp( &(keyEstablishRec[index].pRemoteCertificate[KEY_ESTABLISH_CERT_ISSUER_IDX]),
// 1131                             &(implicitCert[KEY_ESTABLISH_CERT_ISSUER_IDX]),
// 1132                             KEY_ESTABLISH_CERT_ISSUER_LENTGH ) )
        ; Setup parameters for call to function osal_memcmp
        MOV     A,?V0 + 10
        ADD     A,#0x1e
        MOV     ?V0 + 4,A
        MOV     A,?V0 + 11
        ADDC    A,#0x0
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 31)
        MOV     R4,#0x8
        MOV     R5,#0x0
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 31) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 31) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        XCH     A,R0
        ADD     A,#0x1e
        MOV     DPL,A
        MOV     A,R0
        ADDC    A,#0x0
        MOV     DPH,A
        MOV     R1,DPL
        MOV     R2,DPH
        MOV     R3,#0x0
        LCALL   ??osal_memcmp?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 28)
        MOV     A,R1
        JNZ     ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_11
// 1133           {
// 1134             keyStatus = TermKeyStatus_UnknowIssuer;
        MOV     R7,#0x1
// 1135           }
// 1136 
// 1137           osal_mem_free(implicitCert);
??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_11:
        ; Setup parameters for call to function osal_mem_free
        MOV     R2,?V0 + 10
        MOV     R3,?V0 + 11
        LCALL   ??osal_mem_free?relay
// 1138         }
// 1139       }
// 1140     }
// 1141   } // end of parsing of the message
// 1142 
// 1143   if ( keyStatus == TermKeyStatus_Success )
??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_4:
        MOV     A,R7
        JZ      $+5
        LJMP    ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_12 & 0xFFFF
// 1144   {
// 1145     keyEstablishRec[index].state = KeyEstablishState_EDataPending;
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 24) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 24) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,#0x2
        MOVX    @DPTR,A
// 1146 
// 1147     // Send Ephemeral Data Request back
// 1148     zclGeneral_KeyEstablish_Send_EphemeralDataReq( ZCL_KEY_ESTABLISHMENT_ENDPOINT,
// 1149                                                   &pInMsg->msg->srcAddr,
// 1150                                                   keyEstablishRec[index].pLocalEPublicKey,
// 1151                                                   FALSE, zcl_SeqNum++ );
        MOV     DPTR,#zcl_SeqNum
        MOVX    A,@DPTR
        MOV     R0,A
        MOV     A,#0x1
        ADD     A,R0
        MOV     DPTR,#zcl_SeqNum
        MOVX    @DPTR,A
        ; Setup parameters for call to function zclGeneral_KeyEstablish_Send_EphemeralDataReq
        MOV     A,R0
        MOV     ?V0 + 1,A
        MOV     R0,#?V0 + 1
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 29)
        MOV     ?V0 + 1,#0x0
        MOV     R0,#?V0 + 1
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 30)
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 27) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 27) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R4,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R5,A
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        MOVX    A,@DPTR
        ADD     A,#0x6
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#0x0
        MOV     R3,A
        MOV     R1,#0xa
        LCALL   ??zclGeneral_KeyEstablish_Send_EphemeralDataReq
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 28)
        MOV     A,R1
// 1152 
// 1153     // The Request was processed successfuly, now the age timer needs to start based on the
// 1154     // remote Ephemeral Data Generate Time
// 1155     keyEstablishRec[index].age = keyEstablishRec[index].remoteEphDataGenTime;
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 37) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 37) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        PUSH    A
          CFI CFA_SP SP+-1
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 23) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 23) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        POP     A
          CFI CFA_SP SP+0
        MOVX    @DPTR,A
// 1156 
// 1157     // Start the Ephemeral Data Generate aging timer
// 1158     osal_start_reload_timer( zcl_KeyEstablishment_TaskID, KEY_ESTABLISHMENT_REC_AGING_EVT,
// 1159                             KEY_ESTABLISHMENT_REC_AGING_INTERVAL );
        ; Setup parameters for call to function osal_start_reload_timer
        MOV     R4,#-0x18
        MOV     R5,#0x3
        MOV     R2,#0x1
        MOV     R3,#0x0
        MOV     DPTR,#zcl_KeyEstablishment_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_start_reload_timer?relay
        MOV     A,R1
        SJMP    ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_13
// 1160   }
// 1161   else
// 1162   {
// 1163     zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment( ZCL_KEY_ESTABLISHMENT_ENDPOINT,
// 1164                                                            &pInMsg->msg->srcAddr,
// 1165                                                            keyStatus,
// 1166                                                            KEY_ESTABLISHMENT_AVG_TIMEOUT,
// 1167                                                            KEY_ESTABLISHMENT_SUITE,
// 1168                                                            ZCL_FRAME_CLIENT_SERVER_DIR,
// 1169                                                            FALSE, zcl_SeqNum++ );
??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_12:
        MOV     DPTR,#zcl_SeqNum
        MOVX    A,@DPTR
        MOV     R0,A
        MOV     A,#0x1
        ADD     A,R0
        MOV     DPTR,#zcl_SeqNum
        MOVX    @DPTR,A
        ; Setup parameters for call to function zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment
        MOV     A,R0
        MOV     ?V0 + 1,A
        MOV     R0,#?V0 + 1
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 29)
        MOV     ?V0 + 1,#0x0
        MOV     R0,#?V0 + 1
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 30)
        MOV     ?V0 + 1,#0x0
        MOV     R0,#?V0 + 1
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 31)
        MOV     ?V0 + 4,#0x1
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 33)
        MOV     R5,#0x1c
        MOV     A,R7
        MOV     R4,A
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        MOVX    A,@DPTR
        ADD     A,#0x6
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#0x0
        MOV     R3,A
        MOV     R1,#0xa
        LCALL   ??zclGeneral_KeyEstablish_Send_TerminateKeyEsta
        MOV     A,#0x5
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 28)
        MOV     A,R1
// 1170 
// 1171     // Reset the entry
// 1172     if ( index < MAX_KEY_ESTABLISHMENT_REC_ENTRY )
        MOV     A,R6
        CLR     C
        SUBB    A,#0x2
        JNC     ??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_14
// 1173     {
// 1174       zclGeneral_ResetKeyEstablishRec( index );
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
// 1175     }
// 1176 
// 1177 #if defined (NWK_AUTO_POLL)
// 1178     // Restore the saved poll rate for end device
// 1179     NLME_SetPollRate(zclSavedPollRate);
??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_14:
        ; Setup parameters for call to function NLME_SetPollRate
        MOV     DPTR,#zclSavedPollRate
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??NLME_SetPollRate?relay
// 1180 #endif
// 1181   }
// 1182 
// 1183   return ZCL_STATUS_CMD_HAS_RSP;
??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_13:
        MOV     R1,#-0x1
??zclGeneral_ProcessInCmd_InitiateKeyEstablishR_10:
        MOV     A,#0x8
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 20)
        MOV     R7,#0xc
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock15
// 1184 }
// 1185 
// 1186 /*********************************************************************
// 1187  * @fn      zclGeneral_ProcessInCmd_EphemeralDataRsp
// 1188  *
// 1189  * @brief   Process the received Initiate Key Establishment Response.
// 1190  *
// 1191  * @param   pInMsg - pointer to the incoming message
// 1192  *
// 1193  * @return  ZStatus_t - ZFailure @ Unsupported
// 1194  *                      ZCL_STATUS_MALFORMED_COMMAND
// 1195  *                      ZCL_STATUS_CMD_HAS_RSP
// 1196  *                      ZCL_STATUS_SOFTWARE_FAILURE
// 1197  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
// 1198 static ZStatus_t zclGeneral_ProcessInCmd_EphemeralDataRsp( zclIncoming_t *pInMsg )
zclGeneral_ProcessInCmd_EphemeralDataRsp:
          CFI Block cfiBlock16 Using cfiCommon0
          CFI Function zclGeneral_ProcessInCmd_EphemeralDataRsp
        CODE
// 1199 {
        FUNCALL zclGeneral_ProcessInCmd_EphemeralDataRsp, osal_stop_timerEx
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 15, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 15, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_EphemeralDataRsp, zclGeneral_GetKeyEstablishRecIndex
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 15, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 15, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_EphemeralDataRsp, osal_memcpy
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 18, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 18, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_EphemeralDataRsp, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 15, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 15, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_EphemeralDataRsp, zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_EphemeralDataRsp, NLME_SetPollRate
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 15, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 15, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_EphemeralDataRsp, osal_start_timerEx
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 15, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 15, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0xf
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 15)
        ; Saved register size: 15
        ; Auto size: 0
        MOV     ?V0 + 0,R2
        MOV     ?V0 + 1,R3
// 1200   uint8 index;
// 1201   uint8 status = ZFailure;
        MOV     R7,#0x1
// 1202 
// 1203   // Stop the Ephemeral Data Generate timer because the message has been received
// 1204   osal_stop_timerEx( zcl_KeyEstablishment_TaskID, KEY_ESTABLISHMENT_REC_AGING_EVT );
        ; Setup parameters for call to function osal_stop_timerEx
        MOV     R2,#0x1
        MOV     R3,#0x0
        MOV     DPTR,#zcl_KeyEstablishment_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_stop_timerEx?relay
        MOV     A,R1
// 1205 
// 1206   // Check state of the key establishment record. If not match, terminate the procedure
// 1207   if ( ( index = zclGeneral_GetKeyEstablishRecIndex( pInMsg->msg->srcAddr.addr.shortAddr ) )
// 1208       < MAX_KEY_ESTABLISHMENT_REC_ENTRY )
        ; Setup parameters for call to function zclGeneral_GetKeyEstablishRecIndex
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        XCH     A,R0
        ADD     A,#0x6
        MOV     DPL,A
        MOV     A,R0
        ADDC    A,#0x0
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??zclGeneral_GetKeyEstablishRecIndex?relay
        MOV     A,R1
        MOV     R0,A
        MOV     A,R0
        MOV     R6,A
        MOV     A,R0
        CLR     C
        SUBB    A,#0x2
        JC      $+5
        LJMP    ??zclGeneral_ProcessInCmd_EphemeralDataRsp_0 & 0xFFFF
// 1209   {
// 1210     if ( keyEstablishRec[index].role == KEY_ESTABLISHMENT_INITIATOR &&
// 1211          keyEstablishRec[index].state == KeyEstablishState_EDataPending )
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 22) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 22) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        JNZ     ??zclGeneral_ProcessInCmd_EphemeralDataRsp_1
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 24) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 24) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        XRL     A,#0x2
        JNZ     ??zclGeneral_ProcessInCmd_EphemeralDataRsp_1
// 1212     {
// 1213       status = ZSuccess;
        MOV     R7,#0x0
// 1214 
// 1215       // Copy the remote device Ephemeral Public key
// 1216       osal_memcpy( keyEstablishRec[index].pRemotePublicKey,
// 1217                   &(pInMsg->pData[0]),
// 1218                   ZCL_KE_CA_PUBLIC_KEY_LEN );
        ; Setup parameters for call to function osal_memcpy
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 18)
        MOV     R4,#0x16
        MOV     R5,#0x0
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 29) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 29) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 15)
        SJMP    ??zclGeneral_ProcessInCmd_EphemeralDataRsp_0
// 1219     }
// 1220     else
// 1221     {
// 1222       // Reset the entry from the rec table
// 1223       zclGeneral_ResetKeyEstablishRec( index );
??zclGeneral_ProcessInCmd_EphemeralDataRsp_1:
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
// 1224     }
// 1225   }
// 1226 
// 1227   if ( status == ZFailure )
??zclGeneral_ProcessInCmd_EphemeralDataRsp_0:
        MOV     A,#0x1
        XRL     A,R7
        JNZ     ??zclGeneral_ProcessInCmd_EphemeralDataRsp_2
// 1228   {
// 1229     // No existing record found or the record found has a wrong state, terminate the procedure
// 1230     zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment( ZCL_KEY_ESTABLISHMENT_ENDPOINT,
// 1231                                                             &pInMsg->msg->srcAddr,
// 1232                                                             TermKeyStatus_BadMessage,
// 1233                                                             KEY_ESTABLISHMENT_AVG_TIMEOUT,
// 1234                                                             KEY_ESTABLISHMENT_SUITE,
// 1235                                                             ZCL_FRAME_CLIENT_SERVER_DIR,
// 1236                                                             FALSE, zcl_SeqNum++ );
        MOV     DPTR,#zcl_SeqNum
        MOVX    A,@DPTR
        MOV     R0,A
        MOV     A,#0x1
        ADD     A,R0
        MOV     DPTR,#zcl_SeqNum
        MOVX    @DPTR,A
        ; Setup parameters for call to function zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment
        MOV     A,R0
        MOV     ?V0 + 2,A
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 16)
        MOV     ?V0 + 2,#0x0
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 17)
        MOV     ?V0 + 2,#0x0
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 18)
        MOV     ?V0 + 2,#0x1
        MOV     ?V0 + 3,#0x0
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 20)
        MOV     R5,#0x1c
        MOV     R4,#0x3
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOVX    A,@DPTR
        ADD     A,#0x6
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#0x0
        MOV     R3,A
        MOV     R1,#0xa
        LCALL   ??zclGeneral_KeyEstablish_Send_TerminateKeyEsta
        MOV     A,#0x5
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 15)
        MOV     A,R1
// 1237 #if defined (NWK_AUTO_POLL)
// 1238     // Restore the saved poll rate for end device
// 1239     NLME_SetPollRate(zclSavedPollRate);
        ; Setup parameters for call to function NLME_SetPollRate
        MOV     DPTR,#zclSavedPollRate
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??NLME_SetPollRate?relay
        SJMP    ??zclGeneral_ProcessInCmd_EphemeralDataRsp_3
// 1240 #endif
// 1241   }
// 1242   else
// 1243   {
// 1244     keyEstablishRec[index].state = KeyEstablishState_KeyCalculatePending;
??zclGeneral_ProcessInCmd_EphemeralDataRsp_2:
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 24) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 24) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,#0x3
        MOVX    @DPTR,A
// 1245 
// 1246     osal_start_timerEx( zcl_KeyEstablishment_TaskID, KEY_ESTABLISHMENT_RSP_PROCESS_EVT,
// 1247                        KEY_ESTABLISHMENT_WAIT_PERIOD );
        ; Setup parameters for call to function osal_start_timerEx
        MOV     R4,#-0xc
        MOV     R5,#0x1
        MOV     R2,#0x4
        MOV     R3,#0x0
        MOV     DPTR,#zcl_KeyEstablishment_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_start_timerEx?relay
        MOV     A,R1
// 1248 
// 1249   }
// 1250 
// 1251   return ZCL_STATUS_CMD_HAS_RSP;
??zclGeneral_ProcessInCmd_EphemeralDataRsp_3:
        MOV     R1,#-0x1
        MOV     R7,#0x7
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock16
// 1252 }
// 1253 
// 1254 /*********************************************************************
// 1255  * @fn      zclGeneral_ProcessInCmd_ConfirmKey
// 1256  *
// 1257  * @brief   Process the received Confirm Key Command.
// 1258  *
// 1259  * @param   pInMsg - pointer to the incoming message
// 1260  *
// 1261  * @return  ZStatus_t - ZFailure @ Unsupported
// 1262  *                      ZCL_STATUS_CMD_HAS_RSP
// 1263  *                      ZCL_STATUS_SOFTWARE_FAILURE
// 1264  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
// 1265 static ZStatus_t zclGeneral_ProcessInCmd_ConfirmKey( zclIncoming_t *pInMsg )
zclGeneral_ProcessInCmd_ConfirmKey:
          CFI Block cfiBlock17 Using cfiCommon0
          CFI Function zclGeneral_ProcessInCmd_ConfirmKey
        CODE
// 1266 {
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKey, osal_stop_timerEx
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 47, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 47, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKey, zclGeneral_GetKeyEstablishRecIndex
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 47, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 47, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKey, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 47, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 47, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKey, zclGeneral_KeyEstablishment_GenerateMAC
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 47, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 47, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKey, osal_memcmp
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 50, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 50, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKey, ZDSecMgrAddLinkKey
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 49, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 49, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKey, zclGeneral_KeyEstablishment_GenerateMAC
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 47, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 47, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKey, zclGeneral_KeyEstablish_Send_ConfirmKeyRsp
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 49, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 49, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKey, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 47, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 47, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKey, zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 52, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 52, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKey, NLME_SetPollRate
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 47, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 47, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0xf
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 15)
        ; Saved register size: 15
        ; Auto size: 32
        MOV     A,#-0x20
        LCALL   ?ALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 47)
        MOV     ?V0 + 2,R2
        MOV     ?V0 + 3,R3
// 1267   uint8 index;
// 1268   uint8 status = ZFailure;
        MOV     ?V0 + 0,#0x1
// 1269   uint8 MACu[KEY_ESTABLISH_MAC_KEY_LENGTH];
// 1270   uint8 MACv[KEY_ESTABLISH_MAC_KEY_LENGTH];
// 1271   TermKeyStatus_t keyStatus = TermKeyStatus_Success;
        MOV     R7,#0x0
// 1272 
// 1273   // Stop the Config Key Generate aging timer because the message has been received
// 1274   osal_stop_timerEx( zcl_KeyEstablishment_TaskID, KEY_ESTABLISHMENT_REC_AGING_EVT );
        ; Setup parameters for call to function osal_stop_timerEx
        MOV     R2,#0x1
        MOV     R3,#0x0
        MOV     DPTR,#zcl_KeyEstablishment_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_stop_timerEx?relay
        MOV     A,R1
// 1275 
// 1276   // Check state of the key establishment record. If not match, terminate the procedure
// 1277   if ( ( index = zclGeneral_GetKeyEstablishRecIndex( pInMsg->msg->srcAddr.addr.shortAddr ) )
// 1278       < MAX_KEY_ESTABLISHMENT_REC_ENTRY )
        ; Setup parameters for call to function zclGeneral_GetKeyEstablishRecIndex
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        XCH     A,R0
        ADD     A,#0x6
        MOV     DPL,A
        MOV     A,R0
        ADDC    A,#0x0
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??zclGeneral_GetKeyEstablishRecIndex?relay
        MOV     A,R1
        MOV     R0,A
        MOV     A,R0
        MOV     R6,A
        MOV     A,R0
        CLR     C
        SUBB    A,#0x2
        JNC     ??zclGeneral_ProcessInCmd_ConfirmKey_0
// 1279   {
// 1280     if ( keyEstablishRec[index].role == KEY_ESTABLISHMENT_RESPONDER &&
// 1281          keyEstablishRec[index].state == KeyEstablishState_ConfirmPending )
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 22) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 22) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        XRL     A,#0x1
        JNZ     ??zclGeneral_ProcessInCmd_ConfirmKey_1
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 24) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 24) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        XRL     A,#0x4
        JNZ     ??zclGeneral_ProcessInCmd_ConfirmKey_1
// 1282     {
// 1283       status = ZSuccess;
        MOV     ?V0 + 0,#0x0
        SJMP    ??zclGeneral_ProcessInCmd_ConfirmKey_0
// 1284     }
// 1285     else
// 1286     {
// 1287       // Reset the entry
// 1288       zclGeneral_ResetKeyEstablishRec( index );
??zclGeneral_ProcessInCmd_ConfirmKey_1:
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
// 1289     }
// 1290   }
// 1291 
// 1292   if ( status == ZFailure )
??zclGeneral_ProcessInCmd_ConfirmKey_0:
        MOV     A,#0x1
        XRL     A,?V0 + 0
        JNZ     ??zclGeneral_ProcessInCmd_ConfirmKey_2
// 1293   {
// 1294     keyStatus = TermKeyStatus_BadMessage;
        MOV     R7,#0x3
        LJMP    ??zclGeneral_ProcessInCmd_ConfirmKey_3 & 0xFFFF
// 1295   }
// 1296   else
// 1297   {
// 1298     // Calculate MAC(U). Note that the zData is also pointing to the macKey
// 1299     zclGeneral_KeyEstablishment_GenerateMAC( index, TRUE, MACu );
??zclGeneral_ProcessInCmd_ConfirmKey_2:
        ; Setup parameters for call to function zclGeneral_KeyEstablishment_GenerateMAC
        MOV     A,#0x10
        LCALL   ?XSTACK_DISP0_8
        MOV     R4,DPL
        MOV     R5,DPH
        MOV     R2,#0x1
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_KeyEstablishment_GenerateMAC?relay
        MOV     A,R1
// 1300 
// 1301     // Compare MAC(U) with MAC(V)
// 1302     if ( osal_memcmp( MACu, pInMsg->pData, KEY_ESTABLISH_MAC_LENGTH ) == TRUE )
        ; Setup parameters for call to function osal_memcmp
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 50)
        MOV     R4,#0x10
        MOV     R5,#0x0
        MOV     A,#0x13
        LCALL   ?XSTACK_DISP0_8
        MOV     R1,DPL
        MOV     R2,DPH
        MOV     R3,#0x0
        LCALL   ??osal_memcmp?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 47)
        MOV     A,R1
        XRL     A,#0x1
        JZ      $+5
        LJMP    ??zclGeneral_ProcessInCmd_ConfirmKey_4 & 0xFFFF
// 1303     {
// 1304       // Send Confirm Key Response with Status - SUCCESS
// 1305       keyEstablishRec[index].state = KeyEstablishState_TerminationPending;
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 24) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 24) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,#0x5
        MOVX    @DPTR,A
// 1306 
// 1307       // Store the key in the key table
// 1308 
// 1309       ZDSecMgrAddLinkKey( pInMsg->msg->srcAddr.addr.shortAddr,
// 1310                          keyEstablishRec[index].partnerExtAddr,
// 1311                          keyEstablishRec[index].pKey );
        ; Setup parameters for call to function ZDSecMgrAddLinkKey
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 33) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 33) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        LCALL   ?PUSH_XSTACK8_X_TWO
          CFI CFA_XSP16 add(XSP16, 49)
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 14) & 0xff
        ADD     A,R0
        MOV     R4,A
        MOV     A,#((keyEstablishRec + 14) >> 8) & 0xff
        ADDC    A,R1
        MOV     R5,A
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        XCH     A,R0
        ADD     A,#0x6
        MOV     DPL,A
        MOV     A,R0
        ADDC    A,#0x0
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??ZDSecMgrAddLinkKey?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 47)
        MOV     A,R1
// 1312 
// 1313       // Calculate MAC(V) and send it back
// 1314       zclGeneral_KeyEstablishment_GenerateMAC( index, FALSE, MACv );
        ; Setup parameters for call to function zclGeneral_KeyEstablishment_GenerateMAC
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOV     R4,DPL
        MOV     R5,DPH
        MOV     R2,#0x0
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_KeyEstablishment_GenerateMAC?relay
        MOV     A,R1
// 1315 
// 1316       zclGeneral_KeyEstablish_Send_ConfirmKeyRsp( pInMsg->msg->endPoint,
// 1317                                                  &pInMsg->msg->srcAddr,
// 1318                                                  MACv,
// 1319                                                  FALSE, pInMsg->hdr.transSeqNum );
        ; Setup parameters for call to function zclGeneral_KeyEstablish_Send_ConfirmKeyRsp
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 1,A
        MOV     R0,#?V0 + 1
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 48)
        MOV     ?V0 + 1,#0x0
        MOV     R0,#?V0 + 1
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 49)
        MOV     A,#0x2
        LCALL   ?XSTACK_DISP0_8
        MOV     R4,DPL
        MOV     R5,DPH
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        MOVX    A,@DPTR
        ADD     A,#0x6
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#0x0
        MOV     R3,A
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        XCH     A,R0
        ADD     A,#0x14
        MOV     DPL,A
        MOV     A,R0
        ADDC    A,#0x0
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??zclGeneral_KeyEstablish_Send_ConfirmKeyRsp?re
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 47)
        MOV     A,R1
        SJMP    ??zclGeneral_ProcessInCmd_ConfirmKey_5
// 1320     }
// 1321     else
// 1322     {
// 1323       keyStatus = TermKeyStatus_BadKeyConfirm;
??zclGeneral_ProcessInCmd_ConfirmKey_4:
        MOV     R7,#0x2
// 1324     }
// 1325 
// 1326     // Reset the entry, at this point the Key Establishment process has
// 1327     // finished and the record is not needed anymore
// 1328     zclGeneral_ResetKeyEstablishRec( index );
??zclGeneral_ProcessInCmd_ConfirmKey_5:
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
// 1329   }
// 1330 
// 1331   if( keyStatus != TermKeyStatus_Success)
??zclGeneral_ProcessInCmd_ConfirmKey_3:
        MOV     A,R7
        JZ      ??zclGeneral_ProcessInCmd_ConfirmKey_6
// 1332   {
// 1333     // If MAC(U) does not match MAC(V), send response with failure
// 1334     zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment( ZCL_KEY_ESTABLISHMENT_ENDPOINT,
// 1335                                                             &pInMsg->msg->srcAddr,
// 1336                                                             keyStatus,
// 1337                                                             KEY_ESTABLISHMENT_AVG_TIMEOUT,
// 1338                                                             KEY_ESTABLISHMENT_SUITE,
// 1339                                                             ZCL_FRAME_SERVER_CLIENT_DIR,
// 1340                                                             FALSE, zcl_SeqNum++ );
        MOV     DPTR,#zcl_SeqNum
        MOVX    A,@DPTR
        MOV     R0,A
        MOV     A,#0x1
        ADD     A,R0
        MOV     DPTR,#zcl_SeqNum
        MOVX    @DPTR,A
        ; Setup parameters for call to function zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment
        MOV     A,R0
        MOV     ?V0 + 1,A
        MOV     R0,#?V0 + 1
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 48)
        MOV     ?V0 + 1,#0x0
        MOV     R0,#?V0 + 1
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 49)
        MOV     ?V0 + 1,#0x1
        MOV     R0,#?V0 + 1
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 50)
        MOV     ?V0 + 4,#0x1
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 52)
        MOV     R5,#0x1c
        MOV     A,R7
        MOV     R4,A
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        MOVX    A,@DPTR
        ADD     A,#0x6
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#0x0
        MOV     R3,A
        MOV     R1,#0xa
        LCALL   ??zclGeneral_KeyEstablish_Send_TerminateKeyEsta
        MOV     A,#0x5
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 47)
        MOV     A,R1
// 1341   }
// 1342 
// 1343 #if defined (NWK_AUTO_POLL)
// 1344   // Key Establishment Procedure complete. Restore the saved poll rate for end device
// 1345   NLME_SetPollRate(zclSavedPollRate);
??zclGeneral_ProcessInCmd_ConfirmKey_6:
        ; Setup parameters for call to function NLME_SetPollRate
        MOV     DPTR,#zclSavedPollRate
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??NLME_SetPollRate?relay
// 1346 #endif
// 1347 
// 1348   return ZCL_STATUS_CMD_HAS_RSP;
        MOV     R1,#-0x1
        MOV     A,#0x20
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 15)
        MOV     R7,#0x7
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock17
// 1349 }
// 1350 
// 1351 /*********************************************************************
// 1352  * @fn      zclGeneral_ProcessInCmd_ConfirmKeyRsp
// 1353  *
// 1354  * @brief   Process the received Confirm Key Response.
// 1355  *
// 1356  * @param   pInMsg - pointer to the incoming message
// 1357  *
// 1358  * @return  ZStatus_t - ZFailure @ Unsupported
// 1359  *                      ZCL_STATUS_MALFORMED_COMMAND
// 1360  *                      ZCL_STATUS_CMD_HAS_RSP
// 1361  *                      ZCL_STATUS_SOFTWARE_FAILURE
// 1362  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
// 1363 static ZStatus_t zclGeneral_ProcessInCmd_ConfirmKeyRsp( zclIncoming_t *pInMsg )
zclGeneral_ProcessInCmd_ConfirmKeyRsp:
          CFI Block cfiBlock18 Using cfiCommon0
          CFI Function zclGeneral_ProcessInCmd_ConfirmKeyRsp
        CODE
// 1364 {
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKeyRsp, osal_stop_timerEx
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 31, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 31, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKeyRsp, zclGeneral_GetKeyEstablishRecIndex
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 31, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 31, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKeyRsp, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 31, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 31, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKeyRsp, zclGeneral_KeyEstablishment_GenerateMAC
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 31, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 31, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKeyRsp, osal_memcmp
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 34, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 34, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKeyRsp, ZDSecMgrAddLinkKey
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 33, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 33, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKeyRsp, zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 36, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 36, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKeyRsp, osal_msg_allocate
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 31, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 31, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKeyRsp, osal_msg_send
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 31, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 31, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKeyRsp, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 31, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 31, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_ConfirmKeyRsp, NLME_SetPollRate
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 31, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 31, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0xf
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 15)
        ; Saved register size: 15
        ; Auto size: 16
        MOV     A,#-0x10
        LCALL   ?ALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 31)
        MOV     ?V0 + 0,R2
        MOV     ?V0 + 1,R3
// 1365   uint8 index;
// 1366   uint8 status = ZFailure;
        MOV     R7,#0x1
// 1367   uint8 MACv[KEY_ESTABLISH_MAC_LENGTH];
// 1368 
// 1369   // Stop the Config Key Generate aging timer because the message has been received
// 1370   osal_stop_timerEx( zcl_KeyEstablishment_TaskID, KEY_ESTABLISHMENT_REC_AGING_EVT );
        ; Setup parameters for call to function osal_stop_timerEx
        MOV     R2,#0x1
        MOV     R3,#0x0
        MOV     DPTR,#zcl_KeyEstablishment_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_stop_timerEx?relay
        MOV     A,R1
// 1371 
// 1372   // Check state of the key establishment record. If not match, terminate the procedure
// 1373   if ( ( index = zclGeneral_GetKeyEstablishRecIndex( pInMsg->msg->srcAddr.addr.shortAddr ) )
// 1374       < MAX_KEY_ESTABLISHMENT_REC_ENTRY )
        ; Setup parameters for call to function zclGeneral_GetKeyEstablishRecIndex
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        XCH     A,R0
        ADD     A,#0x6
        MOV     DPL,A
        MOV     A,R0
        ADDC    A,#0x0
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??zclGeneral_GetKeyEstablishRecIndex?relay
        MOV     A,R1
        MOV     R0,A
        MOV     A,R0
        MOV     R6,A
        MOV     A,R0
        CLR     C
        SUBB    A,#0x2
        JNC     ??zclGeneral_ProcessInCmd_ConfirmKeyRsp_0
// 1375   {
// 1376     if ( keyEstablishRec[index].role == KEY_ESTABLISHMENT_INITIATOR &&
// 1377          keyEstablishRec[index].state == KeyEstablishState_ConfirmPending )
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 22) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 22) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        JNZ     ??zclGeneral_ProcessInCmd_ConfirmKeyRsp_1
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 24) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 24) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        XRL     A,#0x4
        JNZ     ??zclGeneral_ProcessInCmd_ConfirmKeyRsp_1
// 1378     {
// 1379       status = ZSuccess;
        MOV     R7,#0x0
        SJMP    ??zclGeneral_ProcessInCmd_ConfirmKeyRsp_0
// 1380     }
// 1381     else
// 1382     {
// 1383       // Reset the entry from the rec table
// 1384       zclGeneral_ResetKeyEstablishRec( index );
??zclGeneral_ProcessInCmd_ConfirmKeyRsp_1:
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
// 1385     }
// 1386   }
// 1387 
// 1388   if ( status == ZFailure )
??zclGeneral_ProcessInCmd_ConfirmKeyRsp_0:
        MOV     A,#0x1
        XRL     A,R7
        JNZ     ??zclGeneral_ProcessInCmd_ConfirmKeyRsp_2
// 1389   {
// 1390     status = TermKeyStatus_BadMessage;
        MOV     R7,#0x3
        LJMP    ??zclGeneral_ProcessInCmd_ConfirmKeyRsp_3 & 0xFFFF
// 1391   }
// 1392   else
// 1393   {
// 1394     // Calculate MAC(V)
// 1395     zclGeneral_KeyEstablishment_GenerateMAC( index, FALSE, MACv);
??zclGeneral_ProcessInCmd_ConfirmKeyRsp_2:
        ; Setup parameters for call to function zclGeneral_KeyEstablishment_GenerateMAC
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOV     R4,DPL
        MOV     R5,DPH
        MOV     R2,#0x0
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_KeyEstablishment_GenerateMAC?relay
        MOV     A,R1
// 1396 
// 1397     // Compare M(U) with M(V)
// 1398     if ( osal_memcmp( MACv, pInMsg->pData, KEY_ESTABLISH_MAC_LENGTH ) == TRUE )
        ; Setup parameters for call to function osal_memcmp
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 34)
        MOV     R4,#0x10
        MOV     R5,#0x0
        MOV     A,#0x3
        LCALL   ?XSTACK_DISP0_8
        MOV     R1,DPL
        MOV     R2,DPH
        MOV     R3,#0x0
        LCALL   ??osal_memcmp?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 31)
        MOV     A,R1
        XRL     A,#0x1
        JNZ     ??zclGeneral_ProcessInCmd_ConfirmKeyRsp_4
// 1399     {
// 1400       status = TermKeyStatus_Success;
        MOV     R7,#0x0
// 1401 
// 1402       // Store the link key
// 1403       ZDSecMgrAddLinkKey( pInMsg->msg->srcAddr.addr.shortAddr,
// 1404                      keyEstablishRec[index].partnerExtAddr,
// 1405                      keyEstablishRec[index].pKey );
        ; Setup parameters for call to function ZDSecMgrAddLinkKey
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 33) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 33) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        LCALL   ?PUSH_XSTACK8_X_TWO
          CFI CFA_XSP16 add(XSP16, 33)
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 14) & 0xff
        ADD     A,R0
        MOV     R4,A
        MOV     A,#((keyEstablishRec + 14) >> 8) & 0xff
        ADDC    A,R1
        MOV     R5,A
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        XCH     A,R0
        ADD     A,#0x6
        MOV     DPL,A
        MOV     A,R0
        ADDC    A,#0x0
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??ZDSecMgrAddLinkKey?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 31)
        MOV     A,R1
        SJMP    ??zclGeneral_ProcessInCmd_ConfirmKeyRsp_3
// 1406     }
// 1407     else
// 1408     {
// 1409       // If MAC(U) does not match MAC(V), send response with failure
// 1410       status = TermKeyStatus_BadKeyConfirm;
??zclGeneral_ProcessInCmd_ConfirmKeyRsp_4:
        MOV     R7,#0x2
// 1411     }
// 1412   }
// 1413 
// 1414   if( status != TermKeyStatus_Success )
??zclGeneral_ProcessInCmd_ConfirmKeyRsp_3:
        MOV     A,R7
        JZ      ??zclGeneral_ProcessInCmd_ConfirmKeyRsp_5
// 1415   {
// 1416     zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment( ZCL_KEY_ESTABLISHMENT_ENDPOINT,
// 1417                                                             &pInMsg->msg->srcAddr,
// 1418                                                             (TermKeyStatus_t)status,
// 1419                                                             KEY_ESTABLISHMENT_AVG_TIMEOUT,
// 1420                                                             KEY_ESTABLISHMENT_SUITE,
// 1421                                                             ZCL_FRAME_CLIENT_SERVER_DIR,
// 1422                                                             FALSE, zcl_SeqNum++ );
        MOV     DPTR,#zcl_SeqNum
        MOVX    A,@DPTR
        MOV     R0,A
        MOV     A,#0x1
        ADD     A,R0
        MOV     DPTR,#zcl_SeqNum
        MOVX    @DPTR,A
        ; Setup parameters for call to function zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment
        MOV     A,R0
        MOV     ?V0 + 2,A
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 32)
        MOV     ?V0 + 2,#0x0
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 33)
        MOV     ?V0 + 2,#0x0
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 34)
        MOV     ?V0 + 2,#0x1
        MOV     ?V0 + 3,#0x0
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 36)
        MOV     R5,#0x1c
        MOV     A,R7
        MOV     R4,A
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOVX    A,@DPTR
        ADD     A,#0x6
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        ADDC    A,#0x0
        MOV     R3,A
        MOV     R1,#0xa
        LCALL   ??zclGeneral_KeyEstablish_Send_TerminateKeyEsta
        MOV     A,#0x5
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 31)
        MOV     A,R1
// 1423   }
// 1424 
// 1425   // Send Osal message to the application to indicate the completion
// 1426   if ( keyEstablishRec[index].appTaskID != INVALID_TASK_ID )
??zclGeneral_ProcessInCmd_ConfirmKeyRsp_5:
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 13) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 13) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        XRL     A,#0xff
        JZ      ??zclGeneral_ProcessInCmd_ConfirmKeyRsp_6
// 1427   {
// 1428     keyEstablishmentInd_t *ind;
// 1429 
// 1430     ind = (keyEstablishmentInd_t *)osal_msg_allocate( sizeof( keyEstablishmentInd_t ) );
        ; Setup parameters for call to function osal_msg_allocate
        MOV     R2,#0x5
        MOV     R3,#0x0
        LCALL   ??osal_msg_allocate?relay
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     ?V0 + 2,?V0 + 4
        MOV     ?V0 + 3,?V0 + 5
// 1431     if ( ind )
        MOV     A,?V0 + 2
        ORL     A,?V0 + 3
        JZ      ??zclGeneral_ProcessInCmd_ConfirmKeyRsp_6
// 1432     {
// 1433       ind->hdr.event = ZCL_KEY_ESTABLISH_IND;
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        MOV     A,#0x35
        MOVX    @DPTR,A
// 1434       ind->hdr.status = status;
        MOV     A,R7
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        INC     DPTR
        MOVX    @DPTR,A
// 1435 
// 1436       // Clear remaining fields
// 1437       ind->waitTime = 0;
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        INC     DPTR
        INC     DPTR
        MOV     A,#0x0
        MOVX    @DPTR,A
// 1438       ind->keyEstablishmentSuite = 0;
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOV     A,#0x0
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,#0x0
        MOVX    @DPTR,A
// 1439 
// 1440       osal_msg_send( keyEstablishRec[index].appTaskID, (uint8*)ind );
        ; Setup parameters for call to function osal_msg_send
        MOV     R2,?V0 + 2
        MOV     R3,?V0 + 3
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R4,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R4
        MOV     R4,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R4
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 13) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 13) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_msg_send?relay
        MOV     A,R1
// 1441     }
// 1442   }
// 1443 
// 1444   // End of this transection. Reset the entry from the rec table
// 1445   zclGeneral_ResetKeyEstablishRec( index );
??zclGeneral_ProcessInCmd_ConfirmKeyRsp_6:
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
// 1446 
// 1447 #if defined (NWK_AUTO_POLL)
// 1448   // Key Establishment Procedure complete. Restore the saved poll rate for end device
// 1449   NLME_SetPollRate(zclSavedPollRate);
        ; Setup parameters for call to function NLME_SetPollRate
        MOV     DPTR,#zclSavedPollRate
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??NLME_SetPollRate?relay
// 1450 #endif
// 1451   return ZCL_STATUS_CMD_HAS_RSP;
        MOV     R1,#-0x1
        MOV     A,#0x10
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 15)
        MOV     R7,#0x7
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock18
// 1452 }
// 1453 
// 1454 /*********************************************************************
// 1455  * @fn      zclGeneral_ProcessInCmd_TerminateKeyEstablish
// 1456  *
// 1457  * @brief   Process the received Terminate Key Establishment Command.
// 1458  *
// 1459  * @param   pInMsg - pointer to the incoming message
// 1460  *
// 1461  * @return  ZStatus_t - ZFailure @ Unsupported
// 1462  *                      ZSuccess @ Success
// 1463  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
// 1464 static ZStatus_t zclGeneral_ProcessInCmd_TerminateKeyEstablish( zclIncoming_t *pInMsg )
zclGeneral_ProcessInCmd_TerminateKeyEstablish:
          CFI Block cfiBlock19 Using cfiCommon0
          CFI Function zclGeneral_ProcessInCmd_TerminateKeyEstablish
        CODE
// 1465 {
        FUNCALL zclGeneral_ProcessInCmd_TerminateKeyEstablish, zclGeneral_GetKeyEstablishRecIndex
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 14, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 14, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_TerminateKeyEstablish, osal_msg_allocate
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 14, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 14, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_TerminateKeyEstablish, osal_msg_send
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 14, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 14, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_TerminateKeyEstablish, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 14, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 14, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ProcessInCmd_TerminateKeyEstablish, NLME_SetPollRate
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 14, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 14, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0xe
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 14)
        ; Saved register size: 14
        ; Auto size: 0
        MOV     ?V0 + 0,R2
        MOV     ?V0 + 1,R3
// 1466   uint8 index;
// 1467 
// 1468   // Find the key establishment record and delete the record entry.
// 1469   if ( ( index = zclGeneral_GetKeyEstablishRecIndex( pInMsg->msg->srcAddr.addr.shortAddr ) )
// 1470       < MAX_KEY_ESTABLISHMENT_REC_ENTRY )
        ; Setup parameters for call to function zclGeneral_GetKeyEstablishRecIndex
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        XCH     A,R0
        ADD     A,#0x6
        MOV     DPL,A
        MOV     A,R0
        ADDC    A,#0x0
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??zclGeneral_GetKeyEstablishRecIndex?relay
        MOV     A,R1
        MOV     R0,A
        MOV     ?V0 + 2,R0
        MOV     A,R0
        CLR     C
        SUBB    A,#0x2
        JC      $+5
        LJMP    ??zclGeneral_ProcessInCmd_TerminateKeyEstablish_1 & 0xFFFF
// 1471   {
// 1472     if ( keyEstablishRec[index].appTaskID != INVALID_TASK_ID )
        MOV     A,?V0 + 2
        MOV     R0,?V0 + 2
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 13) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 13) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        XRL     A,#0xff
        JNZ     $+5
        LJMP    ??zclGeneral_ProcessInCmd_TerminateKeyEstablish_2 & 0xFFFF
// 1473     {
// 1474       keyEstablishmentInd_t *ind;
// 1475 
// 1476       // Send osal message to the application
// 1477       ind = (keyEstablishmentInd_t *)osal_msg_allocate( sizeof( keyEstablishmentInd_t ) );
        ; Setup parameters for call to function osal_msg_allocate
        MOV     R2,#0x5
        MOV     R3,#0x0
        LCALL   ??osal_msg_allocate?relay
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     R6,?V0 + 4
        MOV     R7,?V0 + 5
// 1478       if ( ind )
        MOV     A,R6
        ORL     A,R7
        JNZ     $+5
        LJMP    ??zclGeneral_ProcessInCmd_TerminateKeyEstablish_2 & 0xFFFF
// 1479       {
// 1480         ind->hdr.event = ZCL_KEY_ESTABLISH_IND;
        MOV     DPL,R6
        MOV     DPH,R7
        MOV     A,#0x35
        MOVX    @DPTR,A
// 1481         ind->hdr.status = pInMsg->pData[0];
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     DPH,A
        MOV     DPL,R0
        MOVX    A,@DPTR
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        MOVX    @DPTR,A
// 1482         ind->waitTime = pInMsg->pData[1];
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     DPH,A
        MOV     DPL,R0
        INC     DPTR
        MOVX    A,@DPTR
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        INC     DPTR
        MOVX    @DPTR,A
// 1483         ind->keyEstablishmentSuite = BUILD_UINT16( pInMsg->pData[2], pInMsg->pData[3] );
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     DPH,A
        MOV     DPL,R0
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R2,A
        MOV     R3,#0x0
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     DPH,A
        MOV     DPL,R0
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R0,A
        MOV     R1,#0x0
        CLR     A
        XCH     A,R0
        MOV     R1,A
        MOV     A,R2
        ADD     A,R0
        MOV     R0,A
        MOV     A,R3
        ADDC    A,R1
        MOV     R1,A
        MOV     DPL,R6
        MOV     DPH,R7
        INC     DPTR
        INC     DPTR
        INC     DPTR
        MOV     A,R0
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R1
        MOVX    @DPTR,A
// 1484         osal_msg_send( keyEstablishRec[index].appTaskID, (uint8*)ind );
        ; Setup parameters for call to function osal_msg_send
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        MOV     A,?V0 + 2
        MOV     R0,?V0 + 2
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R4,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R4
        MOV     R4,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R4
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 13) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 13) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_msg_send?relay
        MOV     A,R1
// 1485       }
// 1486     }
// 1487     // In either case, remove the entry from the rec table
// 1488     zclGeneral_ResetKeyEstablishRec( index );
??zclGeneral_ProcessInCmd_TerminateKeyEstablish_2:
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     R1,?V0 + 2
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
// 1489 
// 1490 #if defined (NWK_AUTO_POLL)
// 1491     // Restore the saved poll rate for end device
// 1492     NLME_SetPollRate(zclSavedPollRate);
        ; Setup parameters for call to function NLME_SetPollRate
        MOV     DPTR,#zclSavedPollRate
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??NLME_SetPollRate?relay
// 1493 #endif
// 1494   }
// 1495   return ZSuccess;
??zclGeneral_ProcessInCmd_TerminateKeyEstablish_1:
        MOV     R1,#0x0
        MOV     R7,#0x6
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock19
// 1496 }
// 1497 
// 1498 /*********************************************************************
// 1499  * @fn      zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey
// 1500  *
// 1501  * @brief   Calculate the Key using ECC library upon receipt of Initiate
// 1502             Key Establishment Command.
// 1503  *
// 1504  * @param   none
// 1505  *
// 1506  * @return  ZStatus_t - ZFailure @ Entry pending key calculation not found
// 1507  *                      ZSuccess
// 1508  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
// 1509 static ZStatus_t zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey( void )
zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey:
          CFI Block cfiBlock20 Using cfiCommon0
          CFI Function zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey
        CODE
// 1510 {
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, zclGeneral_GetKeyEstablishRecIndex_State
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 40, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 40, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, osal_mem_alloc
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 40, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 40, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 40, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 40, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, osal_mem_alloc
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 40, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 40, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, osal_mem_free
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 40, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 40, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 40, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 40, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, osal_nv_read
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 44, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 44, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, osal_nv_read
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 44, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 44, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, ZMacSetReq
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 40, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 40, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, ZSE_ECCKeyBitGenerate
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 58, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 58, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, ZMacSetReq
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 40, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 40, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, osal_mem_free
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 40, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 40, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, osal_mem_free
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 40, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 40, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, osal_mem_alloc
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 40, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 40, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 40, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 40, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, zclGeneral_KeyEstablishment_KeyDeriveFunction
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 40, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 40, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, osal_memcpy
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 43, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 43, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, osal_memcpy
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 43, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 43, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, osal_mem_free
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 40, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 40, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, zclGeneral_KeyEstablish_Send_EphemeralDataRsp
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 42, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 42, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, osal_start_reload_timer
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 40, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 40, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 45, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 45, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 40, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 40, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey, NLME_SetPollRate
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 40, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 40, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x12
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V9 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V8 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V7 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-16)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-17)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-18)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 18)
        ; Saved register size: 18
        ; Auto size: 22
        MOV     A,#-0x16
        LCALL   ?ALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 40)
// 1511   uint8 zData[KEY_ESTABLISH_SHARED_SECRET_LENGTH];
// 1512   uint8 *caPublicKey, *devicePrivateKey, *keyBit;
// 1513   uint8 index, status, tmp;
// 1514 
// 1515   // It is possible to have multiple entries in the keyCalulationPending state.
// 1516   // Here we assume the partner that starts the key establishment procedure earlier
// 1517   // will have a smaller index in the table.
// 1518   // However, this might not apply due to different processing capability of
// 1519   // different processors.
// 1520   if ( (index = zclGeneral_GetKeyEstablishRecIndex_State( KeyEstablishState_KeyCalculatePending ))
// 1521        >= MAX_KEY_ESTABLISHMENT_REC_ENTRY )
        ; Setup parameters for call to function zclGeneral_GetKeyEstablishRecIndex_State
        MOV     R1,#0x3
        LCALL   ??zclGeneral_GetKeyEstablishRecIndex_State?rela
        MOV     A,R1
        MOV     R0,A
        MOV     A,R0
        MOV     R6,A
        MOV     A,R0
        CLR     C
        SUBB    A,#0x2
        JC      ??zclGeneral_InitiateKeyEstablish_Cmd_Calculate_1
// 1522   {
// 1523     return ZFailure;
        MOV     R1,#0x1
        LJMP    ??zclGeneral_InitiateKeyEstablish_Cmd_Calculate_2 & 0xFFFF
// 1524   }
// 1525 
// 1526   if ((caPublicKey = osal_mem_alloc(ZCL_KE_CA_PUBLIC_KEY_LEN)) == NULL)
??zclGeneral_InitiateKeyEstablish_Cmd_Calculate_1:
        ; Setup parameters for call to function osal_mem_alloc
        MOV     R2,#0x16
        MOV     R3,#0x0
        LCALL   ??osal_mem_alloc?relay
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     R0,?V0 + 4
        MOV     R1,?V0 + 5
        MOV     ?V0 + 2,R0
        MOV     ?V0 + 3,R1
        MOV     A,R0
        ORL     A,R1
        JNZ     ??zclGeneral_InitiateKeyEstablish_Cmd_Calculate_3
// 1527   {
// 1528     // Reset the entry
// 1529     zclGeneral_ResetKeyEstablishRec( index );
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
// 1530 
// 1531     return ZCL_STATUS_SOFTWARE_FAILURE;  // Memory allocation failure.
        MOV     R1,#-0x3f
        LJMP    ??zclGeneral_InitiateKeyEstablish_Cmd_Calculate_2 & 0xFFFF
// 1532   }
// 1533   if ((devicePrivateKey = osal_mem_alloc(ZCL_KE_DEVICE_PRIVATE_KEY_LEN)) == NULL)
??zclGeneral_InitiateKeyEstablish_Cmd_Calculate_3:
        ; Setup parameters for call to function osal_mem_alloc
        MOV     R2,#0x15
        MOV     R3,#0x0
        LCALL   ??osal_mem_alloc?relay
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     R0,?V0 + 4
        MOV     R1,?V0 + 5
        MOV     ?V0 + 8,R0
        MOV     ?V0 + 9,R1
        MOV     A,R0
        ORL     A,R1
        JNZ     ??zclGeneral_InitiateKeyEstablish_Cmd_Calculate_4
// 1534   {
// 1535     osal_mem_free(caPublicKey);
        ; Setup parameters for call to function osal_mem_free
        MOV     R2,?V0 + 2
        MOV     R3,?V0 + 3
        LCALL   ??osal_mem_free?relay
// 1536 
// 1537     // Reset the entry
// 1538     zclGeneral_ResetKeyEstablishRec( index );
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
// 1539 
// 1540     return ZCL_STATUS_SOFTWARE_FAILURE;  // Memory allocation failure.
        MOV     R1,#-0x3f
        LJMP    ??zclGeneral_InitiateKeyEstablish_Cmd_Calculate_2 & 0xFFFF
// 1541   }
// 1542 
// 1543   osal_nv_read(ZCD_NV_CA_PUBLIC_KEY, 0, ZCL_KE_CA_PUBLIC_KEY_LEN, caPublicKey);
??zclGeneral_InitiateKeyEstablish_Cmd_Calculate_4:
        ; Setup parameters for call to function osal_nv_read
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 42)
        MOV     ?V0 + 4,#0x16
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 44)
        MOV     R4,#0x0
        MOV     R5,#0x0
        MOV     R2,#0x6b
        MOV     R3,#0x0
        LCALL   ??osal_nv_read?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 40)
        MOV     A,R1
// 1544   osal_nv_read(ZCD_NV_DEVICE_PRIVATE_KEY, 0, ZCL_KE_DEVICE_PRIVATE_KEY_LEN, devicePrivateKey);
        ; Setup parameters for call to function osal_nv_read
        MOV     R0,#?V0 + 8
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 42)
        MOV     ?V0 + 4,#0x15
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 44)
        MOV     R4,#0x0
        MOV     R5,#0x0
        MOV     R2,#0x6a
        MOV     R3,#0x0
        LCALL   ??osal_nv_read?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 40)
        MOV     A,R1
// 1545 
// 1546   // Turn off the radio
// 1547   tmp = FALSE;
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOV     A,#0x0
        MOVX    @DPTR,A
// 1548   ZMacSetReq( ZMacRxOnIdle, &tmp );
        ; Setup parameters for call to function ZMacSetReq
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOV     R2,DPL
        MOV     R3,DPH
        MOV     R1,#0x52
        LCALL   ??ZMacSetReq?relay
        MOV     A,R1
// 1549 
// 1550   status = ZSE_ECCKeyBitGenerate( devicePrivateKey, keyEstablishRec[index].pLocalEPrivateKey,
// 1551                     keyEstablishRec[index].pLocalEPublicKey,
// 1552                     keyEstablishRec[index].pRemoteCertificate,
// 1553                     keyEstablishRec[index].pRemotePublicKey,
// 1554                     caPublicKey, zData,
// 1555                     zclGeneral_KeyEstablishment_HashFunc,
// 1556                     zclKeyEstablish_YieldFunc, zclKeyEstablish_YieldLevel);
        ; Setup parameters for call to function ZSE_ECCKeyBitGenerate
        MOV     DPTR,#zclKeyEstablish_YieldLevel
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        CLR     A
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,A
        MOV     ?V0 + 7,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_FOUR
          CFI CFA_XSP16 add(XSP16, 44)
        MOV     DPTR,#zclKeyEstablish_YieldFunc
        LCALL   ?PUSH_XSTACK8_X_TWO
          CFI CFA_XSP16 add(XSP16, 46)
        MOV     ?V0 + 4,#??zclGeneral_KeyEstablishment_HashFunc?relay & 0xff
        MOV     ?V0 + 5,#(??zclGeneral_KeyEstablishment_HashFunc?relay >> 8) & 0xff
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 48)
        MOV     A,#0x9
        LCALL   ?XSTACK_DISP0_8
        MOV     ?V0 + 4,DPL
        MOV     ?V0 + 5,DPH
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 50)
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 52)
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 29) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 29) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        LCALL   ?PUSH_XSTACK8_X_TWO
          CFI CFA_XSP16 add(XSP16, 54)
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 31) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 31) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        LCALL   ?PUSH_XSTACK8_X_TWO
          CFI CFA_XSP16 add(XSP16, 56)
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 27) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 27) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        LCALL   ?PUSH_XSTACK8_X_TWO
          CFI CFA_XSP16 add(XSP16, 58)
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 25) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 25) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R4,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R5,A
        MOV     R2,?V0 + 8
        MOV     R3,?V0 + 9
        LCALL   ??ZSE_ECCKeyBitGenerate?relay
        MOV     A,#0x12
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 40)
        MOV     A,R2
        MOV     R7,A
// 1557   tmp = TRUE;
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOV     A,#0x1
        MOVX    @DPTR,A
// 1558   ZMacSetReq( ZMacRxOnIdle, &tmp );  // Turn the radio back on
        ; Setup parameters for call to function ZMacSetReq
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOV     R2,DPL
        MOV     R3,DPH
        MOV     R1,#0x52
        LCALL   ??ZMacSetReq?relay
        MOV     A,R1
// 1559 
// 1560   osal_mem_free(caPublicKey);
        ; Setup parameters for call to function osal_mem_free
        MOV     R2,?V0 + 2
        MOV     R3,?V0 + 3
        LCALL   ??osal_mem_free?relay
// 1561   osal_mem_free(devicePrivateKey);
        ; Setup parameters for call to function osal_mem_free
        MOV     R2,?V0 + 8
        MOV     R3,?V0 + 9
        LCALL   ??osal_mem_free?relay
// 1562 
// 1563   if( status == MCE_SUCCESS )
        MOV     A,R7
        JZ      $+5
        LJMP    ??zclGeneral_InitiateKeyEstablish_Cmd_Calculate_5 & 0xFFFF
// 1564   {
// 1565     // Allocate buffer to store KDF(Z) = MacKey || KeyData
// 1566     if ( (keyBit = osal_mem_alloc( KEY_ESTABLISH_KEY_DATA_LENGTH +
// 1567                                  KEY_ESTABLISH_MAC_KEY_LENGTH)) == NULL )
        ; Setup parameters for call to function osal_mem_alloc
        MOV     R2,#0x20
        MOV     R3,#0x0
        LCALL   ??osal_mem_alloc?relay
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     R0,?V0 + 4
        MOV     R1,?V0 + 5
        MOV     ?V0 + 0,R0
        MOV     ?V0 + 1,R1
        MOV     A,R0
        ORL     A,R1
        JNZ     ??zclGeneral_InitiateKeyEstablish_Cmd_Calculate_6
// 1568     {
// 1569       // Reset the entry
// 1570       zclGeneral_ResetKeyEstablishRec( index );
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
// 1571 
// 1572       return  ZCL_STATUS_SOFTWARE_FAILURE; // Memory allocation failure
        MOV     R1,#-0x3f
        LJMP    ??zclGeneral_InitiateKeyEstablish_Cmd_Calculate_2 & 0xFFFF
// 1573     }
// 1574 
// 1575     // Derive the keying data using KDF function
// 1576     zclGeneral_KeyEstablishment_KeyDeriveFunction(zData,
// 1577                                                   KEY_ESTABLISH_SHARED_SECRET_LENGTH,
// 1578                                                   keyBit );
??zclGeneral_InitiateKeyEstablish_Cmd_Calculate_6:
        ; Setup parameters for call to function zclGeneral_KeyEstablishment_KeyDeriveFunction
        MOV     R4,?V0 + 0
        MOV     R5,?V0 + 1
        MOV     R1,#0x15
        MOV     A,#0x1
        LCALL   ?XSTACK_DISP0_8
        MOV     R2,DPL
        MOV     R3,DPH
        LCALL   ??zclGeneral_KeyEstablishment_KeyDeriveFunction
// 1579 
// 1580     // Save the derived 128-bit key and macKey
// 1581     osal_memcpy( keyEstablishRec[index].pMacKey, keyBit, KEY_ESTABLISH_MAC_KEY_LENGTH );
        ; Setup parameters for call to function osal_memcpy
        MOV     ?V0 + 4,?V0 + 0
        MOV     ?V0 + 5,?V0 + 1
        MOV     ?V0 + 6,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 43)
        MOV     R4,#0x10
        MOV     R5,#0x0
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 35) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 35) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 40)
// 1582     osal_memcpy( keyEstablishRec[index].pKey, &(keyBit[KEY_ESTABLISH_MAC_KEY_LENGTH]),
// 1583                 KEY_ESTABLISH_KEY_DATA_LENGTH);
        ; Setup parameters for call to function osal_memcpy
        MOV     A,?V0 + 0
        ADD     A,#0x10
        MOV     ?V0 + 4,A
        MOV     A,?V0 + 1
        ADDC    A,#0x0
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 43)
        MOV     R4,#0x10
        MOV     R5,#0x0
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 33) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 33) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 40)
// 1584     osal_mem_free( keyBit );
        ; Setup parameters for call to function osal_mem_free
        MOV     R2,?V0 + 0
        MOV     R3,?V0 + 1
        LCALL   ??osal_mem_free?relay
// 1585 
// 1586     // Key Bit generation success, send Ephemeral Data Response back
// 1587     zclGeneral_KeyEstablish_Send_EphemeralDataRsp( ZCL_KEY_ESTABLISHMENT_ENDPOINT,
// 1588                                                    &(keyEstablishRec[index].dstAddr),
// 1589                                                    keyEstablishRec[index].pLocalEPublicKey,
// 1590                                                    FALSE, keyEstablishRec[index].lastSeqNum );
        ; Setup parameters for call to function zclGeneral_KeyEstablish_Send_EphemeralDataRsp
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 12) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 12) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 41)
        MOV     ?V0 + 4,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 42)
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 27) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 27) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R4,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R5,A
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#keyEstablishRec & 0xff
        ADD     A,R0
        MOV     R2,A
        MOV     A,#(keyEstablishRec >> 8) & 0xff
        ADDC    A,R1
        MOV     R3,A
        MOV     R1,#0xa
        LCALL   ??zclGeneral_KeyEstablish_Send_EphemeralDataRsp
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 40)
        MOV     A,R1
// 1591 
// 1592     // The Request was processed successfuly, now the age timer needs to start based on the
// 1593     // remote Config Key Generate
// 1594     keyEstablishRec[index].age = keyEstablishRec[index].remoteConfKeyGenTime;
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 38) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 38) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        PUSH    A
          CFI CFA_SP SP+-1
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 23) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 23) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        POP     A
          CFI CFA_SP SP+0
        MOVX    @DPTR,A
// 1595 
// 1596     // Start the Config Key Generate aging timer
// 1597     osal_start_reload_timer( zcl_KeyEstablishment_TaskID, KEY_ESTABLISHMENT_REC_AGING_EVT,
// 1598                              KEY_ESTABLISHMENT_REC_AGING_INTERVAL );
        ; Setup parameters for call to function osal_start_reload_timer
        MOV     R4,#-0x18
        MOV     R5,#0x3
        MOV     R2,#0x1
        MOV     R3,#0x0
        MOV     DPTR,#zcl_KeyEstablishment_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_start_reload_timer?relay
        MOV     A,R1
// 1599   }
// 1600   else
// 1601   {
// 1602     // Key Bit generation failure. Send terminate key command
// 1603      zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment( ZCL_KEY_ESTABLISHMENT_ENDPOINT,
// 1604                                                             &(keyEstablishRec[index].dstAddr),
// 1605                                                             TermKeyStatus_BadKeyConfirm,
// 1606                                                             KEY_ESTABLISHMENT_AVG_TIMEOUT,
// 1607                                                             KEY_ESTABLISHMENT_SUITE,
// 1608                                                             ZCL_FRAME_SERVER_CLIENT_DIR,
// 1609                                                             FALSE, zcl_SeqNum++ );
// 1610     // Reset the entry
// 1611     zclGeneral_ResetKeyEstablishRec( index );
// 1612 
// 1613 #if defined (NWK_AUTO_POLL)
// 1614     // Restore the saved poll rate for end device
// 1615     NLME_SetPollRate(zclSavedPollRate);
// 1616 #endif
// 1617 
// 1618      return ZFailure;
// 1619   }
// 1620 
// 1621   keyEstablishRec[index].state = KeyEstablishState_ConfirmPending;
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 24) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 24) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,#0x4
        MOVX    @DPTR,A
// 1622   return ZSuccess;
        MOV     R1,#0x0
        SJMP    ??zclGeneral_InitiateKeyEstablish_Cmd_Calculate_2
??zclGeneral_InitiateKeyEstablish_Cmd_Calculate_5:
        MOV     DPTR,#zcl_SeqNum
        MOVX    A,@DPTR
        MOV     R0,A
        MOV     A,#0x1
        ADD     A,R0
        MOV     DPTR,#zcl_SeqNum
        MOVX    @DPTR,A
        ; Setup parameters for call to function zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment
        MOV     A,R0
        MOV     ?V0 + 4,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 41)
        MOV     ?V0 + 4,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 42)
        MOV     ?V0 + 4,#0x1
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 43)
        MOV     ?V0 + 4,#0x1
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 45)
        MOV     R5,#0x1c
        MOV     R4,#0x2
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#keyEstablishRec & 0xff
        ADD     A,R0
        MOV     R2,A
        MOV     A,#(keyEstablishRec >> 8) & 0xff
        ADDC    A,R1
        MOV     R3,A
        MOV     R1,#0xa
        LCALL   ??zclGeneral_KeyEstablish_Send_TerminateKeyEsta
        MOV     A,#0x5
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 40)
        MOV     A,R1
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
        ; Setup parameters for call to function NLME_SetPollRate
        MOV     DPTR,#zclSavedPollRate
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??NLME_SetPollRate?relay
        MOV     R1,#0x1
??zclGeneral_InitiateKeyEstablish_Cmd_Calculate_2:
        MOV     A,#0x16
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 18)
        MOV     R7,#0xa
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock20
// 1623 }
// 1624 
// 1625 /*********************************************************************
// 1626  * @fn      zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey
// 1627  *
// 1628  * @brief   Calculate the Key using ECC library upon receipt of
// 1629  *          Ephemeral Data Response.
// 1630  *
// 1631  * @param   none
// 1632  *
// 1633  * @return  ZStatus_t - ZFailure @ Unsupported
// 1634  *                      ZCL_STATUS_MALFORMED_COMMAND
// 1635  *                      ZCL_STATUS_CMD_HAS_RSP
// 1636  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
// 1637 static ZStatus_t zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey( void )
zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey:
          CFI Block cfiBlock21 Using cfiCommon0
          CFI Function zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey
        CODE
// 1638 {
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, zclGeneral_GetKeyEstablishRecIndex_State
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 57, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, osal_mem_alloc
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 57, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 57, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, osal_mem_alloc
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 57, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 57, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, osal_mem_free
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 57, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, osal_nv_read
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 61, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 61, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, osal_nv_read
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 61, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 61, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, ZMacGetReq
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 57, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, ZMacSetReq
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 57, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, ZSE_ECCKeyBitGenerate
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 75, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 75, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, ZMacSetReq
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 57, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, osal_mem_free
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 57, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, osal_mem_free
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 57, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 62, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 62, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 57, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, NLME_SetPollRate
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 57, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, osal_mem_alloc
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 57, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 57, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, zclGeneral_KeyEstablishment_KeyDeriveFunction
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 57, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, osal_memcpy
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 60, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 60, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, osal_memcpy
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 60, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 60, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, zclGeneral_KeyEstablishment_GenerateMAC
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 57, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, osal_mem_free
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 57, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, zclGeneral_KeyEstablish_Send_ConfirmKey
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 59, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 59, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey, osal_start_reload_timer
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 57, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 57, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x12
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V9 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V8 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V7 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-16)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-17)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-18)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 18)
        ; Saved register size: 18
        ; Auto size: 39
        MOV     A,#-0x27
        LCALL   ?ALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 57)
// 1639   uint8 zData[KEY_ESTABLISH_SHARED_SECRET_LENGTH];
// 1640   uint8 MACu[KEY_ESTABLISH_MAC_LENGTH];
// 1641   uint8 *caPublicKey, *devicePrivateKey, *keyBit;
// 1642   uint8 index, ret, tmp, currentRxState;
// 1643 
// 1644   // It is possible to have multiple entries in the keyCalulationPending state.
// 1645   // Here we assume the partner that starts the key establishment procedure earlier
// 1646   // will have a smaller index in the table.
// 1647   // However, this might not apply due to different processing capability of
// 1648   // different processors.
// 1649   if ( (index = zclGeneral_GetKeyEstablishRecIndex_State( KeyEstablishState_KeyCalculatePending ))
// 1650        >= MAX_KEY_ESTABLISHMENT_REC_ENTRY )
        ; Setup parameters for call to function zclGeneral_GetKeyEstablishRecIndex_State
        MOV     R1,#0x3
        LCALL   ??zclGeneral_GetKeyEstablishRecIndex_State?rela
        MOV     A,R1
        MOV     R0,A
        MOV     A,R0
        MOV     R6,A
        MOV     A,R0
        CLR     C
        SUBB    A,#0x2
        JC      ??zclGeneral_InitiateKeyEstablish_Rsp_Calculate_1
// 1651   {
// 1652     return ZFailure;
        MOV     R1,#0x1
        LJMP    ??zclGeneral_InitiateKeyEstablish_Rsp_Calculate_2 & 0xFFFF
// 1653   }
// 1654 
// 1655   if ((caPublicKey = osal_mem_alloc(ZCL_KE_CA_PUBLIC_KEY_LEN)) == NULL)
??zclGeneral_InitiateKeyEstablish_Rsp_Calculate_1:
        ; Setup parameters for call to function osal_mem_alloc
        MOV     R2,#0x16
        MOV     R3,#0x0
        LCALL   ??osal_mem_alloc?relay
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     R0,?V0 + 4
        MOV     R1,?V0 + 5
        MOV     ?V0 + 2,R0
        MOV     ?V0 + 3,R1
        MOV     A,R0
        ORL     A,R1
        JNZ     ??zclGeneral_InitiateKeyEstablish_Rsp_Calculate_3
// 1656   {
// 1657     // Reset the entry from the rec table
// 1658     zclGeneral_ResetKeyEstablishRec( index );
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
// 1659 
// 1660     return ZCL_STATUS_SOFTWARE_FAILURE;  // Memory allocation failure.
        MOV     R1,#-0x3f
        LJMP    ??zclGeneral_InitiateKeyEstablish_Rsp_Calculate_2 & 0xFFFF
// 1661   }
// 1662   if ((devicePrivateKey = osal_mem_alloc(ZCL_KE_DEVICE_PRIVATE_KEY_LEN)) == NULL)
??zclGeneral_InitiateKeyEstablish_Rsp_Calculate_3:
        ; Setup parameters for call to function osal_mem_alloc
        MOV     R2,#0x15
        MOV     R3,#0x0
        LCALL   ??osal_mem_alloc?relay
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     R0,?V0 + 4
        MOV     R1,?V0 + 5
        MOV     ?V0 + 8,R0
        MOV     ?V0 + 9,R1
        MOV     A,R0
        ORL     A,R1
        JNZ     ??zclGeneral_InitiateKeyEstablish_Rsp_Calculate_4
// 1663   {
// 1664     // Reset the entry from the rec table
// 1665     zclGeneral_ResetKeyEstablishRec( index );
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
// 1666 
// 1667     osal_mem_free(caPublicKey);
        ; Setup parameters for call to function osal_mem_free
        MOV     R2,?V0 + 2
        MOV     R3,?V0 + 3
        LCALL   ??osal_mem_free?relay
// 1668     return ZCL_STATUS_SOFTWARE_FAILURE;  // Memory allocation failure.
        MOV     R1,#-0x3f
        LJMP    ??zclGeneral_InitiateKeyEstablish_Rsp_Calculate_2 & 0xFFFF
// 1669   }
// 1670   osal_nv_read(ZCD_NV_CA_PUBLIC_KEY, 0, ZCL_KE_CA_PUBLIC_KEY_LEN, caPublicKey);
??zclGeneral_InitiateKeyEstablish_Rsp_Calculate_4:
        ; Setup parameters for call to function osal_nv_read
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 59)
        MOV     ?V0 + 4,#0x16
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 61)
        MOV     R4,#0x0
        MOV     R5,#0x0
        MOV     R2,#0x6b
        MOV     R3,#0x0
        LCALL   ??osal_nv_read?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 57)
        MOV     A,R1
// 1671   osal_nv_read(ZCD_NV_DEVICE_PRIVATE_KEY, 0, ZCL_KE_DEVICE_PRIVATE_KEY_LEN, devicePrivateKey);
        ; Setup parameters for call to function osal_nv_read
        MOV     R0,#?V0 + 8
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 59)
        MOV     ?V0 + 4,#0x15
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 61)
        MOV     R4,#0x0
        MOV     R5,#0x0
        MOV     R2,#0x6a
        MOV     R3,#0x0
        LCALL   ??osal_nv_read?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 57)
        MOV     A,R1
// 1672 
// 1673   ZMacGetReq( ZMacRxOnIdle, &currentRxState );  // Save current radio state
        ; Setup parameters for call to function ZMacGetReq
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOV     R2,DPL
        MOV     R3,DPH
        MOV     R1,#0x52
        LCALL   ??ZMacGetReq?relay
        MOV     A,R1
// 1674   // Turn off the radio before the key bit generation, in order to avoid
// 1675   // incoming messages accumulation by interrupts during the long process time.
// 1676   tmp = FALSE;
        MOV     A,#0x1
        LCALL   ?XSTACK_DISP0_8
        MOV     A,#0x0
        MOVX    @DPTR,A
// 1677   ZMacSetReq( ZMacRxOnIdle, &tmp );
        ; Setup parameters for call to function ZMacSetReq
        MOV     A,#0x1
        LCALL   ?XSTACK_DISP0_8
        MOV     R2,DPL
        MOV     R3,DPH
        MOV     R1,#0x52
        LCALL   ??ZMacSetReq?relay
        MOV     A,R1
// 1678 
// 1679   // Generate the Key Bits
// 1680   ret = ZSE_ECCKeyBitGenerate( devicePrivateKey, keyEstablishRec[index].pLocalEPrivateKey,
// 1681                              keyEstablishRec[index].pLocalEPublicKey,
// 1682                              keyEstablishRec[index].pRemoteCertificate,
// 1683                              keyEstablishRec[index].pRemotePublicKey,
// 1684                              caPublicKey, zData,
// 1685                              zclGeneral_KeyEstablishment_HashFunc,
// 1686                              zclKeyEstablish_YieldFunc, zclKeyEstablish_YieldLevel);
        ; Setup parameters for call to function ZSE_ECCKeyBitGenerate
        MOV     DPTR,#zclKeyEstablish_YieldLevel
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        CLR     A
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,A
        MOV     ?V0 + 7,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_FOUR
          CFI CFA_XSP16 add(XSP16, 61)
        MOV     DPTR,#zclKeyEstablish_YieldFunc
        LCALL   ?PUSH_XSTACK8_X_TWO
          CFI CFA_XSP16 add(XSP16, 63)
        MOV     ?V0 + 4,#??zclGeneral_KeyEstablishment_HashFunc?relay & 0xff
        MOV     ?V0 + 5,#(??zclGeneral_KeyEstablishment_HashFunc?relay >> 8) & 0xff
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 65)
        MOV     A,#0x1a
        LCALL   ?XSTACK_DISP0_8
        MOV     ?V0 + 4,DPL
        MOV     ?V0 + 5,DPH
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 67)
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 69)
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 29) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 29) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        LCALL   ?PUSH_XSTACK8_X_TWO
          CFI CFA_XSP16 add(XSP16, 71)
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 31) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 31) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        LCALL   ?PUSH_XSTACK8_X_TWO
          CFI CFA_XSP16 add(XSP16, 73)
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 27) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 27) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        LCALL   ?PUSH_XSTACK8_X_TWO
          CFI CFA_XSP16 add(XSP16, 75)
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 25) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 25) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R4,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R5,A
        MOV     R2,?V0 + 8
        MOV     R3,?V0 + 9
        LCALL   ??ZSE_ECCKeyBitGenerate?relay
        MOV     A,#0x12
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 57)
        MOV     A,R2
        MOV     R7,A
// 1687 
// 1688   ZMacSetReq( ZMacRxOnIdle, &currentRxState );  // Resume saved radio state
        ; Setup parameters for call to function ZMacSetReq
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOV     R2,DPL
        MOV     R3,DPH
        MOV     R1,#0x52
        LCALL   ??ZMacSetReq?relay
        MOV     A,R1
// 1689 
// 1690   osal_mem_free(caPublicKey);
        ; Setup parameters for call to function osal_mem_free
        MOV     R2,?V0 + 2
        MOV     R3,?V0 + 3
        LCALL   ??osal_mem_free?relay
// 1691   osal_mem_free(devicePrivateKey);
        ; Setup parameters for call to function osal_mem_free
        MOV     R2,?V0 + 8
        MOV     R3,?V0 + 9
        LCALL   ??osal_mem_free?relay
// 1692 
// 1693   if ( ret != MCE_SUCCESS )
        MOV     A,R7
        JZ      ??zclGeneral_InitiateKeyEstablish_Rsp_Calculate_5
// 1694   {
// 1695     // Key Bit generation failure. Send terminate key command
// 1696      zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment( ZCL_KEY_ESTABLISHMENT_ENDPOINT,
// 1697                                                             &(keyEstablishRec[index].dstAddr),
// 1698                                                             TermKeyStatus_BadKeyConfirm,
// 1699                                                             KEY_ESTABLISHMENT_AVG_TIMEOUT,
// 1700                                                             KEY_ESTABLISHMENT_SUITE,
// 1701                                                             ZCL_FRAME_CLIENT_SERVER_DIR,
// 1702                                                             FALSE, zcl_SeqNum++ );
        MOV     DPTR,#zcl_SeqNum
        MOVX    A,@DPTR
        MOV     R0,A
        MOV     A,#0x1
        ADD     A,R0
        MOV     DPTR,#zcl_SeqNum
        MOVX    @DPTR,A
        ; Setup parameters for call to function zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment
        MOV     A,R0
        MOV     ?V0 + 4,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 58)
        MOV     ?V0 + 4,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 59)
        MOV     ?V0 + 4,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 60)
        MOV     ?V0 + 4,#0x1
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 62)
        MOV     R5,#0x1c
        MOV     R4,#0x2
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#keyEstablishRec & 0xff
        ADD     A,R0
        MOV     R2,A
        MOV     A,#(keyEstablishRec >> 8) & 0xff
        ADDC    A,R1
        MOV     R3,A
        MOV     R1,#0xa
        LCALL   ??zclGeneral_KeyEstablish_Send_TerminateKeyEsta
        MOV     A,#0x5
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 57)
        MOV     A,R1
// 1703      // Reset the entry from the rec table
// 1704      zclGeneral_ResetKeyEstablishRec( index );
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
// 1705 
// 1706 #if defined (NWK_AUTO_POLL)
// 1707     // Restore the saved poll rate for end device
// 1708     NLME_SetPollRate(zclSavedPollRate);
        ; Setup parameters for call to function NLME_SetPollRate
        MOV     DPTR,#zclSavedPollRate
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??NLME_SetPollRate?relay
// 1709 #endif
// 1710 
// 1711     return ZFailure;
        MOV     R1,#0x1
        LJMP    ??zclGeneral_InitiateKeyEstablish_Rsp_Calculate_2 & 0xFFFF
// 1712   }
// 1713   else
// 1714   {
// 1715     // Allocate buffer to store KDF(Z) = MacKey || KeyData
// 1716     if ( (keyBit = osal_mem_alloc( KEY_ESTABLISH_KEY_DATA_LENGTH +
// 1717                                  KEY_ESTABLISH_MAC_KEY_LENGTH)) == NULL )
??zclGeneral_InitiateKeyEstablish_Rsp_Calculate_5:
        ; Setup parameters for call to function osal_mem_alloc
        MOV     R2,#0x20
        MOV     R3,#0x0
        LCALL   ??osal_mem_alloc?relay
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     R0,?V0 + 4
        MOV     R1,?V0 + 5
        MOV     ?V0 + 0,R0
        MOV     ?V0 + 1,R1
        MOV     A,R0
        ORL     A,R1
        JNZ     ??zclGeneral_InitiateKeyEstablish_Rsp_Calculate_6
// 1718     {
// 1719       // Reset the entry from the rec table
// 1720       zclGeneral_ResetKeyEstablishRec( index );
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
// 1721 
// 1722       return  ZCL_STATUS_SOFTWARE_FAILURE; // Memory allocation failure
        MOV     R1,#-0x3f
        LJMP    ??zclGeneral_InitiateKeyEstablish_Rsp_Calculate_2 & 0xFFFF
// 1723     }
// 1724 
// 1725     // Derive the keying data using KDF function
// 1726     zclGeneral_KeyEstablishment_KeyDeriveFunction(zData,
// 1727                                                   KEY_ESTABLISH_SHARED_SECRET_LENGTH,
// 1728                                                   keyBit );
??zclGeneral_InitiateKeyEstablish_Rsp_Calculate_6:
        ; Setup parameters for call to function zclGeneral_KeyEstablishment_KeyDeriveFunction
        MOV     R4,?V0 + 0
        MOV     R5,?V0 + 1
        MOV     R1,#0x15
        MOV     A,#0x12
        LCALL   ?XSTACK_DISP0_8
        MOV     R2,DPL
        MOV     R3,DPH
        LCALL   ??zclGeneral_KeyEstablishment_KeyDeriveFunction
// 1729 
// 1730     // Save the derived 128-bit keyData
// 1731     osal_memcpy( keyEstablishRec[index].pMacKey, keyBit, KEY_ESTABLISH_KEY_DATA_LENGTH);
        ; Setup parameters for call to function osal_memcpy
        MOV     ?V0 + 4,?V0 + 0
        MOV     ?V0 + 5,?V0 + 1
        MOV     ?V0 + 6,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 60)
        MOV     R4,#0x10
        MOV     R5,#0x0
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 35) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 35) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 57)
// 1732     osal_memcpy( keyEstablishRec[index].pKey, &(keyBit[KEY_ESTABLISH_MAC_KEY_LENGTH]),
// 1733                  KEY_ESTABLISH_KEY_DATA_LENGTH);
        ; Setup parameters for call to function osal_memcpy
        MOV     A,?V0 + 0
        ADD     A,#0x10
        MOV     ?V0 + 4,A
        MOV     A,?V0 + 1
        ADDC    A,#0x0
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 60)
        MOV     R4,#0x10
        MOV     R5,#0x0
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 33) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 33) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 57)
// 1734 
// 1735     // Calculate MAC(U). Note that the keyBit is also pointing to the macKey
// 1736     zclGeneral_KeyEstablishment_GenerateMAC( index, TRUE, MACu );
        ; Setup parameters for call to function zclGeneral_KeyEstablishment_GenerateMAC
        MOV     A,#0x2
        LCALL   ?XSTACK_DISP0_8
        MOV     R4,DPL
        MOV     R5,DPH
        MOV     R2,#0x1
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_KeyEstablishment_GenerateMAC?relay
        MOV     A,R1
// 1737     osal_mem_free( keyBit );
        ; Setup parameters for call to function osal_mem_free
        MOV     R2,?V0 + 0
        MOV     R3,?V0 + 1
        LCALL   ??osal_mem_free?relay
// 1738 
// 1739     // Send MAC(U) to the Partner
// 1740     zclGeneral_KeyEstablish_Send_ConfirmKey( ZCL_KEY_ESTABLISHMENT_ENDPOINT,
// 1741                                              &(keyEstablishRec[index].dstAddr),
// 1742                                              MACu,
// 1743                                              FALSE, zcl_SeqNum++ );
        MOV     DPTR,#zcl_SeqNum
        MOVX    A,@DPTR
        MOV     R0,A
        MOV     A,#0x1
        ADD     A,R0
        MOV     DPTR,#zcl_SeqNum
        MOVX    @DPTR,A
        ; Setup parameters for call to function zclGeneral_KeyEstablish_Send_ConfirmKey
        MOV     A,R0
        MOV     ?V0 + 4,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 58)
        MOV     ?V0 + 4,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_ONE
          CFI CFA_XSP16 add(XSP16, 59)
        MOV     A,#0x4
        LCALL   ?XSTACK_DISP0_8
        MOV     R4,DPL
        MOV     R5,DPH
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#keyEstablishRec & 0xff
        ADD     A,R0
        MOV     R2,A
        MOV     A,#(keyEstablishRec >> 8) & 0xff
        ADDC    A,R1
        MOV     R3,A
        MOV     R1,#0xa
        LCALL   ??zclGeneral_KeyEstablish_Send_ConfirmKey?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 57)
        MOV     A,R1
// 1744 
// 1745     // The Request was processed successfuly, now the age timer needs to start based on the
// 1746     // remote Config Key Generate
// 1747     keyEstablishRec[index].age = keyEstablishRec[index].remoteConfKeyGenTime;
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 38) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 38) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        PUSH    A
          CFI CFA_SP SP+-1
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 23) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 23) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        POP     A
          CFI CFA_SP SP+0
        MOVX    @DPTR,A
// 1748 
// 1749     // Start the Config Key Generate aging timer
// 1750     osal_start_reload_timer( zcl_KeyEstablishment_TaskID, KEY_ESTABLISHMENT_REC_AGING_EVT,
// 1751                              KEY_ESTABLISHMENT_REC_AGING_INTERVAL );
        ; Setup parameters for call to function osal_start_reload_timer
        MOV     R4,#-0x18
        MOV     R5,#0x3
        MOV     R2,#0x1
        MOV     R3,#0x0
        MOV     DPTR,#zcl_KeyEstablishment_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_start_reload_timer?relay
        MOV     A,R1
// 1752 
// 1753     keyEstablishRec[index].state = KeyEstablishState_ConfirmPending;
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 24) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 24) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,#0x4
        MOVX    @DPTR,A
// 1754 
// 1755     return ZSuccess;
        MOV     R1,#0x0
??zclGeneral_InitiateKeyEstablish_Rsp_Calculate_2:
        MOV     A,#0x27
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 18)
        MOV     R7,#0xa
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock21
// 1756   }
// 1757 }
// 1758 
// 1759 /*********************************************************************
// 1760  * @fn      zclGeneral_InitKeyEstablishRecTable
// 1761  *
// 1762  * @brief   Initializae key establishment record table entries.
// 1763  *
// 1764  * @param   none
// 1765  *
// 1766  * @return  none
// 1767  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
// 1768 static void zclGeneral_InitKeyEstablishRecTable( void )
zclGeneral_InitKeyEstablishRecTable:
          CFI Block cfiBlock22 Using cfiCommon0
          CFI Function zclGeneral_InitKeyEstablishRecTable
        CODE
// 1769 {
        FUNCALL zclGeneral_InitKeyEstablishRecTable, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 9, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x9
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 9)
        ; Saved register size: 9
        ; Auto size: 0
// 1770   uint8 i;
// 1771 
// 1772   for ( i = 0; i < MAX_KEY_ESTABLISHMENT_REC_ENTRY; i++ )
        MOV     R6,#0x0
??zclGeneral_InitKeyEstablishRecTable_0:
        MOV     A,R6
        CLR     C
        SUBB    A,#0x2
        JNC     ??zclGeneral_InitKeyEstablishRecTable_1
// 1773   {
// 1774     zclGeneral_ResetKeyEstablishRec(i);
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
// 1775   }
        INC     R6
        SJMP    ??zclGeneral_InitKeyEstablishRecTable_0
// 1776 }
??zclGeneral_InitKeyEstablishRecTable_1:
        MOV     R7,#0x1
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock22
// 1777 
// 1778 /*********************************************************************
// 1779  * @fn      zclGeneral_GetKeyEstablishRecIndex
// 1780  *
// 1781  * @brief   Get the index of a particular key establishment record.
// 1782  *          If the input is INVALID_PARTNER_ADDR, return an empty slot.
// 1783  *
// 1784  * @param   partnerAddress - address of the partner that the local device
// 1785  *                           is establishing key with.
// 1786  *
// 1787  * @return   index of the record
// 1788  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
// 1789 static uint8 zclGeneral_GetKeyEstablishRecIndex( uint16 partnerAddress )
zclGeneral_GetKeyEstablishRecIndex:
          CFI Block cfiBlock23 Using cfiCommon0
          CFI Function zclGeneral_GetKeyEstablishRecIndex
        CODE
// 1790 {
        PUSH    DPL
          CFI DPL0 Frame(CFA_SP, 4)
          CFI CFA_SP SP+-4
        PUSH    DPH
          CFI DPH0 Frame(CFA_SP, 5)
          CFI CFA_SP SP+-5
        ; Saved register size: 2
        ; Auto size: 0
// 1791   uint8 i;
// 1792 
// 1793   // Find an existing entry or vacant entry, depends on what DstAddress is
// 1794   for ( i = 0; i < MAX_KEY_ESTABLISHMENT_REC_ENTRY ; i++ )
        MOV     R1,#0x0
??zclGeneral_GetKeyEstablishRecIndex_0:
        MOV     A,R1
        CLR     C
        SUBB    A,#0x2
        JNC     ??zclGeneral_GetKeyEstablishRecIndex_1
// 1795   {
// 1796     if ( keyEstablishRec[i].dstAddr.addr.shortAddr == partnerAddress )
        MOV     A,R1
        MOV     R4,A
        MOV     R5,#0x0
        MOV     A,R4
        MOV     B,#0x27
        MUL     AB
        XCH     A,R4
        MOV     R0,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R0
        MOV     R0,A
        MOV     B,#0x27
        MOV     A,R5
        MUL     AB
        ADD     A,R0
        MOV     R5,A
        MOV     A,#keyEstablishRec & 0xff
        ADD     A,R4
        MOV     DPL,A
        MOV     A,#(keyEstablishRec >> 8) & 0xff
        ADDC    A,R5
        MOV     DPH,A
        MOVX    A,@DPTR
        XRL     A,R2
        JNZ     ??zclGeneral_GetKeyEstablishRecIndex_2
        INC     DPTR
        MOVX    A,@DPTR
        XRL     A,R3
??zclGeneral_GetKeyEstablishRecIndex_2:
        JZ      ??zclGeneral_GetKeyEstablishRecIndex_1
// 1797     {
// 1798       // entry found
// 1799       break;
// 1800     }
// 1801   }
        INC     R1
        SJMP    ??zclGeneral_GetKeyEstablishRecIndex_0
// 1802 
// 1803   return i;
??zclGeneral_GetKeyEstablishRecIndex_1:
        POP     DPH
          CFI DPH0 SameValue
          CFI CFA_SP SP+-4
        POP     DPL
          CFI DPL0 SameValue
          CFI CFA_SP SP+-3
        LJMP    ?BRET
          CFI EndBlock cfiBlock23
// 1804 }
// 1805 
// 1806 /*********************************************************************
// 1807  * @fn      zclGeneral_GetKeyEstablishRecIndex
// 1808  *
// 1809  * @brief   Get the index of a particular key establishment record.
// 1810  *          If the input is INVALID_PARTNER_ADDR, return an empty slot.
// 1811  *
// 1812  * @param   state - state to find.
// 1813  *
// 1814  * @return   index of the record
// 1815  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
// 1816 static uint8 zclGeneral_GetKeyEstablishRecIndex_State( KeyEstablishState_t state )
zclGeneral_GetKeyEstablishRecIndex_State:
          CFI Block cfiBlock24 Using cfiCommon0
          CFI Function zclGeneral_GetKeyEstablishRecIndex_State
        CODE
// 1817 {
        PUSH    DPL
          CFI DPL0 Frame(CFA_SP, 4)
          CFI CFA_SP SP+-4
        PUSH    DPH
          CFI DPH0 Frame(CFA_SP, 5)
          CFI CFA_SP SP+-5
        ; Saved register size: 2
        ; Auto size: 0
        MOV     A,R1
        MOV     R4,A
// 1818   uint8 i;
// 1819 
// 1820   // Find an existing entry or vacant entry, depends on what DstAddress is
// 1821   for ( i = 0; i < MAX_KEY_ESTABLISHMENT_REC_ENTRY ; i++ )
        MOV     R1,#0x0
??zclGeneral_GetKeyEstablishRecIndex_State_0:
        MOV     A,R1
        CLR     C
        SUBB    A,#0x2
        JNC     ??zclGeneral_GetKeyEstablishRecIndex_State_1
// 1822   {
// 1823     if ( keyEstablishRec[i].state == state )
        MOV     A,R1
        MOV     R2,A
        MOV     R3,#0x0
        MOV     A,R2
        MOV     B,#0x27
        MUL     AB
        XCH     A,R2
        MOV     R0,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R0
        MOV     R0,A
        MOV     B,#0x27
        MOV     A,R3
        MUL     AB
        ADD     A,R0
        MOV     R3,A
        MOV     A,#(keyEstablishRec + 24) & 0xff
        ADD     A,R2
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 24) >> 8) & 0xff
        ADDC    A,R3
        MOV     DPH,A
        MOVX    A,@DPTR
        XRL     A,R4
        JZ      ??zclGeneral_GetKeyEstablishRecIndex_State_1
// 1824     {
// 1825       // entry found
// 1826       break;
// 1827     }
// 1828   }
        INC     R1
        SJMP    ??zclGeneral_GetKeyEstablishRecIndex_State_0
// 1829 
// 1830   return i;
??zclGeneral_GetKeyEstablishRecIndex_State_1:
        POP     DPH
          CFI DPH0 SameValue
          CFI CFA_SP SP+-4
        POP     DPL
          CFI DPL0 SameValue
          CFI CFA_SP SP+-3
        LJMP    ?BRET
          CFI EndBlock cfiBlock24
// 1831 }
// 1832 
// 1833 /*********************************************************************
// 1834  * @fn      zclGeneral_AddKeyEstablishRec
// 1835  *
// 1836  * @brief   Add a new key establishment record. If one already exist,
// 1837  *          remove the existng entry. After initialization, fill in
// 1838  *          partner short address and extended address. If partner extended
// 1839  *          address not available, return failure.
// 1840  *
// 1841  * @param   addr - address of the partner
// 1842  *
// 1843  * @return  index - 0..(MAX_KEY_ESTABLISHMENT_REC_ENTRY-1) @ success
// 1844  *                - MAX_KEY_ESTABLISHMENT_REC_ENTRY @ failure due to rec table full or
// 1845  *                  partner IEEE address not available or failure to allocate key buffers.
// 1846  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
// 1847 static uint8 zclGeneral_AddKeyEstablishRec( afAddrType_t *addr )
zclGeneral_AddKeyEstablishRec:
          CFI Block cfiBlock25 Using cfiCommon0
          CFI Function zclGeneral_AddKeyEstablishRec
        CODE
// 1848 {
        FUNCALL zclGeneral_AddKeyEstablishRec, zclGeneral_GetKeyEstablishRecIndex
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 15, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 15, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_AddKeyEstablishRec, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 15, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 15, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_AddKeyEstablishRec, zclGeneral_GetKeyEstablishRecIndex
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 15, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 15, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_AddKeyEstablishRec, osal_mem_alloc
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 15, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 15, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_AddKeyEstablishRec, osal_memcpy
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 18, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 18, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0xf
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 15)
        ; Saved register size: 15
        ; Auto size: 0
        MOV     ?V0 + 0,R2
        MOV     ?V0 + 1,R3
// 1849   uint8 index, *pBuf;
// 1850 
// 1851   // Search for all current key establishment record
// 1852   // If not found, create a new entry
// 1853   if ( ( index = zclGeneral_GetKeyEstablishRecIndex(addr->addr.shortAddr) )
// 1854       < MAX_KEY_ESTABLISHMENT_REC_ENTRY )
        ; Setup parameters for call to function zclGeneral_GetKeyEstablishRecIndex
        MOV     DPL,?V0 + 0
        MOV     DPH,?V0 + 1
        MOVX    A,@DPTR
        MOV     R2,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R3,A
        LCALL   ??zclGeneral_GetKeyEstablishRecIndex?relay
        MOV     A,R1
        MOV     R0,A
        MOV     ?V0 + 2,R0
        MOV     A,R0
        CLR     C
        SUBB    A,#0x2
        JNC     ??zclGeneral_AddKeyEstablishRec_0
// 1855   {
// 1856     // expire the existing entry for this address
// 1857     zclGeneral_ResetKeyEstablishRec( index );
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     R1,?V0 + 2
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
// 1858   }
// 1859 
// 1860   // Create a new Entry
// 1861   if ( (index = zclGeneral_GetKeyEstablishRecIndex(INVALID_PARTNER_ADDR))
// 1862       < MAX_KEY_ESTABLISHMENT_REC_ENTRY )
??zclGeneral_AddKeyEstablishRec_0:
        ; Setup parameters for call to function zclGeneral_GetKeyEstablishRecIndex
        MOV     R2,#-0x2
        MOV     R3,#-0x1
        LCALL   ??zclGeneral_GetKeyEstablishRecIndex?relay
        MOV     A,R1
        MOV     R0,A
        MOV     ?V0 + 2,R0
        MOV     A,R0
        CLR     C
        SUBB    A,#0x2
        JC      $+5
        LJMP    ??zclGeneral_AddKeyEstablishRec_1 & 0xFFFF
// 1863   {
// 1864     // Allocate memory for the rest of the fields
// 1865     if ( (pBuf = osal_mem_alloc( ZCL_KE_DEVICE_PRIVATE_KEY_LEN +
// 1866                                  ZCL_KE_CA_PUBLIC_KEY_LEN +
// 1867                                  ZCL_KE_CA_PUBLIC_KEY_LEN +
// 1868                                  ZCL_KE_IMPLICIT_CERTIFICATE_LEN +
// 1869                                  KEY_ESTABLISH_KEY_DATA_LENGTH +
// 1870                                  KEY_ESTABLISH_MAC_KEY_LENGTH )) != NULL )
        ; Setup parameters for call to function osal_mem_alloc
        MOV     R2,#-0x6f
        MOV     R3,#0x0
        LCALL   ??osal_mem_alloc?relay
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     R0,?V0 + 4
        MOV     R1,?V0 + 5
        MOV     A,R0
        MOV     R6,A
        MOV     A,R1
        MOV     R7,A
        MOV     A,R0
        ORL     A,R1
        JNZ     $+5
        LJMP    ??zclGeneral_AddKeyEstablishRec_2 & 0xFFFF
// 1871     {
// 1872       keyEstablishRec[index].pLocalEPrivateKey =  pBuf;
        MOV     A,?V0 + 2
        MOV     R0,?V0 + 2
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 25) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 25) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,R6
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R7
        MOVX    @DPTR,A
// 1873                                                   pBuf += ZCL_KE_DEVICE_PRIVATE_KEY_LEN;
        MOV     A,R6
        ADD     A,#0x15
        MOV     R6,A
        MOV     A,R7
        ADDC    A,#0x0
        MOV     R7,A
// 1874       keyEstablishRec[index].pLocalEPublicKey =   pBuf;
        MOV     A,?V0 + 2
        MOV     R0,?V0 + 2
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 27) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 27) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,R6
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R7
        MOVX    @DPTR,A
// 1875                                                   pBuf += ZCL_KE_CA_PUBLIC_KEY_LEN;
        MOV     A,R6
        ADD     A,#0x16
        MOV     R6,A
        MOV     A,R7
        ADDC    A,#0x0
        MOV     R7,A
// 1876       keyEstablishRec[index].pRemotePublicKey =   pBuf;
        MOV     A,?V0 + 2
        MOV     R0,?V0 + 2
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 29) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 29) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,R6
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R7
        MOVX    @DPTR,A
// 1877                                                   pBuf += ZCL_KE_CA_PUBLIC_KEY_LEN;
        MOV     A,R6
        ADD     A,#0x16
        MOV     R6,A
        MOV     A,R7
        ADDC    A,#0x0
        MOV     R7,A
// 1878       keyEstablishRec[index].pRemoteCertificate = pBuf;
        MOV     A,?V0 + 2
        MOV     R0,?V0 + 2
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 31) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 31) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,R6
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R7
        MOVX    @DPTR,A
// 1879                                                   pBuf += ZCL_KE_IMPLICIT_CERTIFICATE_LEN;
        MOV     A,R6
        ADD     A,#0x30
        MOV     R6,A
        MOV     A,R7
        ADDC    A,#0x0
        MOV     R7,A
// 1880       keyEstablishRec[index].pKey =               pBuf;
        MOV     A,?V0 + 2
        MOV     R0,?V0 + 2
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 33) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 33) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,R6
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R7
        MOVX    @DPTR,A
// 1881                                                   pBuf += KEY_ESTABLISH_KEY_DATA_LENGTH;
        MOV     A,R6
        ADD     A,#0x10
        MOV     R6,A
        MOV     A,R7
        ADDC    A,#0x0
        MOV     R7,A
// 1882       keyEstablishRec[index].pMacKey =            pBuf;
        MOV     A,?V0 + 2
        MOV     R0,?V0 + 2
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 35) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 35) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,R6
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,R7
        MOVX    @DPTR,A
// 1883 
// 1884       (void)osal_memcpy(&keyEstablishRec[index].dstAddr, addr, sizeof(afAddrType_t));
        ; Setup parameters for call to function osal_memcpy
        MOV     ?V0 + 4,?V0 + 0
        MOV     ?V0 + 5,?V0 + 1
        MOV     ?V0 + 6,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 18)
        MOV     R4,#0xc
        MOV     R5,#0x0
        MOV     A,?V0 + 2
        MOV     R0,?V0 + 2
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#keyEstablishRec & 0xff
        ADD     A,R0
        MOV     R2,A
        MOV     A,#(keyEstablishRec >> 8) & 0xff
        ADDC    A,R1
        MOV     R3,A
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 15)
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     DPL,?V0 + 4
        MOV     DPH,?V0 + 5
        SJMP    ??zclGeneral_AddKeyEstablishRec_1
// 1885 
// 1886       // extAddr will be unknown when the initator first initiates the key establishment
// 1887       // It will be filled in later after the remote certificate is received.
// 1888     }
// 1889     else
// 1890     {
// 1891       index = MAX_KEY_ESTABLISHMENT_REC_ENTRY;
??zclGeneral_AddKeyEstablishRec_2:
        MOV     ?V0 + 2,#0x2
// 1892     }
// 1893   }
// 1894 
// 1895   return index;
??zclGeneral_AddKeyEstablishRec_1:
        MOV     R1,?V0 + 2
        MOV     R7,#0x7
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock25
// 1896 }
// 1897 
// 1898 /*********************************************************************
// 1899  * @fn      zclGeneral_AgeKeyEstablishRec
// 1900  *
// 1901  * @brief   Function to age Key Establish Rec. This function is called
// 1902  *          as event handler for KEY_ESTABLISHMENT_REC_AGING_EVT every
// 1903  *          second.
// 1904  *
// 1905  * @param   none
// 1906  *
// 1907  * @return  none
// 1908  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
// 1909 static void zclGeneral_AgeKeyEstablishRec( void )
zclGeneral_AgeKeyEstablishRec:
          CFI Block cfiBlock26 Using cfiCommon0
          CFI Function zclGeneral_AgeKeyEstablishRec
        CODE
// 1910 {
        FUNCALL zclGeneral_AgeKeyEstablishRec, zclGeneral_ResetKeyEstablishRec
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 9, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_AgeKeyEstablishRec, osal_stop_timerEx
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 9, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 9, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x9
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 9)
        ; Saved register size: 9
        ; Auto size: 0
// 1911   uint8 i;
// 1912   bool recFound = FALSE;
        MOV     R7,#0x0
// 1913 
// 1914   for ( i = 0; i < MAX_KEY_ESTABLISHMENT_REC_ENTRY; i++ )
        MOV     R6,#0x0
??zclGeneral_AgeKeyEstablishRec_0:
        MOV     A,R6
        CLR     C
        SUBB    A,#0x2
        JC      $+5
        LJMP    ??zclGeneral_AgeKeyEstablishRec_1 & 0xFFFF
// 1915   {
// 1916     // Only age valid rec entry
// 1917     if (keyEstablishRec[i].dstAddr.addrMode == afAddrNotPresent)
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 8) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 8) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        JZ      ??zclGeneral_AgeKeyEstablishRec_2
// 1918     {
// 1919       continue;
// 1920     }
// 1921 
// 1922     if (--(keyEstablishRec[i].age) == 0)
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 23) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 23) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        ADD     A,#-0x1
        MOV     R3,A
        MOV     A,R3
        PUSH    A
          CFI CFA_SP SP+-1
        MOV     A,R6
        MOV     R0,A
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 23) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 23) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        POP     A
          CFI CFA_SP SP+0
        MOVX    @DPTR,A
        MOV     A,R3
        JNZ     ??zclGeneral_AgeKeyEstablishRec_3
// 1923     {
// 1924       // Reset this table entry
// 1925       zclGeneral_ResetKeyEstablishRec( i );
        ; Setup parameters for call to function zclGeneral_ResetKeyEstablishRec
        MOV     A,R6
        MOV     R1,A
        LCALL   ??zclGeneral_ResetKeyEstablishRec?relay
        SJMP    ??zclGeneral_AgeKeyEstablishRec_2
// 1926     }
// 1927     else
// 1928     {
// 1929        recFound = TRUE;
??zclGeneral_AgeKeyEstablishRec_3:
        MOV     R7,#0x1
// 1930     }
// 1931   }
??zclGeneral_AgeKeyEstablishRec_2:
        INC     R6
        LJMP    ??zclGeneral_AgeKeyEstablishRec_0 & 0xFFFF
// 1932 
// 1933   if ( recFound == FALSE )
??zclGeneral_AgeKeyEstablishRec_1:
        MOV     A,R7
        JNZ     ??zclGeneral_AgeKeyEstablishRec_4
// 1934   {
// 1935     osal_stop_timerEx( zcl_KeyEstablishment_TaskID, KEY_ESTABLISHMENT_REC_AGING_EVT );
        ; Setup parameters for call to function osal_stop_timerEx
        MOV     R2,#0x1
        MOV     R3,#0x0
        MOV     DPTR,#zcl_KeyEstablishment_TaskID
        MOVX    A,@DPTR
        MOV     R1,A
        LCALL   ??osal_stop_timerEx?relay
        MOV     A,R1
// 1936   }
// 1937 }
??zclGeneral_AgeKeyEstablishRec_4:
        MOV     R7,#0x1
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock26
// 1938 
// 1939 /*********************************************************************
// 1940  * @fn      zclGeneral_ResetKeyEstablishRec
// 1941  *
// 1942  * @brief   Reset specified key establishment record to initial value.
// 1943  *
// 1944  * @param   index - index of table entry to reset
// 1945  *
// 1946  * @return   ZStatus_t - ZSuccess or ZFailure
// 1947  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
// 1948 static void zclGeneral_ResetKeyEstablishRec( uint8 index )
zclGeneral_ResetKeyEstablishRec:
          CFI Block cfiBlock27 Using cfiCommon0
          CFI Function zclGeneral_ResetKeyEstablishRec
        CODE
// 1949 {
        FUNCALL zclGeneral_ResetKeyEstablishRec, osal_memset
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 14, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 14, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ResetKeyEstablishRec, osal_mem_free
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 14, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 14, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_ResetKeyEstablishRec, osal_memset
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 14, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 14, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0xe
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 14)
        ; Saved register size: 14
        ; Auto size: 0
        MOV     ?V0 + 0,R1
// 1950   uint8 *pKeys;
// 1951 
// 1952   pKeys = keyEstablishRec[index].pLocalEPrivateKey;
        MOV     A,?V0 + 0
        MOV     R0,?V0 + 0
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 25) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 25) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     R0,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     R1,A
        MOV     A,R0
        MOV     R6,A
        MOV     A,R1
        MOV     R7,A
// 1953   if ( pKeys != NULL )
        MOV     A,R6
        ORL     A,R7
        JZ      ??zclGeneral_ResetKeyEstablishRec_0
// 1954   {
// 1955     // All "Key infomation" was allocated in one block,
// 1956     // Clear the allocated memory to remove all copies of keys,
// 1957     (void)osal_memset( pKeys, 0, ZCL_KE_DEVICE_PRIVATE_KEY_LEN +
// 1958                                  ZCL_KE_CA_PUBLIC_KEY_LEN +
// 1959                                  ZCL_KE_CA_PUBLIC_KEY_LEN +
// 1960                                  ZCL_KE_IMPLICIT_CERTIFICATE_LEN +
// 1961                                  KEY_ESTABLISH_KEY_DATA_LENGTH +
// 1962                                  KEY_ESTABLISH_MAC_KEY_LENGTH );
        ; Setup parameters for call to function osal_memset
        MOV     R4,#-0x6f
        MOV     R5,#0x0
        MOV     R1,#0x0
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   ??osal_memset?relay
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     ?V0 + 2,?V0 + 4
        MOV     ?V0 + 3,?V0 + 5
// 1963     osal_mem_free( pKeys );
        ; Setup parameters for call to function osal_mem_free
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   ??osal_mem_free?relay
// 1964   }
// 1965 
// 1966   // Reset the table entry to initial state
// 1967   (void)osal_memset( &(keyEstablishRec[index]), 0, sizeof( zclKeyEstablishRec_t ) );
??zclGeneral_ResetKeyEstablishRec_0:
        ; Setup parameters for call to function osal_memset
        MOV     R4,#0x27
        MOV     R5,#0x0
        MOV     R1,#0x0
        MOV     A,?V0 + 0
        MOV     R2,?V0 + 0
        MOV     R3,#0x0
        MOV     A,R2
        MOV     B,#0x27
        MUL     AB
        XCH     A,R2
        MOV     R0,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R0
        MOV     R0,A
        MOV     B,#0x27
        MOV     A,R3
        MUL     AB
        ADD     A,R0
        MOV     R3,A
        MOV     A,#keyEstablishRec & 0xff
        ADD     A,R2
        MOV     R2,A
        MOV     A,#(keyEstablishRec >> 8) & 0xff
        ADDC    A,R3
        MOV     R3,A
        LCALL   ??osal_memset?relay
        MOV     ?V0 + 2,R2
        MOV     ?V0 + 3,R3
        MOV     R4,?V0 + 2
        MOV     R5,?V0 + 3
// 1968   keyEstablishRec[index].dstAddr.addrMode = afAddrNotPresent;
        MOV     A,?V0 + 0
        MOV     R0,?V0 + 0
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 8) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 8) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,#0x0
        MOVX    @DPTR,A
// 1969   keyEstablishRec[index].dstAddr.addr.shortAddr = INVALID_PARTNER_ADDR;
        MOV     A,?V0 + 0
        MOV     R0,?V0 + 0
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#keyEstablishRec & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#(keyEstablishRec >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,#-0x2
        MOVX    @DPTR,A
        INC     DPTR
        MOV     A,#-0x1
        MOVX    @DPTR,A
// 1970   keyEstablishRec[index].appTaskID = INVALID_TASK_ID;
        MOV     A,?V0 + 0
        MOV     R0,?V0 + 0
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 13) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 13) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,#-0x1
        MOVX    @DPTR,A
// 1971   keyEstablishRec[index].age = KEY_ESTABLISHMENT_REC_EXPIRY_TIME;
        MOV     A,?V0 + 0
        MOV     R0,?V0 + 0
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 23) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 23) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,#-0x1
        MOVX    @DPTR,A
// 1972   keyEstablishRec[index].state = KeyEstablishState_Idle;
        MOV     A,?V0 + 0
        MOV     R0,?V0 + 0
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 24) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 24) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,#0x0
        MOVX    @DPTR,A
// 1973   keyEstablishRec[index].remoteEphDataGenTime = KEY_ESTABLISHMENT_EPH_DATA_GEN_INVALID_TIME;
        MOV     A,?V0 + 0
        MOV     R0,?V0 + 0
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 37) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 37) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,#-0x1
        MOVX    @DPTR,A
// 1974   keyEstablishRec[index].remoteConfKeyGenTime = KEY_ESTABLISHMENT_CONF_KEY_GEN_INVALID_TIME;
        MOV     A,?V0 + 0
        MOV     R0,?V0 + 0
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 38) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 38) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOV     A,#-0x1
        MOVX    @DPTR,A
// 1975 }
        MOV     R7,#0x6
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock27
// 1976 
// 1977 /*********************************************************************
// 1978  * @fn      zclGeneral_KeyEstablishment_GetRandom
// 1979  *
// 1980  * @brief   Fill in a buffer with random numbers
// 1981  *
// 1982  * @param   buffer - output buffer
// 1983  *          len - length of the buffer
// 1984  *
// 1985  * @return  MCE_SUCCESS indicates success
// 1986  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
// 1987 static int zclGeneral_KeyEstablishment_GetRandom(unsigned char *buffer, unsigned long len)
zclGeneral_KeyEstablishment_GetRandom:
          CFI Block cfiBlock28 Using cfiCommon0
          CFI Function zclGeneral_KeyEstablishment_GetRandom
        CODE
// 1988 {
        FUNCALL zclGeneral_KeyEstablishment_GetRandom, SSP_GetTrueRandAES
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 16, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 16, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_GetRandom, SSP_GetTrueRandAES
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 16, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 16, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x10
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V7 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-16)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 16)
        ; Saved register size: 16
        ; Auto size: 0
        MOV     ?V0 + 0,R2
        MOV     ?V0 + 1,R3
        MOV     A,#0x10
        LCALL   ?XSTACK_DISP0_8
        MOV     R0,#?V0 + 4
        LCALL   ?L_MOV_X
// 1989   uint8 *pBuf;
// 1990 
// 1991   pBuf = buffer;
        MOV     R6,?V0 + 0
        MOV     R7,?V0 + 1
// 1992 
// 1993   // Input to SSP_GetTrueRandAES assumes len <= SEC_KEY_LEN
// 1994   // Therefore, call SSP_GetTrueRandAES multiple times to
// 1995   // fill out the buffer.
// 1996   while( len > SEC_KEY_LEN )
??zclGeneral_KeyEstablishment_GetRandom_0:
        MOV     DPTR,#__Constant_11
        MOV     R0,#?V0 + 4
        LCALL   ?UL_GE_X
        JNC     ??zclGeneral_KeyEstablishment_GetRandom_1
// 1997   {
// 1998     SSP_GetTrueRandAES( SEC_KEY_LEN, pBuf );
        ; Setup parameters for call to function SSP_GetTrueRandAES
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        MOV     R1,#0x10
        LCALL   ??SSP_GetTrueRandAES?relay
        MOV     A,R1
// 1999     len -= SEC_KEY_LEN;
        MOV     DPTR,#__Constant_fffffff0
        MOV     R0,#?V0 + 4
        LCALL   ?L_ADD_X
// 2000     pBuf += SEC_KEY_LEN;
        MOV     A,R6
        ADD     A,#0x10
        MOV     R6,A
        MOV     A,R7
        ADDC    A,#0x0
        MOV     R7,A
        SJMP    ??zclGeneral_KeyEstablishment_GetRandom_0
// 2001   }
// 2002   SSP_GetTrueRandAES( len, pBuf );
??zclGeneral_KeyEstablishment_GetRandom_1:
        ; Setup parameters for call to function SSP_GetTrueRandAES
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        MOV     R0,?V0 + 4
        MOV     R1,?V0 + 5
        MOV     A,?V0 + 4
        MOV     R1,?V0 + 4
        LCALL   ??SSP_GetTrueRandAES?relay
        MOV     A,R1
// 2003   return MCE_SUCCESS;
        MOV     R2,#0x0
        MOV     R3,#0x0
        MOV     R7,#0x8
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock28
// 2004 }
// 2005 
// 2006 /*********************************************************************
// 2007  * @fn      zclGeneral_KeyEstablishment_HashFunc
// 2008  *
// 2009  * @brief   Hash Function
// 2010  *
// 2011  * @param   digest - output buffer 16 bytes
// 2012  *          len - length of the input buffer
// 2013  *          data - input buffer
// 2014  *
// 2015  * @return  MCE_SUCCESS indicates success
// 2016  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
// 2017 static int zclGeneral_KeyEstablishment_HashFunc(unsigned char *digest, unsigned long len, unsigned char *data)
zclGeneral_KeyEstablishment_HashFunc:
          CFI Block cfiBlock29 Using cfiCommon0
          CFI Function zclGeneral_KeyEstablishment_HashFunc
        CODE
// 2018 {
        FUNCALL zclGeneral_KeyEstablishment_HashFunc, sspMMOHash
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 24, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x14
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V11 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V10 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V9 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V8 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V7 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-16)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-17)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-18)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-19)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-20)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 20)
        ; Saved register size: 20
        ; Auto size: 0
        MOV     ?V0 + 2,R2
        MOV     ?V0 + 3,R3
        MOV     A,R4
        MOV     R6,A
        MOV     A,R5
        MOV     R7,A
        MOV     A,#0x14
        LCALL   ?XSTACK_DISP0_8
        MOV     R0,#?V0 + 4
        LCALL   ?L_MOV_X
// 2019   len *= 8;  // Convert to bit length
        MOV     DPTR,#__Constant_8
        MOV     R0,#?V0 + 8
        LCALL   ?L_MOV_X
        MOV     R0,#?V0 + 4
        MOV     R1,#?V0 + 8
        LCALL   ?L_MUL
// 2020   sspMMOHash( NULL, 0, data, (uint16)len, digest );
        ; Setup parameters for call to function sspMMOHash
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 22)
        MOV     ?V0 + 0,?V0 + 4
        MOV     ?V0 + 1,?V0 + 5
        MOV     R0,#?V0 + 0
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 24)
        MOV     A,R6
        MOV     R4,A
        MOV     A,R7
        MOV     R5,A
        MOV     R1,#0x0
        MOV     R2,#0x0
        MOV     R3,#0x0
        LCALL   ??sspMMOHash?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 20)
// 2021   return MCE_SUCCESS;
        MOV     R2,#0x0
        MOV     R3,#0x0
        MOV     R7,#0xc
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock29
// 2022 }
// 2023 
// 2024 /*********************************************************************
// 2025  * @fn      zclGeneral_KeyEstablishment_KeyDeriveFunction
// 2026  *
// 2027  * @brief   Key Derive Function (ANSI X9.63).
// 2028  *          Note this is not a generalized KDF. It only applies to the KDF
// 2029  *          specified in ZigBee SE profile. Only the first two hashed keys
// 2030  *          are calculated and concatenated.
// 2031  *
// 2032  * @param   zData - input shared secret (length = KEY_ESTABLISH_SHARED_SECRET_LENGTH)
// 2033  *          keyBitLen - input key data length
// 2034  *          keyBit - output buffer ( 16*2 bytes)
// 2035  *
// 2036  * @return  none
// 2037  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
// 2038 static void zclGeneral_KeyEstablishment_KeyDeriveFunction( uint8 *zData,
zclGeneral_KeyEstablishment_KeyDeriveFunction:
          CFI Block cfiBlock30 Using cfiCommon0
          CFI Function zclGeneral_KeyEstablishment_KeyDeriveFunction
        CODE
// 2039                                                            uint8 keyBitLen,
// 2040                                                            uint8 *keyBit )
// 2041 {
        FUNCALL zclGeneral_KeyEstablishment_KeyDeriveFunction, osal_memcpy
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 47, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 47, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_KeyDeriveFunction, osal_memcpy
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 47, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 47, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_KeyDeriveFunction, sspMMOHash
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 48, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 48, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_KeyDeriveFunction, sspMMOHash
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 48, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 48, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0xf
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 15)
        ; Saved register size: 15
        ; Auto size: 29
        MOV     A,#-0x1d
        LCALL   ?ALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 44)
        MOV     ?V0 + 0,R2
        MOV     ?V0 + 1,R3
        MOV     A,R1
        MOV     R6,A
        MOV     ?V0 + 2,R4
        MOV     ?V0 + 3,R5
// 2042   uint8 hashCounter[4] = {0x00, 0x00, 0x00, 0x01};
        MOV     DPTR,#`?<Constant {0, 0, 0, 1}>`
        PUSH    DPL
          CFI CFA_SP SP+-1
        PUSH    DPH
          CFI CFA_SP SP+-2
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOV     R4,DPL
        MOV     R5,DPH
        POP     DPH
          CFI CFA_SP SP+-1
        POP     DPL
          CFI CFA_SP SP+0
        MOV     A,#0x4
        LCALL   ?MOVE_LONG8_XDATA_XDATA
// 2043   uint8 hashedData[KEY_ESTABLISH_SHARED_SECRET_LENGTH + 4];
// 2044   uint8 bitLen;
// 2045 
// 2046   bitLen = (keyBitLen + 4 ) * 8;
        MOV     B,#0x8
        MOV     A,#0x4
        ADD     A,R6
        MUL     AB
        MOV     R7,A
// 2047 
// 2048   // Calculate K1: Ki = Hash(Z || Counter1 )
// 2049   osal_memcpy( hashedData, zData, KEY_ESTABLISH_SHARED_SECRET_LENGTH );
        ; Setup parameters for call to function osal_memcpy
        MOV     ?V0 + 4,?V0 + 0
        MOV     ?V0 + 5,?V0 + 1
        MOV     ?V0 + 6,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 47)
        MOV     R4,#0x15
        MOV     R5,#0x0
        MOV     A,#0x7
        LCALL   ?XSTACK_DISP0_8
        MOV     R2,DPL
        MOV     R3,DPH
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 44)
// 2050   osal_memcpy( &(hashedData[KEY_ESTABLISH_SHARED_SECRET_LENGTH]), hashCounter, 4);
        ; Setup parameters for call to function osal_memcpy
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOV     R1,DPL
        MOV     R2,DPH
        MOV     R3,#0x0
        MOV     ?V0 + 4,R1
        MOV     ?V0 + 5,R2
        MOV     ?V0 + 6,R3
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 47)
        MOV     R4,#0x4
        MOV     R5,#0x0
        MOV     A,#0x1c
        LCALL   ?XSTACK_DISP0_8
        MOV     R2,DPL
        MOV     R3,DPH
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 44)
// 2051 
// 2052   sspMMOHash(NULL, 0, hashedData, bitLen, keyBit);
        ; Setup parameters for call to function sspMMOHash
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 46)
        MOV     ?V0 + 4,R7
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 48)
        MOV     A,#0x8
        LCALL   ?XSTACK_DISP0_8
        MOV     R4,DPL
        MOV     R5,DPH
        MOV     R1,#0x0
        MOV     R2,#0x0
        MOV     R3,#0x0
        LCALL   ??sspMMOHash?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 44)
// 2053 
// 2054   // Indrement the counter
// 2055   hashedData[KEY_ESTABLISH_SHARED_SECRET_LENGTH + 3] = 0x02;
        MOV     A,#0x1c
        LCALL   ?XSTACK_DISP0_8
        MOV     A,#0x2
        MOVX    @DPTR,A
// 2056 
// 2057   sspMMOHash(NULL, 0, hashedData, bitLen, &(keyBit[KEY_ESTABLISH_KEY_DATA_LENGTH]));
        ; Setup parameters for call to function sspMMOHash
        MOV     A,?V0 + 2
        ADD     A,#0x10
        MOV     ?V0 + 4,A
        MOV     A,?V0 + 3
        ADDC    A,#0x0
        MOV     ?V0 + 5,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 46)
        MOV     ?V0 + 4,R7
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 48)
        MOV     A,#0x8
        LCALL   ?XSTACK_DISP0_8
        MOV     R4,DPL
        MOV     R5,DPH
        MOV     R1,#0x0
        MOV     R2,#0x0
        MOV     R3,#0x0
        LCALL   ??sspMMOHash?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 44)
// 2058 }
        MOV     A,#0x1d
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 15)
        MOV     R7,#0x7
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock30
// 2059 
// 2060 /*********************************************************************
// 2061  * @fn      zclGeneral_KeyEstablishment_GenerateMAC
// 2062  *
// 2063  * @brief   Key Derive Function (ANSI X9.63).
// 2064  *          Note this is not a generalized KDF. It only applies to the KDF
// 2065  *          specified in ZigBee SE profile. Only the first two hashed keys
// 2066  *          are calculated and concatenated.
// 2067  *
// 2068  * @param   recIndex - input key establishment record index
// 2069  *          ifMACu - use M(U) if TRUE, otherwise M(V)
// 2070  *          MAC - output buffer ( 16 bytes )
// 2071  *
// 2072  * @return  ZStatus_t - success
// 2073  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
// 2074 static ZStatus_t zclGeneral_KeyEstablishment_GenerateMAC(uint8 recIndex,
zclGeneral_KeyEstablishment_GenerateMAC:
          CFI Block cfiBlock31 Using cfiCommon0
          CFI Function zclGeneral_KeyEstablishment_GenerateMAC
        CODE
// 2075                                                          uint8 ifMACu,
// 2076                                                          uint8 *MAC)
// 2077 {
        FUNCALL zclGeneral_KeyEstablishment_GenerateMAC, osal_mem_alloc
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_GenerateMAC, NLME_GetExtAddr
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 22, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 22, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_GenerateMAC, SSP_MemCpyReverse
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 22, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 22, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_GenerateMAC, SSP_MemCpyReverse
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 22, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 22, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_GenerateMAC, osal_memcpy
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 23, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 23, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_GenerateMAC, osal_memcpy
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 23, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 23, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_GenerateMAC, SSP_KeyedHash
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 24, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_GenerateMAC, SSP_MemCpyReverse
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 22, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 22, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_GenerateMAC, NLME_GetExtAddr
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 22, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 22, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_GenerateMAC, SSP_MemCpyReverse
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 22, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 22, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_GenerateMAC, osal_memcpy
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 23, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 23, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_GenerateMAC, osal_memcpy
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 23, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 23, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_GenerateMAC, SSP_KeyedHash
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 24, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_GenerateMAC, osal_mem_free
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 20, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 20, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x14
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V11 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V10 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V9 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V8 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V7 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-16)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-17)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-18)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-19)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-20)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 20)
        ; Saved register size: 20
        ; Auto size: 0
        MOV     ?V0 + 0,R1
        MOV     ?V0 + 8,R2
        MOV     ?V0 + 10,R4
        MOV     ?V0 + 11,R5
// 2078   uint8 i;
// 2079   uint8 M;
// 2080   uint8 *hashBuf;
// 2081   uint16 bufLen;
// 2082 
// 2083   // Assumption for M(U) and M(V) is: M(U) = 0x02, M(V) = 0x03
// 2084   if( ifMACu == TRUE )
        MOV     A,#0x1
        XRL     A,?V0 + 8
        JNZ     ??zclGeneral_KeyEstablishment_GenerateMAC_0
// 2085   {
// 2086     M = 0x02;  // Assumption
        MOV     ?V0 + 7,#0x2
        SJMP    ??zclGeneral_KeyEstablishment_GenerateMAC_1
// 2087   }
// 2088   else
// 2089   {
// 2090     M = 0x03;  // Assumption
??zclGeneral_KeyEstablishment_GenerateMAC_0:
        MOV     ?V0 + 7,#0x3
// 2091   }
// 2092 
// 2093   // At this point, it is assumed the device has already
// 2094   // obtained the IEEE address of the partner device.
// 2095   for ( i = 0; i < Z_EXTADDR_LEN; i++ )
??zclGeneral_KeyEstablishment_GenerateMAC_1:
        MOV     ?V0 + 1,#0x0
??zclGeneral_KeyEstablishment_GenerateMAC_2:
        MOV     A,?V0 + 1
        CLR     C
        SUBB    A,#0x8
        JNC     ??zclGeneral_KeyEstablishment_GenerateMAC_3
// 2096   {
// 2097     if ( keyEstablishRec[recIndex].partnerExtAddr[i] != 0 )
        MOV     A,?V0 + 0
        MOV     R0,?V0 + 0
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     ?V0 + 4,?V0 + 1
        MOV     ?V0 + 5,#0x0
        MOV     A,#(keyEstablishRec + 14) & 0xff
        ADD     A,?V0 + 4
        MOV     R2,A
        MOV     A,#((keyEstablishRec + 14) >> 8) & 0xff
        ADDC    A,?V0 + 5
        MOV     R3,A
        MOV     A,R2
        ADD     A,R0
        MOV     DPL,A
        MOV     A,R3
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        JNZ     ??zclGeneral_KeyEstablishment_GenerateMAC_3
// 2098     {
// 2099       break;
// 2100     }
// 2101   }
        INC     ?V0 + 1
        SJMP    ??zclGeneral_KeyEstablishment_GenerateMAC_2
// 2102   if ( i == Z_EXTADDR_LEN )
??zclGeneral_KeyEstablishment_GenerateMAC_3:
        MOV     A,#0x8
        XRL     A,?V0 + 1
        JNZ     ??zclGeneral_KeyEstablishment_GenerateMAC_4
// 2103   {
// 2104     return ZFailure;  // Partner IEEE address not available, return failure.
        MOV     R1,#0x1
        LJMP    ??zclGeneral_KeyEstablishment_GenerateMAC_5 & 0xFFFF
// 2105   }
// 2106 
// 2107   // MAC(U) = MAC(MacKey) { M(U) || ID(U) || ID(V) || E(U) || E(V) }
// 2108   bufLen = (1 + (Z_EXTADDR_LEN * 2) + (ZCL_KE_CA_PUBLIC_KEY_LEN * 2));
??zclGeneral_KeyEstablishment_GenerateMAC_4:
        MOV     R6,#0x3d
        MOV     R7,#0x0
// 2109   if( ( hashBuf = osal_mem_alloc( (bufLen) )) == NULL )
        ; Setup parameters for call to function osal_mem_alloc
        MOV     A,R6
        MOV     R2,A
        MOV     A,R7
        MOV     R3,A
        LCALL   ??osal_mem_alloc?relay
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     R0,?V0 + 4
        MOV     R1,?V0 + 5
        MOV     ?V0 + 2,R0
        MOV     ?V0 + 3,R1
        MOV     A,R0
        ORL     A,R1
        JNZ     ??zclGeneral_KeyEstablishment_GenerateMAC_6
// 2110   {
// 2111     return ZMemError;  // Memory allocation error
        MOV     R1,#0x10
        LJMP    ??zclGeneral_KeyEstablishment_GenerateMAC_5 & 0xFFFF
// 2112   }
// 2113 
// 2114   // Fill in the buffer
// 2115   hashBuf[0] = M;  // M(U)
??zclGeneral_KeyEstablishment_GenerateMAC_6:
        MOV     A,?V0 + 7
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        MOV     A,?V0 + 7
        MOVX    @DPTR,A
// 2116   bufLen = bufLen * 8;  // Convert to bitlength
        MOV     A,R6
        MOV     B,#0x8
        MUL     AB
        XCH     A,R6
        MOV     R0,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R0
        MOV     R0,A
        MOV     B,#0x8
        MOV     A,R7
        MUL     AB
        ADD     A,R0
        MOV     R7,A
// 2117 
// 2118   if ( (keyEstablishRec[recIndex].role == KEY_ESTABLISHMENT_INITIATOR && ifMACu == TRUE) ||
// 2119        (keyEstablishRec[recIndex].role == KEY_ESTABLISHMENT_RESPONDER && ifMACu == FALSE))
        MOV     A,?V0 + 0
        MOV     R0,?V0 + 0
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 22) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 22) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        JNZ     ??zclGeneral_KeyEstablishment_GenerateMAC_7
        MOV     A,#0x1
        XRL     A,?V0 + 8
        JZ      ??zclGeneral_KeyEstablishment_GenerateMAC_8
??zclGeneral_KeyEstablishment_GenerateMAC_7:
        MOV     A,?V0 + 0
        MOV     R0,?V0 + 0
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 22) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 22) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        XRL     A,#0x1
        JZ      $+5
        LJMP    ??zclGeneral_KeyEstablishment_GenerateMAC_9 & 0xFFFF
        MOV     A,?V0 + 8
        JZ      $+5
        LJMP    ??zclGeneral_KeyEstablishment_GenerateMAC_9 & 0xFFFF
// 2120   {
// 2121     // MAC = MAC(MacKey) { M() || ID(L) || ID(R) || E(L) || E(R) }
// 2122     // L - Local, R - Remote
// 2123     SSP_MemCpyReverse( &(hashBuf[1]), NLME_GetExtAddr(), Z_EXTADDR_LEN); // ID(U)
??zclGeneral_KeyEstablishment_GenerateMAC_8:
        ; Setup parameters for call to function SSP_MemCpyReverse
        MOV     ?V0 + 4,#0x8
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 22)
        ; Setup parameters for call to function NLME_GetExtAddr
        LCALL   ??NLME_GetExtAddr?relay
        MOV     A,R2
        MOV     R4,A
        MOV     A,R3
        MOV     R5,A
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        INC     DPTR
        MOV     R2,DPL
        MOV     R3,DPH
        LCALL   ??SSP_MemCpyReverse?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 20)
// 2124     SSP_MemCpyReverse( &(hashBuf[1+Z_EXTADDR_LEN]), keyEstablishRec[recIndex].partnerExtAddr,
// 2125                 Z_EXTADDR_LEN); // ID(V)
        ; Setup parameters for call to function SSP_MemCpyReverse
        MOV     ?V0 + 4,#0x8
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 22)
        MOV     A,?V0 + 0
        MOV     R0,?V0 + 0
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 14) & 0xff
        ADD     A,R0
        MOV     R4,A
        MOV     A,#((keyEstablishRec + 14) >> 8) & 0xff
        ADDC    A,R1
        MOV     R5,A
        MOV     A,?V0 + 2
        ADD     A,#0x9
        MOV     R2,A
        MOV     A,?V0 + 3
        ADDC    A,#0x0
        MOV     R3,A
        LCALL   ??SSP_MemCpyReverse?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 20)
// 2126     osal_memcpy( &(hashBuf[1 + (2 * Z_EXTADDR_LEN)]),                               // E(U)
// 2127                 keyEstablishRec[recIndex].pLocalEPublicKey,
// 2128                 ZCL_KE_CA_PUBLIC_KEY_LEN );
        ; Setup parameters for call to function osal_memcpy
        MOV     A,?V0 + 0
        MOV     R0,?V0 + 0
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 27) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 27) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 23)
        MOV     R4,#0x16
        MOV     R5,#0x0
        MOV     A,?V0 + 2
        ADD     A,#0x11
        MOV     R2,A
        MOV     A,?V0 + 3
        ADDC    A,#0x0
        MOV     R3,A
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 20)
// 2129     osal_memcpy( &(hashBuf[1 + (2 * Z_EXTADDR_LEN) + ZCL_KE_CA_PUBLIC_KEY_LEN]), // E(V)
// 2130                 keyEstablishRec[recIndex].pRemotePublicKey, ZCL_KE_CA_PUBLIC_KEY_LEN );
        ; Setup parameters for call to function osal_memcpy
        MOV     A,?V0 + 0
        MOV     R0,?V0 + 0
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 29) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 29) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 23)
        MOV     R4,#0x16
        MOV     R5,#0x0
        MOV     A,?V0 + 2
        ADD     A,#0x27
        MOV     R2,A
        MOV     A,?V0 + 3
        ADDC    A,#0x0
        MOV     R3,A
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 20)
// 2131 
// 2132     SSP_KeyedHash (hashBuf, bufLen, keyEstablishRec[recIndex].pMacKey, MAC);
        ; Setup parameters for call to function SSP_KeyedHash
        MOV     R0,#?V0 + 10
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 22)
        MOV     A,?V0 + 0
        MOV     R0,?V0 + 0
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 35) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 35) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        LCALL   ?PUSH_XSTACK8_X_TWO
          CFI CFA_XSP16 add(XSP16, 24)
        MOV     A,R6
        MOV     R4,A
        MOV     A,R7
        MOV     R5,A
        MOV     R2,?V0 + 2
        MOV     R3,?V0 + 3
        LCALL   ??SSP_KeyedHash?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 20)
        LJMP    ??zclGeneral_KeyEstablishment_GenerateMAC_10 & 0xFFFF
// 2133   }
// 2134   else
// 2135   {
// 2136     // MAC = MAC(MacKey) { M() || ID(R) || ID(L) || E(R) || E(L) }
// 2137     // L - Local, R - Remote
// 2138     SSP_MemCpyReverse( &(hashBuf[1]), keyEstablishRec[recIndex].partnerExtAddr,
// 2139                 Z_EXTADDR_LEN); // ID(R)
??zclGeneral_KeyEstablishment_GenerateMAC_9:
        ; Setup parameters for call to function SSP_MemCpyReverse
        MOV     ?V0 + 4,#0x8
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 22)
        MOV     A,?V0 + 0
        MOV     R0,?V0 + 0
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 14) & 0xff
        ADD     A,R0
        MOV     R4,A
        MOV     A,#((keyEstablishRec + 14) >> 8) & 0xff
        ADDC    A,R1
        MOV     R5,A
        MOV     DPL,?V0 + 2
        MOV     DPH,?V0 + 3
        INC     DPTR
        MOV     R2,DPL
        MOV     R3,DPH
        LCALL   ??SSP_MemCpyReverse?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 20)
// 2140     SSP_MemCpyReverse( &(hashBuf[1 + Z_EXTADDR_LEN]), NLME_GetExtAddr(), Z_EXTADDR_LEN); // ID(L)
        ; Setup parameters for call to function SSP_MemCpyReverse
        MOV     ?V0 + 4,#0x8
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 22)
        ; Setup parameters for call to function NLME_GetExtAddr
        LCALL   ??NLME_GetExtAddr?relay
        MOV     A,R2
        MOV     R4,A
        MOV     A,R3
        MOV     R5,A
        MOV     A,?V0 + 2
        ADD     A,#0x9
        MOV     R2,A
        MOV     A,?V0 + 3
        ADDC    A,#0x0
        MOV     R3,A
        LCALL   ??SSP_MemCpyReverse?relay
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 20)
// 2141     osal_memcpy( &(hashBuf[ 1 + (2 * Z_EXTADDR_LEN)]), // E(R)
// 2142                 keyEstablishRec[recIndex].pRemotePublicKey,
// 2143                 ZCL_KE_CA_PUBLIC_KEY_LEN );
        ; Setup parameters for call to function osal_memcpy
        MOV     A,?V0 + 0
        MOV     R0,?V0 + 0
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 29) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 29) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 23)
        MOV     R4,#0x16
        MOV     R5,#0x0
        MOV     A,?V0 + 2
        ADD     A,#0x11
        MOV     R2,A
        MOV     A,?V0 + 3
        ADDC    A,#0x0
        MOV     R3,A
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 20)
// 2144     osal_memcpy( &(hashBuf[1 + (2 * Z_EXTADDR_LEN) + ZCL_KE_CA_PUBLIC_KEY_LEN]),                               // E(U)
// 2145                 keyEstablishRec[recIndex].pLocalEPublicKey,
// 2146                 ZCL_KE_CA_PUBLIC_KEY_LEN );
        ; Setup parameters for call to function osal_memcpy
        MOV     A,?V0 + 0
        MOV     R0,?V0 + 0
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 27) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 27) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        INC     DPTR
        MOVX    A,@DPTR
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_THREE
          CFI CFA_XSP16 add(XSP16, 23)
        MOV     R4,#0x16
        MOV     R5,#0x0
        MOV     A,?V0 + 2
        ADD     A,#0x27
        MOV     R2,A
        MOV     A,?V0 + 3
        ADDC    A,#0x0
        MOV     R3,A
        LCALL   ??osal_memcpy?relay
        MOV     A,#0x3
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 20)
// 2147     SSP_KeyedHash (hashBuf, bufLen, keyEstablishRec[recIndex].pMacKey, MAC);
        ; Setup parameters for call to function SSP_KeyedHash
        MOV     R0,#?V0 + 10
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 22)
        MOV     A,?V0 + 0
        MOV     R0,?V0 + 0
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x27
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x27
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     A,#(keyEstablishRec + 35) & 0xff
        ADD     A,R0
        MOV     DPL,A
        MOV     A,#((keyEstablishRec + 35) >> 8) & 0xff
        ADDC    A,R1
        MOV     DPH,A
        LCALL   ?PUSH_XSTACK8_X_TWO
          CFI CFA_XSP16 add(XSP16, 24)
        MOV     A,R6
        MOV     R4,A
        MOV     A,R7
        MOV     R5,A
        MOV     R2,?V0 + 2
        MOV     R3,?V0 + 3
        LCALL   ??SSP_KeyedHash?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 20)
// 2148   }
// 2149 
// 2150   osal_mem_free(hashBuf);
??zclGeneral_KeyEstablishment_GenerateMAC_10:
        ; Setup parameters for call to function osal_mem_free
        MOV     R2,?V0 + 2
        MOV     R3,?V0 + 3
        LCALL   ??osal_mem_free?relay
// 2151   return ZSuccess;
        MOV     R1,#0x0
??zclGeneral_KeyEstablishment_GenerateMAC_5:
        MOV     R7,#0xc
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock31
// 2152 }
// 2153 
// 2154 /*********************************************************************
// 2155  * @fn      zclGeneral_KeyEstablishment_ECDSASign
// 2156  *
// 2157  * @brief    Creates an ECDSA signature of a message digest.
// 2158  *
// 2159  * @param   input - input data buffer
// 2160  *          inputLen - byte length of the input buffer
// 2161  *          output - output buffer ( 21x2 bytes )
// 2162  *
// 2163  * @return  ZStatus_t - success
// 2164  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
// 2165 ZStatus_t zclGeneral_KeyEstablishment_ECDSASign( uint8 *input,  uint8 inputLen,
zclGeneral_KeyEstablishment_ECDSASign:
          CFI Block cfiBlock32 Using cfiCommon0
          CFI Function zclGeneral_KeyEstablishment_ECDSASign
        CODE
// 2166                                              uint8 *output)
// 2167 {
        FUNCALL zclGeneral_KeyEstablishment_ECDSASign, osal_mem_alloc
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 36, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 36, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_ECDSASign, osal_nv_read
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 40, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 40, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_ECDSASign, sspMMOHash
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 40, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 40, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_ECDSASign, ZSE_ECDSASign
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 48, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 48, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_ECDSASign, osal_mem_free
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 36, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 36, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x14
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V11 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V10 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V9 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V8 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V7 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-16)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-17)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-18)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-19)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-20)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 20)
        ; Saved register size: 20
        ; Auto size: 16
        MOV     A,#-0x10
        LCALL   ?ALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 36)
        MOV     A,R2
        MOV     R6,A
        MOV     A,R3
        MOV     R7,A
        MOV     ?V0 + 0,R1
        MOV     ?V0 + 10,R4
        MOV     ?V0 + 11,R5
// 2168   uint8 msgDigest[KEY_ESTABLISH_AES_MMO_HASH_SIZE];
// 2169   uint16 bitLen = inputLen * 8;
        MOV     A,?V0 + 0
        MOV     ?V0 + 8,A
        MOV     ?V0 + 9,#0x0
        MOV     A,?V0 + 8
        MOV     B,#0x8
        MUL     AB
        XCH     A,?V0 + 8
        MOV     R0,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R0
        MOV     R0,A
        MOV     B,#0x8
        MOV     A,?V0 + 9
        MUL     AB
        ADD     A,R0
        MOV     ?V0 + 9,A
// 2170   uint8 status;
// 2171   uint8 *devicePrivateKey;
// 2172 
// 2173   if ((devicePrivateKey = osal_mem_alloc(ZCL_KE_DEVICE_PRIVATE_KEY_LEN)) == NULL)
        ; Setup parameters for call to function osal_mem_alloc
        MOV     R2,#0x15
        MOV     R3,#0x0
        LCALL   ??osal_mem_alloc?relay
        MOV     ?V0 + 4,R2
        MOV     ?V0 + 5,R3
        MOV     R0,?V0 + 4
        MOV     R1,?V0 + 5
        MOV     ?V0 + 2,R0
        MOV     ?V0 + 3,R1
        MOV     A,R0
        ORL     A,R1
        JNZ     ??zclGeneral_KeyEstablishment_ECDSASign_0
// 2174   {
// 2175     return ZCL_STATUS_SOFTWARE_FAILURE;  // Memory allocation failure.
        MOV     R1,#-0x3f
        LJMP    ??zclGeneral_KeyEstablishment_ECDSASign_1 & 0xFFFF
// 2176   }
// 2177   osal_nv_read(ZCD_NV_DEVICE_PRIVATE_KEY, 0, ZCL_KE_DEVICE_PRIVATE_KEY_LEN, devicePrivateKey);
??zclGeneral_KeyEstablishment_ECDSASign_0:
        ; Setup parameters for call to function osal_nv_read
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 38)
        MOV     ?V0 + 4,#0x15
        MOV     ?V0 + 5,#0x0
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 40)
        MOV     R4,#0x0
        MOV     R5,#0x0
        MOV     R2,#0x6a
        MOV     R3,#0x0
        LCALL   ??osal_nv_read?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 36)
        MOV     A,R1
// 2178 
// 2179   // First hash the input buffer
// 2180   sspMMOHash(NULL, 0, input, bitLen, msgDigest);
        ; Setup parameters for call to function sspMMOHash
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOV     ?V0 + 4,DPL
        MOV     ?V0 + 5,DPH
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 38)
        MOV     R0,#?V0 + 8
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 40)
        MOV     A,R6
        MOV     R4,A
        MOV     A,R7
        MOV     R5,A
        MOV     R1,#0x0
        MOV     R2,#0x0
        MOV     R3,#0x0
        LCALL   ??sspMMOHash?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 36)
// 2181 
// 2182   status = ZSE_ECDSASign( (unsigned char*)devicePrivateKey, (unsigned char*)msgDigest,
// 2183                 zclGeneral_KeyEstablishment_GetRandom,
// 2184                (unsigned char*)output, (unsigned char*)output + KEY_ESTABLISH_POINT_ORDER_SIZE,
// 2185                zclKeyEstablish_YieldFunc, zclKeyEstablish_YieldLevel );
        ; Setup parameters for call to function ZSE_ECDSASign
        MOV     DPTR,#zclKeyEstablish_YieldLevel
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        CLR     A
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,A
        MOV     ?V0 + 7,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_FOUR
          CFI CFA_XSP16 add(XSP16, 40)
        MOV     DPTR,#zclKeyEstablish_YieldFunc
        LCALL   ?PUSH_XSTACK8_X_TWO
          CFI CFA_XSP16 add(XSP16, 42)
        MOV     A,?V0 + 10
        ADD     A,#0x15
        MOV     ?V0 + 4,A
        MOV     A,?V0 + 11
        ADDC    A,#0x0
        MOV     ?V0 + 5,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 44)
        MOV     R0,#?V0 + 10
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 46)
        MOV     ?V0 + 4,#??zclGeneral_KeyEstablishment_GetRandom?relay & 0xff
        MOV     ?V0 + 5,#(??zclGeneral_KeyEstablishment_GetRandom?relay >> 8) & 0xff
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 48)
        MOV     A,#0xc
        LCALL   ?XSTACK_DISP0_8
        MOV     R4,DPL
        MOV     R5,DPH
        MOV     R2,?V0 + 2
        MOV     R3,?V0 + 3
        LCALL   ??ZSE_ECDSASign?relay
        MOV     A,#0xc
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 36)
        MOV     A,R2
        MOV     ?V0 + 1,A
// 2186 
// 2187   osal_mem_free(devicePrivateKey);
        ; Setup parameters for call to function osal_mem_free
        MOV     R2,?V0 + 2
        MOV     R3,?V0 + 3
        LCALL   ??osal_mem_free?relay
// 2188 
// 2189   if (status == MCE_SUCCESS )
        MOV     A,?V0 + 1
        JNZ     ??zclGeneral_KeyEstablishment_ECDSASign_2
// 2190   {
// 2191     return ZSuccess;
        MOV     R1,#0x0
        SJMP    ??zclGeneral_KeyEstablishment_ECDSASign_1
// 2192   }
// 2193 
// 2194   return ZFailure;
??zclGeneral_KeyEstablishment_ECDSASign_2:
        MOV     R1,#0x1
??zclGeneral_KeyEstablishment_ECDSASign_1:
        MOV     A,#0x10
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 20)
        MOV     R7,#0xc
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock32
// 2195 }
// 2196 
// 2197 /*********************************************************************
// 2198  * @fn      zclGeneral_KeyEstablishment_ECDSAVerify
// 2199  *
// 2200  * @brief    Verify an ECDSA signature of a message digest.
// 2201  *
// 2202  * @param   input - input data buffer
// 2203  *          inputLen - byte length of the input buffer
// 2204  *          signature - input signature ( 21x2 bytes )
// 2205  *
// 2206  * @return  ZSuccess - success verify
// 2207  *          ZFailure - fail to verify
// 2208  */

        RSEG BANKED_CODE:CODE:NOROOT(0)
// 2209 ZStatus_t zclGeneral_KeyEstablishment_ECDSAVerify( uint8 *input,  uint8 inputLen,
zclGeneral_KeyEstablishment_ECDSAVerify:
          CFI Block cfiBlock33 Using cfiCommon0
          CFI Function zclGeneral_KeyEstablishment_ECDSAVerify
        CODE
// 2210                                              uint8 *signature)
// 2211 {
        FUNCALL zclGeneral_KeyEstablishment_ECDSAVerify, sspMMOHash
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 38, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 38, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL zclGeneral_KeyEstablishment_ECDSAVerify, ZSE_ECDSAVerify
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 44, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 44, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        MOV     A,#-0x12
        LCALL   ?BANKED_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?BRET_EXT load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V9 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V8 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V7 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V6 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-14)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-15)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-16)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-17)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-18)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 18)
        ; Saved register size: 18
        ; Auto size: 16
        MOV     A,#-0x10
        LCALL   ?ALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 34)
        MOV     A,R2
        MOV     R6,A
        MOV     A,R3
        MOV     R7,A
        MOV     ?V0 + 0,R1
        MOV     ?V0 + 8,R4
        MOV     ?V0 + 9,R5
// 2212 
// 2213   uint8 msgDigest[KEY_ESTABLISH_AES_MMO_HASH_SIZE];
// 2214   uint16 bitLen;
// 2215   uint8 ret;
// 2216 
// 2217   bitLen = inputLen * 8;
        MOV     A,?V0 + 0
        MOV     R0,?V0 + 0
        MOV     R1,#0x0
        MOV     A,R0
        MOV     B,#0x8
        MUL     AB
        XCH     A,R0
        MOV     R2,B
        MOV     B,#0x0
        MUL     AB
        ADD     A,R2
        MOV     R2,A
        MOV     B,#0x8
        MOV     A,R1
        MUL     AB
        ADD     A,R2
        MOV     R1,A
        MOV     ?V0 + 2,R0
        MOV     ?V0 + 3,R1
// 2218 
// 2219   // First hash the input buffer
// 2220   sspMMOHash(NULL, 0, input, bitLen, msgDigest);
        ; Setup parameters for call to function sspMMOHash
        MOV     DPL,?XSP + 0
        MOV     DPH,?XSP + 1
        MOV     ?V0 + 4,DPL
        MOV     ?V0 + 5,DPH
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 36)
        MOV     R0,#?V0 + 2
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 38)
        MOV     A,R6
        MOV     R4,A
        MOV     A,R7
        MOV     R5,A
        MOV     R1,#0x0
        MOV     R2,#0x0
        MOV     R3,#0x0
        LCALL   ??sspMMOHash?relay
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 34)
// 2221 
// 2222   ret = ZSE_ECDSAVerify((unsigned char*)NULL, (unsigned char*)msgDigest,
// 2223              (unsigned char*)signature, (unsigned char*)signature + KEY_ESTABLISH_POINT_ORDER_SIZE,
// 2224              zclKeyEstablish_YieldFunc, zclKeyEstablish_YieldLevel );
        ; Setup parameters for call to function ZSE_ECDSAVerify
        MOV     DPTR,#zclKeyEstablish_YieldLevel
        MOVX    A,@DPTR
        MOV     ?V0 + 4,A
        CLR     A
        MOV     ?V0 + 5,A
        MOV     ?V0 + 6,A
        MOV     ?V0 + 7,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_FOUR
          CFI CFA_XSP16 add(XSP16, 38)
        MOV     DPTR,#zclKeyEstablish_YieldFunc
        LCALL   ?PUSH_XSTACK8_X_TWO
          CFI CFA_XSP16 add(XSP16, 40)
        MOV     A,?V0 + 8
        ADD     A,#0x15
        MOV     ?V0 + 4,A
        MOV     A,?V0 + 9
        ADDC    A,#0x0
        MOV     ?V0 + 5,A
        MOV     R0,#?V0 + 4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 42)
        MOV     R0,#?V0 + 8
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 44)
        MOV     A,#0xa
        LCALL   ?XSTACK_DISP0_8
        MOV     R4,DPL
        MOV     R5,DPH
        MOV     R2,#0x0
        MOV     R3,#0x0
        LCALL   ??ZSE_ECDSAVerify?relay
        MOV     A,#0xa
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 34)
        MOV     A,R2
        MOV     ?V0 + 1,A
// 2225 
// 2226   if ( ret == MCE_SUCCESS )
        MOV     A,?V0 + 1
        JNZ     ??zclGeneral_KeyEstablishment_ECDSAVerify_0
// 2227   {
// 2228     return ZSuccess;
        MOV     R1,#0x0
        SJMP    ??zclGeneral_KeyEstablishment_ECDSAVerify_1
// 2229   }
// 2230 
// 2231   return ZFailure;
??zclGeneral_KeyEstablishment_ECDSAVerify_0:
        MOV     R1,#0x1
??zclGeneral_KeyEstablishment_ECDSAVerify_1:
        MOV     A,#0x10
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 18)
        MOV     R7,#0xa
        LJMP    ?BANKED_LEAVE_XDATA
          CFI EndBlock cfiBlock33
// 2232 }

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for zclKeyEstablish_Options>`:
        DATA16
        DW 2048
        DATA8
        DB 16

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for zclSavedPollRate>`:
        DATA16
        DW 1000

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for zclKeyEstablish_SimpleDesc>`:
        DATA8
        DB 10
        DATA16
        DW 265
        DW 1287
        DATA8
        DB 0
        DB 1
        DATA16
        DW zclKeyEstablish_InClusterList
        DATA8
        DB 1
        DATA16
        DW zclKeyEstablish_OutClusterList

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for zclKeyEstablish_Ep>`:
        DATA8
        DB 10
        DATA16
        DW zcl_TaskID
        DW zclKeyEstablish_SimpleDesc
        DATA8
        DB 0

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_KeyEstablish_Init?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_KeyEstablish_Init

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclKeyEstablish_event_loop?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclKeyEstablish_event_loop

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_KeyEstablish_InitiateKeyEstablishm:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_KeyEstablish_InitiateKeyEstablishment

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_KeyEstablish_Send_InitiateKeyEstab:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_KeyEstablish_Send_InitiateKeyEstablishment

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_KeyEstablish_Send_EphemeralDataReq:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_KeyEstablish_Send_EphemeralDataReq

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_KeyEstablish_Send_ConfirmKey?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_KeyEstablish_Send_ConfirmKey

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_KeyEstablish_Send_TerminateKeyEsta:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_KeyEstablish_Send_TerminateKeyEstablishment

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_KeyEstablish_Send_InitiateKeyEstab_1:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_KeyEstablish_Send_InitiateKeyEstablishmentRsp

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_KeyEstablish_Send_EphemeralDataRsp:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_KeyEstablish_Send_EphemeralDataRsp

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_KeyEstablish_Send_ConfirmKeyRsp?re:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_KeyEstablish_Send_ConfirmKeyRsp

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_KeyEstablishment_RegYieldCB?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_KeyEstablishment_RegYieldCB

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_KeyEstablish_HdlIncoming?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_KeyEstablish_HdlIncoming

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_KeyEstablish_HdlInSpecificCommands:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_KeyEstablish_HdlInSpecificCommands

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_ProcessInCmd_InitiateKeyEstablish?:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_ProcessInCmd_InitiateKeyEstablish

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_ProcessInCmd_EphemeralDataReq?rela:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_ProcessInCmd_EphemeralDataReq

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_ProcessInCmd_InitiateKeyEstablishR:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_ProcessInCmd_InitiateKeyEstablishRsp

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_ProcessInCmd_EphemeralDataRsp?rela:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_ProcessInCmd_EphemeralDataRsp

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_ProcessInCmd_ConfirmKey?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_ProcessInCmd_ConfirmKey

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_ProcessInCmd_ConfirmKeyRsp?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_ProcessInCmd_ConfirmKeyRsp

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_ProcessInCmd_TerminateKeyEstablish:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_ProcessInCmd_TerminateKeyEstablish

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_InitiateKeyEstablish_Cmd_Calculate:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_InitiateKeyEstablish_Cmd_CalculateKey

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_InitiateKeyEstablish_Rsp_Calculate:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_InitiateKeyEstablish_Rsp_CalculateKey

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_InitKeyEstablishRecTable?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_InitKeyEstablishRecTable

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_GetKeyEstablishRecIndex?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_GetKeyEstablishRecIndex

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_GetKeyEstablishRecIndex_State?rela:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_GetKeyEstablishRecIndex_State

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_AddKeyEstablishRec?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_AddKeyEstablishRec

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_AgeKeyEstablishRec?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_AgeKeyEstablishRec

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_ResetKeyEstablishRec?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_ResetKeyEstablishRec

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_KeyEstablishment_GetRandom?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_KeyEstablishment_GetRandom

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_KeyEstablishment_HashFunc?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_KeyEstablishment_HashFunc

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_KeyEstablishment_KeyDeriveFunction:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_KeyEstablishment_KeyDeriveFunction

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_KeyEstablishment_GenerateMAC?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_KeyEstablishment_GenerateMAC

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_KeyEstablishment_ECDSASign?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_KeyEstablishment_ECDSASign

        RSEG BANK_RELAYS:CODE:REORDER:NOROOT(0)
??zclGeneral_KeyEstablishment_ECDSAVerify?relay:
        CODE
        LCALL   ?BDISPATCH
        DATA24
        DC24    zclGeneral_KeyEstablishment_ECDSAVerify

        RSEG XDATA_ROM_C:CONST:REORDER:NOROOT(0)
        DATA32
`?<Constant {0, 0, 0, 1}>`:
        DATA8
        DB 0
        DB 0
        DB 0
        DB 1

        RSEG XDATA_ROM_C:CONST:REORDER:NOROOT(0)
        DATA32
__Constant_11:
        DD 17

        RSEG XDATA_ROM_C:CONST:REORDER:NOROOT(0)
        DATA32
__Constant_fffffff0:
        DD 4294967280

        RSEG XDATA_ROM_C:CONST:REORDER:NOROOT(0)
        DATA32
__Constant_8:
        DD 8

        END
// 2233 #endif // ZCL_KEY_ESTABLISH
// 2234 
// 2235 /***************************************************************************
// 2236 ****************************************************************************/
// 
// 12 333 bytes in segment BANKED_CODE
//    204 bytes in segment BANK_RELAYS
//     23 bytes in segment XDATA_I
//     23 bytes in segment XDATA_ID
//     20 bytes in segment XDATA_ROM_C
//     83 bytes in segment XDATA_Z
// 
// 12 560 bytes of CODE  memory
//      8 bytes of CONST memory (+ 12 bytes shared)
//    106 bytes of XDATA memory
//
//Errors: none
//Warnings: none
