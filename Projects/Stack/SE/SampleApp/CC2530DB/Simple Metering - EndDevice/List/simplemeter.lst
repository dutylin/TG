###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.20.2.41139 for 8051             13/Jun/2013  14:53:46 #
# Copyright 2004-2013 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#                                                                             #
#    Source file        =  C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stack #
#                          \SE\SampleApp\Source\SimpleMeter\simplemeter.c     #
#    Command line       =  -f C:\Users\PedroZ\Documents\GitHub\TG\Projects\St #
#                          ack\SE\SampleApp\CC2530DB\..\..\..\Tools\CC2530DB\ #
#                          f8wEndev.cfg (-DCPU32MHZ -DROOT=__near_func        #
#                          -DMAC_CFG_TX_DATA_MAX=3 -DMAC_CFG_TX_MAX=6         #
#                          -DMAC_CFG_RX_MAX=3) -f C:\Users\PedroZ\Documents\G #
#                          itHub\TG\Projects\Stack\SE\SampleApp\CC2530DB\..\. #
#                          .\..\Tools\CC2530DB\f8wConfig.cfg (-DZIGBEEPRO     #
#                          -DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR       #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100    #
#                          -DREJOIN_POLL_RATE=440) -f                         #
#                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stack #
#                          \SE\SampleApp\CC2530DB\..\..\..\Tools\CC2530DB\f8w #
#                          ZCL.cfg (-DZCL_READ -DZCL_WRITE -DZCL_BASIC        #
#                          -DZCL_IDENTIFY -DZCL_ON_OFF -DZCL_KEY_ESTABLISH    #
#                          -DZCL_KEY_ESTABLISHMENT_KEY_GENERATE_TIMEOUT=4     #
#                          -DZCL_KEY_ESTABLISHMENT_MAC_GENERATE_TIMEOUT=10    #
#                          -DZCL_KEY_ESTABLISHMENT_EKEY_GENERATE_TIMEOUT=10   #
#                          -DZCL_LOAD_CONTROL -DZCL_SIMPLE_METERING           #
#                          -DZCL_PRICING -DZCL_MESSAGE -DZCL_TUNNELING        #
#                          -DZCL_TOU) -DZCL_DEVICE_MGMT                       #
#                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stack #
#                          \SE\SampleApp\Source\SimpleMeter\simplemeter.c -D  #
#                          TC_LINKKEY_JOIN -D ZTOOL_P1 -D MT_TASK -D          #
#                          MT_APP_FUNC -D MT_SYS_FUNC -D LCD_SUPPORTED -D     #
#                          NV_INIT -D xNV_RESTORE -D HOLD_AUTO_START -D       #
#                          NWK_AUTO_POLL -D ZCL_REPORT -D POWER_SAVING -D     #
#                          MAX_POLL_FAILURE_RETRIES=20 -D TEST_CERT_DATA -lC  #
#                          "C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stac #
#                          k\SE\SampleApp\CC2530DB\Simple Metering -          #
#                          EndDevice\List\" -lA "C:\Users\PedroZ\Documents\Gi #
#                          tHub\TG\Projects\Stack\SE\SampleApp\CC2530DB\Simpl #
#                          e Metering - EndDevice\List\" --diag_suppress      #
#                          Pe001,Pa010 -o "C:\Users\PedroZ\Documents\GitHub\T #
#                          G\Projects\Stack\SE\SampleApp\CC2530DB\Simple      #
#                          Metering - EndDevice\Obj\" -e --no_cse             #
#                          --no_unroll --no_inline --no_code_motion           #
#                          --no_tbaa --debug --core=plain --dptr=16,1         #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I C:\Users\PedroZ\Documents\GitHub\TG\Projects\St #
#                          ack\SE\SampleApp\CC2530DB\ -I                      #
#                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stack #
#                          \SE\SampleApp\CC2530DB\..\Source\ -I               #
#                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stack #
#                          \SE\SampleApp\CC2530DB\..\..\Source\ -I            #
#                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stack #
#                          \SE\SampleApp\CC2530DB\..\..\..\ZMain\TI2530DB\    #
#                          -I C:\Users\PedroZ\Documents\GitHub\TG\Projects\St #
#                          ack\SE\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\hal\include\ -I C:\Users\PedroZ\Documents\GitHub #
#                          \TG\Projects\Stack\SE\SampleApp\CC2530DB\..\..\..\ #
#                          ..\..\Components\hal\target\CC2530EB\ -I           #
#                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stack #
#                          \SE\SampleApp\CC2530DB\..\..\..\..\..\Components\m #
#                          ac\include\ -I C:\Users\PedroZ\Documents\GitHub\TG #
#                          \Projects\Stack\SE\SampleApp\CC2530DB\..\..\..\..\ #
#                          ..\Components\mac\high_level\ -I                   #
#                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stack #
#                          \SE\SampleApp\CC2530DB\..\..\..\..\..\Components\m #
#                          ac\low_level\srf04\ -I C:\Users\PedroZ\Documents\G #
#                          itHub\TG\Projects\Stack\SE\SampleApp\CC2530DB\..\. #
#                          .\..\..\..\Components\mac\low_level\srf04\single_c #
#                          hip\ -I C:\Users\PedroZ\Documents\GitHub\TG\Projec #
#                          ts\Stack\SE\SampleApp\CC2530DB\..\..\..\..\..\Comp #
#                          onents\mt\ -I C:\Users\PedroZ\Documents\GitHub\TG\ #
#                          Projects\Stack\SE\SampleApp\CC2530DB\..\..\..\..\. #
#                          .\Components\osal\include\ -I                      #
#                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stack #
#                          \SE\SampleApp\CC2530DB\..\..\..\..\..\Components\s #
#                          ervices\saddr\ -I C:\Users\PedroZ\Documents\GitHub #
#                          \TG\Projects\Stack\SE\SampleApp\CC2530DB\..\..\..\ #
#                          ..\..\Components\services\sdata\ -I                #
#                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stack #
#                          \SE\SampleApp\CC2530DB\..\..\..\..\..\Components\s #
#                          tack\af\ -I C:\Users\PedroZ\Documents\GitHub\TG\Pr #
#                          ojects\Stack\SE\SampleApp\CC2530DB\..\..\..\..\..\ #
#                          Components\stack\nwk\ -I                           #
#                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stack #
#                          \SE\SampleApp\CC2530DB\..\..\..\..\..\Components\s #
#                          tack\sapi\ -I C:\Users\PedroZ\Documents\GitHub\TG\ #
#                          Projects\Stack\SE\SampleApp\CC2530DB\..\..\..\..\. #
#                          .\Components\stack\sec\ -I                         #
#                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stack #
#                          \SE\SampleApp\CC2530DB\..\..\..\..\..\Components\s #
#                          tack\sys\ -I C:\Users\PedroZ\Documents\GitHub\TG\P #
#                          rojects\Stack\SE\SampleApp\CC2530DB\..\..\..\..\.. #
#                          \Components\stack\zcl\ -I                          #
#                          C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stack #
#                          \SE\SampleApp\CC2530DB\..\..\..\..\..\Components\s #
#                          tack\zdo\ -I C:\Users\PedroZ\Documents\GitHub\TG\P #
#                          rojects\Stack\SE\SampleApp\CC2530DB\..\..\..\..\.. #
#                          \Components\zmac\ -I C:\Users\PedroZ\Documents\Git #
#                          Hub\TG\Projects\Stack\SE\SampleApp\CC2530DB\..\..\ #
#                          ..\..\..\Components\zmac\f8w\ -On                  #
#                          --require_prototypes                               #
#    List file          =  C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stack #
#                          \SE\SampleApp\CC2530DB\Simple Metering -           #
#                          EndDevice\List\simplemeter.lst                     #
#    Object file        =  C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stack #
#                          \SE\SampleApp\CC2530DB\Simple Metering -           #
#                          EndDevice\Obj\simplemeter.r51                      #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\PedroZ\Documents\GitHub\TG\Projects\Stack\SE\SampleApp\Source\SimpleMeter\simplemeter.c
      1          /**************************************************************************************************
      2            Filename:       simplemeter.c
      3            Revised:        $Date: 2012-04-02 17:02:19 -0700 (Mon, 02 Apr 2012) $
      4            Revision:       $Revision: 29996 $
      5          
      6            Description:    This module implements the Simple Meter functionality and
      7                            contains the init and event loop functions
      8          
      9          
     10            Copyright 2009-2012 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com.
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42            This application is designed for the test purpose of the SE profile which
     43            exploits the following clusters for a Simple Metering configuration:
     44          
     45            General Basic
     46            General Alarms
     47            General Time
     48            General Key Establishment
     49            SE     Simple Metering
     50          
     51            Key control:
     52              SW1:  Join Network
     53              SW2:  N/A
     54              SW3:  N/A
     55              SW4:  N/A
     56          
     57          *********************************************************************/
     58          
     59          /*********************************************************************
     60           * INCLUDES
     61           */
     62          
     63          #include "OSAL.h"
     64          #include "OSAL_Clock.h"
     65          #include "OSAL_Nv.h"
     66          #include "ZDApp.h"
     67          #include "ZDObject.h"
     68          #include "AddrMgr.h"
     69          
     70          #include "se.h"
     71          #include "simplemeter.h"
     72          #include "zcl_general.h"
     73          #include "zcl_se.h"
     74          #include "zcl_key_establish.h"
     75          
     76          #include "onboard.h"
     77          
     78          /* HAL */
     79          #include "hal_lcd.h"
     80          #include "hal_led.h"
     81          #include "hal_key.h"
     82          
     83          
     84          /*********************************************************************
     85           * MACROS
     86           */
     87          
     88          // There is no attribute in the Mandatory Reportable Attribute list for now
     89          #define zcl_MandatoryReportableAttribute( a ) ( a == NULL )
     90          
     91          /*********************************************************************
     92           * CONSTANTS
     93           */
     94          
     95          #define SIMPLEMETER_MIN_REPORTING_INTERVAL       5
     96          
     97          /*********************************************************************
     98           * TYPEDEFS
     99           */
    100          
    101          /*********************************************************************
    102           * GLOBAL VARIABLES
    103           */
    104          
    105          /*********************************************************************
    106           * GLOBAL FUNCTIONS
    107           */
    108          
    109          /*********************************************************************
    110           * LOCAL VARIABLES
    111           */
    112          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    113          static uint8 simpleMeterTaskID;                                    // osal task id of simple meter
   \                     simpleMeterTaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    114          static uint8 simpleMeterTransID;                                   // transaction id
   \                     simpleMeterTransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    115          static afAddrType_t ESPAddr;                                       // esp destination address
   \                     ESPAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    116          static zclReportCmd_t *pSeReportCmd;                               // report command structure for SE Cluster
   \                     pSeReportCmd:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    117          static zclReportCmd_t *pBasicReportCmd;                            // report command structure for Basic Cluster
   \                     pBasicReportCmd:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_I, align 1, keep-with-next
    118          static uint8 numSeAttr = 5;                                        // number of SE Cluster attributes in report
   \                     numSeAttr:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for numSeAttr>`
   \   000001                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
    119          static uint8 numBasicAttr = 2;                                     // number of Basic Cluster attributes in report
   \                     numBasicAttr:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for numBasicAttr>`
   \   000001                REQUIRE __INIT_XDATA_I
    120          
    121          // Report attributes defined in simplemeter_data.c
    122          extern uint8 simpleMeterCurrentSummationDelivered[];
    123          extern const uint8 simpleMeterZCLVersion;
    124          extern const uint8 simpleMeterPowerSource;
    125          extern uint8 simpleMeterStatus;
    126          extern uint8 simpleMeterUnitOfMeasure;
    127          extern uint8 simpleMeterSummationFormating;
    128          extern uint8 simpleMeterDeviceType;
    129          
    130          #if SECURE
    131          static uint8 linkKeyStatus;                                        // status return from get link key routine
    132          #endif
    133          
    134          #if defined ( SE_UK_EXT ) && defined ( SE_MIRROR )
    135          static afAddrType_t mirrorAddr;
    136          #endif  // SE_UK_EXT && SE_MIRROR
    137          
    138          /*********************************************************************
    139           * LOCAL FUNCTIONS
    140           */
    141          static void simplemeter_HandleKeys( uint8 shift, uint8 keys );
    142          
    143          #if SECURE
    144          static uint8 simplemeter_KeyEstablish_ReturnLinkKey( uint16 shortAddr );
    145          #endif
    146          
    147          static void simplemeter_ProcessIdentifyTimeChange( void );
    148          
    149          /*************************************************************************/
    150          /*** Application Callback Functions                                    ***/
    151          /*************************************************************************/
    152          
    153          // Foundation Callback functions
    154          static uint8 simplemeter_ValidateAttrDataCB( zclAttrRec_t *pAttr, zclWriteRec_t *pAttrInfo );
    155          
    156          // General Cluster Callback functions
    157          static void simplemeter_BasicResetCB( void );
    158          static void simplemeter_IdentifyCB( zclIdentify_t *pCmd );
    159          static void simplemeter_IdentifyQueryRspCB( zclIdentifyQueryRsp_t *pRsp );
    160          static void simplemeter_AlarmCB( zclAlarm_t *pAlarm );
    161          #ifdef SE_UK_EXT
    162          static void simplemeter_GetEventLogCB( uint8 srcEP, afAddrType_t *srcAddr,
    163                                             zclGetEventLog_t *pEventLog, uint8 seqNum );
    164          static void simplemeter_PublishEventLogCB( afAddrType_t *srcAddr,
    165                                                       zclPublishEventLog_t *pEventLog );
    166          #endif // SE_UK_EXT
    167          
    168          // Function to process ZDO callback messages
    169          static void simplemeter_ProcessZDOMsgs( zdoIncomingMsg_t *pMsg );
    170          
    171          // SE Callback functions
    172          static void simplemeter_GetProfileCmdCB( zclCCGetProfileCmd_t *pCmd,
    173                                                   afAddrType_t *srcAddr, uint8 seqNum );
    174          static void simplemeter_GetProfileRspCB( zclCCGetProfileRsp_t *pCmd,
    175                                                   afAddrType_t *srcAddr, uint8 seqNum );
    176          static void simplemeter_ReqMirrorRspCB( zclCCReqMirrorRsp_t *pCmd,
    177                                                   afAddrType_t *srcAddr, uint8 seqNum );
    178          static void simplemeter_MirrorRemRspCB( zclCCMirrorRemRsp_t *pCmd,
    179                                                   afAddrType_t *srcAddr, uint8 seqNum );
    180          #if defined ( SE_UK_EXT )
    181          static void simplemeter_GetSnapshotCmdCB( zclCCReqGetSnapshotCmd_t *pCmd,
    182                                                   afAddrType_t *srcAddr, uint8 seqNum );
    183          static void simplemeter_TakeSnapshotCmdCB( afAddrType_t *srcAddr, uint8 seqNum );
    184          static void simplemeter_MirrorReportAttrRspCB( zclCCReqMirrorReportAttrRsp_t *pCmd,
    185                                                   afAddrType_t *srcAddr, uint8 seqNum );
    186          static void simplemeter_PublishTariffInformationCB( zclCCPublishTariffInformation_t *pCmd,
    187                                                   afAddrType_t *srcAddr, uint8 seqNum );
    188          static void simplemeter_PublishPriceMatrixCB( zclCCPublishPriceMatrix_t *pCmd,
    189                                                   afAddrType_t *srcAddr, uint8 seqNum );
    190          static void simplemeter_PublishBlockThresholdsCB( zclCCPublishBlockThresholds_t *pCmd,
    191                                                   afAddrType_t *srcAddr, uint8 seqNum );
    192          static void simplemeter_PublishConversionFactorCB( zclCCPublishConversionFactor_t *pCmd,
    193                                                   afAddrType_t *srcAddr, uint8 seqNum );
    194          static void simplemeter_PublishCalorificValueCB( zclCCPublishCalorificValue_t *pCmd,
    195                                                   afAddrType_t *srcAddr, uint8 seqNum );
    196          static void simplemeter_PublishCO2ValueCB( zclCCPublishCO2Value_t *pCmd,
    197                                                   afAddrType_t *srcAddr, uint8 seqNum );
    198          static void simplemeter_PublishCPPEventCB( zclCCPublishCPPEvent_t *pCmd,
    199                                                   afAddrType_t *srcAddr, uint8 seqNum );
    200          static void simplemeter_PublishBillingPeriodCB( zclCCPublishBillingPeriod_t *pCmd,
    201                                                   afAddrType_t *srcAddr, uint8 seqNum );
    202          static void simplemeter_PublishConsolidatedBillCB( zclCCPublishConsolidatedBill_t *pCmd,
    203                                                   afAddrType_t *srcAddr, uint8 seqNum );
    204          static void simplemeter_PublishCreditPaymentInfoCB( zclCCPublishCreditPaymentInfo_t *pCmd,
    205                                                   afAddrType_t *srcAddr, uint8 seqNum );
    206          static void simplemeter_ChangeDebtCB( zclCCChangeDebt_t *pCmd,
    207                                                   afAddrType_t *srcAddr, uint8 seqNum );
    208          static void simplemeter_EmergencyCreditSetupCB( zclCCEmergencyCreditSetup_t *pCmd,
    209                                                   afAddrType_t *srcAddr, uint8 seqNum );
    210          static void simplemeter_ConsumerTopupCB( zclCCConsumerTopup_t *pCmd,
    211                                                   afAddrType_t *srcAddr, uint8 seqNum );
    212          static void simplemeter_CreditAdjustmentCB( zclCCCreditAdjustment_t *pCmd,
    213                                                   afAddrType_t *srcAddr, uint8 seqNum );
    214          static void simplemeter_ChangePaymentModeCB( zclCCChangePaymentMode_t *pCmd,
    215                                                   afAddrType_t *srcAddr, uint8 seqNum );
    216          static void simplemeter_GetPrepaySnapshotCB( zclCCGetPrepaySnapshot_t *pCmd,
    217                                                   afAddrType_t *srcAddr, uint8 seqNum );
    218          static void simplemeter_GetTopupLogCB( uint8 numEvents,
    219                                                   afAddrType_t *srcAddr, uint8 seqNum );
    220          static void simplemeter_SetLowCreditWarningLevelCB( uint8 numEvents,
    221                                                   afAddrType_t *srcAddr, uint8 seqNum );
    222          static void simplemeter_GetDebtRepaymentLogCB( zclCCGetDebtRepaymentLog_t *pCmd,
    223                                                   afAddrType_t *srcAddr, uint8 seqNum );
    224          #endif  // SE_UK_EXT
    225          
    226          /************************************************************************/
    227          /***               Functions to process ZCL Foundation                ***/
    228          /***               incoming Command/Response messages                 ***/
    229          /************************************************************************/
    230          static void simplemeter_ProcessZCLMsg( zclIncomingMsg_t *msg );
    231          #if defined ( ZCL_READ )
    232          static uint8 simplemeter_ProcessInReadRspCmd( zclIncomingMsg_t *pInMsg );
    233          #endif // ZCL_READ
    234          #if defined ( ZCL_WRITE )
    235          static uint8 simplemeter_ProcessInWriteRspCmd( zclIncomingMsg_t *pInMsg );
    236          #endif // ZCL_WRITE
    237          #if defined ( ZCL_REPORT )
    238          static uint8 simplemeter_ProcessInConfigReportCmd( zclIncomingMsg_t *pInMsg );
    239          static uint8 simplemeter_ProcessInConfigReportRspCmd( zclIncomingMsg_t *pInMsg );
    240          static uint8 simplemeter_ProcessInReadReportCfgCmd( zclIncomingMsg_t *pInMsg );
    241          static uint8 simplemeter_ProcessInReadReportCfgRspCmd( zclIncomingMsg_t *pInMsg );
    242          static uint8 simplemeter_ProcessInReportCmd( zclIncomingMsg_t *pInMsg );
    243          #endif // ZCL_REPORT
    244          static uint8 simplemeter_ProcessInDefaultRspCmd( zclIncomingMsg_t *pInMsg );
    245          #if defined ( ZCL_DISCOVER )
    246          static uint8 simplemeter_ProcessInDiscRspCmd( zclIncomingMsg_t *pInMsg );
    247          #endif // ZCL_DISCOVER
    248          
    249          /*********************************************************************
    250           * ZCL General Clusters Callback table
    251           */

   \                                 In  segment XDATA_I, align 1, keep-with-next
    252          static zclGeneral_AppCallbacks_t simplemeter_GenCmdCallbacks =
   \                     simplemeter_GenCmdCallbacks:
   \   000000                DS 30
   \   00001E                REQUIRE `?<Initializer for simplemeter_GenCmdCallbacks>`
   \   00001E                REQUIRE __INIT_XDATA_I
    253          {
    254            simplemeter_BasicResetCB,              // Basic Cluster Reset command
    255            simplemeter_IdentifyCB,                // Identify command
    256            simplemeter_IdentifyQueryRspCB,        // Identify Query Response command
    257            NULL,                                  // On/Off cluster commands
    258            NULL,                                  // Level Control Move to Level command
    259            NULL,                                  // Level Control Move command
    260            NULL,                                  // Level Control Step command
    261            NULL,                                  // Level Control Stop command
    262            NULL,                                  // Group Response commands
    263            NULL,                                  // Scene Store Request command
    264            NULL,                                  // Scene Recall Request command
    265            NULL,                                  // Scene Response command
    266            simplemeter_AlarmCB,                   // Alarm (Response) command
    267          #ifdef SE_UK_EXT
    268            simplemeter_GetEventLogCB,             // Get Event Log command
    269            simplemeter_PublishEventLogCB,         // Publish Event Log command
    270          #endif
    271            NULL,                                  // RSSI Location command
    272            NULL                                   // RSSI Location Response command
    273          };
    274          
    275          /*********************************************************************
    276           * ZCL SE Clusters Callback table
    277           */

   \                                 In  segment XDATA_I, align 1, keep-with-next
    278          static zclSE_AppCallbacks_t simplemeter_SECmdCallbacks =
   \                     simplemeter_SECmdCallbacks:
   \   000000                DS 66
   \   000042                REQUIRE `?<Initializer for simplemeter_SECmdCallbacks>`
   \   000042                REQUIRE __INIT_XDATA_I
    279          {
    280            NULL,                                               // Publish Price
    281            NULL,                                               // Publish Block Period
    282          #if defined ( SE_UK_EXT )
    283            simplemeter_PublishTariffInformationCB,             // Publish Tariff Information
    284            simplemeter_PublishPriceMatrixCB,                   // Publish Price Matrix
    285            simplemeter_PublishBlockThresholdsCB,               // Publish Block Thresholds
    286            simplemeter_PublishConversionFactorCB,              // Publish Conversion Factor
    287            simplemeter_PublishCalorificValueCB,                // Publish Calorific Value
    288            simplemeter_PublishCO2ValueCB,                      // Publish CO2 Value
    289            simplemeter_PublishCPPEventCB,                      // Publish CPP Event
    290            simplemeter_PublishBillingPeriodCB,                 // Publish Billing Period
    291            simplemeter_PublishConsolidatedBillCB,              // Publish Consolidated Bill
    292            simplemeter_PublishCreditPaymentInfoCB,             // Publish Credit Payment Info
    293          #endif  // SE_UK_EXT
    294            NULL,                                               // Get Current Price
    295            NULL,                                               // Get Scheduled Price
    296            NULL,                                               // Price Acknowledgement
    297            NULL,                                               // Get Block Period
    298          #if defined ( SE_UK_EXT )
    299            NULL,                                               // Get Tariff Information
    300            NULL,                                               // Get Price Matrix
    301            NULL,                                               // Get Block Thresholds
    302            NULL,                                               // Get Conversion Factor
    303            NULL,                                               // Get Calorific Value
    304            NULL,                                               // Get CO2 Value
    305            NULL,                                               // Get Billing Period
    306            NULL,                                               // Get Consolidated Bill
    307            NULL,                                               // CPP Event Response
    308          #endif  // SE_UK_EXT
    309            NULL,                                               // Load Control Event
    310            NULL,                                               // Cancel Load Control Event
    311            NULL,                                               // Cancel All Load Control Events
    312            NULL,                                               // Report Event Status
    313            NULL,                                               // Get Scheduled Event
    314            simplemeter_GetProfileRspCB,                        // Get Profile Response
    315            NULL,                                               // Request Mirror Command
    316            NULL,                                               // Mirror Remove Command
    317            NULL,                                               // Request Fast Poll Mode Response
    318          #if defined ( SE_UK_EXT )
    319            NULL,                                               // Get Snapshot Response
    320          #endif  // SE_UK_EXT
    321            simplemeter_GetProfileCmdCB,                        // Get Profile Command
    322            simplemeter_ReqMirrorRspCB,                         // Request Mirror Response
    323            simplemeter_MirrorRemRspCB,                         // Mirror Remove Response
    324            NULL,                                               // Request Fast Poll Mode Command
    325          #if defined ( SE_UK_EXT )
    326            simplemeter_GetSnapshotCmdCB,                       // Get Snapshot Command
    327            simplemeter_TakeSnapshotCmdCB,                      // Take Snapshot Command
    328            simplemeter_MirrorReportAttrRspCB,                  // Mirror Report Attribute Response
    329          #endif  // SE_UK_EXT
    330            NULL,                                               // Display Message Command
    331            NULL,                                               // Cancel Message Command
    332            NULL,                                               // Get Last Message Command
    333            NULL,                                               // Message Confirmation
    334            NULL,                                               // Request Tunnel Response
    335            NULL,                                               // Transfer Data
    336            NULL,                                               // Transfer Data Error
    337            NULL,                                               // Ack Transfer Data
    338            NULL,                                               // Ready Data
    339          #if defined ( SE_UK_EXT )
    340            NULL,                                               // Supported Tunnel Protocols Response
    341            NULL,                                               // Tunnel Closure Notification
    342          #endif  // SE_UK_EXT
    343            NULL,                                               // Request Tunnel
    344            NULL,                                               // Close Tunnel
    345          #if defined ( SE_UK_EXT )
    346            NULL,                                               // Get Supported Tunnel Protocols
    347          #endif  // SE_UK_EXT
    348            NULL,                                               // Supply Status Response
    349          #if defined ( SE_UK_EXT )
    350            NULL,                                               // Get Prepay Snapshot Response
    351            NULL,                                               // Change Payment Mode Response
    352            NULL,                                               // Consumer Topup Response
    353            NULL,                                               // Get Commands
    354            NULL,                                               // Publish Topup Log
    355            NULL,                                               // Publish Debt Log
    356          #endif  // SE_UK_EXT
    357            NULL,                                               // Select Available Emergency Credit Command
    358            NULL,                                               // Change Supply Command
    359          #if defined ( SE_UK_EXT )
    360            simplemeter_ChangeDebtCB,                           // Change Debt
    361            simplemeter_EmergencyCreditSetupCB,                 // Emergency Credit Setup
    362            simplemeter_ConsumerTopupCB,                        // Consumer Topup
    363            simplemeter_CreditAdjustmentCB,                     // Credit Adjustment
    364            simplemeter_ChangePaymentModeCB,                    // Change PaymentMode
    365            simplemeter_GetPrepaySnapshotCB,                    // Get Prepay Snapshot
    366            simplemeter_GetTopupLogCB,                          // Get Topup Log
    367            simplemeter_SetLowCreditWarningLevelCB,             // Set Low Credit Warning Level
    368            simplemeter_GetDebtRepaymentLogCB,                  // Get Debt Repayment Log
    369            NULL,                                               // Publish Calendar
    370            NULL,                                               // Publish Day Profile
    371            NULL,                                               // Publish Week Profile
    372            NULL,                                               // Publish Seasons
    373            NULL,                                               // Publish Special Days
    374            NULL,                                               // Get Calendar
    375            NULL,                                               // Get Day Profiles
    376            NULL,                                               // Get Week Profiles
    377            NULL,                                               // Get Seasons
    378            NULL,                                               // Get Special Days
    379            NULL,                                               // Publish Change Tenancy
    380            NULL,                                               // Publish Change Supplier
    381            NULL,                                               // Change Supply
    382            NULL,                                               // Change Password
    383            NULL,                                               // Local Change Supply
    384            NULL,                                               // Get Change Tenancy
    385            NULL,                                               // Get Change Supplier
    386            NULL,                                               // Get Change Supply
    387            NULL,                                               // Supply Status Response
    388            NULL,                                               // Get Password
    389          #endif  // SE_UK_EXT
    390          };
    391          
    392          /*********************************************************************
    393           * @fn          simplemeter_Init
    394           *
    395           * @brief       Initialization function for the ZCL App Application.
    396           *
    397           * @param       uint8 task_id - simple meter task id
    398           *
    399           * @return      none
    400           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    401          void simplemeter_Init( uint8 task_id )
   \                     simplemeter_Init:
    402          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    403            simpleMeterTaskID = task_id;
   \   000007   EE           MOV     A,R6
   \   000008   90....       MOV     DPTR,#simpleMeterTaskID
   \   00000B   F0           MOVX    @DPTR,A
    404            simpleMeterTransID = 0;
   \   00000C   90....       MOV     DPTR,#simpleMeterTransID
   \   00000F   7400         MOV     A,#0x0
   \   000011   F0           MOVX    @DPTR,A
    405          
    406            // Device hardware initialization can be added here or in main() (Zmain.c).
    407            // If the hardware is application specific - add it here.
    408            // If the hardware is other parts of the device add it in main().
    409          
    410            // ESP destination address init
    411            ESPAddr.addrMode = (afAddrMode_t)Addr16Bit;
   \   000012   90....       MOV     DPTR,#ESPAddr + 8
   \   000015   7402         MOV     A,#0x2
   \   000017   F0           MOVX    @DPTR,A
    412            ESPAddr.endPoint = SIMPLEMETER_ENDPOINT;
   \   000018   90....       MOV     DPTR,#ESPAddr + 9
   \   00001B   7409         MOV     A,#0x9
   \   00001D   F0           MOVX    @DPTR,A
    413            ESPAddr.addr.shortAddr = 0;
   \   00001E   90....       MOV     DPTR,#ESPAddr
   \   000021   7400         MOV     A,#0x0
   \   000023   F0           MOVX    @DPTR,A
   \   000024   A3           INC     DPTR
   \   000025   7400         MOV     A,#0x0
   \   000027   F0           MOVX    @DPTR,A
    414          
    415            // register for SE endpoint
    416            zclSE_Init( &simpleMeterSimpleDesc );
   \   000028                ; Setup parameters for call to function zclSE_Init
   \   000028   7A..         MOV     R2,#simpleMeterSimpleDesc & 0xff
   \   00002A   7B..         MOV     R3,#(simpleMeterSimpleDesc >> 8) & 0xff
   \   00002C   12....       LCALL   ??zclSE_Init?relay
    417          
    418            // Register the ZCL General Cluster Library callback functions
    419            zclGeneral_RegisterCmdCallbacks( SIMPLEMETER_ENDPOINT, &simplemeter_GenCmdCallbacks );
   \   00002F                ; Setup parameters for call to function zclGeneral_RegisterCmdCallbacks
   \   00002F   7A..         MOV     R2,#simplemeter_GenCmdCallbacks & 0xff
   \   000031   7B..         MOV     R3,#(simplemeter_GenCmdCallbacks >> 8) & 0xff
   \   000033   7909         MOV     R1,#0x9
   \   000035   12....       LCALL   ??zclGeneral_RegisterCmdCallbacks?relay
   \   000038   E9           MOV     A,R1
    420          
    421            // Register the ZCL SE Cluster Library callback functions
    422            zclSE_RegisterCmdCallbacks( SIMPLEMETER_ENDPOINT, &simplemeter_SECmdCallbacks );
   \   000039                ; Setup parameters for call to function zclSE_RegisterCmdCallbacks
   \   000039   7A..         MOV     R2,#simplemeter_SECmdCallbacks & 0xff
   \   00003B   7B..         MOV     R3,#(simplemeter_SECmdCallbacks >> 8) & 0xff
   \   00003D   7909         MOV     R1,#0x9
   \   00003F   12....       LCALL   ??zclSE_RegisterCmdCallbacks?relay
   \   000042   E9           MOV     A,R1
    423          
    424            // Register the application's attribute list
    425            zcl_registerAttrList( SIMPLEMETER_ENDPOINT, SIMPLEMETER_MAX_ATTRIBUTES, simpleMeterAttrs );
   \   000043                ; Setup parameters for call to function zcl_registerAttrList
   \   000043   7C..         MOV     R4,#simpleMeterAttrs & 0xff
   \   000045   7D..         MOV     R5,#(simpleMeterAttrs >> 8) & 0xff
   \   000047   7A37         MOV     R2,#0x37
   \   000049   7909         MOV     R1,#0x9
   \   00004B   12....       LCALL   ??zcl_registerAttrList?relay
   \   00004E   E9           MOV     A,R1
    426          
    427            // Register the application's cluster option list
    428            zcl_registerClusterOptionList( SIMPLEMETER_ENDPOINT, SIMPLEMETER_MAX_OPTIONS, simpleMeterOptions );
   \   00004F                ; Setup parameters for call to function zcl_registerClusterOptionList
   \   00004F   7C..         MOV     R4,#simpleMeterOptions & 0xff
   \   000051   7D..         MOV     R5,#(simpleMeterOptions >> 8) & 0xff
   \   000053   7A02         MOV     R2,#0x2
   \   000055   7909         MOV     R1,#0x9
   \   000057   12....       LCALL   ??zcl_registerClusterOptionList?relay
   \   00005A   E9           MOV     A,R1
    429          
    430            // Register the application's attribute data validation callback function
    431            zcl_registerValidateAttrData( simplemeter_ValidateAttrDataCB );
   \   00005B                ; Setup parameters for call to function zcl_registerValidateAttrData
   \   00005B   7A..         MOV     R2,#??simplemeter_ValidateAttrDataCB?relay & 0xff
   \   00005D   7B..         MOV     R3,#(??simplemeter_ValidateAttrDataCB?relay >> 8) & 0xff
   \   00005F   12....       LCALL   ??zcl_registerValidateAttrData?relay
   \   000062   E9           MOV     A,R1
    432          
    433            // Register the Application to receive the unprocessed Foundation command/response messages
    434            zcl_registerForMsg( simpleMeterTaskID );
   \   000063                ; Setup parameters for call to function zcl_registerForMsg
   \   000063   90....       MOV     DPTR,#simpleMeterTaskID
   \   000066   E0           MOVX    A,@DPTR
   \   000067   F9           MOV     R1,A
   \   000068   12....       LCALL   ??zcl_registerForMsg?relay
   \   00006B   E9           MOV     A,R1
    435          
    436            // Register for all key events - This app will handle all key events
    437            RegisterForKeys( simpleMeterTaskID );
   \   00006C                ; Setup parameters for call to function RegisterForKeys
   \   00006C   90....       MOV     DPTR,#simpleMeterTaskID
   \   00006F   E0           MOVX    A,@DPTR
   \   000070   F9           MOV     R1,A
   \   000071   12....       LCALL   ??RegisterForKeys?relay
   \   000074   E9           MOV     A,R1
    438          
    439            // Register with the ZDO to receive Match Descriptor Responses
    440            ZDO_RegisterForZDOMsg(task_id, Match_Desc_rsp);
   \   000075                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000075   7A06         MOV     R2,#0x6
   \   000077   7B80         MOV     R3,#-0x80
   \   000079   EE           MOV     A,R6
   \   00007A   F9           MOV     R1,A
   \   00007B   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   00007E   E9           MOV     A,R1
    441          
    442            // Start the timer to sync SimpleMeter timer with the osal timer
    443            osal_start_timerEx( simpleMeterTaskID, SIMPLEMETER_UPDATE_TIME_EVT, SIMPLEMETER_UPDATE_TIME_PERIOD );
   \   00007F                ; Setup parameters for call to function osal_start_timerEx
   \   00007F   7CE8         MOV     R4,#-0x18
   \   000081   7D03         MOV     R5,#0x3
   \   000083   7A02         MOV     R2,#0x2
   \   000085   7B00         MOV     R3,#0x0
   \   000087   90....       MOV     DPTR,#simpleMeterTaskID
   \   00008A   E0           MOVX    A,@DPTR
   \   00008B   F9           MOV     R1,A
   \   00008C   12....       LCALL   ??osal_start_timerEx?relay
   \   00008F   E9           MOV     A,R1
    444          
    445            // setup attribute IDs of interest for Simple Meter
    446            pBasicReportCmd = (zclReportCmd_t *)osal_mem_alloc( sizeof( zclReportCmd_t ) + ( numBasicAttr * sizeof( zclReport_t ) ) );
   \   000090                ; Setup parameters for call to function osal_mem_alloc
   \   000090   90....       MOV     DPTR,#numBasicAttr
   \   000093   E0           MOVX    A,@DPTR
   \   000094   F8           MOV     R0,A
   \   000095   7900         MOV     R1,#0x0
   \   000097   E8           MOV     A,R0
   \   000098   75F005       MOV     B,#0x5
   \   00009B   A4           MUL     AB
   \   00009C   C8           XCH     A,R0
   \   00009D   AAF0         MOV     R2,B
   \   00009F   75F000       MOV     B,#0x0
   \   0000A2   A4           MUL     AB
   \   0000A3   2A           ADD     A,R2
   \   0000A4   FA           MOV     R2,A
   \   0000A5   75F005       MOV     B,#0x5
   \   0000A8   E9           MOV     A,R1
   \   0000A9   A4           MUL     AB
   \   0000AA   2A           ADD     A,R2
   \   0000AB   F9           MOV     R1,A
   \   0000AC   E8           MOV     A,R0
   \   0000AD   2401         ADD     A,#0x1
   \   0000AF   FA           MOV     R2,A
   \   0000B0   E9           MOV     A,R1
   \   0000B1   3400         ADDC    A,#0x0
   \   0000B3   FB           MOV     R3,A
   \   0000B4   12....       LCALL   ??osal_mem_alloc?relay
   \   0000B7   90....       MOV     DPTR,#pBasicReportCmd
   \   0000BA   EA           MOV     A,R2
   \   0000BB   F0           MOVX    @DPTR,A
   \   0000BC   A3           INC     DPTR
   \   0000BD   EB           MOV     A,R3
   \   0000BE   F0           MOVX    @DPTR,A
    447            if ( pBasicReportCmd != NULL )
   \   0000BF   90....       MOV     DPTR,#pBasicReportCmd
   \   0000C2   E0           MOVX    A,@DPTR
   \   0000C3   F8           MOV     R0,A
   \   0000C4   A3           INC     DPTR
   \   0000C5   E0           MOVX    A,@DPTR
   \   0000C6   F9           MOV     R1,A
   \   0000C7   E8           MOV     A,R0
   \   0000C8   49           ORL     A,R1
   \   0000C9   7003         JNZ     $+5
   \   0000CB   02....       LJMP    ??simplemeter_Init_0 & 0xFFFF
    448            {
    449              pBasicReportCmd->numAttr = numBasicAttr;
   \   0000CE   90....       MOV     DPTR,#numBasicAttr
   \   0000D1   E0           MOVX    A,@DPTR
   \   0000D2   C0E0         PUSH    A
   \   0000D4   90....       MOV     DPTR,#pBasicReportCmd
   \   0000D7   E0           MOVX    A,@DPTR
   \   0000D8   F8           MOV     R0,A
   \   0000D9   A3           INC     DPTR
   \   0000DA   E0           MOVX    A,@DPTR
   \   0000DB   F583         MOV     DPH,A
   \   0000DD   8882         MOV     DPL,R0
   \   0000DF   D0E0         POP     A
   \   0000E1   F0           MOVX    @DPTR,A
    450          
    451              pBasicReportCmd->attrList[0].attrID = ATTRID_BASIC_ZCL_VERSION;
   \   0000E2   90....       MOV     DPTR,#pBasicReportCmd
   \   0000E5   E0           MOVX    A,@DPTR
   \   0000E6   F8           MOV     R0,A
   \   0000E7   A3           INC     DPTR
   \   0000E8   E0           MOVX    A,@DPTR
   \   0000E9   F583         MOV     DPH,A
   \   0000EB   8882         MOV     DPL,R0
   \   0000ED   A3           INC     DPTR
   \   0000EE   7400         MOV     A,#0x0
   \   0000F0   F0           MOVX    @DPTR,A
   \   0000F1   A3           INC     DPTR
   \   0000F2   7400         MOV     A,#0x0
   \   0000F4   F0           MOVX    @DPTR,A
    452              pBasicReportCmd->attrList[0].dataType = ZCL_DATATYPE_UINT8;
   \   0000F5   90....       MOV     DPTR,#pBasicReportCmd
   \   0000F8   E0           MOVX    A,@DPTR
   \   0000F9   F8           MOV     R0,A
   \   0000FA   A3           INC     DPTR
   \   0000FB   E0           MOVX    A,@DPTR
   \   0000FC   F583         MOV     DPH,A
   \   0000FE   8882         MOV     DPL,R0
   \   000100   A3           INC     DPTR
   \   000101   A3           INC     DPTR
   \   000102   A3           INC     DPTR
   \   000103   7420         MOV     A,#0x20
   \   000105   F0           MOVX    @DPTR,A
    453              pBasicReportCmd->attrList[0].attrData = (uint8*) &simpleMeterZCLVersion;
   \   000106   90....       MOV     DPTR,#pBasicReportCmd
   \   000109   E0           MOVX    A,@DPTR
   \   00010A   F8           MOV     R0,A
   \   00010B   A3           INC     DPTR
   \   00010C   E0           MOVX    A,@DPTR
   \   00010D   F583         MOV     DPH,A
   \   00010F   8882         MOV     DPL,R0
   \   000111   A3           INC     DPTR
   \   000112   A3           INC     DPTR
   \   000113   A3           INC     DPTR
   \   000114   A3           INC     DPTR
   \   000115   74..         MOV     A,#simpleMeterZCLVersion & 0xff
   \   000117   F0           MOVX    @DPTR,A
   \   000118   A3           INC     DPTR
   \   000119   74..         MOV     A,#(simpleMeterZCLVersion >> 8) & 0xff
   \   00011B   F0           MOVX    @DPTR,A
    454          
    455              pBasicReportCmd->attrList[1].attrID = ATTRID_BASIC_POWER_SOURCE;
   \   00011C   90....       MOV     DPTR,#pBasicReportCmd
   \   00011F   E0           MOVX    A,@DPTR
   \   000120   F8           MOV     R0,A
   \   000121   A3           INC     DPTR
   \   000122   E0           MOVX    A,@DPTR
   \   000123   C8           XCH     A,R0
   \   000124   2406         ADD     A,#0x6
   \   000126   F582         MOV     DPL,A
   \   000128   E8           MOV     A,R0
   \   000129   3400         ADDC    A,#0x0
   \   00012B   F583         MOV     DPH,A
   \   00012D   7407         MOV     A,#0x7
   \   00012F   F0           MOVX    @DPTR,A
   \   000130   A3           INC     DPTR
   \   000131   7400         MOV     A,#0x0
   \   000133   F0           MOVX    @DPTR,A
    456              pBasicReportCmd->attrList[1].dataType = ZCL_DATATYPE_ENUM8;
   \   000134   90....       MOV     DPTR,#pBasicReportCmd
   \   000137   E0           MOVX    A,@DPTR
   \   000138   F8           MOV     R0,A
   \   000139   A3           INC     DPTR
   \   00013A   E0           MOVX    A,@DPTR
   \   00013B   C8           XCH     A,R0
   \   00013C   2408         ADD     A,#0x8
   \   00013E   F582         MOV     DPL,A
   \   000140   E8           MOV     A,R0
   \   000141   3400         ADDC    A,#0x0
   \   000143   F583         MOV     DPH,A
   \   000145   7430         MOV     A,#0x30
   \   000147   F0           MOVX    @DPTR,A
    457              pBasicReportCmd->attrList[1].attrData = (uint8*) &simpleMeterPowerSource;
   \   000148   90....       MOV     DPTR,#pBasicReportCmd
   \   00014B   E0           MOVX    A,@DPTR
   \   00014C   F8           MOV     R0,A
   \   00014D   A3           INC     DPTR
   \   00014E   E0           MOVX    A,@DPTR
   \   00014F   C8           XCH     A,R0
   \   000150   2409         ADD     A,#0x9
   \   000152   F582         MOV     DPL,A
   \   000154   E8           MOV     A,R0
   \   000155   3400         ADDC    A,#0x0
   \   000157   F583         MOV     DPH,A
   \   000159   74..         MOV     A,#simpleMeterPowerSource & 0xff
   \   00015B   F0           MOVX    @DPTR,A
   \   00015C   A3           INC     DPTR
   \   00015D   74..         MOV     A,#(simpleMeterPowerSource >> 8) & 0xff
   \   00015F   F0           MOVX    @DPTR,A
    458            }
    459          
    460            pSeReportCmd = (zclReportCmd_t *)osal_mem_alloc( sizeof( zclReportCmd_t ) + ( numSeAttr * sizeof( zclReport_t ) ) );
   \                     ??simplemeter_Init_0:
   \   000160                ; Setup parameters for call to function osal_mem_alloc
   \   000160   90....       MOV     DPTR,#numSeAttr
   \   000163   E0           MOVX    A,@DPTR
   \   000164   F8           MOV     R0,A
   \   000165   7900         MOV     R1,#0x0
   \   000167   E8           MOV     A,R0
   \   000168   75F005       MOV     B,#0x5
   \   00016B   A4           MUL     AB
   \   00016C   C8           XCH     A,R0
   \   00016D   AAF0         MOV     R2,B
   \   00016F   75F000       MOV     B,#0x0
   \   000172   A4           MUL     AB
   \   000173   2A           ADD     A,R2
   \   000174   FA           MOV     R2,A
   \   000175   75F005       MOV     B,#0x5
   \   000178   E9           MOV     A,R1
   \   000179   A4           MUL     AB
   \   00017A   2A           ADD     A,R2
   \   00017B   F9           MOV     R1,A
   \   00017C   E8           MOV     A,R0
   \   00017D   2401         ADD     A,#0x1
   \   00017F   FA           MOV     R2,A
   \   000180   E9           MOV     A,R1
   \   000181   3400         ADDC    A,#0x0
   \   000183   FB           MOV     R3,A
   \   000184   12....       LCALL   ??osal_mem_alloc?relay
   \   000187   90....       MOV     DPTR,#pSeReportCmd
   \   00018A   EA           MOV     A,R2
   \   00018B   F0           MOVX    @DPTR,A
   \   00018C   A3           INC     DPTR
   \   00018D   EB           MOV     A,R3
   \   00018E   F0           MOVX    @DPTR,A
    461            if ( pSeReportCmd != NULL )
   \   00018F   90....       MOV     DPTR,#pSeReportCmd
   \   000192   E0           MOVX    A,@DPTR
   \   000193   F8           MOV     R0,A
   \   000194   A3           INC     DPTR
   \   000195   E0           MOVX    A,@DPTR
   \   000196   F9           MOV     R1,A
   \   000197   E8           MOV     A,R0
   \   000198   49           ORL     A,R1
   \   000199   7003         JNZ     $+5
   \   00019B   02....       LJMP    ??simplemeter_Init_1 & 0xFFFF
    462            {
    463              pSeReportCmd->numAttr = numSeAttr;
   \   00019E   90....       MOV     DPTR,#numSeAttr
   \   0001A1   E0           MOVX    A,@DPTR
   \   0001A2   C0E0         PUSH    A
   \   0001A4   90....       MOV     DPTR,#pSeReportCmd
   \   0001A7   E0           MOVX    A,@DPTR
   \   0001A8   F8           MOV     R0,A
   \   0001A9   A3           INC     DPTR
   \   0001AA   E0           MOVX    A,@DPTR
   \   0001AB   F583         MOV     DPH,A
   \   0001AD   8882         MOV     DPL,R0
   \   0001AF   D0E0         POP     A
   \   0001B1   F0           MOVX    @DPTR,A
    464          
    465              // Set up the first attribute
    466              pSeReportCmd->attrList[0].attrID = ATTRID_SE_CURRENT_SUMMATION_DELIVERED;
   \   0001B2   90....       MOV     DPTR,#pSeReportCmd
   \   0001B5   E0           MOVX    A,@DPTR
   \   0001B6   F8           MOV     R0,A
   \   0001B7   A3           INC     DPTR
   \   0001B8   E0           MOVX    A,@DPTR
   \   0001B9   F583         MOV     DPH,A
   \   0001BB   8882         MOV     DPL,R0
   \   0001BD   A3           INC     DPTR
   \   0001BE   7400         MOV     A,#0x0
   \   0001C0   F0           MOVX    @DPTR,A
   \   0001C1   A3           INC     DPTR
   \   0001C2   7400         MOV     A,#0x0
   \   0001C4   F0           MOVX    @DPTR,A
    467              pSeReportCmd->attrList[0].dataType = ZCL_DATATYPE_UINT48;
   \   0001C5   90....       MOV     DPTR,#pSeReportCmd
   \   0001C8   E0           MOVX    A,@DPTR
   \   0001C9   F8           MOV     R0,A
   \   0001CA   A3           INC     DPTR
   \   0001CB   E0           MOVX    A,@DPTR
   \   0001CC   F583         MOV     DPH,A
   \   0001CE   8882         MOV     DPL,R0
   \   0001D0   A3           INC     DPTR
   \   0001D1   A3           INC     DPTR
   \   0001D2   A3           INC     DPTR
   \   0001D3   7425         MOV     A,#0x25
   \   0001D5   F0           MOVX    @DPTR,A
    468              pSeReportCmd->attrList[0].attrData = simpleMeterCurrentSummationDelivered;
   \   0001D6   90....       MOV     DPTR,#pSeReportCmd
   \   0001D9   E0           MOVX    A,@DPTR
   \   0001DA   F8           MOV     R0,A
   \   0001DB   A3           INC     DPTR
   \   0001DC   E0           MOVX    A,@DPTR
   \   0001DD   F583         MOV     DPH,A
   \   0001DF   8882         MOV     DPL,R0
   \   0001E1   A3           INC     DPTR
   \   0001E2   A3           INC     DPTR
   \   0001E3   A3           INC     DPTR
   \   0001E4   A3           INC     DPTR
   \   0001E5   74..         MOV     A,#simpleMeterCurrentSummationDelivered & 0xff
   \   0001E7   F0           MOVX    @DPTR,A
   \   0001E8   A3           INC     DPTR
   \   0001E9   74..         MOV     A,#(simpleMeterCurrentSummationDelivered >> 8) & 0xff
   \   0001EB   F0           MOVX    @DPTR,A
    469          
    470              pSeReportCmd->attrList[1].attrID = ATTRID_SE_STATUS;
   \   0001EC   90....       MOV     DPTR,#pSeReportCmd
   \   0001EF   E0           MOVX    A,@DPTR
   \   0001F0   F8           MOV     R0,A
   \   0001F1   A3           INC     DPTR
   \   0001F2   E0           MOVX    A,@DPTR
   \   0001F3   C8           XCH     A,R0
   \   0001F4   2406         ADD     A,#0x6
   \   0001F6   F582         MOV     DPL,A
   \   0001F8   E8           MOV     A,R0
   \   0001F9   3400         ADDC    A,#0x0
   \   0001FB   F583         MOV     DPH,A
   \   0001FD   7400         MOV     A,#0x0
   \   0001FF   F0           MOVX    @DPTR,A
   \   000200   A3           INC     DPTR
   \   000201   7402         MOV     A,#0x2
   \   000203   F0           MOVX    @DPTR,A
    471              pSeReportCmd->attrList[1].dataType = ZCL_DATATYPE_BITMAP8;
   \   000204   90....       MOV     DPTR,#pSeReportCmd
   \   000207   E0           MOVX    A,@DPTR
   \   000208   F8           MOV     R0,A
   \   000209   A3           INC     DPTR
   \   00020A   E0           MOVX    A,@DPTR
   \   00020B   C8           XCH     A,R0
   \   00020C   2408         ADD     A,#0x8
   \   00020E   F582         MOV     DPL,A
   \   000210   E8           MOV     A,R0
   \   000211   3400         ADDC    A,#0x0
   \   000213   F583         MOV     DPH,A
   \   000215   7418         MOV     A,#0x18
   \   000217   F0           MOVX    @DPTR,A
    472              pSeReportCmd->attrList[1].attrData = &simpleMeterStatus;
   \   000218   90....       MOV     DPTR,#pSeReportCmd
   \   00021B   E0           MOVX    A,@DPTR
   \   00021C   F8           MOV     R0,A
   \   00021D   A3           INC     DPTR
   \   00021E   E0           MOVX    A,@DPTR
   \   00021F   C8           XCH     A,R0
   \   000220   2409         ADD     A,#0x9
   \   000222   F582         MOV     DPL,A
   \   000224   E8           MOV     A,R0
   \   000225   3400         ADDC    A,#0x0
   \   000227   F583         MOV     DPH,A
   \   000229   74..         MOV     A,#simpleMeterStatus & 0xff
   \   00022B   F0           MOVX    @DPTR,A
   \   00022C   A3           INC     DPTR
   \   00022D   74..         MOV     A,#(simpleMeterStatus >> 8) & 0xff
   \   00022F   F0           MOVX    @DPTR,A
    473          
    474              pSeReportCmd->attrList[2].attrID = ATTRID_SE_UNIT_OF_MEASURE;
   \   000230   90....       MOV     DPTR,#pSeReportCmd
   \   000233   E0           MOVX    A,@DPTR
   \   000234   F8           MOV     R0,A
   \   000235   A3           INC     DPTR
   \   000236   E0           MOVX    A,@DPTR
   \   000237   C8           XCH     A,R0
   \   000238   240B         ADD     A,#0xb
   \   00023A   F582         MOV     DPL,A
   \   00023C   E8           MOV     A,R0
   \   00023D   3400         ADDC    A,#0x0
   \   00023F   F583         MOV     DPH,A
   \   000241   7400         MOV     A,#0x0
   \   000243   F0           MOVX    @DPTR,A
   \   000244   A3           INC     DPTR
   \   000245   7403         MOV     A,#0x3
   \   000247   F0           MOVX    @DPTR,A
    475              pSeReportCmd->attrList[2].dataType = ZCL_DATATYPE_ENUM8;
   \   000248   90....       MOV     DPTR,#pSeReportCmd
   \   00024B   E0           MOVX    A,@DPTR
   \   00024C   F8           MOV     R0,A
   \   00024D   A3           INC     DPTR
   \   00024E   E0           MOVX    A,@DPTR
   \   00024F   C8           XCH     A,R0
   \   000250   240D         ADD     A,#0xd
   \   000252   F582         MOV     DPL,A
   \   000254   E8           MOV     A,R0
   \   000255   3400         ADDC    A,#0x0
   \   000257   F583         MOV     DPH,A
   \   000259   7430         MOV     A,#0x30
   \   00025B   F0           MOVX    @DPTR,A
    476              pSeReportCmd->attrList[2].attrData = &simpleMeterUnitOfMeasure;
   \   00025C   90....       MOV     DPTR,#pSeReportCmd
   \   00025F   E0           MOVX    A,@DPTR
   \   000260   F8           MOV     R0,A
   \   000261   A3           INC     DPTR
   \   000262   E0           MOVX    A,@DPTR
   \   000263   C8           XCH     A,R0
   \   000264   240E         ADD     A,#0xe
   \   000266   F582         MOV     DPL,A
   \   000268   E8           MOV     A,R0
   \   000269   3400         ADDC    A,#0x0
   \   00026B   F583         MOV     DPH,A
   \   00026D   74..         MOV     A,#simpleMeterUnitOfMeasure & 0xff
   \   00026F   F0           MOVX    @DPTR,A
   \   000270   A3           INC     DPTR
   \   000271   74..         MOV     A,#(simpleMeterUnitOfMeasure >> 8) & 0xff
   \   000273   F0           MOVX    @DPTR,A
    477          
    478              pSeReportCmd->attrList[3].attrID = ATTRID_SE_SUMMATION_FORMATTING;
   \   000274   90....       MOV     DPTR,#pSeReportCmd
   \   000277   E0           MOVX    A,@DPTR
   \   000278   F8           MOV     R0,A
   \   000279   A3           INC     DPTR
   \   00027A   E0           MOVX    A,@DPTR
   \   00027B   C8           XCH     A,R0
   \   00027C   2410         ADD     A,#0x10
   \   00027E   F582         MOV     DPL,A
   \   000280   E8           MOV     A,R0
   \   000281   3400         ADDC    A,#0x0
   \   000283   F583         MOV     DPH,A
   \   000285   7403         MOV     A,#0x3
   \   000287   F0           MOVX    @DPTR,A
   \   000288   A3           INC     DPTR
   \   000289   7403         MOV     A,#0x3
   \   00028B   F0           MOVX    @DPTR,A
    479              pSeReportCmd->attrList[3].dataType = ZCL_DATATYPE_BITMAP8;
   \   00028C   90....       MOV     DPTR,#pSeReportCmd
   \   00028F   E0           MOVX    A,@DPTR
   \   000290   F8           MOV     R0,A
   \   000291   A3           INC     DPTR
   \   000292   E0           MOVX    A,@DPTR
   \   000293   C8           XCH     A,R0
   \   000294   2412         ADD     A,#0x12
   \   000296   F582         MOV     DPL,A
   \   000298   E8           MOV     A,R0
   \   000299   3400         ADDC    A,#0x0
   \   00029B   F583         MOV     DPH,A
   \   00029D   7418         MOV     A,#0x18
   \   00029F   F0           MOVX    @DPTR,A
    480              pSeReportCmd->attrList[3].attrData = &simpleMeterSummationFormating;
   \   0002A0   90....       MOV     DPTR,#pSeReportCmd
   \   0002A3   E0           MOVX    A,@DPTR
   \   0002A4   F8           MOV     R0,A
   \   0002A5   A3           INC     DPTR
   \   0002A6   E0           MOVX    A,@DPTR
   \   0002A7   C8           XCH     A,R0
   \   0002A8   2413         ADD     A,#0x13
   \   0002AA   F582         MOV     DPL,A
   \   0002AC   E8           MOV     A,R0
   \   0002AD   3400         ADDC    A,#0x0
   \   0002AF   F583         MOV     DPH,A
   \   0002B1   74..         MOV     A,#simpleMeterSummationFormating & 0xff
   \   0002B3   F0           MOVX    @DPTR,A
   \   0002B4   A3           INC     DPTR
   \   0002B5   74..         MOV     A,#(simpleMeterSummationFormating >> 8) & 0xff
   \   0002B7   F0           MOVX    @DPTR,A
    481          
    482              pSeReportCmd->attrList[4].attrID = ATTRID_SE_METERING_DEVICE_TYPE;
   \   0002B8   90....       MOV     DPTR,#pSeReportCmd
   \   0002BB   E0           MOVX    A,@DPTR
   \   0002BC   F8           MOV     R0,A
   \   0002BD   A3           INC     DPTR
   \   0002BE   E0           MOVX    A,@DPTR
   \   0002BF   C8           XCH     A,R0
   \   0002C0   2415         ADD     A,#0x15
   \   0002C2   F582         MOV     DPL,A
   \   0002C4   E8           MOV     A,R0
   \   0002C5   3400         ADDC    A,#0x0
   \   0002C7   F583         MOV     DPH,A
   \   0002C9   7406         MOV     A,#0x6
   \   0002CB   F0           MOVX    @DPTR,A
   \   0002CC   A3           INC     DPTR
   \   0002CD   7403         MOV     A,#0x3
   \   0002CF   F0           MOVX    @DPTR,A
    483              pSeReportCmd->attrList[4].dataType = ZCL_DATATYPE_BITMAP8;
   \   0002D0   90....       MOV     DPTR,#pSeReportCmd
   \   0002D3   E0           MOVX    A,@DPTR
   \   0002D4   F8           MOV     R0,A
   \   0002D5   A3           INC     DPTR
   \   0002D6   E0           MOVX    A,@DPTR
   \   0002D7   C8           XCH     A,R0
   \   0002D8   2417         ADD     A,#0x17
   \   0002DA   F582         MOV     DPL,A
   \   0002DC   E8           MOV     A,R0
   \   0002DD   3400         ADDC    A,#0x0
   \   0002DF   F583         MOV     DPH,A
   \   0002E1   7418         MOV     A,#0x18
   \   0002E3   F0           MOVX    @DPTR,A
    484              pSeReportCmd->attrList[4].attrData = &simpleMeterDeviceType;
   \   0002E4   90....       MOV     DPTR,#pSeReportCmd
   \   0002E7   E0           MOVX    A,@DPTR
   \   0002E8   F8           MOV     R0,A
   \   0002E9   A3           INC     DPTR
   \   0002EA   E0           MOVX    A,@DPTR
   \   0002EB   C8           XCH     A,R0
   \   0002EC   2418         ADD     A,#0x18
   \   0002EE   F582         MOV     DPL,A
   \   0002F0   E8           MOV     A,R0
   \   0002F1   3400         ADDC    A,#0x0
   \   0002F3   F583         MOV     DPH,A
   \   0002F5   74..         MOV     A,#simpleMeterDeviceType & 0xff
   \   0002F7   F0           MOVX    @DPTR,A
   \   0002F8   A3           INC     DPTR
   \   0002F9   74..         MOV     A,#(simpleMeterDeviceType >> 8) & 0xff
   \   0002FB   F0           MOVX    @DPTR,A
    485          
    486              // Set up additional attributes
    487            }
    488            ZDOInitDevice(0);  // Join the network.
   \                     ??simplemeter_Init_1:
   \   0002FC                ; Setup parameters for call to function ZDOInitDevice
   \   0002FC   7A00         MOV     R2,#0x0
   \   0002FE   7B00         MOV     R3,#0x0
   \   000300   12....       LCALL   ??ZDOInitDevice?relay
   \   000303   E9           MOV     A,R1
    489          }
   \   000304   7F01         MOV     R7,#0x1
   \   000306   02....       LJMP    ?BANKED_LEAVE_XDATA
    490          
    491          /*********************************************************************
    492           * @fn          simplemeter_event_loop
    493           *
    494           * @brief       Event Loop Processor for the simple meter.
    495           *
    496           * @param       uint8 task_id - the osal task id
    497           * @param       uint16 events - the event bitmask
    498           *
    499           * @return      none
    500           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    501          uint16 simplemeter_event_loop( uint8 task_id, uint16 events )
   \                     simplemeter_event_loop:
    502          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 2,R1
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
    503            afIncomingMSGPacket_t *MSGpkt;
    504          
    505            if ( events & SYS_EVENT_MSG )
   \   00000B   EE           MOV     A,R6
   \   00000C   5400         ANL     A,#0x0
   \   00000E   F8           MOV     R0,A
   \   00000F   EF           MOV     A,R7
   \   000010   5480         ANL     A,#0x80
   \   000012   F9           MOV     R1,A
   \   000013   E8           MOV     A,R0
   \   000014   49           ORL     A,R1
   \   000015   7003         JNZ     $+5
   \   000017   02....       LJMP    ??simplemeter_event_loop_0 & 0xFFFF
    506            {
    507              while ( (MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( simpleMeterTaskID )) )
   \                     ??simplemeter_event_loop_1:
   \   00001A                ; Setup parameters for call to function osal_msg_receive
   \   00001A   90....       MOV     DPTR,#simpleMeterTaskID
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F9           MOV     R1,A
   \   00001F   12....       LCALL   ??osal_msg_receive?relay
   \   000022   8A..         MOV     ?V0 + 4,R2
   \   000024   8B..         MOV     ?V0 + 5,R3
   \   000026   A8..         MOV     R0,?V0 + 4
   \   000028   A9..         MOV     R1,?V0 + 5
   \   00002A   88..         MOV     ?V0 + 0,R0
   \   00002C   89..         MOV     ?V0 + 1,R1
   \   00002E   E8           MOV     A,R0
   \   00002F   49           ORL     A,R1
   \   000030   7003         JNZ     $+5
   \   000032   02....       LJMP    ??simplemeter_event_loop_2 & 0xFFFF
    508              {
    509                switch ( MSGpkt->hdr.event )
   \   000035   85..82       MOV     DPL,?V0 + 0
   \   000038   85..83       MOV     DPH,?V0 + 1
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   24CC         ADD     A,#-0x34
   \   00003E   6018         JZ      ??simplemeter_event_loop_3
   \   000040   14           DEC     A
   \   000041   6066         JZ      ??simplemeter_event_loop_4
   \   000043   2475         ADD     A,#0x75
   \   000045   601A         JZ      ??simplemeter_event_loop_5
   \   000047   24EF         ADD     A,#-0x11
   \   000049   6030         JZ      ??simplemeter_event_loop_6
   \   00004B   24FE         ADD     A,#-0x2
   \   00004D   7077         JNZ     ??simplemeter_event_loop_7
    510                {
    511                  case ZDO_CB_MSG:
    512                    simplemeter_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
   \   00004F                ; Setup parameters for call to function simplemeter_ProcessZDOMsgs
   \   00004F   AA..         MOV     R2,?V0 + 0
   \   000051   AB..         MOV     R3,?V0 + 1
   \   000053   12....       LCALL   ??simplemeter_ProcessZDOMsgs?relay
    513                    break;
   \   000056   806E         SJMP    ??simplemeter_event_loop_7
    514          
    515                  case ZCL_INCOMING_MSG:
    516                    // Incoming ZCL foundation command/response messages
    517                    simplemeter_ProcessZCLMsg( (zclIncomingMsg_t *)MSGpkt );
   \                     ??simplemeter_event_loop_3:
   \   000058                ; Setup parameters for call to function simplemeter_ProcessZCLMsg
   \   000058   AA..         MOV     R2,?V0 + 0
   \   00005A   AB..         MOV     R3,?V0 + 1
   \   00005C   12....       LCALL   ??simplemeter_ProcessZCLMsg?relay
    518                    break;
   \   00005F   8065         SJMP    ??simplemeter_event_loop_7
    519          
    520                  case KEY_CHANGE:
    521                    simplemeter_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
   \                     ??simplemeter_event_loop_5:
   \   000061                ; Setup parameters for call to function simplemeter_HandleKeys
   \   000061   85..82       MOV     DPL,?V0 + 0
   \   000064   85..83       MOV     DPH,?V0 + 1
   \   000067   A3           INC     DPTR
   \   000068   A3           INC     DPTR
   \   000069   A3           INC     DPTR
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   FA           MOV     R2,A
   \   00006C   85..82       MOV     DPL,?V0 + 0
   \   00006F   85..83       MOV     DPH,?V0 + 1
   \   000072   A3           INC     DPTR
   \   000073   A3           INC     DPTR
   \   000074   E0           MOVX    A,@DPTR
   \   000075   F9           MOV     R1,A
   \   000076   12....       LCALL   ??simplemeter_HandleKeys?relay
    522                    break;
   \   000079   804B         SJMP    ??simplemeter_event_loop_7
    523          
    524                  case ZDO_STATE_CHANGE:
    525                    if ((DEV_END_DEVICE == (devStates_t)(MSGpkt->hdr.status)) ||
    526                        (DEV_ROUTER == (devStates_t)(MSGpkt->hdr.status)))
   \                     ??simplemeter_event_loop_6:
   \   00007B   85..82       MOV     DPL,?V0 + 0
   \   00007E   85..83       MOV     DPH,?V0 + 1
   \   000081   A3           INC     DPTR
   \   000082   E0           MOVX    A,@DPTR
   \   000083   6406         XRL     A,#0x6
   \   000085   600C         JZ      ??simplemeter_event_loop_8
   \   000087   85..82       MOV     DPL,?V0 + 0
   \   00008A   85..83       MOV     DPH,?V0 + 1
   \   00008D   A3           INC     DPTR
   \   00008E   E0           MOVX    A,@DPTR
   \   00008F   6407         XRL     A,#0x7
   \   000091   7033         JNZ     ??simplemeter_event_loop_7
    527                    {
    528          #if SECURE
    529                      {
    530                        // check to see if link key had already been established
    531                        linkKeyStatus = simplemeter_KeyEstablish_ReturnLinkKey(ESPAddr.addr.shortAddr);
    532          
    533                        if (linkKeyStatus != ZSuccess)
    534                        {
    535                          cId_t cbkeCluster = ZCL_CLUSTER_ID_GEN_KEY_ESTABLISHMENT;
    536                          zAddrType_t dstAddr;
    537          
    538                          // Send out a match for the key establishment
    539                          dstAddr.addrMode = AddrBroadcast;
    540                          dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
    541                          ZDP_MatchDescReq( &dstAddr, NWK_BROADCAST_SHORTADDR, ZCL_SE_PROFILE_ID,
    542                                            1, &cbkeCluster, 0, NULL, FALSE );
    543                        }
    544                        else
    545                        {
    546                          // link key already established, resume sending reports
    547                          osal_set_event( simpleMeterTaskID, SIMPLEMETER_CONNECTED_EVT );
    548                        }
    549                      }
    550          #else
    551                      {
    552                        osal_set_event( simpleMeterTaskID, SIMPLEMETER_CONNECTED_EVT );
   \                     ??simplemeter_event_loop_8:
   \   000093                ; Setup parameters for call to function osal_set_event
   \   000093   7A10         MOV     R2,#0x10
   \   000095   7B00         MOV     R3,#0x0
   \   000097   90....       MOV     DPTR,#simpleMeterTaskID
   \   00009A   E0           MOVX    A,@DPTR
   \   00009B   F9           MOV     R1,A
   \   00009C   12....       LCALL   ??osal_set_event?relay
   \   00009F   E9           MOV     A,R1
    553                      }
    554          #endif
    555                      // per smart energy spec end device polling requirement of not to poll < 7.5 seconds
    556                      NLME_SetPollRate ( SE_DEVICE_POLL_RATE );
   \   0000A0                ; Setup parameters for call to function NLME_SetPollRate
   \   0000A0   7A40         MOV     R2,#0x40
   \   0000A2   7B1F         MOV     R3,#0x1f
   \   0000A4   12....       LCALL   ??NLME_SetPollRate?relay
    557                    }
    558                    break;
   \   0000A7   801D         SJMP    ??simplemeter_event_loop_7
    559          
    560          #if defined( ZCL_KEY_ESTABLISH )
    561                  case ZCL_KEY_ESTABLISH_IND:
    562                    if ((MSGpkt->hdr.status) == TermKeyStatus_Success)
   \                     ??simplemeter_event_loop_4:
   \   0000A9   85..82       MOV     DPL,?V0 + 0
   \   0000AC   85..83       MOV     DPH,?V0 + 1
   \   0000AF   A3           INC     DPTR
   \   0000B0   E0           MOVX    A,@DPTR
   \   0000B1   7013         JNZ     ??simplemeter_event_loop_7
    563                    {
    564                      ESPAddr.endPoint = SIMPLEMETER_ENDPOINT; // set destination endpoint back to application endpoint
   \   0000B3   90....       MOV     DPTR,#ESPAddr + 9
   \   0000B6   7409         MOV     A,#0x9
   \   0000B8   F0           MOVX    @DPTR,A
    565                      osal_set_event( simpleMeterTaskID, SIMPLEMETER_CONNECTED_EVT );
   \   0000B9                ; Setup parameters for call to function osal_set_event
   \   0000B9   7A10         MOV     R2,#0x10
   \   0000BB   7B00         MOV     R3,#0x0
   \   0000BD   90....       MOV     DPTR,#simpleMeterTaskID
   \   0000C0   E0           MOVX    A,@DPTR
   \   0000C1   F9           MOV     R1,A
   \   0000C2   12....       LCALL   ??osal_set_event?relay
   \   0000C5   E9           MOV     A,R1
    566                    }
    567                    break;
    568          #endif
    569          
    570                  default:
    571                    break;
    572                }
    573          
    574                // Release the memory
    575                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??simplemeter_event_loop_7:
   \   0000C6                ; Setup parameters for call to function osal_msg_deallocate
   \   0000C6   AA..         MOV     R2,?V0 + 0
   \   0000C8   AB..         MOV     R3,?V0 + 1
   \   0000CA   12....       LCALL   ??osal_msg_deallocate?relay
   \   0000CD   E9           MOV     A,R1
   \   0000CE   02....       LJMP    ??simplemeter_event_loop_1 & 0xFFFF
    576              }
    577          
    578              // return unprocessed events
    579              return (events ^ SYS_EVENT_MSG);
   \                     ??simplemeter_event_loop_2:
   \   0000D1   EE           MOV     A,R6
   \   0000D2   6400         XRL     A,#0x0
   \   0000D4   FA           MOV     R2,A
   \   0000D5   EF           MOV     A,R7
   \   0000D6   6480         XRL     A,#0x80
   \   0000D8   FB           MOV     R3,A
   \   0000D9   02....       LJMP    ??simplemeter_event_loop_9 & 0xFFFF
    580            }
    581          
    582            // event to intiate key establishment request
    583            if ( events & SIMPLEMETER_KEY_ESTABLISHMENT_REQUEST_EVT )
   \                     ??simplemeter_event_loop_0:
   \   0000DC   EE           MOV     A,R6
   \   0000DD   5404         ANL     A,#0x4
   \   0000DF   601D         JZ      ??simplemeter_event_loop_10
    584            {
    585              zclGeneral_KeyEstablish_InitiateKeyEstablishment(simpleMeterTaskID, &ESPAddr, simpleMeterTransID);
   \   0000E1                ; Setup parameters for call to function zclGeneral_KeyEstablish_InitiateKeyEstablishment
   \   0000E1   90....       MOV     DPTR,#simpleMeterTransID
   \   0000E4   E0           MOVX    A,@DPTR
   \   0000E5   FC           MOV     R4,A
   \   0000E6   7A..         MOV     R2,#ESPAddr & 0xff
   \   0000E8   7B..         MOV     R3,#(ESPAddr >> 8) & 0xff
   \   0000EA   90....       MOV     DPTR,#simpleMeterTaskID
   \   0000ED   E0           MOVX    A,@DPTR
   \   0000EE   F9           MOV     R1,A
   \   0000EF   12....       LCALL   ??zclGeneral_KeyEstablish_InitiateKeyEstablishm
   \   0000F2   E9           MOV     A,R1
    586          
    587              return ( events ^ SIMPLEMETER_KEY_ESTABLISHMENT_REQUEST_EVT );
   \   0000F3   EE           MOV     A,R6
   \   0000F4   6404         XRL     A,#0x4
   \   0000F6   FA           MOV     R2,A
   \   0000F7   EF           MOV     A,R7
   \   0000F8   6400         XRL     A,#0x0
   \   0000FA   FB           MOV     R3,A
   \   0000FB   02....       LJMP    ??simplemeter_event_loop_9 & 0xFFFF
    588            }
    589          
    590            // Event indicating the meter has connected, and the security process has completed
    591            if ( events & SIMPLEMETER_CONNECTED_EVT )
   \                     ??simplemeter_event_loop_10:
   \   0000FE   EE           MOV     A,R6
   \   0000FF   5410         ANL     A,#0x10
   \   000101   601C         JZ      ??simplemeter_event_loop_11
    592            {
    593          #if defined ( SE_UK_EXT ) && defined ( SE_MIRROR )
    594              // Request a mirror on the ESP
    595              zclSE_SimpleMetering_Send_ReqMirrorCmd(SIMPLEMETER_ENDPOINT, &ESPAddr, TRUE, 0);
    596          #endif  // SE_UK_EXT && SE_MIRROR
    597          
    598              // Start Reporting attributes
    599              osal_start_timerEx( simpleMeterTaskID, SIMPLEMETER_REPORT_ATTRIBUTE_EVT, SIMPLEMETER_REPORT_PERIOD );
   \   000103                ; Setup parameters for call to function osal_start_timerEx
   \   000103   7C88         MOV     R4,#-0x78
   \   000105   7D13         MOV     R5,#0x13
   \   000107   7A08         MOV     R2,#0x8
   \   000109   7B00         MOV     R3,#0x0
   \   00010B   90....       MOV     DPTR,#simpleMeterTaskID
   \   00010E   E0           MOVX    A,@DPTR
   \   00010F   F9           MOV     R1,A
   \   000110   12....       LCALL   ??osal_start_timerEx?relay
   \   000113   E9           MOV     A,R1
    600          
    601              return ( events ^ SIMPLEMETER_CONNECTED_EVT );
   \   000114   EE           MOV     A,R6
   \   000115   6410         XRL     A,#0x10
   \   000117   FA           MOV     R2,A
   \   000118   EF           MOV     A,R7
   \   000119   6400         XRL     A,#0x0
   \   00011B   FB           MOV     R3,A
   \   00011C   02....       LJMP    ??simplemeter_event_loop_9 & 0xFFFF
    602            }
    603          
    604            // event to send report attribute
    605            if ( events & SIMPLEMETER_REPORT_ATTRIBUTE_EVT )
   \                     ??simplemeter_event_loop_11:
   \   00011F   EE           MOV     A,R6
   \   000120   5408         ANL     A,#0x8
   \   000122   6058         JZ      ??simplemeter_event_loop_12
    606            {
    607              if ( pSeReportCmd != NULL )
   \   000124   90....       MOV     DPTR,#pSeReportCmd
   \   000127   E0           MOVX    A,@DPTR
   \   000128   F8           MOV     R0,A
   \   000129   A3           INC     DPTR
   \   00012A   E0           MOVX    A,@DPTR
   \   00012B   F9           MOV     R1,A
   \   00012C   E8           MOV     A,R0
   \   00012D   49           ORL     A,R1
   \   00012E   6042         JZ      ??simplemeter_event_loop_13
    608              {
    609                zcl_SendReportCmd( SIMPLEMETER_ENDPOINT, &ESPAddr,
    610                                   ZCL_CLUSTER_ID_SE_SIMPLE_METERING, pSeReportCmd,
    611                                   ZCL_FRAME_SERVER_CLIENT_DIR, 1, 0 );
   \   000130                ; Setup parameters for call to function zcl_SendReportCmd
   \   000130   75..00       MOV     ?V0 + 3,#0x0
   \   000133   78..         MOV     R0,#?V0 + 3
   \   000135   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000138   75..01       MOV     ?V0 + 3,#0x1
   \   00013B   78..         MOV     R0,#?V0 + 3
   \   00013D   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000140   75..01       MOV     ?V0 + 3,#0x1
   \   000143   78..         MOV     R0,#?V0 + 3
   \   000145   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000148   90....       MOV     DPTR,#pSeReportCmd
   \   00014B   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   00014E   7C02         MOV     R4,#0x2
   \   000150   7D07         MOV     R5,#0x7
   \   000152   7A..         MOV     R2,#ESPAddr & 0xff
   \   000154   7B..         MOV     R3,#(ESPAddr >> 8) & 0xff
   \   000156   7909         MOV     R1,#0x9
   \   000158   12....       LCALL   ??zcl_SendReportCmd?relay
   \   00015B   7405         MOV     A,#0x5
   \   00015D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000160   E9           MOV     A,R1
    612          
    613                osal_start_timerEx( simpleMeterTaskID, SIMPLEMETER_REPORT_ATTRIBUTE_EVT, SIMPLEMETER_REPORT_PERIOD );
   \   000161                ; Setup parameters for call to function osal_start_timerEx
   \   000161   7C88         MOV     R4,#-0x78
   \   000163   7D13         MOV     R5,#0x13
   \   000165   7A08         MOV     R2,#0x8
   \   000167   7B00         MOV     R3,#0x0
   \   000169   90....       MOV     DPTR,#simpleMeterTaskID
   \   00016C   E0           MOVX    A,@DPTR
   \   00016D   F9           MOV     R1,A
   \   00016E   12....       LCALL   ??osal_start_timerEx?relay
   \   000171   E9           MOV     A,R1
    614              }
    615          
    616              return ( events ^ SIMPLEMETER_REPORT_ATTRIBUTE_EVT );
   \                     ??simplemeter_event_loop_13:
   \   000172   EE           MOV     A,R6
   \   000173   6408         XRL     A,#0x8
   \   000175   FA           MOV     R2,A
   \   000176   EF           MOV     A,R7
   \   000177   6400         XRL     A,#0x0
   \   000179   FB           MOV     R3,A
   \   00017A   8057         SJMP    ??simplemeter_event_loop_9
    617            }
    618          
    619            // handle processing of identify timeout event triggered by an identify command
    620            if ( events & SIMPLEMETER_IDENTIFY_TIMEOUT_EVT )
   \                     ??simplemeter_event_loop_12:
   \   00017C   EE           MOV     A,R6
   \   00017D   A2E0         MOV     C,0xE0 /* A   */.0
   \   00017F   5025         JNC     ??simplemeter_event_loop_14
    621            {
    622              if ( simpleMeterIdentifyTime > 0 )
   \   000181   90....       MOV     DPTR,#simpleMeterIdentifyTime
   \   000184   E0           MOVX    A,@DPTR
   \   000185   F8           MOV     R0,A
   \   000186   A3           INC     DPTR
   \   000187   E0           MOVX    A,@DPTR
   \   000188   F9           MOV     R1,A
   \   000189   E8           MOV     A,R0
   \   00018A   49           ORL     A,R1
   \   00018B   600C         JZ      ??simplemeter_event_loop_15
    623              {
    624                simpleMeterIdentifyTime--;
   \   00018D   90....       MOV     DPTR,#simpleMeterIdentifyTime
   \   000190   E0           MOVX    A,@DPTR
   \   000191   24FF         ADD     A,#-0x1
   \   000193   F0           MOVX    @DPTR,A
   \   000194   A3           INC     DPTR
   \   000195   E0           MOVX    A,@DPTR
   \   000196   34FF         ADDC    A,#-0x1
   \   000198   F0           MOVX    @DPTR,A
    625              }
    626              simplemeter_ProcessIdentifyTimeChange();
   \                     ??simplemeter_event_loop_15:
   \   000199                ; Setup parameters for call to function simplemeter_ProcessIdentifyTimeChange
   \   000199   12....       LCALL   ??simplemeter_ProcessIdentifyTimeChange?relay
    627          
    628              return ( events ^ SIMPLEMETER_IDENTIFY_TIMEOUT_EVT );
   \   00019C   EE           MOV     A,R6
   \   00019D   6401         XRL     A,#0x1
   \   00019F   FA           MOV     R2,A
   \   0001A0   EF           MOV     A,R7
   \   0001A1   6400         XRL     A,#0x0
   \   0001A3   FB           MOV     R3,A
   \   0001A4   802D         SJMP    ??simplemeter_event_loop_9
    629            }
    630          
    631            // event to get current time
    632            if ( events & SIMPLEMETER_UPDATE_TIME_EVT )
   \                     ??simplemeter_event_loop_14:
   \   0001A6   EE           MOV     A,R6
   \   0001A7   5402         ANL     A,#0x2
   \   0001A9   6024         JZ      ??simplemeter_event_loop_16
    633            {
    634              simpleMeterTime = osal_getClock();
   \   0001AB                ; Setup parameters for call to function osal_getClock
   \   0001AB   12....       LCALL   ??osal_getClock?relay
   \   0001AE   90....       MOV     DPTR,#simpleMeterTime
   \   0001B1   12....       LCALL   ?XSTORE_R2345
    635              osal_start_timerEx( simpleMeterTaskID, SIMPLEMETER_UPDATE_TIME_EVT, SIMPLEMETER_UPDATE_TIME_PERIOD );
   \   0001B4                ; Setup parameters for call to function osal_start_timerEx
   \   0001B4   7CE8         MOV     R4,#-0x18
   \   0001B6   7D03         MOV     R5,#0x3
   \   0001B8   7A02         MOV     R2,#0x2
   \   0001BA   7B00         MOV     R3,#0x0
   \   0001BC   90....       MOV     DPTR,#simpleMeterTaskID
   \   0001BF   E0           MOVX    A,@DPTR
   \   0001C0   F9           MOV     R1,A
   \   0001C1   12....       LCALL   ??osal_start_timerEx?relay
   \   0001C4   E9           MOV     A,R1
    636          
    637              return ( events ^ SIMPLEMETER_UPDATE_TIME_EVT );
   \   0001C5   EE           MOV     A,R6
   \   0001C6   6402         XRL     A,#0x2
   \   0001C8   FA           MOV     R2,A
   \   0001C9   EF           MOV     A,R7
   \   0001CA   6400         XRL     A,#0x0
   \   0001CC   FB           MOV     R3,A
   \   0001CD   8004         SJMP    ??simplemeter_event_loop_9
    638            }
    639          
    640            // Discard unknown events
    641            return 0;
   \                     ??simplemeter_event_loop_16:
   \   0001CF   7A00         MOV     R2,#0x0
   \   0001D1   7B00         MOV     R3,#0x0
   \                     ??simplemeter_event_loop_9:
   \   0001D3   7F06         MOV     R7,#0x6
   \   0001D5   02....       LJMP    ?BANKED_LEAVE_XDATA
    642          }
    643          
    644          /*********************************************************************
    645           * @fn      simplemeter_ProcessZDOMsgs
    646           *
    647           * @brief   Called to process callbacks from the ZDO.
    648           *
    649           * @param   none
    650           *
    651           * @return  none
    652           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    653          static void simplemeter_ProcessZDOMsgs( zdoIncomingMsg_t *pMsg )
   \                     simplemeter_ProcessZDOMsgs:
    654          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    655            if (pMsg->clusterID == Match_Desc_rsp)
   \   000009   EE           MOV     A,R6
   \   00000A   240C         ADD     A,#0xc
   \   00000C   F582         MOV     DPL,A
   \   00000E   EF           MOV     A,R7
   \   00000F   3400         ADDC    A,#0x0
   \   000011   F583         MOV     DPH,A
   \   000013   E0           MOVX    A,@DPTR
   \   000014   6406         XRL     A,#0x6
   \   000016   7004         JNZ     ??simplemeter_ProcessZDOMsgs_0
   \   000018   A3           INC     DPTR
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   6480         XRL     A,#0x80
   \                     ??simplemeter_ProcessZDOMsgs_0:
   \   00001C   7059         JNZ     ??simplemeter_ProcessZDOMsgs_1
    656            {
    657              ZDO_ActiveEndpointRsp_t *pRsp = ZDO_ParseEPListRsp( pMsg );
   \   00001E                ; Setup parameters for call to function ZDO_ParseEPListRsp
   \   00001E   EE           MOV     A,R6
   \   00001F   FA           MOV     R2,A
   \   000020   EF           MOV     A,R7
   \   000021   FB           MOV     R3,A
   \   000022   12....       LCALL   ??ZDO_ParseEPListRsp?relay
   \   000025   8A..         MOV     ?V0 + 2,R2
   \   000027   8B..         MOV     ?V0 + 3,R3
   \   000029   85....       MOV     ?V0 + 0,?V0 + 2
   \   00002C   85....       MOV     ?V0 + 1,?V0 + 3
    658          
    659              if (pRsp)
   \   00002F   E5..         MOV     A,?V0 + 0
   \   000031   45..         ORL     A,?V0 + 1
   \   000033   6042         JZ      ??simplemeter_ProcessZDOMsgs_1
    660              {
    661                if (pRsp->cnt)
   \   000035   85..82       MOV     DPL,?V0 + 0
   \   000038   85..83       MOV     DPH,?V0 + 1
   \   00003B   A3           INC     DPTR
   \   00003C   A3           INC     DPTR
   \   00003D   A3           INC     DPTR
   \   00003E   E0           MOVX    A,@DPTR
   \   00003F   602F         JZ      ??simplemeter_ProcessZDOMsgs_2
    662                {
    663                  // Record the trust center
    664                  ESPAddr.endPoint = pRsp->epList[0];
   \   000041   85..82       MOV     DPL,?V0 + 0
   \   000044   85..83       MOV     DPH,?V0 + 1
   \   000047   A3           INC     DPTR
   \   000048   A3           INC     DPTR
   \   000049   A3           INC     DPTR
   \   00004A   A3           INC     DPTR
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   90....       MOV     DPTR,#ESPAddr + 9
   \   00004F   F0           MOVX    @DPTR,A
    665                  ESPAddr.addr.shortAddr = pMsg->srcAddr.addr.shortAddr;
   \   000050   8E82         MOV     DPL,R6
   \   000052   8F83         MOV     DPH,R7
   \   000054   A3           INC     DPTR
   \   000055   A3           INC     DPTR
   \   000056   E0           MOVX    A,@DPTR
   \   000057   F8           MOV     R0,A
   \   000058   A3           INC     DPTR
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   F9           MOV     R1,A
   \   00005B   90....       MOV     DPTR,#ESPAddr
   \   00005E   E8           MOV     A,R0
   \   00005F   F0           MOVX    @DPTR,A
   \   000060   A3           INC     DPTR
   \   000061   E9           MOV     A,R1
   \   000062   F0           MOVX    @DPTR,A
    666          
    667                  // send out key establishment request
    668                  osal_set_event( simpleMeterTaskID, SIMPLEMETER_KEY_ESTABLISHMENT_REQUEST_EVT);
   \   000063                ; Setup parameters for call to function osal_set_event
   \   000063   7A04         MOV     R2,#0x4
   \   000065   7B00         MOV     R3,#0x0
   \   000067   90....       MOV     DPTR,#simpleMeterTaskID
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   F9           MOV     R1,A
   \   00006C   12....       LCALL   ??osal_set_event?relay
   \   00006F   E9           MOV     A,R1
    669                }
    670                osal_mem_free(pRsp);
   \                     ??simplemeter_ProcessZDOMsgs_2:
   \   000070                ; Setup parameters for call to function osal_mem_free
   \   000070   AA..         MOV     R2,?V0 + 0
   \   000072   AB..         MOV     R3,?V0 + 1
   \   000074   12....       LCALL   ??osal_mem_free?relay
    671              }
    672            }
    673          }
   \                     ??simplemeter_ProcessZDOMsgs_1:
   \   000077   7F04         MOV     R7,#0x4
   \   000079   02....       LJMP    ?BANKED_LEAVE_XDATA
    674          
    675          /*********************************************************************
    676           * @fn      simplemeter_ProcessIdentifyTimeChange
    677           *
    678           * @brief   Called to blink led for specified IdentifyTime attribute value
    679           *
    680           * @param   none
    681           *
    682           * @return  none
    683           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    684          static void simplemeter_ProcessIdentifyTimeChange( void )
   \                     simplemeter_ProcessIdentifyTimeChange:
    685          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    686            if ( simpleMeterIdentifyTime > 0 )
   \   000004   90....       MOV     DPTR,#simpleMeterIdentifyTime
   \   000007   E0           MOVX    A,@DPTR
   \   000008   F8           MOV     R0,A
   \   000009   A3           INC     DPTR
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   F9           MOV     R1,A
   \   00000C   E8           MOV     A,R0
   \   00000D   49           ORL     A,R1
   \   00000E   6020         JZ      ??simplemeter_ProcessIdentifyTimeChange_0
    687            {
    688              osal_start_timerEx( simpleMeterTaskID, SIMPLEMETER_IDENTIFY_TIMEOUT_EVT, 1000 );
   \   000010                ; Setup parameters for call to function osal_start_timerEx
   \   000010   7CE8         MOV     R4,#-0x18
   \   000012   7D03         MOV     R5,#0x3
   \   000014   7A01         MOV     R2,#0x1
   \   000016   7B00         MOV     R3,#0x0
   \   000018   90....       MOV     DPTR,#simpleMeterTaskID
   \   00001B   E0           MOVX    A,@DPTR
   \   00001C   F9           MOV     R1,A
   \   00001D   12....       LCALL   ??osal_start_timerEx?relay
   \   000020   E9           MOV     A,R1
    689              HalLedBlink ( HAL_LED_4, 0xFF, HAL_LED_DEFAULT_DUTY_CYCLE, HAL_LED_DEFAULT_FLASH_TIME );
   \   000021                ; Setup parameters for call to function HalLedBlink
   \   000021   7CE8         MOV     R4,#-0x18
   \   000023   7D03         MOV     R5,#0x3
   \   000025   7B05         MOV     R3,#0x5
   \   000027   7AFF         MOV     R2,#-0x1
   \   000029   7908         MOV     R1,#0x8
   \   00002B   12....       LCALL   ??HalLedBlink?relay
   \   00002E   8015         SJMP    ??simplemeter_ProcessIdentifyTimeChange_1
    690            }
    691            else
    692            {
    693              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
   \                     ??simplemeter_ProcessIdentifyTimeChange_0:
   \   000030                ; Setup parameters for call to function HalLedSet
   \   000030   7A00         MOV     R2,#0x0
   \   000032   7908         MOV     R1,#0x8
   \   000034   12....       LCALL   ??HalLedSet?relay
   \   000037   E9           MOV     A,R1
    694              osal_stop_timerEx( simpleMeterTaskID, SIMPLEMETER_IDENTIFY_TIMEOUT_EVT );
   \   000038                ; Setup parameters for call to function osal_stop_timerEx
   \   000038   7A01         MOV     R2,#0x1
   \   00003A   7B00         MOV     R3,#0x0
   \   00003C   90....       MOV     DPTR,#simpleMeterTaskID
   \   00003F   E0           MOVX    A,@DPTR
   \   000040   F9           MOV     R1,A
   \   000041   12....       LCALL   ??osal_stop_timerEx?relay
   \   000044   E9           MOV     A,R1
    695            }
    696          }
   \                     ??simplemeter_ProcessIdentifyTimeChange_1:
   \   000045   D083         POP     DPH
   \   000047   D082         POP     DPL
   \   000049   02....       LJMP    ?BRET
    697          
    698          #if SECURE
    699          /*********************************************************************
    700           * @fn      simplemeter_KeyEstablish_ReturnLinkKey
    701           *
    702           * @brief   This function get the requested link key
    703           *
    704           * @param   shortAddr - short address of the partner.
    705           *
    706           * @return  none
    707           */
    708          static uint8 simplemeter_KeyEstablish_ReturnLinkKey( uint16 shortAddr )
    709          {
    710            uint8 status = ZFailure;
    711            AddrMgrEntry_t entry;
    712          
    713            // Look up the long address of the device
    714          
    715            entry.user = ADDRMGR_USER_DEFAULT;
    716            entry.nwkAddr = shortAddr;
    717          
    718            if ( AddrMgrEntryLookupNwk( &entry ) )
    719            {
    720              // check if APS link key has been established
    721              if ( APSME_IsLinkKeyValid( entry.extAddr ) == TRUE )
    722              {
    723                status = ZSuccess;
    724              }
    725            }
    726            else
    727            {
    728              // It's an unknown device
    729              status = ZInvalidParameter;
    730            }
    731          
    732            return status;
    733          }
    734          #endif
    735          
    736          /*********************************************************************
    737           * @fn      simplemeter_HandleKeys
    738           *
    739           * @brief   Handles all key events for this device.
    740           *
    741           * @param   shift - true if in shift/alt.
    742           * @param   keys - bit field for key events. Valid entries:
    743           *                 HAL_KEY_SW_4
    744           *                 HAL_KEY_SW_3
    745           *                 HAL_KEY_SW_2
    746           *                 HAL_KEY_SW_1
    747           *
    748           * @return  none
    749           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    750          static void simplemeter_HandleKeys( uint8 shift, uint8 keys )
   \                     simplemeter_HandleKeys:
    751          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   \   000007   EA           MOV     A,R2
   \   000008   FF           MOV     R7,A
    752            // Shift is used to make each button/switch dual purpose.
    753            if ( shift )
   \   000009   EE           MOV     A,R6
   \   00000A   601A         JZ      ??simplemeter_HandleKeys_0
    754            {
    755              if ( keys & HAL_KEY_SW_1 )
   \   00000C   EF           MOV     A,R7
   \   00000D   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000F   5001         JNC     ??simplemeter_HandleKeys_1
    756              {
    757                asm("NOP");
   \   000011   00           NOP
    758              }
    759              if ( keys & HAL_KEY_SW_2 )
   \                     ??simplemeter_HandleKeys_1:
   \   000012   EF           MOV     A,R7
   \   000013   A2E1         MOV     C,0xE0 /* A   */.1
   \   000015   5001         JNC     ??simplemeter_HandleKeys_2
    760              {
    761                asm("NOP");
   \   000017   00           NOP
    762              }
    763              if ( keys & HAL_KEY_SW_3 )
   \                     ??simplemeter_HandleKeys_2:
   \   000018   EF           MOV     A,R7
   \   000019   A2E4         MOV     C,0xE0 /* A   */.4
   \   00001B   5001         JNC     ??simplemeter_HandleKeys_3
    764              {
    765                asm("NOP");
   \   00001D   00           NOP
    766              }
    767              if ( keys & HAL_KEY_SW_6 )
   \                     ??simplemeter_HandleKeys_3:
   \   00001E   EF           MOV     A,R7
   \   00001F   A2E5         MOV     C,0xE0 /* A   */.5
   \   000021   507B         JNC     ??simplemeter_HandleKeys_4
    768              {
    769                asm("NOP");
   \   000023   00           NOP
   \   000024   8078         SJMP    ??simplemeter_HandleKeys_4
    770              }
    771            }
    772            else
    773            {
    774              if ( keys & HAL_KEY_SW_1 )
   \                     ??simplemeter_HandleKeys_0:
   \   000026   EF           MOV     A,R7
   \   000027   A2E0         MOV     C,0xE0 /* A   */.0
   \   000029   5008         JNC     ??simplemeter_HandleKeys_5
    775              {
    776                ZDOInitDevice(0);  // Join the network.
   \   00002B                ; Setup parameters for call to function ZDOInitDevice
   \   00002B   7A00         MOV     R2,#0x0
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   12....       LCALL   ??ZDOInitDevice?relay
   \   000032   E9           MOV     A,R1
    777              }
    778          
    779              if ( keys & HAL_KEY_SW_2 )
   \                     ??simplemeter_HandleKeys_5:
   \   000033   EF           MOV     A,R7
   \   000034   A2E1         MOV     C,0xE0 /* A   */.1
   \   000036   5059         JNC     ??simplemeter_HandleKeys_6
    780              {
    781                // Remove mirror
    782                zclSE_SimpleMetering_Send_RemMirrorCmd(SIMPLEMETER_ENDPOINT, &ESPAddr, TRUE, 0);
   \   000038                ; Setup parameters for call to function zcl_SendCommand
   \   000038   E4           CLR     A
   \   000039   F5..         MOV     ?V0 + 0,A
   \   00003B   F5..         MOV     ?V0 + 1,A
   \   00003D   78..         MOV     R0,#?V0 + 0
   \   00003F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000042   E4           CLR     A
   \   000043   F5..         MOV     ?V0 + 0,A
   \   000045   F5..         MOV     ?V0 + 1,A
   \   000047   78..         MOV     R0,#?V0 + 0
   \   000049   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00004C   75..00       MOV     ?V0 + 0,#0x0
   \   00004F   78..         MOV     R0,#?V0 + 0
   \   000051   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000054   E4           CLR     A
   \   000055   F5..         MOV     ?V0 + 0,A
   \   000057   F5..         MOV     ?V0 + 1,A
   \   000059   78..         MOV     R0,#?V0 + 0
   \   00005B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005E   75..01       MOV     ?V0 + 0,#0x1
   \   000061   78..         MOV     R0,#?V0 + 0
   \   000063   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000066   75..01       MOV     ?V0 + 0,#0x1
   \   000069   78..         MOV     R0,#?V0 + 0
   \   00006B   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00006E   75..01       MOV     ?V0 + 0,#0x1
   \   000071   78..         MOV     R0,#?V0 + 0
   \   000073   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000076   75..02       MOV     ?V0 + 0,#0x2
   \   000079   78..         MOV     R0,#?V0 + 0
   \   00007B   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00007E   7C02         MOV     R4,#0x2
   \   000080   7D07         MOV     R5,#0x7
   \   000082   7A..         MOV     R2,#ESPAddr & 0xff
   \   000084   7B..         MOV     R3,#(ESPAddr >> 8) & 0xff
   \   000086   7909         MOV     R1,#0x9
   \   000088   12....       LCALL   ??zcl_SendCommand?relay
   \   00008B   740B         MOV     A,#0xb
   \   00008D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000090   E9           MOV     A,R1
    783              }
    784          
    785              if ( keys & HAL_KEY_SW_3 )
    786              {
    787          
    788              }
    789          
    790              if ( keys & HAL_KEY_SW_6 )
   \                     ??simplemeter_HandleKeys_6:
   \   000091   EF           MOV     A,R7
   \   000092   A2E5         MOV     C,0xE0 /* A   */.5
   \   000094   5008         JNC     ??simplemeter_HandleKeys_4
    791              {
    792              ZDOInitDevice(0);  // Join the network.
   \   000096                ; Setup parameters for call to function ZDOInitDevice
   \   000096   7A00         MOV     R2,#0x0
   \   000098   7B00         MOV     R3,#0x0
   \   00009A   12....       LCALL   ??ZDOInitDevice?relay
   \   00009D   E9           MOV     A,R1
    793              }
    794            }
    795          }
   \                     ??simplemeter_HandleKeys_4:
   \   00009E   7F02         MOV     R7,#0x2
   \   0000A0   02....       LJMP    ?BANKED_LEAVE_XDATA
    796          
    797          /*********************************************************************
    798           * @fn      simplemeter_ValidateAttrDataCB
    799           *
    800           * @brief   Check to see if the supplied value for the attribute data
    801           *          is within the specified range of the attribute.
    802           *
    803           * @param   pAttr - pointer to attribute
    804           * @param   pAttrInfo - pointer to attribute info
    805           *
    806           * @return  TRUE if data valid. FALSE otherwise.
    807           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    808          static uint8 simplemeter_ValidateAttrDataCB( zclAttrRec_t *pAttr, zclWriteRec_t *pAttrInfo )
   \                     simplemeter_ValidateAttrDataCB:
    809          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    810            uint8 valid = TRUE;
   \   000004   7901         MOV     R1,#0x1
    811          
    812            switch ( pAttrInfo->dataType )
   \   000006   8C82         MOV     DPL,R4
   \   000008   8D83         MOV     DPH,R5
   \   00000A   A3           INC     DPTR
   \   00000B   A3           INC     DPTR
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6410         XRL     A,#0x10
   \   00000F   7028         JNZ     ??simplemeter_ValidateAttrDataCB_0
    813            {
    814              case ZCL_DATATYPE_BOOLEAN:
    815                if ( ( *(pAttrInfo->attrData) != 0 ) && ( *(pAttrInfo->attrData) != 1 ) )
   \   000011   8C82         MOV     DPL,R4
   \   000013   8D83         MOV     DPH,R5
   \   000015   A3           INC     DPTR
   \   000016   A3           INC     DPTR
   \   000017   A3           INC     DPTR
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F8           MOV     R0,A
   \   00001A   A3           INC     DPTR
   \   00001B   E0           MOVX    A,@DPTR
   \   00001C   F583         MOV     DPH,A
   \   00001E   8882         MOV     DPL,R0
   \   000020   E0           MOVX    A,@DPTR
   \   000021   6016         JZ      ??simplemeter_ValidateAttrDataCB_0
   \   000023   8C82         MOV     DPL,R4
   \   000025   8D83         MOV     DPH,R5
   \   000027   A3           INC     DPTR
   \   000028   A3           INC     DPTR
   \   000029   A3           INC     DPTR
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   F8           MOV     R0,A
   \   00002C   A3           INC     DPTR
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   F583         MOV     DPH,A
   \   000030   8882         MOV     DPL,R0
   \   000032   E0           MOVX    A,@DPTR
   \   000033   6401         XRL     A,#0x1
   \   000035   6002         JZ      ??simplemeter_ValidateAttrDataCB_0
    816                  valid = FALSE;
   \   000037   7900         MOV     R1,#0x0
    817                break;
    818          
    819              default:
    820                break;
    821            }
    822          
    823            return ( valid );
   \                     ??simplemeter_ValidateAttrDataCB_0:
   \   000039   D083         POP     DPH
   \   00003B   D082         POP     DPL
   \   00003D   02....       LJMP    ?BRET
    824          }
    825          
    826          /*********************************************************************
    827           * @fn      simplemeter_BasicResetCB
    828           *
    829           * @brief   Callback from the ZCL General Cluster Library to set all
    830           *          the attributes of all the clusters to their factory defaults
    831           *
    832           * @param   none
    833           *
    834           * @return  none
    835           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    836          static void simplemeter_BasicResetCB( void )
   \                     simplemeter_BasicResetCB:
    837          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    838            // user should handle setting attributes to factory defaults here
    839          }
   \   000000   02....       LJMP    ?BRET
    840          
    841          /*********************************************************************
    842           * @fn      simplemeter_IdentifyCB
    843           *
    844           * @brief   Callback from the ZCL General Cluster Library when
    845           *          it received an Identity Command for this application.
    846           *
    847           * @param   pCmd - pointer to structure for Identify command
    848           *
    849           * @return  none
    850           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    851          static void simplemeter_IdentifyCB( zclIdentify_t *pCmd )
   \                     simplemeter_IdentifyCB:
    852          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    853            simpleMeterIdentifyTime = pCmd->identifyTime;
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   A3           INC     DPTR
   \   00000E   A3           INC     DPTR
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   F8           MOV     R0,A
   \   000011   A3           INC     DPTR
   \   000012   E0           MOVX    A,@DPTR
   \   000013   F9           MOV     R1,A
   \   000014   90....       MOV     DPTR,#simpleMeterIdentifyTime
   \   000017   E8           MOV     A,R0
   \   000018   F0           MOVX    @DPTR,A
   \   000019   A3           INC     DPTR
   \   00001A   E9           MOV     A,R1
   \   00001B   F0           MOVX    @DPTR,A
    854            simplemeter_ProcessIdentifyTimeChange();
   \   00001C                ; Setup parameters for call to function simplemeter_ProcessIdentifyTimeChange
   \   00001C   12....       LCALL   ??simplemeter_ProcessIdentifyTimeChange?relay
    855          }
   \   00001F   7F01         MOV     R7,#0x1
   \   000021   02....       LJMP    ?BANKED_LEAVE_XDATA
    856          
    857          /*********************************************************************
    858           * @fn      simplemeter_IdentifyQueryRspCB
    859           *
    860           * @brief   Callback from the ZCL General Cluster Library when
    861           *          it received an Identity Query Response Command for this application.
    862           *
    863           * @param   pRsp - pointer to structure for Identity Query Response command
    864           *
    865           * @return  none
    866           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    867          static void simplemeter_IdentifyQueryRspCB( zclIdentifyQueryRsp_t *pRsp )
   \                     simplemeter_IdentifyQueryRspCB:
    868          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    869            // add user code here
    870          }
   \   000000   02....       LJMP    ?BRET
    871          
    872          
    873          
    874          /*********************************************************************
    875           * @fn      simplemeter_AlarmCB
    876           *
    877           * @brief   Callback from the ZCL General Cluster Library when
    878           *          it received an Alarm request or response command for
    879           *          this application.
    880           *
    881           * @param   pAlarm - pointer to structure for Alarm command
    882           *
    883           * @return  none
    884           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    885          static void simplemeter_AlarmCB( zclAlarm_t *pAlarm )
   \                     simplemeter_AlarmCB:
    886          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    887            // add user code here
    888          }
   \   000000   02....       LJMP    ?BRET
    889          
    890          #ifdef SE_UK_EXT
    891          /*********************************************************************
    892           * @fn      simplemeter_GetEventLogCB
    893           *
    894           * @brief   Callback from the ZCL General Cluster Library when
    895           *          it received a Get Event Log command for this
    896           *          application.
    897           *
    898           * @param   srcEP - source endpoint
    899           * @param   srcAddr - pointer to source address
    900           * @param   pEventLog - pointer to structure for Get Event Log command
    901           * @param   seqNum - sequence number of this command
    902           *
    903           * @return  none
    904           */
    905          static void simplemeter_GetEventLogCB( uint8 srcEP, afAddrType_t *srcAddr,
    906                                                 zclGetEventLog_t *pEventLog, uint8 seqNum )
    907          {
    908            // add user code here, which could fragment the event log payload if
    909            // the entire payload doesn't fit into one Publish Event Log Command.
    910            // Note: the Command Index starts at 0 and is incremented for each
    911            // fragment belonging to the same command.
    912          
    913            // There's no event log for now! The Metering Device will support
    914            // logging for all events configured to do so.
    915          }
    916          
    917          /*********************************************************************
    918           * @fn      simplemeter_PublishEventLogCB
    919           *
    920           * @brief   Callback from the ZCL General Cluster Library when
    921           *          it received a Publish Event Log command for this
    922           *          application.
    923           *
    924           * @param   srcAddr - pointer to source address
    925           * @param   pEventLog - pointer to structure for Publish Event Log command
    926           *
    927           * @return  none
    928           */
    929          static void simplemeter_PublishEventLogCB( afAddrType_t *srcAddr, zclPublishEventLog_t *pEventLog )
    930          {
    931            // add user code here
    932          }
    933          #endif // SE_UK_EXT
    934          
    935          /*********************************************************************
    936           * @fn      simplemeter_GetProfileCmdCB
    937           *
    938           * @brief   Callback from the ZCL SE Profile Simple Metering Cluster Library when
    939           *          it received a Get Profile Command for
    940           *          this application.
    941           *
    942           * @param   pCmd - pointer to structure for Get Profile command
    943           * @param   srcAddr - pointer to source address
    944           * @param   seqNum - sequence number of this command
    945           *
    946           * @return  none
    947           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    948          static void simplemeter_GetProfileCmdCB( zclCCGetProfileCmd_t *pCmd,
   \                     simplemeter_GetProfileCmdCB:
    949                                                   afAddrType_t *srcAddr, uint8 seqNum )
    950          {
   \   000000   74EA         MOV     A,#-0x16
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 22
   \   000005                ; Auto size: 20
   \   000005   74EC         MOV     A,#-0x14
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 12,R2
   \   00000C   8B..         MOV     ?V0 + 13,R3
   \   00000E   8C..         MOV     ?V0 + 10,R4
   \   000010   8D..         MOV     ?V0 + 11,R5
   \   000012   89..         MOV     ?V0 + 9,R1
    951          #if defined ( ZCL_SIMPLE_METERING )
    952            // Upon receipt of the Get Profile Command, the metering device shall send
    953            // Get Profile Response back.
    954          
    955            // Variables in the following are initialized to arbitrary value for test purpose
    956            // In real application, user shall look up the interval data captured during
    957            // the period specified in the pCmd->endTime and return corresponding data.
    958          
    959            uint32 endTime;
    960            uint8  status = zclSE_SimpleMeter_GetProfileRsp_Status_Success;
   \   000014   75..00       MOV     ?V0 + 8,#0x0
    961            uint8  profileIntervalPeriod = PROFILE_INTERVAL_PERIOD_60MIN;
   \   000017   7F01         MOV     R7,#0x1
    962            uint8  numberOfPeriodDelivered = 5;
   \   000019   7E05         MOV     R6,#0x5
    963            uint24 intervals[] = {0xa00001, 0xa00002, 0xa00003, 0xa00004, 0xa00005};
   \   00001B   90....       MOV     DPTR,#`?<Constant {10485761L, 10485762L, 10485763L, 1`
   \   00001E   C082         PUSH    DPL
   \   000020   C083         PUSH    DPH
   \   000022   85..82       MOV     DPL,?XSP + 0
   \   000025   85..83       MOV     DPH,?XSP + 1
   \   000028   AC82         MOV     R4,DPL
   \   00002A   AD83         MOV     R5,DPH
   \   00002C   D083         POP     DPH
   \   00002E   D082         POP     DPL
   \   000030   7414         MOV     A,#0x14
   \   000032   12....       LCALL   ?MOVE_LONG8_XDATA_XDATA
    964          
    965            // endTime: 32 bit value (in UTC) representing the end time of the most
    966            // chronologically recent interval being requested.
    967            // Example: Data collected from 2:00 PM to 3:00 PM would be specified as a
    968            // 3:00 PM interval (end time).
    969          
    970            // The Intervals block returned shall be the most recent block with
    971            // its EndTime equal or older to the one in the request (pCmd->endTime).
    972            // Requested End Time with value 0xFFFFFFFF indicats the most recent
    973            // Intervals block is requested.
    974          
    975            // Sample Code - assuming the end time of the requested block is the same as
    976            // it in the request.
    977            endTime = pCmd->endTime;
   \   000035   85..82       MOV     DPL,?V0 + 12
   \   000038   85..83       MOV     DPH,?V0 + 13
   \   00003B   A3           INC     DPTR
   \   00003C   78..         MOV     R0,#?V0 + 0
   \   00003E   12....       LCALL   ?L_MOV_X
   \   000041   85....       MOV     ?V0 + 4,?V0 + 0
   \   000044   85....       MOV     ?V0 + 5,?V0 + 1
   \   000047   85....       MOV     ?V0 + 6,?V0 + 2
   \   00004A   85....       MOV     ?V0 + 7,?V0 + 3
    978          
    979            // Send Get Profile Response Command back
    980          
    981            zclSE_SimpleMetering_Send_GetProfileRsp( SIMPLEMETER_ENDPOINT, srcAddr, endTime,
    982                                                     status,
    983                                                     profileIntervalPeriod,
    984                                                     numberOfPeriodDelivered, intervals,
    985                                                     FALSE, seqNum );
   \   00004D                ; Setup parameters for call to function zclSE_SimpleMetering_Send_GetProfileRsp
   \   00004D   E5..         MOV     A,?V0 + 9
   \   00004F   F5..         MOV     ?V0 + 0,A
   \   000051   78..         MOV     R0,#?V0 + 0
   \   000053   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000056   75..00       MOV     ?V0 + 0,#0x0
   \   000059   78..         MOV     R0,#?V0 + 0
   \   00005B   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00005E   7402         MOV     A,#0x2
   \   000060   12....       LCALL   ?XSTACK_DISP0_8
   \   000063   8582..       MOV     ?V0 + 0,DPL
   \   000066   8583..       MOV     ?V0 + 1,DPH
   \   000069   78..         MOV     R0,#?V0 + 0
   \   00006B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00006E   EE           MOV     A,R6
   \   00006F   F5..         MOV     ?V0 + 0,A
   \   000071   78..         MOV     R0,#?V0 + 0
   \   000073   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000076   78..         MOV     R0,#?V0 + 4
   \   000078   12....       LCALL   ?PUSH_XSTACK_I_FOUR
   \   00007B   EF           MOV     A,R7
   \   00007C   FD           MOV     R5,A
   \   00007D   AC..         MOV     R4,?V0 + 8
   \   00007F   AA..         MOV     R2,?V0 + 10
   \   000081   AB..         MOV     R3,?V0 + 11
   \   000083   7909         MOV     R1,#0x9
   \   000085   12....       LCALL   ??zclSE_SimpleMetering_Send_GetProfileRsp?relay
   \   000088   7409         MOV     A,#0x9
   \   00008A   12....       LCALL   ?DEALLOC_XSTACK8
   \   00008D   E9           MOV     A,R1
    986          #endif // ZCL_SIMPLE_METERING
    987          }
   \   00008E   7414         MOV     A,#0x14
   \   000090   12....       LCALL   ?DEALLOC_XSTACK8
   \   000093   7F0E         MOV     R7,#0xe
   \   000095   02....       LJMP    ?BANKED_LEAVE_XDATA
    988          
    989          /*********************************************************************
    990           * @fn      simplemeter_GetProfileRspCB
    991           *
    992           * @brief   Callback from the ZCL SE Profile Simple Metering Cluster Library when
    993           *          it received a Get Profile Response for
    994           *          this application.
    995           *
    996           * @param   pCmd - pointer to structure for Get Profile Response command
    997           * @param   srcAddr - pointer to source address
    998           * @param   seqNum - sequence number of this command
    999           *
   1000           * @return  none
   1001           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1002          static void simplemeter_GetProfileRspCB( zclCCGetProfileRsp_t *pCmd,
   \                     simplemeter_GetProfileRspCB:
   1003                                                   afAddrType_t *srcAddr, uint8 seqNum )
   1004          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   1005            // add user code here
   1006          }
   \   000000   02....       LJMP    ?BRET
   1007          
   1008          /*********************************************************************
   1009           * @fn      simplemeter_ReqMirrorRspCB
   1010           *
   1011           * @brief   Callback from the ZCL SE Profile Simple Metering Cluster Library when
   1012           *          it received a Request Mirror Response for
   1013           *          this application.
   1014           *
   1015           * @param   pCmd - pointer to structure for Request Mirror Response command
   1016           * @param   srcAddr - pointer to source address
   1017           * @param   seqNum - sequence number of this command
   1018           *
   1019           * @return  none
   1020           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1021          static void simplemeter_ReqMirrorRspCB( zclCCReqMirrorRsp_t *pCmd,
   \                     simplemeter_ReqMirrorRspCB:
   1022                                                  afAddrType_t *srcAddr, uint8 seqNum )
   1023          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   1024          #if defined ( ZCL_SIMPLE_METERING )
   1025          #if defined ( SE_UK_EXT ) && defined ( SE_MIRROR )
   1026            if ( pCmd != NULL )
   1027            {
   1028              if (pCmd->endpointId == 0xFFFF)
   1029              {
   1030                // The create mirror failed, try another ESP
   1031                // Add user code
   1032              }
   1033              else
   1034              {
   1035                // Record the mirror address and endpoint
   1036                osal_memcpy(&mirrorAddr, srcAddr, sizeof(afAddrType_t));
   1037                mirrorAddr.endPoint = pCmd->endpointId;
   1038          
   1039                // Send a report attribute to the mirror endpoint
   1040                if (pSeReportCmd)
   1041                {
   1042                  zcl_SendReportCmd( SIMPLEMETER_ENDPOINT, &mirrorAddr,
   1043                                     ZCL_CLUSTER_ID_SE_SIMPLE_METERING, pSeReportCmd,
   1044                                     ZCL_FRAME_SERVER_CLIENT_DIR, 1, 0 );
   1045                }
   1046          
   1047                if (pBasicReportCmd)
   1048                {
   1049                  zcl_SendReportCmd( SIMPLEMETER_ENDPOINT, &mirrorAddr,
   1050                                     ZCL_CLUSTER_ID_GEN_BASIC, pBasicReportCmd,
   1051                                     ZCL_FRAME_SERVER_CLIENT_DIR, 1, 0 );
   1052                }
   1053              }
   1054            }
   1055          #endif  // SE_UK_EXT && SE_MIRROR
   1056          #endif  // ZCL_SIMPLE_METERING
   1057          }
   \   000000   02....       LJMP    ?BRET
   1058          
   1059          /*********************************************************************
   1060           * @fn      simplemeter_MirrorRemRspCB
   1061           *
   1062           * @brief   Callback from the ZCL SE Profile Simple Metering Cluster Library when
   1063           *          it received a Mirror Remove Response for
   1064           *          this application.
   1065           *
   1066           * @param   pCmd - pointer to structure for Mirror Remove Response command
   1067           * @param   srcAddr - pointer to source address
   1068           * @param   seqNum - sequence number of this command
   1069           *
   1070           * @return  none
   1071           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1072          static void simplemeter_MirrorRemRspCB( zclCCMirrorRemRsp_t *pCmd,
   \                     simplemeter_MirrorRemRspCB:
   1073                                                  afAddrType_t *srcAddr, uint8 seqNum )
   1074          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   \   000009   8C..         MOV     ?V0 + 0,R4
   \   00000B   8D..         MOV     ?V0 + 1,R5
   \   00000D   89..         MOV     ?V0 + 2,R1
   1075          #if defined ( ZCL_SIMPLE_METERING )
   1076            osal_stop_timerEx( simpleMeterTaskID, SIMPLEMETER_REPORT_ATTRIBUTE_EVT );
   \   00000F                ; Setup parameters for call to function osal_stop_timerEx
   \   00000F   7A08         MOV     R2,#0x8
   \   000011   7B00         MOV     R3,#0x0
   \   000013   90....       MOV     DPTR,#simpleMeterTaskID
   \   000016   E0           MOVX    A,@DPTR
   \   000017   F9           MOV     R1,A
   \   000018   12....       LCALL   ??osal_stop_timerEx?relay
   \   00001B   E9           MOV     A,R1
   1077          #endif  // ZCL_SIMPLE_METERING
   1078          }
   \   00001C   7F03         MOV     R7,#0x3
   \   00001E   02....       LJMP    ?BANKED_LEAVE_XDATA
   1079          
   1080          #if defined ( SE_UK_EXT )
   1081          /*********************************************************************
   1082           * @fn      simplemeter_GetSnapshotCmdCB
   1083           *
   1084           * @brief   Callback from the ZCL SE Profile Simple Metering Cluster Library when
   1085           *          it received a Get Snapshot Command for
   1086           *          this application.
   1087           *
   1088           * @param   pCmd - pointer to structure for Get Snapshot command
   1089           * @param   srcAddr - pointer to source address
   1090           * @param   seqNum - sequence number of this command
   1091           *
   1092           * @return  none
   1093           */
   1094          static void simplemeter_GetSnapshotCmdCB( zclCCReqGetSnapshotCmd_t *pCmd,
   1095                                                    afAddrType_t *srcAddr, uint8 seqNum )
   1096          {
   1097            // add user code here
   1098          }
   1099          
   1100          /*********************************************************************
   1101           * @fn      simplemeter_TakeSnapshotCmdCB
   1102           *
   1103           * @brief   Callback from the ZCL SE Profile Simple Metering Cluster Library when
   1104           *          it received a Take Snapshot Command for
   1105           *          this application.
   1106           *
   1107           * @param   srcAddr - pointer to source address
   1108           * @param   seqNum - sequence number of this command
   1109           *
   1110           * @return  none
   1111           */
   1112          static void simplemeter_TakeSnapshotCmdCB( afAddrType_t *srcAddr, uint8 seqNum )
   1113          {
   1114            // add user code  to store the snapshot
   1115          }
   1116          
   1117          /*********************************************************************
   1118           * @fn      simplemeter_MirrorReportAttrRspCB
   1119           *
   1120           * @brief   Callback from the ZCL SE Profile Simple Metering Cluster Library when
   1121           *          it received a Mirror Report Attribute Response for
   1122           *          this application.
   1123           *
   1124           * @param   pCmd - pointer to structure for Mirror Report Attribute Response command
   1125           * @param   srcAddr - pointer to source address
   1126           * @param   seqNum - sequence number of this command
   1127           *
   1128           * @return  none
   1129           */
   1130          static void simplemeter_MirrorReportAttrRspCB( zclCCReqMirrorReportAttrRsp_t *pCmd,
   1131                                                        afAddrType_t *srcAddr, uint8 seqNum )
   1132          {
   1133            // add user code here
   1134          }
   1135          
   1136          /*********************************************************************
   1137           * @fn      simplemeter_PublishTariffInformationCB
   1138           *
   1139           * @brief   Callback from the ZCL SE Profile Price Cluster Library when
   1140           *          it received a Publish Tariff Information for this application.
   1141           *
   1142           * @param   pCmd - pointer to structure for Publish Tariff Information command
   1143           * @param   srcAddr - pointer to source address
   1144           * @param   seqNum - sequence number of this command
   1145           *
   1146           * @return  none
   1147           */
   1148          static void simplemeter_PublishTariffInformationCB( zclCCPublishTariffInformation_t *pCmd,
   1149                                                              afAddrType_t *srcAddr, uint8 seqNum )
   1150          {
   1151            // add user code here
   1152          }
   1153          
   1154          /*********************************************************************
   1155           * @fn      simplemeter_PublishPriceMatrixCB
   1156           *
   1157           * @brief   Callback from the ZCL SE Profile Price Cluster Library when
   1158           *          it received a Publish Price Matrix for this application.
   1159           *
   1160           * @param   pCmd - pointer to structure for Publish Price Matrix command
   1161           * @param   srcAddr - pointer to source address
   1162           * @param   seqNum - sequence number of this command
   1163           *
   1164           * @return  none
   1165           */
   1166          static void simplemeter_PublishPriceMatrixCB( zclCCPublishPriceMatrix_t *pCmd,
   1167                                                        afAddrType_t *srcAddr, uint8 seqNum )
   1168          {
   1169            // add user code here
   1170          }
   1171          
   1172          /*********************************************************************
   1173           * @fn      simplemeter_PublishBlockThresholdsCB
   1174           *
   1175           * @brief   Callback from the ZCL SE Profile Price Cluster Library when
   1176           *          it received a Publish Block Thresholds for this application.
   1177           *
   1178           * @param   pCmd - pointer to structure for Publish Block Thresholds command
   1179           * @param   srcAddr - pointer to source address
   1180           * @param   seqNum - sequence number of this command
   1181           *
   1182           * @return  none
   1183           */
   1184          static void simplemeter_PublishBlockThresholdsCB( zclCCPublishBlockThresholds_t *pCmd,
   1185                                                            afAddrType_t *srcAddr, uint8 seqNum )
   1186          {
   1187            // add user code here
   1188          }
   1189          
   1190          /*********************************************************************
   1191           * @fn      simplemeter_PublishConversionFactorCB
   1192           *
   1193           * @brief   Callback from the ZCL SE Profile Price Cluster Library when
   1194           *          it received a Publish Conversion Factor for this application.
   1195           *
   1196           * @param   pCmd - pointer to structure for Publish Conversion Factor command
   1197           * @param   srcAddr - pointer to source address
   1198           * @param   seqNum - sequence number of this command
   1199           *
   1200           * @return  none
   1201           */
   1202          static void simplemeter_PublishConversionFactorCB( zclCCPublishConversionFactor_t *pCmd,
   1203                                                             afAddrType_t *srcAddr, uint8 seqNum )
   1204          {
   1205            // add user code here
   1206          }
   1207          
   1208          /*********************************************************************
   1209           * @fn      simplemeter_PublishCalorificValueCB
   1210           *
   1211           * @brief   Callback from the ZCL SE Profile Price Cluster Library when
   1212           *          it received a Publish Calorific Value for this application.
   1213           *
   1214           * @param   pCmd - pointer to structure for Publish Calorific Value command
   1215           * @param   srcAddr - pointer to source address
   1216           * @param   seqNum - sequence number of this command
   1217           *
   1218           * @return  none
   1219           */
   1220          static void simplemeter_PublishCalorificValueCB( zclCCPublishCalorificValue_t *pCmd,
   1221                                                           afAddrType_t *srcAddr, uint8 seqNum )
   1222          {
   1223            // add user code here
   1224          }
   1225          
   1226          /*********************************************************************
   1227           * @fn      simplemeter_PublishCO2ValueCB
   1228           *
   1229           * @brief   Callback from the ZCL SE Profile Price Cluster Library when
   1230           *          it received a Publish CO2 Value for this application.
   1231           *
   1232           * @param   pCmd - pointer to structure for Publish CO2 Value command
   1233           * @param   srcAddr - pointer to source address
   1234           * @param   seqNum - sequence number of this command
   1235           *
   1236           * @return  none
   1237           */
   1238          static void simplemeter_PublishCO2ValueCB( zclCCPublishCO2Value_t *pCmd,
   1239                                                     afAddrType_t *srcAddr, uint8 seqNum )
   1240          {
   1241            // add user code here
   1242          }
   1243          
   1244          /*********************************************************************
   1245           * @fn      simplemeter_PublishCPPEventCB
   1246           *
   1247           * @brief   Callback from the ZCL SE Profile Price Cluster Library when
   1248           *          it received a Publish CPP Event for this application.
   1249           *
   1250           * @param   pCmd - pointer to structure for Publish CPP Event command
   1251           * @param   srcAddr - pointer to source address
   1252           * @param   seqNum - sequence number of this command
   1253           *
   1254           * @return  none
   1255           */
   1256          static void simplemeter_PublishCPPEventCB( zclCCPublishCPPEvent_t *pCmd,
   1257                                                     afAddrType_t *srcAddr, uint8 seqNum )
   1258          {
   1259            // add user code here
   1260          }
   1261          
   1262          /*********************************************************************
   1263           * @fn      simplemeter_PublishBillingPeriodCB
   1264           *
   1265           * @brief   Callback from the ZCL SE Profile Price Cluster Library when
   1266           *          it received a Publish Billing Period for this application.
   1267           *
   1268           * @param   pCmd - pointer to structure for Publish Billing Period command
   1269           * @param   srcAddr - pointer to source address
   1270           * @param   seqNum - sequence number of this command
   1271           *
   1272           * @return  none
   1273           */
   1274          static void simplemeter_PublishBillingPeriodCB( zclCCPublishBillingPeriod_t *pCmd,
   1275                                                          afAddrType_t *srcAddr, uint8 seqNum )
   1276          {
   1277            // add user code here
   1278          }
   1279          
   1280          /*********************************************************************
   1281           * @fn      simplemeter_PublishConsolidatedBillCB
   1282           *
   1283           * @brief   Callback from the ZCL SE Profile Price Cluster Library when
   1284           *          it received a Publish Consolidated Bill for this application.
   1285           *
   1286           * @param   pCmd - pointer to structure for Publish Consolidated Bill command
   1287           * @param   srcAddr - pointer to source address
   1288           * @param   seqNum - sequence number of this command
   1289           *
   1290           * @return  none
   1291           */
   1292          static void simplemeter_PublishConsolidatedBillCB( zclCCPublishConsolidatedBill_t *pCmd,
   1293                                                             afAddrType_t *srcAddr, uint8 seqNum )
   1294          {
   1295            // add user code here
   1296          }
   1297          
   1298          /*********************************************************************
   1299           * @fn      simplemeter_PublishCreditPaymentInfoCB
   1300           *
   1301           * @brief   Callback from the ZCL SE Profile Price Cluster Library when
   1302           *          it received a Publish Credit Payment Info for this application.
   1303           *
   1304           * @param   pCmd - pointer to structure for Publish Credit Payment Info command
   1305           * @param   srcAddr - pointer to source address
   1306           * @param   seqNum - sequence number of this command
   1307           *
   1308           * @return  none
   1309           */
   1310          static void simplemeter_PublishCreditPaymentInfoCB( zclCCPublishCreditPaymentInfo_t *pCmd,
   1311                                                              afAddrType_t *srcAddr, uint8 seqNum )
   1312          {
   1313            // add user code here
   1314          }
   1315          
   1316          /*********************************************************************
   1317           * @fn      simplemeter_ChangeDebtCB
   1318           *
   1319           * @brief   Callback from the ZCL SE Profile Prepayment Cluster Library when
   1320           *          it received a Change Debt for this application.
   1321           *
   1322           * @param   pCmd - pointer to structure for Change Debt command
   1323           * @param   srcAddr - pointer to source address
   1324           * @param   seqNum - sequence number of this command
   1325           *
   1326           * @return  none
   1327           */
   1328          static void simplemeter_ChangeDebtCB( zclCCChangeDebt_t *pCmd,
   1329                                                afAddrType_t *srcAddr, uint8 seqNum )
   1330          {
   1331            // add user code here
   1332          }
   1333          
   1334          /*********************************************************************
   1335           * @fn      simplemeter_EmergencyCreditSetupCB
   1336           *
   1337           * @brief   Callback from the ZCL SE Profile Prepayment Cluster Library when
   1338           *          it received a Emergency Credit Setup for this application.
   1339           *
   1340           * @param   pCmd - pointer to structure for Emergency Credit Setup command
   1341           * @param   srcAddr - pointer to source address
   1342           * @param   seqNum - sequence number of this command
   1343           *
   1344           * @return  none
   1345           */
   1346          static void simplemeter_EmergencyCreditSetupCB( zclCCEmergencyCreditSetup_t *pCmd,
   1347                                                          afAddrType_t *srcAddr, uint8 seqNum )
   1348          {
   1349            // add user code here
   1350          }
   1351          
   1352          /*********************************************************************
   1353           * @fn      simplemeter_ConsumerTopupCB
   1354           *
   1355           * @brief   Callback from the ZCL SE Profile Prepayment Cluster Library when
   1356           *          it received a Consumer Topup for this application.
   1357           *
   1358           * @param   pCmd - pointer to structure for Consumer Topup command
   1359           * @param   srcAddr - pointer to source address
   1360           * @param   seqNum - sequence number of this command
   1361           *
   1362           * @return  none
   1363           */
   1364          static void simplemeter_ConsumerTopupCB( zclCCConsumerTopup_t *pCmd,
   1365                                                   afAddrType_t *srcAddr, uint8 seqNum )
   1366          {
   1367            // add user code here
   1368          }
   1369          
   1370          /*********************************************************************
   1371           * @fn      simplemeter_CreditAdjustmentCB
   1372           *
   1373           * @brief   Callback from the ZCL SE Profile Prepayment Cluster Library when
   1374           *          it received a Credit Adjustment for this application.
   1375           *
   1376           * @param   pCmd - pointer to structure for Credit Adjustment command
   1377           * @param   srcAddr - pointer to source address
   1378           * @param   seqNum - sequence number of this command
   1379           *
   1380           * @return  none
   1381           */
   1382          static void simplemeter_CreditAdjustmentCB( zclCCCreditAdjustment_t *pCmd,
   1383                                                      afAddrType_t *srcAddr, uint8 seqNum )
   1384          {
   1385            // add user code here
   1386          }
   1387          
   1388          /*********************************************************************
   1389           * @fn      simplemeter_ChangePaymentModeCB
   1390           *
   1391           * @brief   Callback from the ZCL SE Profile Prepayment Cluster Library when
   1392           *          it received a Change Payment Mode for this application.
   1393           *
   1394           * @param   pCmd - pointer to structure for Change Payment Mode command
   1395           * @param   srcAddr - pointer to source address
   1396           * @param   seqNum - sequence number of this command
   1397           *
   1398           * @return  none
   1399           */
   1400          static void simplemeter_ChangePaymentModeCB( zclCCChangePaymentMode_t *pCmd,
   1401                                                       afAddrType_t *srcAddr, uint8 seqNum )
   1402          {
   1403            // add user code here
   1404          }
   1405          
   1406          /*********************************************************************
   1407           * @fn      simplemeter_GetPrepaySnapshotCB
   1408           *
   1409           * @brief   Callback from the ZCL SE Profile Prepayment Cluster Library when
   1410           *          it received a Get Prepay Snapshot for this application.
   1411           *
   1412           * @param   pCmd - pointer to structure for Get Prepay Snapshot command
   1413           * @param   srcAddr - pointer to source address
   1414           * @param   seqNum - sequence number of this command
   1415           *
   1416           * @return  none
   1417           */
   1418          static void simplemeter_GetPrepaySnapshotCB( zclCCGetPrepaySnapshot_t *pCmd,
   1419                                                       afAddrType_t *srcAddr, uint8 seqNum )
   1420          {
   1421            // add user code here
   1422          }
   1423          
   1424          /*********************************************************************
   1425           * @fn      simplemeter_GetTopupLogCB
   1426           *
   1427           * @brief   Callback from the ZCL SE Profile Prepayment Cluster Library when
   1428           *          it received a Get Topup Log for this application.
   1429           *
   1430           * @param   numEvents - number of events
   1431           * @param   srcAddr - pointer to source address
   1432           * @param   seqNum - sequence number of this command
   1433           *
   1434           * @return  none
   1435           */
   1436          static void simplemeter_GetTopupLogCB( uint8 numEvents,
   1437                                                 afAddrType_t *srcAddr, uint8 seqNum )
   1438          {
   1439            // add user code here
   1440          }
   1441          
   1442          /*********************************************************************
   1443           * @fn      simplemeter_SetLowCreditWarningLevelCB
   1444           *
   1445           * @brief   Callback from the ZCL SE Profile Prepayment Cluster Library when
   1446           *          it received a Set Low Credit Warning Level for this application.
   1447           *
   1448           * @param   numEvents - number of events
   1449           * @param   srcAddr - pointer to source address
   1450           * @param   seqNum - sequence number of this command
   1451           *
   1452           * @return  none
   1453           */
   1454          static void simplemeter_SetLowCreditWarningLevelCB( uint8 numEvents,
   1455                                                              afAddrType_t *srcAddr, uint8 seqNum )
   1456          {
   1457            // add user code here
   1458          }
   1459          
   1460          /*********************************************************************
   1461           * @fn      simplemeter_GetDebtRepaymentLogCB
   1462           *
   1463           * @brief   Callback from the ZCL SE Profile Prepayment Cluster Library when
   1464           *          it received a Get Debt Repayment Log for this application.
   1465           *
   1466           * @param   pCmd - pointer to structure for Get Debt Repayment Log command
   1467           * @param   srcAddr - pointer to source address
   1468           * @param   seqNum - sequence number of this command
   1469           *
   1470           * @return  none
   1471           */
   1472          static void simplemeter_GetDebtRepaymentLogCB( zclCCGetDebtRepaymentLog_t *pCmd,
   1473                                                         afAddrType_t *srcAddr, uint8 seqNum )
   1474          {
   1475            // add user code here
   1476          }
   1477          #endif  // SE_UK_EXT
   1478          
   1479          /******************************************************************************
   1480           *
   1481           *  Functions for processing ZCL Foundation incoming Command/Response messages
   1482           *
   1483           *****************************************************************************/
   1484          
   1485          /*********************************************************************
   1486           * @fn      simplemeter_ProcessZCLMsg
   1487           *
   1488           * @brief   Process ZCL Foundation incoming message
   1489           *
   1490           * @param   pInMsg - message to process
   1491           *
   1492           * @return  none
   1493           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1494          static void simplemeter_ProcessZCLMsg( zclIncomingMsg_t *pInMsg )
   \                     simplemeter_ProcessZCLMsg:
   1495          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   1496            switch ( pInMsg->zclHdr.commandID )
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   A3           INC     DPTR
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   A3           INC     DPTR
   \   000011   A3           INC     DPTR
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   E0           MOVX    A,@DPTR
   \   000015   14           DEC     A
   \   000016   6019         JZ      ??simplemeter_ProcessZCLMsg_0
   \   000018   24FD         ADD     A,#-0x3
   \   00001A   601F         JZ      ??simplemeter_ProcessZCLMsg_1
   \   00001C   24FE         ADD     A,#-0x2
   \   00001E   6025         JZ      ??simplemeter_ProcessZCLMsg_2
   \   000020   14           DEC     A
   \   000021   602C         JZ      ??simplemeter_ProcessZCLMsg_3
   \   000023   14           DEC     A
   \   000024   6033         JZ      ??simplemeter_ProcessZCLMsg_4
   \   000026   14           DEC     A
   \   000027   603A         JZ      ??simplemeter_ProcessZCLMsg_5
   \   000029   14           DEC     A
   \   00002A   6041         JZ      ??simplemeter_ProcessZCLMsg_6
   \   00002C   14           DEC     A
   \   00002D   6048         JZ      ??simplemeter_ProcessZCLMsg_7
   \   00002F   804E         SJMP    ??simplemeter_ProcessZCLMsg_8
   1497            {
   1498          #if defined ( ZCL_READ )
   1499              case ZCL_CMD_READ_RSP:
   1500                simplemeter_ProcessInReadRspCmd( pInMsg );
   \                     ??simplemeter_ProcessZCLMsg_0:
   \   000031                ; Setup parameters for call to function simplemeter_ProcessInReadRspCmd
   \   000031   EE           MOV     A,R6
   \   000032   FA           MOV     R2,A
   \   000033   EF           MOV     A,R7
   \   000034   FB           MOV     R3,A
   \   000035   12....       LCALL   ??simplemeter_ProcessInReadRspCmd?relay
   \   000038   E9           MOV     A,R1
   1501                break;
   \   000039   8044         SJMP    ??simplemeter_ProcessZCLMsg_8
   1502          #endif // ZCL_READ
   1503          #if defined ( ZCL_WRITE )
   1504              case ZCL_CMD_WRITE_RSP:
   1505                simplemeter_ProcessInWriteRspCmd( pInMsg );
   \                     ??simplemeter_ProcessZCLMsg_1:
   \   00003B                ; Setup parameters for call to function simplemeter_ProcessInWriteRspCmd
   \   00003B   EE           MOV     A,R6
   \   00003C   FA           MOV     R2,A
   \   00003D   EF           MOV     A,R7
   \   00003E   FB           MOV     R3,A
   \   00003F   12....       LCALL   ??simplemeter_ProcessInWriteRspCmd?relay
   \   000042   E9           MOV     A,R1
   1506                break;
   \   000043   803A         SJMP    ??simplemeter_ProcessZCLMsg_8
   1507          #endif // ZCL_READ
   1508          #if defined ( ZCL_REPORT )
   1509              case ZCL_CMD_CONFIG_REPORT:
   1510                simplemeter_ProcessInConfigReportCmd( pInMsg );
   \                     ??simplemeter_ProcessZCLMsg_2:
   \   000045                ; Setup parameters for call to function simplemeter_ProcessInConfigReportCmd
   \   000045   EE           MOV     A,R6
   \   000046   FA           MOV     R2,A
   \   000047   EF           MOV     A,R7
   \   000048   FB           MOV     R3,A
   \   000049   12....       LCALL   ??simplemeter_ProcessInConfigReportCmd?relay
   \   00004C   E9           MOV     A,R1
   1511                break;
   \   00004D   8030         SJMP    ??simplemeter_ProcessZCLMsg_8
   1512          
   1513              case ZCL_CMD_CONFIG_REPORT_RSP:
   1514                simplemeter_ProcessInConfigReportRspCmd( pInMsg );
   \                     ??simplemeter_ProcessZCLMsg_3:
   \   00004F                ; Setup parameters for call to function simplemeter_ProcessInConfigReportRspCmd
   \   00004F   EE           MOV     A,R6
   \   000050   FA           MOV     R2,A
   \   000051   EF           MOV     A,R7
   \   000052   FB           MOV     R3,A
   \   000053   12....       LCALL   ??simplemeter_ProcessInConfigReportRspCmd?relay
   \   000056   E9           MOV     A,R1
   1515                break;
   \   000057   8026         SJMP    ??simplemeter_ProcessZCLMsg_8
   1516          
   1517              case ZCL_CMD_READ_REPORT_CFG:
   1518                simplemeter_ProcessInReadReportCfgCmd( pInMsg );
   \                     ??simplemeter_ProcessZCLMsg_4:
   \   000059                ; Setup parameters for call to function simplemeter_ProcessInReadReportCfgCmd
   \   000059   EE           MOV     A,R6
   \   00005A   FA           MOV     R2,A
   \   00005B   EF           MOV     A,R7
   \   00005C   FB           MOV     R3,A
   \   00005D   12....       LCALL   ??simplemeter_ProcessInReadReportCfgCmd?relay
   \   000060   E9           MOV     A,R1
   1519                break;
   \   000061   801C         SJMP    ??simplemeter_ProcessZCLMsg_8
   1520          
   1521              case ZCL_CMD_READ_REPORT_CFG_RSP:
   1522                simplemeter_ProcessInReadReportCfgRspCmd( pInMsg );
   \                     ??simplemeter_ProcessZCLMsg_5:
   \   000063                ; Setup parameters for call to function simplemeter_ProcessInReadReportCfgRspCmd
   \   000063   EE           MOV     A,R6
   \   000064   FA           MOV     R2,A
   \   000065   EF           MOV     A,R7
   \   000066   FB           MOV     R3,A
   \   000067   12....       LCALL   ??simplemeter_ProcessInReadReportCfgRspCmd?rela
   \   00006A   E9           MOV     A,R1
   1523                break;
   \   00006B   8012         SJMP    ??simplemeter_ProcessZCLMsg_8
   1524          
   1525              case ZCL_CMD_REPORT:
   1526                simplemeter_ProcessInReportCmd( pInMsg );
   \                     ??simplemeter_ProcessZCLMsg_6:
   \   00006D                ; Setup parameters for call to function simplemeter_ProcessInReportCmd
   \   00006D   EE           MOV     A,R6
   \   00006E   FA           MOV     R2,A
   \   00006F   EF           MOV     A,R7
   \   000070   FB           MOV     R3,A
   \   000071   12....       LCALL   ??simplemeter_ProcessInReportCmd?relay
   \   000074   E9           MOV     A,R1
   1527                break;
   \   000075   8008         SJMP    ??simplemeter_ProcessZCLMsg_8
   1528          #endif // ZCL_REPORT
   1529              case ZCL_CMD_DEFAULT_RSP:
   1530                simplemeter_ProcessInDefaultRspCmd( pInMsg );
   \                     ??simplemeter_ProcessZCLMsg_7:
   \   000077                ; Setup parameters for call to function simplemeter_ProcessInDefaultRspCmd
   \   000077   EE           MOV     A,R6
   \   000078   FA           MOV     R2,A
   \   000079   EF           MOV     A,R7
   \   00007A   FB           MOV     R3,A
   \   00007B   12....       LCALL   ??simplemeter_ProcessInDefaultRspCmd?relay
   \   00007E   E9           MOV     A,R1
   1531                break;
   1532          #if defined ( ZCL_DISCOVER )
   1533              case ZCL_CMD_DISCOVER_RSP:
   1534                simplemeter_ProcessInDiscRspCmd( pInMsg );
   1535                break;
   1536          #endif // ZCL_DISCOVER
   1537              default:
   1538                break;
   1539            }
   1540          
   1541            if ( pInMsg->attrCmd != NULL )
   \                     ??simplemeter_ProcessZCLMsg_8:
   \   00007F   EE           MOV     A,R6
   \   000080   2417         ADD     A,#0x17
   \   000082   F582         MOV     DPL,A
   \   000084   EF           MOV     A,R7
   \   000085   3400         ADDC    A,#0x0
   \   000087   F583         MOV     DPH,A
   \   000089   E0           MOVX    A,@DPTR
   \   00008A   F8           MOV     R0,A
   \   00008B   A3           INC     DPTR
   \   00008C   E0           MOVX    A,@DPTR
   \   00008D   F9           MOV     R1,A
   \   00008E   E8           MOV     A,R0
   \   00008F   49           ORL     A,R1
   \   000090   6023         JZ      ??simplemeter_ProcessZCLMsg_9
   1542            {
   1543              // free the parsed command
   1544              osal_mem_free( pInMsg->attrCmd );
   \   000092                ; Setup parameters for call to function osal_mem_free
   \   000092   EE           MOV     A,R6
   \   000093   2417         ADD     A,#0x17
   \   000095   F582         MOV     DPL,A
   \   000097   EF           MOV     A,R7
   \   000098   3400         ADDC    A,#0x0
   \   00009A   F583         MOV     DPH,A
   \   00009C   E0           MOVX    A,@DPTR
   \   00009D   FA           MOV     R2,A
   \   00009E   A3           INC     DPTR
   \   00009F   E0           MOVX    A,@DPTR
   \   0000A0   FB           MOV     R3,A
   \   0000A1   12....       LCALL   ??osal_mem_free?relay
   1545              pInMsg->attrCmd = NULL;
   \   0000A4   EE           MOV     A,R6
   \   0000A5   2417         ADD     A,#0x17
   \   0000A7   F582         MOV     DPL,A
   \   0000A9   EF           MOV     A,R7
   \   0000AA   3400         ADDC    A,#0x0
   \   0000AC   F583         MOV     DPH,A
   \   0000AE   7400         MOV     A,#0x0
   \   0000B0   F0           MOVX    @DPTR,A
   \   0000B1   A3           INC     DPTR
   \   0000B2   7400         MOV     A,#0x0
   \   0000B4   F0           MOVX    @DPTR,A
   1546            }
   1547          }
   \                     ??simplemeter_ProcessZCLMsg_9:
   \   0000B5   7F01         MOV     R7,#0x1
   \   0000B7   02....       LJMP    ?BANKED_LEAVE_XDATA
   1548          
   1549          #if defined ( ZCL_READ )
   1550          /*********************************************************************
   1551           * @fn      simplemeter_ProcessInReadRspCmd
   1552           *
   1553           * @brief   Process the "Profile" Read Response Command
   1554           *
   1555           * @param   pInMsg - incoming message to process
   1556           *
   1557           * @return  none
   1558           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1559          static uint8 simplemeter_ProcessInReadRspCmd( zclIncomingMsg_t *pInMsg )
   \                     simplemeter_ProcessInReadRspCmd:
   1560          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   1561            zclReadRspCmd_t *readRspCmd;
   1562            uint8 i;
   1563          
   1564            readRspCmd = (zclReadRspCmd_t *)pInMsg->attrCmd;
   \   000005   EA           MOV     A,R2
   \   000006   2417         ADD     A,#0x17
   \   000008   F582         MOV     DPL,A
   \   00000A   EB           MOV     A,R3
   \   00000B   3400         ADDC    A,#0x0
   \   00000D   F583         MOV     DPH,A
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   F8           MOV     R0,A
   \   000011   A3           INC     DPTR
   \   000012   E0           MOVX    A,@DPTR
   \   000013   F9           MOV     R1,A
   \   000014   E8           MOV     A,R0
   \   000015   FE           MOV     R6,A
   \   000016   E9           MOV     A,R1
   \   000017   FF           MOV     R7,A
   1565            for (i = 0; i < readRspCmd->numAttr; i++)
   \   000018   7C00         MOV     R4,#0x0
   \                     ??simplemeter_ProcessInReadRspCmd_0:
   \   00001A   8E82         MOV     DPL,R6
   \   00001C   8F83         MOV     DPH,R7
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   F8           MOV     R0,A
   \   000020   EC           MOV     A,R4
   \   000021   C3           CLR     C
   \   000022   98           SUBB    A,R0
   \   000023   5003         JNC     ??simplemeter_ProcessInReadRspCmd_1
   \   000025   0C           INC     R4
   \   000026   80F2         SJMP    ??simplemeter_ProcessInReadRspCmd_0
   1566            {
   1567              // Notify the originator of the results of the original read attributes
   1568              // attempt and, for each successfull request, the value of the requested
   1569              // attribute
   1570            }
   1571          
   1572            return TRUE;
   \                     ??simplemeter_ProcessInReadRspCmd_1:
   \   000028   7901         MOV     R1,#0x1
   \   00002A   7F01         MOV     R7,#0x1
   \   00002C   02....       LJMP    ?BANKED_LEAVE_XDATA
   1573          }
   1574          #endif // ZCL_READ
   1575          
   1576          #if defined ( ZCL_WRITE )
   1577          /*********************************************************************
   1578           * @fn      simplemeter_ProcessInWriteRspCmd
   1579           *
   1580           * @brief   Process the "Profile" Write Response Command
   1581           *
   1582           * @param   pInMsg - incoming message to process
   1583           *
   1584           * @return  none
   1585           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1586          static uint8 simplemeter_ProcessInWriteRspCmd( zclIncomingMsg_t *pInMsg )
   \                     simplemeter_ProcessInWriteRspCmd:
   1587          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   1588            zclWriteRspCmd_t *writeRspCmd;
   1589            uint8 i;
   1590          
   1591            writeRspCmd = (zclWriteRspCmd_t *)pInMsg->attrCmd;
   \   000005   EA           MOV     A,R2
   \   000006   2417         ADD     A,#0x17
   \   000008   F582         MOV     DPL,A
   \   00000A   EB           MOV     A,R3
   \   00000B   3400         ADDC    A,#0x0
   \   00000D   F583         MOV     DPH,A
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   F8           MOV     R0,A
   \   000011   A3           INC     DPTR
   \   000012   E0           MOVX    A,@DPTR
   \   000013   F9           MOV     R1,A
   \   000014   E8           MOV     A,R0
   \   000015   FE           MOV     R6,A
   \   000016   E9           MOV     A,R1
   \   000017   FF           MOV     R7,A
   1592            for (i = 0; i < writeRspCmd->numAttr; i++)
   \   000018   7C00         MOV     R4,#0x0
   \                     ??simplemeter_ProcessInWriteRspCmd_0:
   \   00001A   8E82         MOV     DPL,R6
   \   00001C   8F83         MOV     DPH,R7
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   F8           MOV     R0,A
   \   000020   EC           MOV     A,R4
   \   000021   C3           CLR     C
   \   000022   98           SUBB    A,R0
   \   000023   5003         JNC     ??simplemeter_ProcessInWriteRspCmd_1
   \   000025   0C           INC     R4
   \   000026   80F2         SJMP    ??simplemeter_ProcessInWriteRspCmd_0
   1593            {
   1594              // Notify the device of the results of the its original write attributes
   1595              // command.
   1596            }
   1597          
   1598            return TRUE;
   \                     ??simplemeter_ProcessInWriteRspCmd_1:
   \   000028   7901         MOV     R1,#0x1
   \   00002A   7F01         MOV     R7,#0x1
   \   00002C   02....       LJMP    ?BANKED_LEAVE_XDATA
   1599          }
   1600          #endif // ZCL_WRITE
   1601          
   1602          #if defined ( ZCL_REPORT )
   1603          /*********************************************************************
   1604           * @fn      simplemeter_ProcessInConfigReportCmd
   1605           *
   1606           * @brief   Process the "Profile" Configure Reporting Command
   1607           *
   1608           * @param   pInMsg - incoming message to process
   1609           *
   1610           * @return  TRUE if attribute was found in the Attribute list,
   1611           *          FALSE if not
   1612           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1613          static uint8 simplemeter_ProcessInConfigReportCmd( zclIncomingMsg_t *pInMsg )
   \                     simplemeter_ProcessInConfigReportCmd:
   1614          {
   \   000000   74EC         MOV     A,#-0x14
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 20
   \   000005                ; Auto size: 8
   \   000005   74F8         MOV     A,#-0x8
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 4,R2
   \   00000C   8B..         MOV     ?V0 + 5,R3
   1615            zclCfgReportCmd_t *cfgReportCmd;
   1616            zclCfgReportRec_t *reportRec;
   1617            zclCfgReportRspCmd_t *cfgReportRspCmd;
   1618            zclAttrRec_t attrRec;
   1619            uint8 status;
   1620            uint8 i, j = 0;
   \   00000E   7E00         MOV     R6,#0x0
   1621          
   1622            cfgReportCmd = (zclCfgReportCmd_t *)pInMsg->attrCmd;
   \   000010   E5..         MOV     A,?V0 + 4
   \   000012   2417         ADD     A,#0x17
   \   000014   F582         MOV     DPL,A
   \   000016   E5..         MOV     A,?V0 + 5
   \   000018   3400         ADDC    A,#0x0
   \   00001A   F583         MOV     DPH,A
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F8           MOV     R0,A
   \   00001E   A3           INC     DPTR
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   F9           MOV     R1,A
   \   000021   88..         MOV     ?V0 + 6,R0
   \   000023   89..         MOV     ?V0 + 7,R1
   1623          
   1624            // Allocate space for the response command
   1625            cfgReportRspCmd = (zclCfgReportRspCmd_t *)osal_mem_alloc( sizeof ( zclCfgReportRspCmd_t ) + \
   1626                                                  sizeof ( zclCfgReportStatus_t) * cfgReportCmd->numAttr );
   \   000025                ; Setup parameters for call to function osal_mem_alloc
   \   000025   85..82       MOV     DPL,?V0 + 6
   \   000028   85..83       MOV     DPH,?V0 + 7
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   F8           MOV     R0,A
   \   00002D   7900         MOV     R1,#0x0
   \   00002F   E8           MOV     A,R0
   \   000030   75F004       MOV     B,#0x4
   \   000033   A4           MUL     AB
   \   000034   C8           XCH     A,R0
   \   000035   AAF0         MOV     R2,B
   \   000037   75F000       MOV     B,#0x0
   \   00003A   A4           MUL     AB
   \   00003B   2A           ADD     A,R2
   \   00003C   FA           MOV     R2,A
   \   00003D   75F004       MOV     B,#0x4
   \   000040   E9           MOV     A,R1
   \   000041   A4           MUL     AB
   \   000042   2A           ADD     A,R2
   \   000043   F9           MOV     R1,A
   \   000044   E8           MOV     A,R0
   \   000045   2401         ADD     A,#0x1
   \   000047   FA           MOV     R2,A
   \   000048   E9           MOV     A,R1
   \   000049   3400         ADDC    A,#0x0
   \   00004B   FB           MOV     R3,A
   \   00004C   12....       LCALL   ??osal_mem_alloc?relay
   \   00004F   8A..         MOV     ?V0 + 10,R2
   \   000051   8B..         MOV     ?V0 + 11,R3
   \   000053   85....       MOV     ?V0 + 8,?V0 + 10
   \   000056   85....       MOV     ?V0 + 9,?V0 + 11
   1627            if ( cfgReportRspCmd == NULL )
   \   000059   E5..         MOV     A,?V0 + 8
   \   00005B   45..         ORL     A,?V0 + 9
   \   00005D   7005         JNZ     ??simplemeter_ProcessInConfigReportCmd_0
   1628              return FALSE; // EMBEDDED RETURN
   \   00005F   7900         MOV     R1,#0x0
   \   000061   02....       LJMP    ??simplemeter_ProcessInConfigReportCmd_1 & 0xFFFF
   1629          
   1630            // Process each Attribute Reporting Configuration record
   1631            for ( i = 0; i < cfgReportCmd->numAttr; i++ )
   \                     ??simplemeter_ProcessInConfigReportCmd_0:
   \   000064   75..00       MOV     ?V0 + 2,#0x0
   \                     ??simplemeter_ProcessInConfigReportCmd_2:
   \   000067   85..82       MOV     DPL,?V0 + 6
   \   00006A   85..83       MOV     DPH,?V0 + 7
   \   00006D   E0           MOVX    A,@DPTR
   \   00006E   F8           MOV     R0,A
   \   00006F   E5..         MOV     A,?V0 + 2
   \   000071   C3           CLR     C
   \   000072   98           SUBB    A,R0
   \   000073   4003         JC      $+5
   \   000075   02....       LJMP    ??simplemeter_ProcessInConfigReportCmd_3 & 0xFFFF
   1632            {
   1633              reportRec = &(cfgReportCmd->attrList[i]);
   \   000078   E5..         MOV     A,?V0 + 2
   \   00007A   A8..         MOV     R0,?V0 + 2
   \   00007C   7900         MOV     R1,#0x0
   \   00007E   E8           MOV     A,R0
   \   00007F   75F00C       MOV     B,#0xc
   \   000082   A4           MUL     AB
   \   000083   C8           XCH     A,R0
   \   000084   AAF0         MOV     R2,B
   \   000086   75F000       MOV     B,#0x0
   \   000089   A4           MUL     AB
   \   00008A   2A           ADD     A,R2
   \   00008B   FA           MOV     R2,A
   \   00008C   75F00C       MOV     B,#0xc
   \   00008F   E9           MOV     A,R1
   \   000090   A4           MUL     AB
   \   000091   2A           ADD     A,R2
   \   000092   F9           MOV     R1,A
   \   000093   E5..         MOV     A,?V0 + 6
   \   000095   28           ADD     A,R0
   \   000096   F582         MOV     DPL,A
   \   000098   E5..         MOV     A,?V0 + 7
   \   00009A   39           ADDC    A,R1
   \   00009B   F583         MOV     DPH,A
   \   00009D   A3           INC     DPTR
   \   00009E   8582..       MOV     ?V0 + 0,DPL
   \   0000A1   8583..       MOV     ?V0 + 1,DPH
   1634          
   1635              status = ZCL_STATUS_SUCCESS;
   \   0000A4   7F00         MOV     R7,#0x0
   1636          
   1637              if ( zclFindAttrRec( SIMPLEMETER_ENDPOINT, pInMsg->clusterId, reportRec->attrID, &attrRec ) )
   \   0000A6                ; Setup parameters for call to function zclFindAttrRec
   \   0000A6   85..82       MOV     DPL,?XSP + 0
   \   0000A9   85..83       MOV     DPH,?XSP + 1
   \   0000AC   8582..       MOV     ?V0 + 10,DPL
   \   0000AF   8583..       MOV     ?V0 + 11,DPH
   \   0000B2   78..         MOV     R0,#?V0 + 10
   \   0000B4   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000B7   85..82       MOV     DPL,?V0 + 0
   \   0000BA   85..83       MOV     DPH,?V0 + 1
   \   0000BD   A3           INC     DPTR
   \   0000BE   E0           MOVX    A,@DPTR
   \   0000BF   FC           MOV     R4,A
   \   0000C0   A3           INC     DPTR
   \   0000C1   E0           MOVX    A,@DPTR
   \   0000C2   FD           MOV     R5,A
   \   0000C3   85..82       MOV     DPL,?V0 + 4
   \   0000C6   85..83       MOV     DPH,?V0 + 5
   \   0000C9   A3           INC     DPTR
   \   0000CA   A3           INC     DPTR
   \   0000CB   A3           INC     DPTR
   \   0000CC   A3           INC     DPTR
   \   0000CD   A3           INC     DPTR
   \   0000CE   A3           INC     DPTR
   \   0000CF   A3           INC     DPTR
   \   0000D0   A3           INC     DPTR
   \   0000D1   E0           MOVX    A,@DPTR
   \   0000D2   FA           MOV     R2,A
   \   0000D3   A3           INC     DPTR
   \   0000D4   E0           MOVX    A,@DPTR
   \   0000D5   FB           MOV     R3,A
   \   0000D6   7909         MOV     R1,#0x9
   \   0000D8   12....       LCALL   ??zclFindAttrRec?relay
   \   0000DB   7402         MOV     A,#0x2
   \   0000DD   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000E0   E9           MOV     A,R1
   \   0000E1   7003         JNZ     $+5
   \   0000E3   02....       LJMP    ??simplemeter_ProcessInConfigReportCmd_4 & 0xFFFF
   1638              {
   1639                if ( reportRec->direction == ZCL_SEND_ATTR_REPORTS )
   \   0000E6   85..82       MOV     DPL,?V0 + 0
   \   0000E9   85..83       MOV     DPH,?V0 + 1
   \   0000EC   E0           MOVX    A,@DPTR
   \   0000ED   6003         JZ      $+5
   \   0000EF   02....       LJMP    ??simplemeter_ProcessInConfigReportCmd_5 & 0xFFFF
   1640                {
   1641                  if ( reportRec->dataType == attrRec.attr.dataType )
   \   0000F2   85..82       MOV     DPL,?V0 + 0
   \   0000F5   85..83       MOV     DPH,?V0 + 1
   \   0000F8   A3           INC     DPTR
   \   0000F9   A3           INC     DPTR
   \   0000FA   A3           INC     DPTR
   \   0000FB   E0           MOVX    A,@DPTR
   \   0000FC   F8           MOV     R0,A
   \   0000FD   7404         MOV     A,#0x4
   \   0000FF   12....       LCALL   ?XSTACK_DISP0_8
   \   000102   E0           MOVX    A,@DPTR
   \   000103   68           XRL     A,R0
   \   000104   706C         JNZ     ??simplemeter_ProcessInConfigReportCmd_6
   1642                  {
   1643                    // This the attribute that is to be reported
   1644                    if ( zcl_MandatoryReportableAttribute( &attrRec ) == TRUE )
   \   000106   85..82       MOV     DPL,?XSP + 0
   \   000109   85..83       MOV     DPH,?XSP + 1
   \   00010C   E582         MOV     A,DPL
   \   00010E   4583         ORL     A,DPH
   \   000110   705C         JNZ     ??simplemeter_ProcessInConfigReportCmd_7
   1645                    {
   1646                      if ( reportRec->minReportInt < SIMPLEMETER_MIN_REPORTING_INTERVAL ||
   1647                           ( reportRec->maxReportInt != 0 &&
   1648                             reportRec->maxReportInt < reportRec->minReportInt ) )
   \   000112   85..82       MOV     DPL,?V0 + 0
   \   000115   85..83       MOV     DPH,?V0 + 1
   \   000118   A3           INC     DPTR
   \   000119   A3           INC     DPTR
   \   00011A   A3           INC     DPTR
   \   00011B   A3           INC     DPTR
   \   00011C   C3           CLR     C
   \   00011D   E0           MOVX    A,@DPTR
   \   00011E   9405         SUBB    A,#0x5
   \   000120   A3           INC     DPTR
   \   000121   E0           MOVX    A,@DPTR
   \   000122   9400         SUBB    A,#0x0
   \   000124   4040         JC      ??simplemeter_ProcessInConfigReportCmd_8
   \   000126   85..82       MOV     DPL,?V0 + 0
   \   000129   85..83       MOV     DPH,?V0 + 1
   \   00012C   A3           INC     DPTR
   \   00012D   A3           INC     DPTR
   \   00012E   A3           INC     DPTR
   \   00012F   A3           INC     DPTR
   \   000130   A3           INC     DPTR
   \   000131   A3           INC     DPTR
   \   000132   E0           MOVX    A,@DPTR
   \   000133   F8           MOV     R0,A
   \   000134   A3           INC     DPTR
   \   000135   E0           MOVX    A,@DPTR
   \   000136   F9           MOV     R1,A
   \   000137   E8           MOV     A,R0
   \   000138   49           ORL     A,R1
   \   000139   602F         JZ      ??simplemeter_ProcessInConfigReportCmd_9
   \   00013B   85..82       MOV     DPL,?V0 + 0
   \   00013E   85..83       MOV     DPH,?V0 + 1
   \   000141   A3           INC     DPTR
   \   000142   A3           INC     DPTR
   \   000143   A3           INC     DPTR
   \   000144   A3           INC     DPTR
   \   000145   A3           INC     DPTR
   \   000146   A3           INC     DPTR
   \   000147   C082         PUSH    DPL
   \   000149   C083         PUSH    DPH
   \   00014B   85..82       MOV     DPL,?V0 + 0
   \   00014E   85..83       MOV     DPH,?V0 + 1
   \   000151   A3           INC     DPTR
   \   000152   A3           INC     DPTR
   \   000153   A3           INC     DPTR
   \   000154   A3           INC     DPTR
   \   000155   E0           MOVX    A,@DPTR
   \   000156   F8           MOV     R0,A
   \   000157   A3           INC     DPTR
   \   000158   E0           MOVX    A,@DPTR
   \   000159   F9           MOV     R1,A
   \   00015A   D083         POP     DPH
   \   00015C   D082         POP     DPL
   \   00015E   C3           CLR     C
   \   00015F   E0           MOVX    A,@DPTR
   \   000160   98           SUBB    A,R0
   \   000161   A3           INC     DPTR
   \   000162   E0           MOVX    A,@DPTR
   \   000163   99           SUBB    A,R1
   \   000164   5004         JNC     ??simplemeter_ProcessInConfigReportCmd_9
   1649                      {
   1650                        // Invalid fields
   1651                        status = ZCL_STATUS_INVALID_VALUE;
   \                     ??simplemeter_ProcessInConfigReportCmd_8:
   \   000166   7F87         MOV     R7,#-0x79
   \   000168   8022         SJMP    ??simplemeter_ProcessInConfigReportCmd_10
   1652                      }
   1653                      else
   1654                      {
   1655                        // Set the Min and Max Reporting Intervals and Reportable Change
   1656                        //status = zclSetAttrReportInterval( pAttr, cfgReportCmd );
   1657                        status = ZCL_STATUS_UNREPORTABLE_ATTRIBUTE; // for now
   \                     ??simplemeter_ProcessInConfigReportCmd_9:
   \   00016A   7F8C         MOV     R7,#-0x74
   \   00016C   801E         SJMP    ??simplemeter_ProcessInConfigReportCmd_10
   1658                      }
   1659                    }
   1660                    else
   1661                    {
   1662                      // Attribute cannot be reported
   1663                      status = ZCL_STATUS_UNREPORTABLE_ATTRIBUTE;
   \                     ??simplemeter_ProcessInConfigReportCmd_7:
   \   00016E   7F8C         MOV     R7,#-0x74
   \   000170   801A         SJMP    ??simplemeter_ProcessInConfigReportCmd_10
   1664                    }
   1665                  }
   1666                  else
   1667                  {
   1668                    // Attribute data type is incorrect
   1669                    status = ZCL_STATUS_INVALID_DATA_TYPE;
   \                     ??simplemeter_ProcessInConfigReportCmd_6:
   \   000172   7F8D         MOV     R7,#-0x73
   \   000174   8016         SJMP    ??simplemeter_ProcessInConfigReportCmd_10
   1670                  }
   1671                }
   1672                else
   1673                {
   1674                  // We shall expect reports of values of this attribute
   1675                  if ( zcl_MandatoryReportableAttribute( &attrRec ) == TRUE )
   \                     ??simplemeter_ProcessInConfigReportCmd_5:
   \   000176   85..82       MOV     DPL,?XSP + 0
   \   000179   85..83       MOV     DPH,?XSP + 1
   \   00017C   E582         MOV     A,DPL
   \   00017E   4583         ORL     A,DPH
   \   000180   7004         JNZ     ??simplemeter_ProcessInConfigReportCmd_11
   1676                  {
   1677                    // Set the Timeout Period
   1678                    //status = zclSetAttrTimeoutPeriod( pAttr, cfgReportCmd );
   1679                    status = ZCL_STATUS_UNSUPPORTED_ATTRIBUTE; // for now
   \   000182   7F86         MOV     R7,#-0x7a
   \   000184   8006         SJMP    ??simplemeter_ProcessInConfigReportCmd_10
   1680                  }
   1681                  else
   1682                  {
   1683                    // Reports of attribute cannot be received
   1684                    status = ZCL_STATUS_UNSUPPORTED_ATTRIBUTE;
   \                     ??simplemeter_ProcessInConfigReportCmd_11:
   \   000186   7F86         MOV     R7,#-0x7a
   \   000188   8002         SJMP    ??simplemeter_ProcessInConfigReportCmd_10
   1685                  }
   1686                }
   1687              }
   1688              else
   1689              {
   1690                // Attribute is not supported
   1691                status = ZCL_STATUS_UNSUPPORTED_ATTRIBUTE;
   \                     ??simplemeter_ProcessInConfigReportCmd_4:
   \   00018A   7F86         MOV     R7,#-0x7a
   1692              }
   1693          
   1694              // If not successful then record the status
   1695              if ( status != ZCL_STATUS_SUCCESS )
   \                     ??simplemeter_ProcessInConfigReportCmd_10:
   \   00018C   EF           MOV     A,R7
   \   00018D   6062         JZ      ??simplemeter_ProcessInConfigReportCmd_12
   1696              {
   1697                cfgReportRspCmd->attrList[j].status = status;
   \   00018F   EF           MOV     A,R7
   \   000190   C0E0         PUSH    A
   \   000192   EE           MOV     A,R6
   \   000193   F8           MOV     R0,A
   \   000194   7900         MOV     R1,#0x0
   \   000196   E8           MOV     A,R0
   \   000197   75F004       MOV     B,#0x4
   \   00019A   A4           MUL     AB
   \   00019B   C8           XCH     A,R0
   \   00019C   AAF0         MOV     R2,B
   \   00019E   75F000       MOV     B,#0x0
   \   0001A1   A4           MUL     AB
   \   0001A2   2A           ADD     A,R2
   \   0001A3   FA           MOV     R2,A
   \   0001A4   75F004       MOV     B,#0x4
   \   0001A7   E9           MOV     A,R1
   \   0001A8   A4           MUL     AB
   \   0001A9   2A           ADD     A,R2
   \   0001AA   F9           MOV     R1,A
   \   0001AB   E5..         MOV     A,?V0 + 8
   \   0001AD   28           ADD     A,R0
   \   0001AE   F582         MOV     DPL,A
   \   0001B0   E5..         MOV     A,?V0 + 9
   \   0001B2   39           ADDC    A,R1
   \   0001B3   F583         MOV     DPH,A
   \   0001B5   A3           INC     DPTR
   \   0001B6   D0E0         POP     A
   \   0001B8   F0           MOVX    @DPTR,A
   1698                cfgReportRspCmd->attrList[j++].attrID = reportRec->attrID;
   \   0001B9   85..82       MOV     DPL,?V0 + 0
   \   0001BC   85..83       MOV     DPH,?V0 + 1
   \   0001BF   A3           INC     DPTR
   \   0001C0   E0           MOVX    A,@DPTR
   \   0001C1   FA           MOV     R2,A
   \   0001C2   A3           INC     DPTR
   \   0001C3   E0           MOVX    A,@DPTR
   \   0001C4   FB           MOV     R3,A
   \   0001C5   EE           MOV     A,R6
   \   0001C6   F8           MOV     R0,A
   \   0001C7   7900         MOV     R1,#0x0
   \   0001C9   E8           MOV     A,R0
   \   0001CA   75F004       MOV     B,#0x4
   \   0001CD   A4           MUL     AB
   \   0001CE   C8           XCH     A,R0
   \   0001CF   ACF0         MOV     R4,B
   \   0001D1   75F000       MOV     B,#0x0
   \   0001D4   A4           MUL     AB
   \   0001D5   2C           ADD     A,R4
   \   0001D6   FC           MOV     R4,A
   \   0001D7   75F004       MOV     B,#0x4
   \   0001DA   E9           MOV     A,R1
   \   0001DB   A4           MUL     AB
   \   0001DC   2C           ADD     A,R4
   \   0001DD   F9           MOV     R1,A
   \   0001DE   E5..         MOV     A,?V0 + 8
   \   0001E0   28           ADD     A,R0
   \   0001E1   F582         MOV     DPL,A
   \   0001E3   E5..         MOV     A,?V0 + 9
   \   0001E5   39           ADDC    A,R1
   \   0001E6   F583         MOV     DPH,A
   \   0001E8   A3           INC     DPTR
   \   0001E9   A3           INC     DPTR
   \   0001EA   A3           INC     DPTR
   \   0001EB   EA           MOV     A,R2
   \   0001EC   F0           MOVX    @DPTR,A
   \   0001ED   A3           INC     DPTR
   \   0001EE   EB           MOV     A,R3
   \   0001EF   F0           MOVX    @DPTR,A
   \   0001F0   0E           INC     R6
   1699              }
   1700            } // for loop
   \                     ??simplemeter_ProcessInConfigReportCmd_12:
   \   0001F1   05..         INC     ?V0 + 2
   \   0001F3   02....       LJMP    ??simplemeter_ProcessInConfigReportCmd_2 & 0xFFFF
   1701          
   1702            if ( j == 0 )
   \                     ??simplemeter_ProcessInConfigReportCmd_3:
   \   0001F6   EE           MOV     A,R6
   \   0001F7   7015         JNZ     ??simplemeter_ProcessInConfigReportCmd_13
   1703            {
   1704              // Since all attributes were configured successfully, include a single
   1705              // attribute status record in the response command with the status field
   1706              // set to SUCCESS and the attribute ID field omitted.
   1707              cfgReportRspCmd->attrList[0].status = ZCL_STATUS_SUCCESS;
   \   0001F9   85..82       MOV     DPL,?V0 + 8
   \   0001FC   85..83       MOV     DPH,?V0 + 9
   \   0001FF   A3           INC     DPTR
   \   000200   7400         MOV     A,#0x0
   \   000202   F0           MOVX    @DPTR,A
   1708              cfgReportRspCmd->numAttr = 1;
   \   000203   85..82       MOV     DPL,?V0 + 8
   \   000206   85..83       MOV     DPH,?V0 + 9
   \   000209   7401         MOV     A,#0x1
   \   00020B   F0           MOVX    @DPTR,A
   \   00020C   8008         SJMP    ??simplemeter_ProcessInConfigReportCmd_14
   1709            }
   1710            else
   1711            {
   1712              cfgReportRspCmd->numAttr = j;
   \                     ??simplemeter_ProcessInConfigReportCmd_13:
   \   00020E   EE           MOV     A,R6
   \   00020F   85..82       MOV     DPL,?V0 + 8
   \   000212   85..83       MOV     DPH,?V0 + 9
   \   000215   F0           MOVX    @DPTR,A
   1713            }
   1714          
   1715            // Send the response back
   1716            zcl_SendConfigReportRspCmd( SIMPLEMETER_ENDPOINT, &(pInMsg->srcAddr),
   1717                                        pInMsg->clusterId, cfgReportRspCmd, ZCL_FRAME_SERVER_CLIENT_DIR,
   1718                                        TRUE, pInMsg->zclHdr.transSeqNum );
   \                     ??simplemeter_ProcessInConfigReportCmd_14:
   \   000216                ; Setup parameters for call to function zcl_SendConfigReportRspCmd
   \   000216   85..82       MOV     DPL,?V0 + 4
   \   000219   85..83       MOV     DPH,?V0 + 5
   \   00021C   A3           INC     DPTR
   \   00021D   A3           INC     DPTR
   \   00021E   A3           INC     DPTR
   \   00021F   A3           INC     DPTR
   \   000220   A3           INC     DPTR
   \   000221   A3           INC     DPTR
   \   000222   E0           MOVX    A,@DPTR
   \   000223   F5..         MOV     ?V0 + 3,A
   \   000225   78..         MOV     R0,#?V0 + 3
   \   000227   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00022A   75..01       MOV     ?V0 + 3,#0x1
   \   00022D   78..         MOV     R0,#?V0 + 3
   \   00022F   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000232   75..01       MOV     ?V0 + 3,#0x1
   \   000235   78..         MOV     R0,#?V0 + 3
   \   000237   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00023A   78..         MOV     R0,#?V0 + 8
   \   00023C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00023F   85..82       MOV     DPL,?V0 + 4
   \   000242   85..83       MOV     DPH,?V0 + 5
   \   000245   A3           INC     DPTR
   \   000246   A3           INC     DPTR
   \   000247   A3           INC     DPTR
   \   000248   A3           INC     DPTR
   \   000249   A3           INC     DPTR
   \   00024A   A3           INC     DPTR
   \   00024B   A3           INC     DPTR
   \   00024C   A3           INC     DPTR
   \   00024D   E0           MOVX    A,@DPTR
   \   00024E   FC           MOV     R4,A
   \   00024F   A3           INC     DPTR
   \   000250   E0           MOVX    A,@DPTR
   \   000251   FD           MOV     R5,A
   \   000252   E5..         MOV     A,?V0 + 4
   \   000254   240A         ADD     A,#0xa
   \   000256   FA           MOV     R2,A
   \   000257   E5..         MOV     A,?V0 + 5
   \   000259   3400         ADDC    A,#0x0
   \   00025B   FB           MOV     R3,A
   \   00025C   7909         MOV     R1,#0x9
   \   00025E   12....       LCALL   ??zcl_SendConfigReportRspCmd?relay
   \   000261   7405         MOV     A,#0x5
   \   000263   12....       LCALL   ?DEALLOC_XSTACK8
   \   000266   E9           MOV     A,R1
   1719            osal_mem_free( cfgReportRspCmd );
   \   000267                ; Setup parameters for call to function osal_mem_free
   \   000267   AA..         MOV     R2,?V0 + 8
   \   000269   AB..         MOV     R3,?V0 + 9
   \   00026B   12....       LCALL   ??osal_mem_free?relay
   1720          
   1721            return TRUE ;
   \   00026E   7901         MOV     R1,#0x1
   \                     ??simplemeter_ProcessInConfigReportCmd_1:
   \   000270   7408         MOV     A,#0x8
   \   000272   12....       LCALL   ?DEALLOC_XSTACK8
   \   000275   7F0C         MOV     R7,#0xc
   \   000277   02....       LJMP    ?BANKED_LEAVE_XDATA
   1722          }
   1723          
   1724          /*********************************************************************
   1725           * @fn      simplemeter_ProcessInConfigReportRspCmd
   1726           *
   1727           * @brief   Process the "Profile" Configure Reporting Response Command
   1728           *
   1729           * @param   pInMsg - incoming message to process
   1730           *
   1731           * @return  none
   1732           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1733          static uint8 simplemeter_ProcessInConfigReportRspCmd( zclIncomingMsg_t *pInMsg )
   \                     simplemeter_ProcessInConfigReportRspCmd:
   1734          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 8
   \   000005   74F8         MOV     A,#-0x8
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
   1735            zclCfgReportRspCmd_t *cfgReportRspCmd;
   1736            zclAttrRec_t attrRec;
   1737            uint8 i;
   1738          
   1739            cfgReportRspCmd = (zclCfgReportRspCmd_t *)pInMsg->attrCmd;
   \   00000E   E5..         MOV     A,?V0 + 0
   \   000010   2417         ADD     A,#0x17
   \   000012   F582         MOV     DPL,A
   \   000014   E5..         MOV     A,?V0 + 1
   \   000016   3400         ADDC    A,#0x0
   \   000018   F583         MOV     DPH,A
   \   00001A   E0           MOVX    A,@DPTR
   \   00001B   F8           MOV     R0,A
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F9           MOV     R1,A
   \   00001F   E8           MOV     A,R0
   \   000020   FE           MOV     R6,A
   \   000021   E9           MOV     A,R1
   \   000022   FF           MOV     R7,A
   1740            for (i = 0; i < cfgReportRspCmd->numAttr; i++)
   \   000023   75..00       MOV     ?V0 + 2,#0x0
   \                     ??simplemeter_ProcessInConfigReportRspCmd_0:
   \   000026   8E82         MOV     DPL,R6
   \   000028   8F83         MOV     DPH,R7
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   F8           MOV     R0,A
   \   00002C   E5..         MOV     A,?V0 + 2
   \   00002E   C3           CLR     C
   \   00002F   98           SUBB    A,R0
   \   000030   505E         JNC     ??simplemeter_ProcessInConfigReportRspCmd_1
   1741            {
   1742              if ( zclFindAttrRec( SIMPLEMETER_ENDPOINT, pInMsg->clusterId,
   1743                                   cfgReportRspCmd->attrList[i].attrID, &attrRec ) )
   \   000032                ; Setup parameters for call to function zclFindAttrRec
   \   000032   85..82       MOV     DPL,?XSP + 0
   \   000035   85..83       MOV     DPH,?XSP + 1
   \   000038   8582..       MOV     ?V0 + 4,DPL
   \   00003B   8583..       MOV     ?V0 + 5,DPH
   \   00003E   78..         MOV     R0,#?V0 + 4
   \   000040   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000043   E5..         MOV     A,?V0 + 2
   \   000045   A8..         MOV     R0,?V0 + 2
   \   000047   7900         MOV     R1,#0x0
   \   000049   E8           MOV     A,R0
   \   00004A   75F004       MOV     B,#0x4
   \   00004D   A4           MUL     AB
   \   00004E   C8           XCH     A,R0
   \   00004F   AAF0         MOV     R2,B
   \   000051   75F000       MOV     B,#0x0
   \   000054   A4           MUL     AB
   \   000055   2A           ADD     A,R2
   \   000056   FA           MOV     R2,A
   \   000057   75F004       MOV     B,#0x4
   \   00005A   E9           MOV     A,R1
   \   00005B   A4           MUL     AB
   \   00005C   2A           ADD     A,R2
   \   00005D   F9           MOV     R1,A
   \   00005E   EE           MOV     A,R6
   \   00005F   28           ADD     A,R0
   \   000060   F582         MOV     DPL,A
   \   000062   EF           MOV     A,R7
   \   000063   39           ADDC    A,R1
   \   000064   F583         MOV     DPH,A
   \   000066   A3           INC     DPTR
   \   000067   A3           INC     DPTR
   \   000068   A3           INC     DPTR
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   FC           MOV     R4,A
   \   00006B   A3           INC     DPTR
   \   00006C   E0           MOVX    A,@DPTR
   \   00006D   FD           MOV     R5,A
   \   00006E   85..82       MOV     DPL,?V0 + 0
   \   000071   85..83       MOV     DPH,?V0 + 1
   \   000074   A3           INC     DPTR
   \   000075   A3           INC     DPTR
   \   000076   A3           INC     DPTR
   \   000077   A3           INC     DPTR
   \   000078   A3           INC     DPTR
   \   000079   A3           INC     DPTR
   \   00007A   A3           INC     DPTR
   \   00007B   A3           INC     DPTR
   \   00007C   E0           MOVX    A,@DPTR
   \   00007D   FA           MOV     R2,A
   \   00007E   A3           INC     DPTR
   \   00007F   E0           MOVX    A,@DPTR
   \   000080   FB           MOV     R3,A
   \   000081   7909         MOV     R1,#0x9
   \   000083   12....       LCALL   ??zclFindAttrRec?relay
   \   000086   7402         MOV     A,#0x2
   \   000088   12....       LCALL   ?DEALLOC_XSTACK8
   \   00008B   E9           MOV     A,R1
   1744              {
   1745                // Notify the device of success (or otherwise) of the its original configure
   1746                // reporting command, for each attribute.
   1747              }
   1748            }
   \   00008C   05..         INC     ?V0 + 2
   \   00008E   8096         SJMP    ??simplemeter_ProcessInConfigReportRspCmd_0
   1749          
   1750            return TRUE;
   \                     ??simplemeter_ProcessInConfigReportRspCmd_1:
   \   000090   7901         MOV     R1,#0x1
   \   000092   7408         MOV     A,#0x8
   \   000094   12....       LCALL   ?DEALLOC_XSTACK8
   \   000097   7F06         MOV     R7,#0x6
   \   000099   02....       LJMP    ?BANKED_LEAVE_XDATA
   1751          }
   1752          
   1753          /*********************************************************************
   1754           * @fn      simplemeter_ProcessInReadReportCfgCmd
   1755           *
   1756           * @brief   Process the "Profile" Read Reporting Configuration Command
   1757           *
   1758           * @param   pInMsg - incoming message to process
   1759           *
   1760           * @return  none
   1761           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1762          static uint8 simplemeter_ProcessInReadReportCfgCmd( zclIncomingMsg_t *pInMsg )
   \                     simplemeter_ProcessInReadReportCfgCmd:
   1763          {
   \   000000   74E8         MOV     A,#-0x18
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 24
   \   000005                ; Auto size: 10
   \   000005   74F6         MOV     A,#-0xa
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 6,R2
   \   00000C   8B..         MOV     ?V0 + 7,R3
   1764            zclReadReportCfgCmd_t *readReportCfgCmd;
   1765            zclReadReportCfgRspCmd_t *readReportCfgRspCmd;
   1766            zclReportCfgRspRec_t *reportRspRec;
   1767            zclAttrRec_t attrRec;
   1768            uint8 reportChangeLen;
   1769            uint8 *dataPtr;
   1770            uint8 hdrLen;
   1771            uint8 dataLen = 0;
   \   00000E   75..00       MOV     ?V0 + 1,#0x0
   1772            uint8 status;
   1773            uint8 i;
   1774          
   1775            readReportCfgCmd = (zclReadReportCfgCmd_t *)pInMsg->attrCmd;
   \   000011   E5..         MOV     A,?V0 + 6
   \   000013   2417         ADD     A,#0x17
   \   000015   F582         MOV     DPL,A
   \   000017   E5..         MOV     A,?V0 + 7
   \   000019   3400         ADDC    A,#0x0
   \   00001B   F583         MOV     DPH,A
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F8           MOV     R0,A
   \   00001F   A3           INC     DPTR
   \   000020   E0           MOVX    A,@DPTR
   \   000021   F9           MOV     R1,A
   \   000022   88..         MOV     ?V0 + 2,R0
   \   000024   89..         MOV     ?V0 + 3,R1
   1776          
   1777            // Find out the response length (Reportable Change field is of variable length)
   1778            for ( i = 0; i < readReportCfgCmd->numAttr; i++ )
   \   000026   7E00         MOV     R6,#0x0
   \                     ??simplemeter_ProcessInReadReportCfgCmd_0:
   \   000028   85..82       MOV     DPL,?V0 + 2
   \   00002B   85..83       MOV     DPH,?V0 + 3
   \   00002E   E0           MOVX    A,@DPTR
   \   00002F   F8           MOV     R0,A
   \   000030   EE           MOV     A,R6
   \   000031   C3           CLR     C
   \   000032   98           SUBB    A,R0
   \   000033   4003         JC      $+5
   \   000035   02....       LJMP    ??simplemeter_ProcessInReadReportCfgCmd_1 & 0xFFFF
   1779            {
   1780              // For supported attributes with 'analog' data type, find out the length of
   1781              // the Reportable Change field
   1782              if ( zclFindAttrRec( SIMPLEMETER_ENDPOINT, pInMsg->clusterId,
   1783                                   readReportCfgCmd->attrList[i].attrID, &attrRec ) )
   \   000038                ; Setup parameters for call to function zclFindAttrRec
   \   000038   7402         MOV     A,#0x2
   \   00003A   12....       LCALL   ?XSTACK_DISP0_8
   \   00003D   8582..       MOV     ?V0 + 8,DPL
   \   000040   8583..       MOV     ?V0 + 9,DPH
   \   000043   78..         MOV     R0,#?V0 + 8
   \   000045   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000048   EE           MOV     A,R6
   \   000049   F8           MOV     R0,A
   \   00004A   7900         MOV     R1,#0x0
   \   00004C   E8           MOV     A,R0
   \   00004D   75F003       MOV     B,#0x3
   \   000050   A4           MUL     AB
   \   000051   C8           XCH     A,R0
   \   000052   AAF0         MOV     R2,B
   \   000054   75F000       MOV     B,#0x0
   \   000057   A4           MUL     AB
   \   000058   2A           ADD     A,R2
   \   000059   FA           MOV     R2,A
   \   00005A   75F003       MOV     B,#0x3
   \   00005D   E9           MOV     A,R1
   \   00005E   A4           MUL     AB
   \   00005F   2A           ADD     A,R2
   \   000060   F9           MOV     R1,A
   \   000061   E5..         MOV     A,?V0 + 2
   \   000063   28           ADD     A,R0
   \   000064   F582         MOV     DPL,A
   \   000066   E5..         MOV     A,?V0 + 3
   \   000068   39           ADDC    A,R1
   \   000069   F583         MOV     DPH,A
   \   00006B   A3           INC     DPTR
   \   00006C   A3           INC     DPTR
   \   00006D   E0           MOVX    A,@DPTR
   \   00006E   FC           MOV     R4,A
   \   00006F   A3           INC     DPTR
   \   000070   E0           MOVX    A,@DPTR
   \   000071   FD           MOV     R5,A
   \   000072   85..82       MOV     DPL,?V0 + 6
   \   000075   85..83       MOV     DPH,?V0 + 7
   \   000078   A3           INC     DPTR
   \   000079   A3           INC     DPTR
   \   00007A   A3           INC     DPTR
   \   00007B   A3           INC     DPTR
   \   00007C   A3           INC     DPTR
   \   00007D   A3           INC     DPTR
   \   00007E   A3           INC     DPTR
   \   00007F   A3           INC     DPTR
   \   000080   E0           MOVX    A,@DPTR
   \   000081   FA           MOV     R2,A
   \   000082   A3           INC     DPTR
   \   000083   E0           MOVX    A,@DPTR
   \   000084   FB           MOV     R3,A
   \   000085   7909         MOV     R1,#0x9
   \   000087   12....       LCALL   ??zclFindAttrRec?relay
   \   00008A   7402         MOV     A,#0x2
   \   00008C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00008F   E9           MOV     A,R1
   \   000090   6028         JZ      ??simplemeter_ProcessInReadReportCfgCmd_2
   1784              {
   1785                if ( zclAnalogDataType( attrRec.attr.dataType ) )
   \   000092                ; Setup parameters for call to function zclAnalogDataType
   \   000092   7406         MOV     A,#0x6
   \   000094   12....       LCALL   ?XSTACK_DISP0_8
   \   000097   E0           MOVX    A,@DPTR
   \   000098   F9           MOV     R1,A
   \   000099   12....       LCALL   ??zclAnalogDataType?relay
   \   00009C   E9           MOV     A,R1
   \   00009D   601B         JZ      ??simplemeter_ProcessInReadReportCfgCmd_2
   1786                {
   1787                   reportChangeLen = zclGetDataTypeLength( attrRec.attr.dataType );
   \   00009F                ; Setup parameters for call to function zclGetDataTypeLength
   \   00009F   7406         MOV     A,#0x6
   \   0000A1   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A4   E0           MOVX    A,@DPTR
   \   0000A5   F9           MOV     R1,A
   \   0000A6   12....       LCALL   ??zclGetDataTypeLength?relay
   \   0000A9   E9           MOV     A,R1
   \   0000AA   FF           MOV     R7,A
   1788          
   1789                   // add padding if neede
   1790                   if ( PADDING_NEEDED( reportChangeLen ) )
   \   0000AB   EF           MOV     A,R7
   \   0000AC   75F002       MOV     B,#0x2
   \   0000AF   84           DIV     AB
   \   0000B0   E5F0         MOV     A,B
   \   0000B2   6001         JZ      ??simplemeter_ProcessInReadReportCfgCmd_3
   1791                     reportChangeLen++;
   \   0000B4   0F           INC     R7
   1792                   dataLen += reportChangeLen;
   \                     ??simplemeter_ProcessInReadReportCfgCmd_3:
   \   0000B5   EF           MOV     A,R7
   \   0000B6   25..         ADD     A,?V0 + 1
   \   0000B8   F5..         MOV     ?V0 + 1,A
   1793                }
   1794              }
   1795            }
   \                     ??simplemeter_ProcessInReadReportCfgCmd_2:
   \   0000BA   0E           INC     R6
   \   0000BB   02....       LJMP    ??simplemeter_ProcessInReadReportCfgCmd_0 & 0xFFFF
   1796          
   1797            hdrLen = sizeof( zclReadReportCfgRspCmd_t ) + ( readReportCfgCmd->numAttr * sizeof( zclReportCfgRspRec_t ) );
   \                     ??simplemeter_ProcessInReadReportCfgCmd_1:
   \   0000BE   75F00D       MOV     B,#0xd
   \   0000C1   85..82       MOV     DPL,?V0 + 2
   \   0000C4   85..83       MOV     DPH,?V0 + 3
   \   0000C7   E0           MOVX    A,@DPTR
   \   0000C8   A4           MUL     AB
   \   0000C9   2401         ADD     A,#0x1
   \   0000CB   F5..         MOV     ?V0 + 12,A
   1798          
   1799            // Allocate space for the response command
   1800            readReportCfgRspCmd = (zclReadReportCfgRspCmd_t *)osal_mem_alloc( hdrLen + dataLen );
   \   0000CD                ; Setup parameters for call to function osal_mem_alloc
   \   0000CD   85....       MOV     ?V0 + 10,?V0 + 12
   \   0000D0   75..00       MOV     ?V0 + 11,#0x0
   \   0000D3   85....       MOV     ?V0 + 8,?V0 + 1
   \   0000D6   75..00       MOV     ?V0 + 9,#0x0
   \   0000D9   E5..         MOV     A,?V0 + 10
   \   0000DB   25..         ADD     A,?V0 + 8
   \   0000DD   FA           MOV     R2,A
   \   0000DE   E5..         MOV     A,?V0 + 11
   \   0000E0   35..         ADDC    A,?V0 + 9
   \   0000E2   FB           MOV     R3,A
   \   0000E3   12....       LCALL   ??osal_mem_alloc?relay
   \   0000E6   8A..         MOV     ?V0 + 8,R2
   \   0000E8   8B..         MOV     ?V0 + 9,R3
   \   0000EA   85....       MOV     ?V0 + 4,?V0 + 8
   \   0000ED   85....       MOV     ?V0 + 5,?V0 + 9
   1801            if ( readReportCfgRspCmd == NULL )
   \   0000F0   E5..         MOV     A,?V0 + 4
   \   0000F2   45..         ORL     A,?V0 + 5
   \   0000F4   7005         JNZ     ??simplemeter_ProcessInReadReportCfgCmd_4
   1802              return FALSE; // EMBEDDED RETURN
   \   0000F6   7900         MOV     R1,#0x0
   \   0000F8   02....       LJMP    ??simplemeter_ProcessInReadReportCfgCmd_5 & 0xFFFF
   1803          
   1804            dataPtr = (uint8 *)( (uint8 *)readReportCfgRspCmd + hdrLen );
   \                     ??simplemeter_ProcessInReadReportCfgCmd_4:
   \   0000FB   85....       MOV     ?V0 + 8,?V0 + 12
   \   0000FE   75..00       MOV     ?V0 + 9,#0x0
   \   000101   E5..         MOV     A,?V0 + 4
   \   000103   25..         ADD     A,?V0 + 8
   \   000105   F8           MOV     R0,A
   \   000106   E5..         MOV     A,?V0 + 5
   \   000108   35..         ADDC    A,?V0 + 9
   \   00010A   F9           MOV     R1,A
   \   00010B   88..         MOV     ?V0 + 14,R0
   \   00010D   89..         MOV     ?V0 + 15,R1
   1805            readReportCfgRspCmd->numAttr = readReportCfgCmd->numAttr;
   \   00010F   85..82       MOV     DPL,?V0 + 2
   \   000112   85..83       MOV     DPH,?V0 + 3
   \   000115   E0           MOVX    A,@DPTR
   \   000116   85..82       MOV     DPL,?V0 + 4
   \   000119   85..83       MOV     DPH,?V0 + 5
   \   00011C   F0           MOVX    @DPTR,A
   1806            for (i = 0; i < readReportCfgCmd->numAttr; i++)
   \   00011D   7E00         MOV     R6,#0x0
   \                     ??simplemeter_ProcessInReadReportCfgCmd_6:
   \   00011F   85..82       MOV     DPL,?V0 + 2
   \   000122   85..83       MOV     DPH,?V0 + 3
   \   000125   E0           MOVX    A,@DPTR
   \   000126   F8           MOV     R0,A
   \   000127   EE           MOV     A,R6
   \   000128   C3           CLR     C
   \   000129   98           SUBB    A,R0
   \   00012A   4003         JC      $+5
   \   00012C   02....       LJMP    ??simplemeter_ProcessInReadReportCfgCmd_7 & 0xFFFF
   1807            {
   1808              reportRspRec = &(readReportCfgRspCmd->attrList[i]);
   \   00012F   EE           MOV     A,R6
   \   000130   F8           MOV     R0,A
   \   000131   7900         MOV     R1,#0x0
   \   000133   E8           MOV     A,R0
   \   000134   75F00D       MOV     B,#0xd
   \   000137   A4           MUL     AB
   \   000138   C8           XCH     A,R0
   \   000139   AAF0         MOV     R2,B
   \   00013B   75F000       MOV     B,#0x0
   \   00013E   A4           MUL     AB
   \   00013F   2A           ADD     A,R2
   \   000140   FA           MOV     R2,A
   \   000141   75F00D       MOV     B,#0xd
   \   000144   E9           MOV     A,R1
   \   000145   A4           MUL     AB
   \   000146   2A           ADD     A,R2
   \   000147   F9           MOV     R1,A
   \   000148   E5..         MOV     A,?V0 + 4
   \   00014A   28           ADD     A,R0
   \   00014B   F582         MOV     DPL,A
   \   00014D   E5..         MOV     A,?V0 + 5
   \   00014F   39           ADDC    A,R1
   \   000150   F583         MOV     DPH,A
   \   000152   A3           INC     DPTR
   \   000153   A882         MOV     R0,DPL
   \   000155   A983         MOV     R1,DPH
   \   000157   85..82       MOV     DPL,?XSP + 0
   \   00015A   85..83       MOV     DPH,?XSP + 1
   \   00015D   E8           MOV     A,R0
   \   00015E   F0           MOVX    @DPTR,A
   \   00015F   A3           INC     DPTR
   \   000160   E9           MOV     A,R1
   \   000161   F0           MOVX    @DPTR,A
   1809          
   1810              if ( zclFindAttrRec( SIMPLEMETER_ENDPOINT, pInMsg->clusterId,
   1811                                   readReportCfgCmd->attrList[i].attrID, &attrRec ) )
   \   000162                ; Setup parameters for call to function zclFindAttrRec
   \   000162   7402         MOV     A,#0x2
   \   000164   12....       LCALL   ?XSTACK_DISP0_8
   \   000167   8582..       MOV     ?V0 + 8,DPL
   \   00016A   8583..       MOV     ?V0 + 9,DPH
   \   00016D   78..         MOV     R0,#?V0 + 8
   \   00016F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000172   EE           MOV     A,R6
   \   000173   F8           MOV     R0,A
   \   000174   7900         MOV     R1,#0x0
   \   000176   E8           MOV     A,R0
   \   000177   75F003       MOV     B,#0x3
   \   00017A   A4           MUL     AB
   \   00017B   C8           XCH     A,R0
   \   00017C   AAF0         MOV     R2,B
   \   00017E   75F000       MOV     B,#0x0
   \   000181   A4           MUL     AB
   \   000182   2A           ADD     A,R2
   \   000183   FA           MOV     R2,A
   \   000184   75F003       MOV     B,#0x3
   \   000187   E9           MOV     A,R1
   \   000188   A4           MUL     AB
   \   000189   2A           ADD     A,R2
   \   00018A   F9           MOV     R1,A
   \   00018B   E5..         MOV     A,?V0 + 2
   \   00018D   28           ADD     A,R0
   \   00018E   F582         MOV     DPL,A
   \   000190   E5..         MOV     A,?V0 + 3
   \   000192   39           ADDC    A,R1
   \   000193   F583         MOV     DPH,A
   \   000195   A3           INC     DPTR
   \   000196   A3           INC     DPTR
   \   000197   E0           MOVX    A,@DPTR
   \   000198   FC           MOV     R4,A
   \   000199   A3           INC     DPTR
   \   00019A   E0           MOVX    A,@DPTR
   \   00019B   FD           MOV     R5,A
   \   00019C   85..82       MOV     DPL,?V0 + 6
   \   00019F   85..83       MOV     DPH,?V0 + 7
   \   0001A2   A3           INC     DPTR
   \   0001A3   A3           INC     DPTR
   \   0001A4   A3           INC     DPTR
   \   0001A5   A3           INC     DPTR
   \   0001A6   A3           INC     DPTR
   \   0001A7   A3           INC     DPTR
   \   0001A8   A3           INC     DPTR
   \   0001A9   A3           INC     DPTR
   \   0001AA   E0           MOVX    A,@DPTR
   \   0001AB   FA           MOV     R2,A
   \   0001AC   A3           INC     DPTR
   \   0001AD   E0           MOVX    A,@DPTR
   \   0001AE   FB           MOV     R3,A
   \   0001AF   7909         MOV     R1,#0x9
   \   0001B1   12....       LCALL   ??zclFindAttrRec?relay
   \   0001B4   7402         MOV     A,#0x2
   \   0001B6   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001B9   E9           MOV     A,R1
   \   0001BA   6068         JZ      ??simplemeter_ProcessInReadReportCfgCmd_8
   1812              {
   1813                if ( zcl_MandatoryReportableAttribute( &attrRec ) == TRUE )
   \   0001BC   7402         MOV     A,#0x2
   \   0001BE   12....       LCALL   ?XSTACK_DISP0_8
   \   0001C1   E582         MOV     A,DPL
   \   0001C3   4583         ORL     A,DPH
   \   0001C5   7058         JNZ     ??simplemeter_ProcessInReadReportCfgCmd_9
   1814                {
   1815                  // Get the Reporting Configuration
   1816                  // status = zclReadReportCfg( readReportCfgCmd->attrID[i], reportRspRec );
   1817                  status = ZCL_STATUS_UNREPORTABLE_ATTRIBUTE; // for now
   \   0001C7   75..8C       MOV     ?V0 + 0,#-0x74
   1818                  if ( status == ZCL_STATUS_SUCCESS && zclAnalogDataType( attrRec.attr.dataType ) )
   \   0001CA   E5..         MOV     A,?V0 + 0
   \   0001CC   7059         JNZ     ??simplemeter_ProcessInReadReportCfgCmd_10
   \   0001CE                ; Setup parameters for call to function zclAnalogDataType
   \   0001CE   7406         MOV     A,#0x6
   \   0001D0   12....       LCALL   ?XSTACK_DISP0_8
   \   0001D3   E0           MOVX    A,@DPTR
   \   0001D4   F9           MOV     R1,A
   \   0001D5   12....       LCALL   ??zclAnalogDataType?relay
   \   0001D8   E9           MOV     A,R1
   \   0001D9   604C         JZ      ??simplemeter_ProcessInReadReportCfgCmd_10
   1819                  {
   1820                    reportChangeLen = zclGetDataTypeLength( attrRec.attr.dataType );
   \   0001DB                ; Setup parameters for call to function zclGetDataTypeLength
   \   0001DB   7406         MOV     A,#0x6
   \   0001DD   12....       LCALL   ?XSTACK_DISP0_8
   \   0001E0   E0           MOVX    A,@DPTR
   \   0001E1   F9           MOV     R1,A
   \   0001E2   12....       LCALL   ??zclGetDataTypeLength?relay
   \   0001E5   E9           MOV     A,R1
   \   0001E6   FF           MOV     R7,A
   1821                    //osal_memcpy( dataPtr, pBuf, reportChangeLen );
   1822                    reportRspRec->reportableChange = dataPtr;
   \   0001E7   85..82       MOV     DPL,?XSP + 0
   \   0001EA   85..83       MOV     DPH,?XSP + 1
   \   0001ED   E0           MOVX    A,@DPTR
   \   0001EE   F8           MOV     R0,A
   \   0001EF   A3           INC     DPTR
   \   0001F0   E0           MOVX    A,@DPTR
   \   0001F1   C8           XCH     A,R0
   \   0001F2   240B         ADD     A,#0xb
   \   0001F4   F582         MOV     DPL,A
   \   0001F6   E8           MOV     A,R0
   \   0001F7   3400         ADDC    A,#0x0
   \   0001F9   F583         MOV     DPH,A
   \   0001FB   E5..         MOV     A,?V0 + 14
   \   0001FD   F0           MOVX    @DPTR,A
   \   0001FE   A3           INC     DPTR
   \   0001FF   E5..         MOV     A,?V0 + 15
   \   000201   F0           MOVX    @DPTR,A
   1823          
   1824                    // add padding if needed
   1825                    if ( PADDING_NEEDED( reportChangeLen ) )
   \   000202   EF           MOV     A,R7
   \   000203   75F002       MOV     B,#0x2
   \   000206   84           DIV     AB
   \   000207   E5F0         MOV     A,B
   \   000209   6001         JZ      ??simplemeter_ProcessInReadReportCfgCmd_11
   1826                      reportChangeLen++;
   \   00020B   0F           INC     R7
   1827                    dataPtr += reportChangeLen;
   \                     ??simplemeter_ProcessInReadReportCfgCmd_11:
   \   00020C   8F..         MOV     ?V0 + 8,R7
   \   00020E   75..00       MOV     ?V0 + 9,#0x0
   \   000211   E5..         MOV     A,?V0 + 14
   \   000213   25..         ADD     A,?V0 + 8
   \   000215   F5..         MOV     ?V0 + 14,A
   \   000217   E5..         MOV     A,?V0 + 15
   \   000219   35..         ADDC    A,?V0 + 9
   \   00021B   F5..         MOV     ?V0 + 15,A
   \   00021D   8008         SJMP    ??simplemeter_ProcessInReadReportCfgCmd_10
   1828                  }
   1829                }
   1830                else
   1831                {
   1832                  // Attribute not in the Mandatory Reportable Attribute list
   1833                  status = ZCL_STATUS_UNREPORTABLE_ATTRIBUTE;
   \                     ??simplemeter_ProcessInReadReportCfgCmd_9:
   \   00021F   75..8C       MOV     ?V0 + 0,#-0x74
   \   000222   8003         SJMP    ??simplemeter_ProcessInReadReportCfgCmd_10
   1834                }
   1835              }
   1836              else
   1837              {
   1838                // Attribute not found
   1839                status = ZCL_STATUS_UNSUPPORTED_ATTRIBUTE;
   \                     ??simplemeter_ProcessInReadReportCfgCmd_8:
   \   000224   75..86       MOV     ?V0 + 0,#-0x7a
   1840              }
   1841          
   1842              reportRspRec->status = status;
   \                     ??simplemeter_ProcessInReadReportCfgCmd_10:
   \   000227   E5..         MOV     A,?V0 + 0
   \   000229   85..82       MOV     DPL,?XSP + 0
   \   00022C   85..83       MOV     DPH,?XSP + 1
   \   00022F   E0           MOVX    A,@DPTR
   \   000230   F8           MOV     R0,A
   \   000231   A3           INC     DPTR
   \   000232   E0           MOVX    A,@DPTR
   \   000233   F583         MOV     DPH,A
   \   000235   8882         MOV     DPL,R0
   \   000237   E5..         MOV     A,?V0 + 0
   \   000239   F0           MOVX    @DPTR,A
   1843              reportRspRec->attrID = readReportCfgCmd->attrList[i].attrID;
   \   00023A   EE           MOV     A,R6
   \   00023B   F8           MOV     R0,A
   \   00023C   7900         MOV     R1,#0x0
   \   00023E   E8           MOV     A,R0
   \   00023F   75F003       MOV     B,#0x3
   \   000242   A4           MUL     AB
   \   000243   C8           XCH     A,R0
   \   000244   AAF0         MOV     R2,B
   \   000246   75F000       MOV     B,#0x0
   \   000249   A4           MUL     AB
   \   00024A   2A           ADD     A,R2
   \   00024B   FA           MOV     R2,A
   \   00024C   75F003       MOV     B,#0x3
   \   00024F   E9           MOV     A,R1
   \   000250   A4           MUL     AB
   \   000251   2A           ADD     A,R2
   \   000252   F9           MOV     R1,A
   \   000253   E5..         MOV     A,?V0 + 2
   \   000255   28           ADD     A,R0
   \   000256   F582         MOV     DPL,A
   \   000258   E5..         MOV     A,?V0 + 3
   \   00025A   39           ADDC    A,R1
   \   00025B   F583         MOV     DPH,A
   \   00025D   A3           INC     DPTR
   \   00025E   A3           INC     DPTR
   \   00025F   E0           MOVX    A,@DPTR
   \   000260   FA           MOV     R2,A
   \   000261   A3           INC     DPTR
   \   000262   E0           MOVX    A,@DPTR
   \   000263   FB           MOV     R3,A
   \   000264   85..82       MOV     DPL,?XSP + 0
   \   000267   85..83       MOV     DPH,?XSP + 1
   \   00026A   E0           MOVX    A,@DPTR
   \   00026B   F8           MOV     R0,A
   \   00026C   A3           INC     DPTR
   \   00026D   E0           MOVX    A,@DPTR
   \   00026E   F583         MOV     DPH,A
   \   000270   8882         MOV     DPL,R0
   \   000272   A3           INC     DPTR
   \   000273   A3           INC     DPTR
   \   000274   EA           MOV     A,R2
   \   000275   F0           MOVX    @DPTR,A
   \   000276   A3           INC     DPTR
   \   000277   EB           MOV     A,R3
   \   000278   F0           MOVX    @DPTR,A
   1844            }
   \   000279   0E           INC     R6
   \   00027A   02....       LJMP    ??simplemeter_ProcessInReadReportCfgCmd_6 & 0xFFFF
   1845          
   1846            // Send the response back
   1847            zcl_SendReadReportCfgRspCmd( SIMPLEMETER_ENDPOINT, &(pInMsg->srcAddr),
   1848                                         pInMsg->clusterId, readReportCfgRspCmd, ZCL_FRAME_SERVER_CLIENT_DIR,
   1849                                         TRUE, pInMsg->zclHdr.transSeqNum );
   \                     ??simplemeter_ProcessInReadReportCfgCmd_7:
   \   00027D                ; Setup parameters for call to function zcl_SendReadReportCfgRspCmd
   \   00027D   85..82       MOV     DPL,?V0 + 6
   \   000280   85..83       MOV     DPH,?V0 + 7
   \   000283   A3           INC     DPTR
   \   000284   A3           INC     DPTR
   \   000285   A3           INC     DPTR
   \   000286   A3           INC     DPTR
   \   000287   A3           INC     DPTR
   \   000288   A3           INC     DPTR
   \   000289   E0           MOVX    A,@DPTR
   \   00028A   F5..         MOV     ?V0 + 8,A
   \   00028C   78..         MOV     R0,#?V0 + 8
   \   00028E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000291   75..01       MOV     ?V0 + 8,#0x1
   \   000294   78..         MOV     R0,#?V0 + 8
   \   000296   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000299   75..01       MOV     ?V0 + 8,#0x1
   \   00029C   78..         MOV     R0,#?V0 + 8
   \   00029E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0002A1   78..         MOV     R0,#?V0 + 4
   \   0002A3   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0002A6   85..82       MOV     DPL,?V0 + 6
   \   0002A9   85..83       MOV     DPH,?V0 + 7
   \   0002AC   A3           INC     DPTR
   \   0002AD   A3           INC     DPTR
   \   0002AE   A3           INC     DPTR
   \   0002AF   A3           INC     DPTR
   \   0002B0   A3           INC     DPTR
   \   0002B1   A3           INC     DPTR
   \   0002B2   A3           INC     DPTR
   \   0002B3   A3           INC     DPTR
   \   0002B4   E0           MOVX    A,@DPTR
   \   0002B5   FC           MOV     R4,A
   \   0002B6   A3           INC     DPTR
   \   0002B7   E0           MOVX    A,@DPTR
   \   0002B8   FD           MOV     R5,A
   \   0002B9   E5..         MOV     A,?V0 + 6
   \   0002BB   240A         ADD     A,#0xa
   \   0002BD   FA           MOV     R2,A
   \   0002BE   E5..         MOV     A,?V0 + 7
   \   0002C0   3400         ADDC    A,#0x0
   \   0002C2   FB           MOV     R3,A
   \   0002C3   7909         MOV     R1,#0x9
   \   0002C5   12....       LCALL   ??zcl_SendReadReportCfgRspCmd?relay
   \   0002C8   7405         MOV     A,#0x5
   \   0002CA   12....       LCALL   ?DEALLOC_XSTACK8
   \   0002CD   E9           MOV     A,R1
   1850            osal_mem_free( readReportCfgRspCmd );
   \   0002CE                ; Setup parameters for call to function osal_mem_free
   \   0002CE   AA..         MOV     R2,?V0 + 4
   \   0002D0   AB..         MOV     R3,?V0 + 5
   \   0002D2   12....       LCALL   ??osal_mem_free?relay
   1851          
   1852            return TRUE;
   \   0002D5   7901         MOV     R1,#0x1
   \                     ??simplemeter_ProcessInReadReportCfgCmd_5:
   \   0002D7   740A         MOV     A,#0xa
   \   0002D9   12....       LCALL   ?DEALLOC_XSTACK8
   \   0002DC   7F10         MOV     R7,#0x10
   \   0002DE   02....       LJMP    ?BANKED_LEAVE_XDATA
   1853          }
   1854          
   1855          /*********************************************************************
   1856           * @fn      simplemeter_ProcessInReadReportCfgRspCmd
   1857           *
   1858           * @brief   Process the "Profile" Read Reporting Configuration Response Command
   1859           *
   1860           * @param   pInMsg - incoming message to process
   1861           *
   1862           * @return  none
   1863           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1864          static uint8 simplemeter_ProcessInReadReportCfgRspCmd( zclIncomingMsg_t *pInMsg )
   \                     simplemeter_ProcessInReadReportCfgRspCmd:
   1865          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1866            zclReadReportCfgRspCmd_t *readReportCfgRspCmd;
   1867            zclReportCfgRspRec_t *reportRspRec;
   1868            uint8 i;
   1869          
   1870            readReportCfgRspCmd = (zclReadReportCfgRspCmd_t *)pInMsg->attrCmd;
   \   000005   EA           MOV     A,R2
   \   000006   2417         ADD     A,#0x17
   \   000008   F582         MOV     DPL,A
   \   00000A   EB           MOV     A,R3
   \   00000B   3400         ADDC    A,#0x0
   \   00000D   F583         MOV     DPH,A
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   F8           MOV     R0,A
   \   000011   A3           INC     DPTR
   \   000012   E0           MOVX    A,@DPTR
   \   000013   F9           MOV     R1,A
   \   000014   E8           MOV     A,R0
   \   000015   FC           MOV     R4,A
   \   000016   E9           MOV     A,R1
   \   000017   FD           MOV     R5,A
   1871            for ( i = 0; i < readReportCfgRspCmd->numAttr; i++ )
   \   000018   7F00         MOV     R7,#0x0
   \                     ??simplemeter_ProcessInReadReportCfgRspCmd_0:
   \   00001A   8C82         MOV     DPL,R4
   \   00001C   8D83         MOV     DPH,R5
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   F8           MOV     R0,A
   \   000020   EF           MOV     A,R7
   \   000021   C3           CLR     C
   \   000022   98           SUBB    A,R0
   \   000023   5032         JNC     ??simplemeter_ProcessInReadReportCfgRspCmd_1
   1872            {
   1873              reportRspRec = &(readReportCfgRspCmd->attrList[i]);
   \   000025   EF           MOV     A,R7
   \   000026   F8           MOV     R0,A
   \   000027   7900         MOV     R1,#0x0
   \   000029   E8           MOV     A,R0
   \   00002A   75F00D       MOV     B,#0xd
   \   00002D   A4           MUL     AB
   \   00002E   F8           MOV     R0,A
   \   00002F   AEF0         MOV     R6,B
   \   000031   75F000       MOV     B,#0x0
   \   000034   A4           MUL     AB
   \   000035   2E           ADD     A,R6
   \   000036   FE           MOV     R6,A
   \   000037   75F00D       MOV     B,#0xd
   \   00003A   E9           MOV     A,R1
   \   00003B   A4           MUL     AB
   \   00003C   2E           ADD     A,R6
   \   00003D   F9           MOV     R1,A
   \   00003E   EC           MOV     A,R4
   \   00003F   28           ADD     A,R0
   \   000040   F582         MOV     DPL,A
   \   000042   ED           MOV     A,R5
   \   000043   39           ADDC    A,R1
   \   000044   F583         MOV     DPH,A
   \   000046   A3           INC     DPTR
   \   000047   8582..       MOV     ?V0 + 0,DPL
   \   00004A   8583..       MOV     ?V0 + 1,DPH
   1874          
   1875              // Notify the device of the results of the its original read reporting
   1876              // configuration command.
   1877          
   1878              if ( reportRspRec->status == ZCL_STATUS_SUCCESS )
   \   00004D   85..82       MOV     DPL,?V0 + 0
   \   000050   85..83       MOV     DPH,?V0 + 1
   \   000053   E0           MOVX    A,@DPTR
   1879              {
   1880                if ( reportRspRec->direction == ZCL_SEND_ATTR_REPORTS )
   1881                {
   1882                  // add user code here
   1883                }
   1884                else
   1885                {
   1886                  // expecting attribute reports
   1887                }
   1888              }
   1889            }
   \   000054   0F           INC     R7
   \   000055   80C3         SJMP    ??simplemeter_ProcessInReadReportCfgRspCmd_0
   1890          
   1891            return TRUE;
   \                     ??simplemeter_ProcessInReadReportCfgRspCmd_1:
   \   000057   7901         MOV     R1,#0x1
   \   000059   7F02         MOV     R7,#0x2
   \   00005B   02....       LJMP    ?BANKED_LEAVE_XDATA
   1892          }
   1893          
   1894          /*********************************************************************
   1895           * @fn      simplemeter_ProcessInReportCmd
   1896           *
   1897           * @brief   Process the "Profile" Report Command
   1898           *
   1899           * @param   pInMsg - incoming message to process
   1900           *
   1901           * @return  none
   1902           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1903          static uint8 simplemeter_ProcessInReportCmd( zclIncomingMsg_t *pInMsg )
   \                     simplemeter_ProcessInReportCmd:
   1904          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   1905            zclReportCmd_t *reportCmd;
   1906            uint8 i;
   1907          
   1908            reportCmd = (zclReportCmd_t *)pInMsg->attrCmd;
   \   000005   EA           MOV     A,R2
   \   000006   2417         ADD     A,#0x17
   \   000008   F582         MOV     DPL,A
   \   00000A   EB           MOV     A,R3
   \   00000B   3400         ADDC    A,#0x0
   \   00000D   F583         MOV     DPH,A
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   F8           MOV     R0,A
   \   000011   A3           INC     DPTR
   \   000012   E0           MOVX    A,@DPTR
   \   000013   F9           MOV     R1,A
   \   000014   E8           MOV     A,R0
   \   000015   FE           MOV     R6,A
   \   000016   E9           MOV     A,R1
   \   000017   FF           MOV     R7,A
   1909            for (i = 0; i < reportCmd->numAttr; i++)
   \   000018   7C00         MOV     R4,#0x0
   \                     ??simplemeter_ProcessInReportCmd_0:
   \   00001A   8E82         MOV     DPL,R6
   \   00001C   8F83         MOV     DPH,R7
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   F8           MOV     R0,A
   \   000020   EC           MOV     A,R4
   \   000021   C3           CLR     C
   \   000022   98           SUBB    A,R0
   \   000023   5003         JNC     ??simplemeter_ProcessInReportCmd_1
   \   000025   0C           INC     R4
   \   000026   80F2         SJMP    ??simplemeter_ProcessInReportCmd_0
   1910            {
   1911              // add user code here
   1912            }
   1913          
   1914            return TRUE;
   \                     ??simplemeter_ProcessInReportCmd_1:
   \   000028   7901         MOV     R1,#0x1
   \   00002A   7F01         MOV     R7,#0x1
   \   00002C   02....       LJMP    ?BANKED_LEAVE_XDATA
   1915          }
   1916          #endif // ZCL_REPORT
   1917          
   1918          /*********************************************************************
   1919           * @fn      simplemeter_ProcessInDefaultRspCmd
   1920           *
   1921           * @brief   Process the "Profile" Default Response Command
   1922           *
   1923           * @param   pInMsg - incoming message to process
   1924           *
   1925           * @return  none
   1926           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1927          static uint8 simplemeter_ProcessInDefaultRspCmd( zclIncomingMsg_t *pInMsg )
   \                     simplemeter_ProcessInDefaultRspCmd:
   1928          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   1929            // zclDefaultRspCmd_t *defaultRspCmd = (zclDefaultRspCmd_t *)pInMsg->attrCmd;
   1930          
   1931            // Device is notified of the Default Response command.
   1932          
   1933            return TRUE;
   \   000000   7901         MOV     R1,#0x1
   \   000002   02....       LJMP    ?BRET
   1934          }

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for numSeAttr>`:
   \   000000   05           DB 5

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for numBasicAttr>`:
   \   000000   02           DB 2

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for simplemeter_GenCmdCallbacks>`:
   \   000000   ....         DW ??simplemeter_BasicResetCB?relay
   \   000002   ....         DW ??simplemeter_IdentifyCB?relay
   \   000004   ....         DW ??simplemeter_IdentifyQueryRspCB?relay
   \   000006   0000         DW 0H
   \   000008   0000         DW 0H
   \   00000A   0000         DW 0H
   \   00000C   0000         DW 0H
   \   00000E   0000         DW 0H
   \   000010   0000         DW 0H
   \   000012   0000         DW 0H
   \   000014   0000         DW 0H
   \   000016   0000         DW 0H
   \   000018   ....         DW ??simplemeter_AlarmCB?relay
   \   00001A   0000         DW 0H
   \   00001C   0000         DW 0H

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for simplemeter_SECmdCallbacks>`:
   \   000000   0000         DW 0H
   \   000002   0000         DW 0H
   \   000004   0000         DW 0H
   \   000006   0000         DW 0H
   \   000008   0000         DW 0H
   \   00000A   0000         DW 0H
   \   00000C   0000         DW 0H
   \   00000E   0000         DW 0H
   \   000010   0000         DW 0H
   \   000012   0000         DW 0H
   \   000014   0000         DW 0H
   \   000016   ....         DW ??simplemeter_GetProfileRspCB?relay
   \   000018   0000         DW 0H
   \   00001A   0000         DW 0H
   \   00001C   0000         DW 0H
   \   00001E   ....         DW ??simplemeter_GetProfileCmdCB?relay
   \   000020   ....         DW ??simplemeter_ReqMirrorRspCB?relay
   \   000022   ....         DW ??simplemeter_MirrorRemRspCB?relay
   \   000024   0000         DW 0H
   \   000026   0000         DW 0H
   \   000028   0000         DW 0H
   \   00002A   0000         DW 0H
   \   00002C   0000         DW 0H
   \   00002E   0000         DW 0H
   \   000030   0000         DW 0H
   \   000032   0000         DW 0H
   \   000034   0000         DW 0H
   \   000036   0000         DW 0H
   \   000038   0000         DW 0H
   \   00003A   0000         DW 0H
   \   00003C   0000         DW 0H
   \   00003E   0000         DW 0H
   \   000040   0000         DW 0H

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_event_loop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_ProcessZDOMsgs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_ProcessZDOMsgs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_ProcessIdentifyTimeChange?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_ProcessIdentifyTimeChange

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_HandleKeys?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_HandleKeys

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_ValidateAttrDataCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_ValidateAttrDataCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_BasicResetCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_BasicResetCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_IdentifyCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_IdentifyCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_IdentifyQueryRspCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_IdentifyQueryRspCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_AlarmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_AlarmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_GetProfileCmdCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_GetProfileCmdCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_GetProfileRspCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_GetProfileRspCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_ReqMirrorRspCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_ReqMirrorRspCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_MirrorRemRspCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_MirrorRemRspCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_ProcessZCLMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_ProcessZCLMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_ProcessInReadRspCmd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_ProcessInReadRspCmd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_ProcessInWriteRspCmd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_ProcessInWriteRspCmd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_ProcessInConfigReportCmd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_ProcessInConfigReportCmd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_ProcessInConfigReportRspCmd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_ProcessInConfigReportRspCmd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_ProcessInReadReportCfgCmd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_ProcessInReadReportCfgCmd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_ProcessInReadReportCfgRspCmd?rela:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_ProcessInReadReportCfgRspCmd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_ProcessInReportCmd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_ProcessInReportCmd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??simplemeter_ProcessInDefaultRspCmd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    simplemeter_ProcessInDefaultRspCmd

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant {10485761L, 10485762L, 10485763L, 1`:
   \   000000   0100A000     DD 10485761
   \   000004   0200A000     DD 10485762
   \   000008   0300A000     DD 10485763
   \   00000C   0400A000     DD 10485764
   \   000010   0500A000     DD 10485765
   1935          
   1936          #if defined ( ZCL_DISCOVER )
   1937          /*********************************************************************
   1938           * @fn      simplemeter_ProcessInDiscRspCmd
   1939           *
   1940           * @brief   Process the "Profile" Discover Response Command
   1941           *
   1942           * @param   pInMsg - incoming message to process
   1943           *
   1944           * @return  none
   1945           */
   1946          static uint8 simplemeter_ProcessInDiscRspCmd( zclIncomingMsg_t *pInMsg )
   1947          {
   1948            zclDiscoverRspCmd_t *discoverRspCmd;
   1949            uint8 i;
   1950          
   1951            discoverRspCmd = (zclDiscoverRspCmd_t *)pInMsg->attrCmd;
   1952            for ( i = 0; i < discoverRspCmd->numAttr; i++ )
   1953            {
   1954              // Device is notified of the result of its attribute discovery command.
   1955            }
   1956          
   1957            return TRUE;
   1958          }
   1959          #endif // ZCL_DISCOVER
   1960          
   1961          /****************************************************************************
   1962          ****************************************************************************/

   Maximum stack usage in bytes:

   ISTACK PSTACK XSTACK Function
   ------ ------ ------ --------
       0      0      0  simplemeter_AlarmCB
       0      0      0  simplemeter_BasicResetCB
       2      0     51  simplemeter_GetProfileCmdCB
                          0 0 51 -> zclSE_SimpleMetering_Send_GetProfileRsp
       0      0      0  simplemeter_GetProfileRspCB
       0      0     35  simplemeter_HandleKeys
                          0 0 10 -> ZDOInitDevice
                          0 0 21 -> zcl_SendCommand
       0      0      9  simplemeter_IdentifyCB
                          0 0  9 -> simplemeter_ProcessIdentifyTimeChange
       0      0      0  simplemeter_IdentifyQueryRspCB
       1      0      9  simplemeter_Init
                          0 0  9 -> RegisterForKeys
                          0 0  9 -> ZDOInitDevice
                          0 0  9 -> ZDO_RegisterForZDOMsg
                          0 0  9 -> osal_mem_alloc
                          0 0  9 -> osal_start_timerEx
                          0 0  9 -> zclGeneral_RegisterCmdCallbacks
                          0 0  9 -> zclSE_Init
                          0 0  9 -> zclSE_RegisterCmdCallbacks
                          0 0  9 -> zcl_registerAttrList
                          0 0  9 -> zcl_registerClusterOptionList
                          0 0  9 -> zcl_registerForMsg
                          0 0  9 -> zcl_registerValidateAttrData
       0      0     11  simplemeter_MirrorRemRspCB
                          0 0 11 -> osal_stop_timerEx
       2      0     14  simplemeter_ProcessIdentifyTimeChange
                          2 0  0 -> HalLedBlink
                          2 0  0 -> HalLedSet
                          2 0  0 -> osal_start_timerEx
                          2 0  0 -> osal_stop_timerEx
       2      0     42  simplemeter_ProcessInConfigReportCmd
                          0 0 28 -> osal_mem_alloc
                          0 0 28 -> osal_mem_free
                          0 0 30 -> zclFindAttrRec
                          0 0 33 -> zcl_SendConfigReportRspCmd
       0      0     33  simplemeter_ProcessInConfigReportRspCmd
                          0 0 24 -> zclFindAttrRec
       0      0      9  simplemeter_ProcessInDefaultRspCmd
       1      0     48  simplemeter_ProcessInReadReportCfgCmd
                          0 0 34 -> osal_mem_alloc
                          0 0 34 -> osal_mem_free
                          0 0 34 -> zclAnalogDataType
                          0 0 36 -> zclFindAttrRec
                          0 0 34 -> zclGetDataTypeLength
                          0 0 39 -> zcl_SendReadReportCfgRspCmd
       0      0     19  simplemeter_ProcessInReadReportCfgRspCmd
       0      0     18  simplemeter_ProcessInReadRspCmd
       0      0     18  simplemeter_ProcessInReportCmd
       0      0     18  simplemeter_ProcessInWriteRspCmd
       0      0     23  simplemeter_ProcessZCLMsg
                          0 0  9 -> osal_mem_free
                          0 0  9 -> simplemeter_ProcessInConfigReportCmd
                          0 0  9 -> simplemeter_ProcessInConfigReportRspCmd
                          0 0  9 -> simplemeter_ProcessInDefaultRspCmd
                          0 0  9 -> simplemeter_ProcessInReadReportCfgCmd
                          0 0  9 -> simplemeter_ProcessInReadReportCfgRspCmd
                          0 0  9 -> simplemeter_ProcessInReadRspCmd
                          0 0  9 -> simplemeter_ProcessInReportCmd
                          0 0  9 -> simplemeter_ProcessInWriteRspCmd
       0      0     26  simplemeter_ProcessZDOMsgs
                          0 0 12 -> ZDO_ParseEPListRsp
                          0 0 12 -> osal_mem_free
                          0 0 12 -> osal_set_event
       0      0      0  simplemeter_ReqMirrorRspCB
       2      0      0  simplemeter_ValidateAttrDataCB
       0      0     19  simplemeter_event_loop
                          0 0 14 -> NLME_SetPollRate
                          0 0 14 -> osal_getClock
                          0 0 14 -> osal_msg_deallocate
                          0 0 14 -> osal_msg_receive
                          0 0 14 -> osal_set_event
                          0 0 14 -> osal_start_timerEx
                          0 0 14 -> simplemeter_HandleKeys
                          0 0 14 -> simplemeter_ProcessIdentifyTimeChange
                          0 0 14 -> simplemeter_ProcessZCLMsg
                          0 0 14 -> simplemeter_ProcessZDOMsgs
                          0 0 14 -> zclGeneral_KeyEstablish_InitiateKeyEstablishment
                          0 0 19 -> zcl_SendReportCmd


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
      20  ?<Constant {10485761L, 10485762L, 10485763L, 1
       1  ?<Initializer for numBasicAttr>
       1  ?<Initializer for numSeAttr>
      30  ?<Initializer for simplemeter_GenCmdCallbacks>
      66  ?<Initializer for simplemeter_SECmdCallbacks>
       6  ??simplemeter_AlarmCB?relay
       6  ??simplemeter_BasicResetCB?relay
       6  ??simplemeter_GetProfileCmdCB?relay
       6  ??simplemeter_GetProfileRspCB?relay
       6  ??simplemeter_HandleKeys?relay
       6  ??simplemeter_IdentifyCB?relay
       6  ??simplemeter_IdentifyQueryRspCB?relay
       6  ??simplemeter_Init?relay
       6  ??simplemeter_MirrorRemRspCB?relay
       6  ??simplemeter_ProcessIdentifyTimeChange?relay
       6  ??simplemeter_ProcessInConfigReportCmd?relay
       6  ??simplemeter_ProcessInConfigReportRspCmd?relay
       6  ??simplemeter_ProcessInDefaultRspCmd?relay
       6  ??simplemeter_ProcessInReadReportCfgCmd?relay
       6  ??simplemeter_ProcessInReadReportCfgRspCmd?rela
       6  ??simplemeter_ProcessInReadRspCmd?relay
       6  ??simplemeter_ProcessInReportCmd?relay
       6  ??simplemeter_ProcessInWriteRspCmd?relay
       6  ??simplemeter_ProcessZCLMsg?relay
       6  ??simplemeter_ProcessZDOMsgs?relay
       6  ??simplemeter_ReqMirrorRspCB?relay
       6  ??simplemeter_ValidateAttrDataCB?relay
       6  ??simplemeter_event_loop?relay
      12  ESPAddr
       1  numBasicAttr
       1  numSeAttr
       2  pBasicReportCmd
       2  pSeReportCmd
       1  simpleMeterTaskID
       1  simpleMeterTransID
       3  simplemeter_AlarmCB
       3  simplemeter_BasicResetCB
      30  simplemeter_GenCmdCallbacks
     152  simplemeter_GetProfileCmdCB
       3  simplemeter_GetProfileRspCB
     163  simplemeter_HandleKeys
      36  simplemeter_IdentifyCB
       3  simplemeter_IdentifyQueryRspCB
     777  simplemeter_Init
      33  simplemeter_MirrorRemRspCB
      76  simplemeter_ProcessIdentifyTimeChange
     634  simplemeter_ProcessInConfigReportCmd
     156  simplemeter_ProcessInConfigReportRspCmd
       5  simplemeter_ProcessInDefaultRspCmd
     737  simplemeter_ProcessInReadReportCfgCmd
      94  simplemeter_ProcessInReadReportCfgRspCmd
      47  simplemeter_ProcessInReadRspCmd
      47  simplemeter_ProcessInReportCmd
      47  simplemeter_ProcessInWriteRspCmd
     186  simplemeter_ProcessZCLMsg
     124  simplemeter_ProcessZDOMsgs
       3  simplemeter_ReqMirrorRspCB
      66  simplemeter_SECmdCallbacks
      64  simplemeter_ValidateAttrDataCB
     472  simplemeter_event_loop

 
 3 865 bytes in segment BANKED_CODE
   138 bytes in segment BANK_RELAYS
    98 bytes in segment XDATA_I
    98 bytes in segment XDATA_ID
    20 bytes in segment XDATA_ROM_C
    18 bytes in segment XDATA_Z
 
 4 101 bytes of CODE  memory
    20 bytes of CONST memory
   116 bytes of XDATA memory

Errors: none
Warnings: none
